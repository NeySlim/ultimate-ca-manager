import{j as e,R as Q,L as W,T as S,C as k}from"./radix-B6Y-MRu0.js";import{a as u}from"./vendor-DEQSVNfj.js";import{m as z}from"./ArrowsClockwise.es-DS70dwCP.js";import{C as X,a as Z,e as ee,b as w,c as N,d as i}from"./DetailCard-BKBzFg8i.js";import{c as ae,a as j,I as o,A as te,B as p,k as P,x as D,C as se,i as le,j as re,n as ne}from"./index-vswyqp58.js";import{a as I,b as F}from"./Globe.es-CtUoIY1T.js";import{c as E}from"./Lightning.es-C-Sz8AXK.js";import{a as O}from"./PencilSimple.es-CJefJBPq.js";import{n as oe}from"./Plus.es-DN9hvW10.js";import{n as U}from"./TestTube.es-BJzbVb1c.js";import{n as $}from"./Trash.es-DhgoD9TD.js";import{P as ie}from"./PageLayout-Dh0KLD48.js";import{M as ce}from"./Modal-7_eTIvz3.js";import{B as A}from"./Badge-CZ5NzBfK.js";import{E as de}from"./EmptyState-B4dAc_K5.js";import{S as R}from"./Select-PwXyFoxR.js";import{T as ue}from"./Textarea-DuI5mbE0.js";import{H as me}from"./HelpCard-BINCqYIf.js";import"./CaretDown.es-DuThAI6u.js";import"./Fingerprint.es-a52JDt2Q.js";import"./ui-bTlm5Mct.js";import"./ArrowLeft.es-CZcTzWfI.js";import"./HelpModal-BnkmCwhU.js";const pe=[{value:"ldap",label:"LDAP / Active Directory",icon:F},{value:"oauth2",label:"OAuth2 / OIDC",icon:I},{value:"saml",label:"SAML 2.0",icon:D}],M={ldap:F,oauth2:I,saml:D};function Ie(){const[a,h]=u.useState([]),[n,s]=u.useState(null),[x,d]=u.useState(!0),[v,r]=u.useState(!1),[_,t]=u.useState("create"),[m,f]=u.useState(!1),[b,B]=u.useState(""),{showSuccess:y,showError:g}=ae();u.useEffect(()=>{C()},[]);const C=async()=>{try{const l=await j.get("/sso/providers");h(l.data||[]),l.data?.length>0&&!n&&s(l.data[0])}catch{g("Failed to load SSO providers","error")}finally{d(!1)}},L=()=>{s(null),t("create"),r(!0)},V=l=>{s(l),t("edit"),r(!0)},H=async l=>{if(confirm(`Delete SSO provider "${l.name}"?`))try{await j.delete(`/sso/providers/${l.id}`),y("Provider deleted"),C(),s(null)}catch{g("Failed to delete provider","error")}},Y=async l=>{try{await j.post(`/sso/providers/${l.id}/toggle`),y(`Provider ${l.enabled?"disabled":"enabled"}`),C()}catch{g("Failed to toggle provider","error")}},G=async l=>{f(!0);try{const c=await j.post(`/sso/providers/${l.id}/test`);c.data?.status==="success"?y(c.data.message||"Connection successful"):g(c.message||"Test failed")}catch(c){g(c.message||"Connection test failed")}finally{f(!1)}},q=async l=>{try{_==="create"?(await j.post("/sso/providers",l),y("Provider created")):(await j.put(`/sso/providers/${n.id}`,l),y("Provider updated")),r(!1),C()}catch(c){g(c.message||"Failed to save provider")}},T=a.filter(l=>l.name?.toLowerCase().includes(b.toLowerCase())||l.display_name?.toLowerCase().includes(b.toLowerCase())),J=e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(o,{placeholder:"Search providers...",value:b,onChange:l=>B(l.target.value),icon:e.jsx(te,{size:14}),className:"w-64"}),e.jsxs(p,{onClick:L,children:[e.jsx(oe,{size:14}),"New Provider"]})]}),x?e.jsx("div",{className:"p-8 text-center text-text-secondary",children:"Loading..."}):T.length===0?e.jsx(de,{icon:P,title:b?"No matches":"No SSO providers",description:b?"Try a different search":"Add LDAP, OAuth2, or SAML providers",action:b?void 0:{label:"Add Provider",onClick:L}}):e.jsx("div",{className:"grid gap-3 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:T.map(l=>{const c=M[l.provider_type]||P;return e.jsx(se,{className:`cursor-pointer transition-all ${n?.id===l.id?"ring-2 ring-accent-primary bg-accent-primary/5":"hover:bg-bg-tertiary"}`,onClick:()=>s(l),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${n?.id===l.id?"bg-accent-primary/20":"bg-bg-tertiary"}`,children:e.jsx(c,{size:20,className:n?.id===l.id?"text-accent-primary":"text-text-tertiary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-text-primary truncate",children:l.display_name||l.name}),l.enabled?e.jsx(le,{size:16,className:"status-success-text shrink-0",weight:"fill"}):e.jsx(re,{size:16,className:"text-text-tertiary shrink-0"})]}),e.jsx("p",{className:"text-xs text-text-tertiary mt-0.5",children:l.provider_type?.toUpperCase()||"Unknown"})]})]})},l.id)})}),e.jsxs("div",{className:"mt-4 text-xs text-text-tertiary",children:[a.length," provider",a.length!==1?"s":""]})]}),K=n?e.jsx(he,{provider:n,onEdit:()=>V(n),onDelete:()=>H(n),onToggle:()=>Y(n),onTest:()=>G(n),testing:m}):e.jsx("div",{className:"flex items-center justify-center h-full p-4 text-text-secondary",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{size:40,className:"mx-auto mb-3 text-text-tertiary"}),e.jsx("p",{className:"text-sm",children:"Select a provider to view details"})]})});return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"SSO Providers",focusTitle:"Provider Details",focusContent:K,focusCollapsible:!0,focusDefaultOpen:!0,children:J}),v&&e.jsx(xe,{provider:_==="edit"?n:null,onSave:q,onClose:()=>r(!1)})]})}function he({provider:a,onEdit:h,onDelete:n,onToggle:s,onTest:x,testing:d}){const v=M[a.provider_type]||P;return d?z:U,a.enabled,E,O,$,e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs(me,{variant:"info",title:"Single Sign-On",compact:!0,className:"mb-3",children:["Configure ",a.provider_type?.toUpperCase()," for centralized authentication and user provisioning."]}),e.jsx(X,{icon:v,iconClass:a.enabled?"bg-status-success/20":"bg-bg-tertiary",title:a.display_name||a.name,subtitle:`${a.provider_type?.toUpperCase()||"Unknown"} Provider`,badge:e.jsx(A,{variant:a.enabled?"success":"secondary",size:"sm",children:a.enabled?"Enabled":"Disabled"})}),e.jsx(Z,{stats:[{icon:ee,value:a.created_at?new Date(a.created_at).toLocaleDateString():"—"},...a.last_used_at?[{icon:ne,value:new Date(a.last_used_at).toLocaleDateString()}]:[]]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(p,{size:"sm",variant:"secondary",onClick:x,disabled:d,children:[d?e.jsx(z,{size:14,className:"animate-spin"}):e.jsx(U,{size:14}),d?"Testing...":"Test"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:s,children:[e.jsx(E,{size:14}),a.enabled?"Disable":"Enable"]}),e.jsx(p,{size:"sm",variant:"secondary",onClick:h,children:e.jsx(O,{size:14})}),e.jsx(p,{size:"sm",variant:"danger",onClick:n,children:e.jsx($,{size:14})})]}),e.jsxs(w,{title:"Configuration",children:[a.provider_type==="ldap"&&e.jsxs(N,{children:[e.jsx(i,{label:"Server",value:`${a.ldap_server}:${a.ldap_port}`,mono:!0,copyable:!0}),e.jsx(i,{label:"SSL/TLS",value:a.ldap_use_ssl?"Enabled":"Disabled"}),e.jsx(i,{label:"Base DN",value:a.ldap_base_dn,mono:!0,copyable:!0}),e.jsx(i,{label:"User Filter",value:a.ldap_user_filter,mono:!0})]}),a.provider_type==="oauth2"&&e.jsxs(N,{children:[e.jsx(i,{label:"Client ID",value:a.oauth2_client_id,mono:!0,copyable:!0}),e.jsx(i,{label:"Scopes",value:a.oauth2_scopes?.join(", ")}),e.jsx(i,{label:"Authorization URL",value:a.oauth2_auth_url,mono:!0,copyable:!0}),e.jsx(i,{label:"Token URL",value:a.oauth2_token_url,mono:!0,copyable:!0})]}),a.provider_type==="saml"&&e.jsxs(N,{children:[e.jsx(i,{label:"Entity ID",value:a.saml_entity_id,mono:!0,copyable:!0}),e.jsx(i,{label:"SSO URL",value:a.saml_sso_url,mono:!0,copyable:!0}),e.jsx(i,{label:"SLO URL",value:a.saml_slo_url||"—",mono:!0}),e.jsx(i,{label:"Certificate",value:a.saml_certificate?"✓ Configured":"✗ Missing"})]})]}),e.jsx(w,{title:"User Provisioning",children:e.jsxs(N,{cols:3,children:[e.jsx(i,{label:"Auto-create",value:a.auto_create_users?"Yes":"No"}),e.jsx(i,{label:"Auto-update",value:a.auto_update_users?"Yes":"No"}),e.jsx(i,{label:"Default role",value:a.default_role||"viewer"})]})}),a.role_mapping&&Object.keys(a.role_mapping).length>0&&e.jsx(w,{title:"Role Mapping",collapsible:!0,children:e.jsx("div",{className:"space-y-2",children:Object.entries(a.role_mapping).map(([r,_])=>e.jsxs("div",{className:"flex items-center justify-between text-xs p-2 rounded bg-bg-tertiary/50 border border-border",children:[e.jsx("span",{className:"text-text-secondary font-mono",children:r}),e.jsx("span",{className:"text-text-tertiary",children:"→"}),e.jsx(A,{variant:"secondary",size:"sm",children:_})]},r))})})]})}function xe({provider:a,onSave:h,onClose:n}){const[s,x]=u.useState({name:a?.name||"",display_name:a?.display_name||"",provider_type:a?.provider_type||"ldap",enabled:a?.enabled??!1,default_role:a?.default_role||"viewer",auto_create_users:a?.auto_create_users??!0,auto_update_users:a?.auto_update_users??!0,ldap_server:a?.ldap_server||"",ldap_port:a?.ldap_port||389,ldap_use_ssl:a?.ldap_use_ssl??!1,ldap_bind_dn:a?.ldap_bind_dn||"",ldap_bind_password:"",ldap_base_dn:a?.ldap_base_dn||"",ldap_user_filter:a?.ldap_user_filter||"(uid={username})",oauth2_client_id:a?.oauth2_client_id||"",oauth2_client_secret:"",oauth2_auth_url:a?.oauth2_auth_url||"",oauth2_token_url:a?.oauth2_token_url||"",oauth2_userinfo_url:a?.oauth2_userinfo_url||"",oauth2_scopes:a?.oauth2_scopes?.join(" ")||"openid profile email",saml_entity_id:a?.saml_entity_id||"",saml_sso_url:a?.saml_sso_url||"",saml_slo_url:a?.saml_slo_url||"",saml_certificate:a?.saml_certificate||""}),[d,v]=u.useState("general"),r=(t,m)=>{x(f=>({...f,[t]:m}))},_=t=>{t.preventDefault();const m={...s};m.provider_type==="oauth2"&&(m.oauth2_scopes=m.oauth2_scopes.split(/\s+/).filter(Boolean)),h(m)};return e.jsx(ce,{open:!0,onClose:n,title:a?"Edit SSO Provider":"New SSO Provider",size:"lg",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs(Q,{value:d,onValueChange:v,children:[e.jsxs(W,{className:"flex gap-1 border-b border-border mb-4",children:[e.jsx(S,{value:"general",className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary data-[state=active]:text-accent-primary data-[state=active]:border-b-2 data-[state=active]:border-accent-primary",children:"General"}),e.jsx(S,{value:"connection",className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary data-[state=active]:text-accent-primary data-[state=active]:border-b-2 data-[state=active]:border-accent-primary",children:"Connection"}),e.jsx(S,{value:"provisioning",className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary data-[state=active]:text-accent-primary data-[state=active]:border-b-2 data-[state=active]:border-accent-primary",children:"Provisioning"})]}),e.jsxs(k,{value:"general",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Provider Name",value:s.name,onChange:t=>r("name",t.target.value),required:!0,placeholder:"e.g., corporate-ldap"}),e.jsx(o,{label:"Display Name",value:s.display_name,onChange:t=>r("display_name",t.target.value),placeholder:"e.g., Corporate Directory"})]}),!a&&e.jsx(R,{label:"Provider Type",value:s.provider_type,onChange:t=>r("provider_type",t),options:pe}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:t=>r("enabled",t.target.checked),className:"rounded"}),"Enable provider"]})})]}),e.jsxs(k,{value:"connection",className:"space-y-4 mt-4",children:[s.provider_type==="ldap"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{label:"LDAP Server",value:s.ldap_server,onChange:t=>r("ldap_server",t.target.value),placeholder:"ldap.example.com",className:"col-span-2"}),e.jsx(o,{label:"Port",type:"number",value:s.ldap_port,onChange:t=>r("ldap_port",parseInt(t.target.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.ldap_use_ssl,onChange:t=>r("ldap_use_ssl",t.target.checked),className:"rounded"}),"Use SSL/TLS"]}),e.jsx(o,{label:"Bind DN",value:s.ldap_bind_dn,onChange:t=>r("ldap_bind_dn",t.target.value),placeholder:"cn=admin,dc=example,dc=com"}),e.jsx(o,{label:"Bind Password",type:"password",value:s.ldap_bind_password,onChange:t=>r("ldap_bind_password",t.target.value),placeholder:a?"••••••• (leave empty to keep)":""}),e.jsx(o,{label:"Base DN",value:s.ldap_base_dn,onChange:t=>r("ldap_base_dn",t.target.value),placeholder:"dc=example,dc=com"}),e.jsx(o,{label:"User Filter",value:s.ldap_user_filter,onChange:t=>r("ldap_user_filter",t.target.value),placeholder:"(uid={username})"})]}),s.provider_type==="oauth2"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Client ID",value:s.oauth2_client_id,onChange:t=>r("oauth2_client_id",t.target.value)}),e.jsx(o,{label:"Client Secret",type:"password",value:s.oauth2_client_secret,onChange:t=>r("oauth2_client_secret",t.target.value),placeholder:a?"••••••• (leave empty to keep)":""}),e.jsx(o,{label:"Authorization URL",value:s.oauth2_auth_url,onChange:t=>r("oauth2_auth_url",t.target.value),placeholder:"https://provider.com/oauth/authorize"}),e.jsx(o,{label:"Token URL",value:s.oauth2_token_url,onChange:t=>r("oauth2_token_url",t.target.value),placeholder:"https://provider.com/oauth/token"}),e.jsx(o,{label:"User Info URL",value:s.oauth2_userinfo_url,onChange:t=>r("oauth2_userinfo_url",t.target.value),placeholder:"https://provider.com/oauth/userinfo"}),e.jsx(o,{label:"Scopes",value:s.oauth2_scopes,onChange:t=>r("oauth2_scopes",t.target.value),placeholder:"openid profile email"})]}),s.provider_type==="saml"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Entity ID",value:s.saml_entity_id,onChange:t=>r("saml_entity_id",t.target.value),placeholder:"https://idp.example.com/saml/metadata"}),e.jsx(o,{label:"SSO URL",value:s.saml_sso_url,onChange:t=>r("saml_sso_url",t.target.value),placeholder:"https://idp.example.com/saml/sso"}),e.jsx(o,{label:"SLO URL (optional)",value:s.saml_slo_url,onChange:t=>r("saml_slo_url",t.target.value),placeholder:"https://idp.example.com/saml/slo"}),e.jsx(ue,{label:"IdP Certificate (PEM)",value:s.saml_certificate,onChange:t=>r("saml_certificate",t.target.value),rows:6,placeholder:"-----BEGIN CERTIFICATE-----...",className:"font-mono text-xs"})]})]}),e.jsxs(k,{value:"provisioning",className:"space-y-4 mt-4",children:[e.jsx(R,{label:"Default Role",value:s.default_role,onChange:t=>r("default_role",t),options:[{value:"admin",label:"Admin"},{value:"operator",label:"Operator"},{value:"viewer",label:"Viewer"}]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.auto_create_users,onChange:t=>r("auto_create_users",t.target.checked),className:"rounded"}),"Auto-create users on first login"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.auto_update_users,onChange:t=>r("auto_update_users",t.target.checked),className:"rounded"}),"Update user info on each login"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:n,children:"Cancel"}),e.jsxs(p,{type:"submit",children:[a?"Update":"Create"," Provider"]})]})]})})}export{Ie as default};
