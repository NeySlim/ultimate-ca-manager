import{j as e}from"./radix-B6Y-MRu0.js";import{a as o}from"./vendor-DEQSVNfj.js";import{m as _,d as I,k as me,y as ue,h as xe,B as p,q as T,i as te,u as pe,c as ve,F as X,v as he,f as fe,t as je,I as Y}from"./index-vswyqp58.js";import{s as O}from"./Download.es-Bp_lE9WD.js";import{n as K}from"./Plus.es-DN9hvW10.js";import{n as ae}from"./Trash.es-DhgoD9TD.js";import{M as be}from"./Modal-7_eTIvz3.js";import{B as g}from"./Badge-CZ5NzBfK.js";import{S as B}from"./Select-PwXyFoxR.js";import{T as ge}from"./Textarea-DuI5mbE0.js";import{H}from"./HelpCard-BINCqYIf.js";import{m as ye}from"./ArrowsClockwise.es-DS70dwCP.js";import{b as j,c as S,d as r,k as Ce,p as ke,l as Se,e as Z,n as Ne,s as _e}from"./DetailCard-BKBzFg8i.js";import{a as we,n as ze}from"./Globe.es-CtUoIY1T.js";import{R as Re}from"./ResponsiveDataTable-kYvH3TtM.js";import{R as Ee}from"./ResponsiveLayout-BgG2EW8C.js";import{c as N}from"./certificates.service-DOwLiyPH.js";import{c as Ie}from"./cas.service-CAbj5j2-.js";import{u as Ae}from"./usePermission-B5db8pNS.js";import"./CaretDown.es-DuThAI6u.js";import"./Fingerprint.es-a52JDt2Q.js";import"./CaretUp.es-CYK8cpGg.js";import"./CaretRight.es-B3hFfvz_.js";import"./ArrowLeft.es-CZcTzWfI.js";import"./UnifiedPageHeader-Cbwye_R6.js";const ee={valid:{variant:"success",label:"Valid"},expiring:{variant:"warning",label:"Expiring Soon"},expired:{variant:"danger",label:"Expired"},revoked:{variant:"danger",label:"Revoked"}},De={acme:{variant:"info",label:"ACME"},scep:{variant:"warning",label:"SCEP"},import:{variant:"default",label:"Imported"},csr:{variant:"default",label:"From CSR"},manual:{variant:"default",label:"Manual"}};function $(d,c="full"){if(!d)return"—";try{const m=new Date(d);return c==="short"?m.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):m.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return d}}function Pe({daysRemaining:d,validTo:c}){let m="text-status-success",n="bg-status-success/10",u=`${d} days remaining`;return d<=0?(m="text-status-error",n="bg-status-error/10",u="Expired"):d<=7?(m="text-status-error",n="bg-status-error/10",u=`${d} days remaining`):d<=30&&(m="text-status-warning",n="bg-status-warning/10"),e.jsxs("div",{className:I("flex items-center gap-2 px-3 py-2 rounded-lg",n),children:[e.jsx(ze,{size:16,className:m}),e.jsxs("div",{children:[e.jsx("div",{className:I("text-sm font-medium",m),children:u}),e.jsxs("div",{className:"text-xs text-text-tertiary",children:["Expires ",$(c,"short")]})]})]})}function $e({certificate:d,onExport:c,onRevoke:m,onDelete:n,onRenew:u,canWrite:w=!1,canDelete:l=!1,compact:i=!1,showActions:b=!0,showPem:L=!0}){const[h,z]=o.useState(!1),[y,A]=o.useState(!1);if(!d)return null;const t=d,C=t.revoked?"revoked":t.status||"valid",M=ee[C]||ee.valid,v=De[t.source]||null;return e.jsxs("div",{className:I("space-y-4 p-4",i&&"space-y-3 p-3"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:I("p-2.5 rounded-lg shrink-0",t.revoked?"bg-status-error/10":"bg-accent-primary/10"),children:e.jsx(_,{size:24,className:t.revoked?"text-status-error":"text-accent-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary truncate",children:t.cn||t.common_name||t.descr||"Certificate"}),e.jsx(g,{variant:M.variant,size:"sm",children:M.label}),v&&e.jsx(g,{variant:v.variant,size:"sm",children:v.label})]}),e.jsx("p",{className:"text-xs text-text-tertiary truncate mt-0.5",children:t.subject})]})]}),!t.revoked&&t.days_remaining!==void 0&&e.jsx(Pe,{daysRemaining:t.days_remaining,validTo:t.valid_to}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-bg-tertiary/50 rounded-lg p-2.5 text-center",children:[e.jsx(me,{size:16,className:"mx-auto text-text-tertiary mb-1"}),e.jsx("div",{className:"text-xs font-medium text-text-primary",children:t.key_algorithm||"RSA"}),e.jsx("div",{className:"text-[10px] text-text-tertiary",children:t.key_size?`${t.key_size} bits`:"—"})]}),e.jsxs("div",{className:"bg-bg-tertiary/50 rounded-lg p-2.5 text-center",children:[e.jsx(ue,{size:16,className:I("mx-auto mb-1",t.has_private_key?"text-status-success":"text-text-tertiary")}),e.jsx("div",{className:"text-xs font-medium text-text-primary",children:t.has_private_key?"Has Key":"No Key"}),e.jsx("div",{className:"text-[10px] text-text-tertiary",children:t.private_key_location||"—"})]}),e.jsxs("div",{className:"bg-bg-tertiary/50 rounded-lg p-2.5 text-center",children:[e.jsx(xe,{size:16,className:"mx-auto text-text-tertiary mb-1"}),e.jsx("div",{className:"text-xs font-medium text-text-primary truncate",children:t.signature_algorithm||"—"}),e.jsx("div",{className:"text-[10px] text-text-tertiary",children:"Signature"})]})]}),b&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[c&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>c("pem"),children:[e.jsx(O,{size:14})," PEM"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>c("der"),children:[e.jsx(O,{size:14})," DER"]}),t.has_private_key&&e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>c("p12"),children:[e.jsx(O,{size:14})," PKCS#12"]})]}),u&&w&&!t.revoked&&e.jsxs(p,{size:"sm",variant:"secondary",onClick:u,children:[e.jsx(ye,{size:14})," Renew"]}),m&&w&&!t.revoked&&e.jsxs(p,{size:"sm",variant:"danger",onClick:m,children:[e.jsx(T,{size:14})," Revoke"]}),n&&l&&e.jsx(p,{size:"sm",variant:"danger",onClick:n,children:e.jsx(ae,{size:14})})]}),e.jsx(j,{title:"Subject",children:e.jsxs(S,{children:[e.jsx(r,{icon:we,label:"Common Name",value:t.cn||t.common_name}),e.jsx(r,{icon:Ce,label:"Organization",value:t.organization}),e.jsx(r,{autoIcon:!0,label:"Org Unit",value:t.organizational_unit}),e.jsx(r,{icon:ke,label:"Locality",value:t.locality}),e.jsx(r,{autoIcon:!0,label:"State",value:t.state}),e.jsx(r,{autoIcon:!0,label:"Country",value:t.country}),e.jsx(r,{icon:Se,label:"Email",value:t.email,colSpan:2})]})}),e.jsx(j,{title:"Validity",children:e.jsxs(S,{children:[e.jsx(r,{icon:Z,label:"Valid From",value:$(t.valid_from)}),e.jsx(r,{icon:Z,label:"Valid Until",value:$(t.valid_to)})]})}),e.jsx(j,{title:"Technical Details",children:e.jsxs(S,{children:[e.jsx(r,{icon:Ne,label:"Serial",value:t.serial_number,mono:!0,copyable:!0}),e.jsx(r,{autoIcon:!0,label:"Key Type",value:t.key_type}),e.jsx(r,{autoIcon:!0,label:"Sig Algo",value:t.signature_algorithm}),e.jsx(r,{autoIcon:!0,label:"Cert Type",value:t.cert_type})]})}),t.san_combined&&e.jsx(j,{title:"Subject Alternative Names",children:e.jsx("div",{className:"text-xs font-mono text-text-primary break-all bg-bg-tertiary/30 p-2 rounded border border-border/50",children:t.san_combined})}),e.jsx(j,{title:"Issuer",children:e.jsxs(S,{cols:1,children:[e.jsx(r,{autoIcon:!0,label:"Issuer",value:t.issuer,mono:!0}),e.jsx(r,{autoIcon:!0,label:"CA",value:t.issuer_name}),e.jsx(r,{autoIcon:!0,label:"CA Reference",value:t.caref,mono:!0,copyable:!0})]})}),e.jsx(j,{title:"Fingerprints",collapsible:!0,defaultOpen:!1,children:e.jsxs(S,{cols:1,children:[e.jsx(r,{autoIcon:!0,label:"SHA-1",value:t.thumbprint_sha1,mono:!0,copyable:!0}),e.jsx(r,{autoIcon:!0,label:"SHA-256",value:t.thumbprint_sha256,mono:!0,copyable:!0})]})}),L&&t.pem&&e.jsxs(j,{title:"PEM Certificate",collapsible:!0,defaultOpen:!1,children:[e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:I("text-[10px] font-mono text-text-secondary bg-bg-tertiary/50 p-2 rounded overflow-x-auto border border-border/30",!y&&"max-h-24 overflow-hidden"),children:t.pem}),!y&&t.pem.length>500&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-bg-primary to-transparent pointer-events-none"})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(p,{type:"button",size:"sm",variant:"ghost",onClick:R=>{R.stopPropagation(),A(!y)},children:y?"Show Less":"Show Full"}),e.jsxs(p,{type:"button",size:"sm",variant:"ghost",onClick:R=>{R.stopPropagation(),navigator.clipboard.writeText(t.pem),z(!0),setTimeout(()=>z(!1),2e3)},children:[h?e.jsx(te,{size:14}):e.jsx(_e,{size:14}),h?"Copied!":"Copy PEM"]})]})]}),t.revoked&&e.jsx(j,{title:"Revocation Details",children:e.jsxs("div",{className:"bg-status-error/10 border border-status-error/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-status-error mb-2",children:[e.jsx(T,{size:16}),e.jsx("span",{className:"font-medium",children:"This certificate has been revoked"})]}),e.jsxs(S,{children:[e.jsx(r,{label:"Revoked At",value:$(t.revoked_at)}),e.jsx(r,{label:"Reason",value:t.revoke_reason||"Unspecified"})]})]})}),e.jsx(j,{title:"Metadata",collapsible:!0,defaultOpen:!1,children:e.jsxs(S,{children:[e.jsx(r,{label:"Created",value:$(t.created_at)}),e.jsx(r,{label:"Created By",value:t.created_by}),e.jsx(r,{label:"Source",value:t.source}),e.jsx(r,{label:"Imported From",value:t.imported_from}),e.jsx(r,{label:"Reference ID",value:t.refid,mono:!0,copyable:!0,colSpan:2})]})})]})}function ot(){const{isMobile:d}=pe(),[c,m]=o.useState([]),[n,u]=o.useState([]),[w,l]=o.useState(!0),[i,b]=o.useState(null),[L,h]=o.useState(!1),[z,y]=o.useState(1),[A,t]=o.useState(25),[C,M]=o.useState(0),[v,R]=o.useState(""),[k,q]=o.useState(""),{showSuccess:D,showError:E,showConfirm:W}=ve(),{canWrite:P,canDelete:U}=Ae();o.useEffect(()=>{F()},[z,A]);const F=async()=>{try{l(!0);const[a,s]=await Promise.all([N.getAll({page:z,per_page:A}),Ie.getAll()]),f=a.data||[];m(f),M(a.meta?.total||a.pagination?.total||f.length),u(s.data||[])}catch{E("Failed to load certificates")}finally{l(!1)}},G=o.useCallback(async a=>{if(!a){b(null);return}try{const s=await N.getById(a.id);b(s.data||a)}catch{b(a)}},[]),se=async a=>{if(i)try{const s=await N.export(i.id,a),f=URL.createObjectURL(s),x=document.createElement("a");x.href=f,x.download=`${i.common_name||"certificate"}.${a}`,x.click(),URL.revokeObjectURL(f),D("Certificate exported")}catch{E("Export failed")}},J=async a=>{if(await W("Revoke this certificate? This action cannot be undone.",{title:"Revoke Certificate",confirmText:"Revoke",variant:"danger"}))try{await N.revoke(a),D("Certificate revoked"),F(),b(null)}catch{E("Revoke failed")}},Q=async a=>{if(await W("Delete this certificate permanently?",{title:"Delete Certificate",confirmText:"Delete",variant:"danger"}))try{await N.delete(a),D("Certificate deleted"),F(),b(null)}catch{E("Delete failed")}},ie=o.useMemo(()=>{let a=c.map(s=>({...s,status:s.revoked?"revoked":s.status,cn:X(s.subject)||s.common_name||"Certificate"}));return v&&(a=a.filter(s=>s.status===v)),k&&(a=a.filter(s=>String(s.ca_id)===k||s.caref===k)),a},[c,v,k]),re=o.useMemo(()=>{const a=c.filter(x=>!x.revoked&&x.status==="valid").length,s=c.filter(x=>x.status==="expiring").length,f=c.filter(x=>x.revoked).length;return[{icon:te,label:"Valid",value:a,variant:"success"},{icon:he,label:"Expiring",value:s,variant:"warning"},{icon:T,label:"Revoked",value:f,variant:"danger"},{icon:_,label:"Total",value:C,variant:"primary"}]},[c,C]),le=o.useMemo(()=>[{key:"cn",header:"Common Name",priority:1,sortable:!0,render:(a,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:16,className:"text-accent-primary shrink-0"}),e.jsx("span",{className:"font-medium truncate",children:a}),s.source==="acme"&&e.jsx(g,{variant:"info",size:"sm",children:"ACME"}),s.source==="scep"&&e.jsx(g,{variant:"warning",size:"sm",children:"SCEP"})]})},{key:"status",header:"Status",priority:2,sortable:!0,render:(a,s)=>e.jsx(g,{variant:s.revoked?"danger":a==="valid"?"success":a==="expiring"?"warning":"danger",size:"sm",children:s.revoked?"Revoked":a||"Unknown"})},{key:"issuer",header:"Issuer",priority:3,hideOnMobile:!0,render:(a,s)=>e.jsx("span",{className:"text-text-secondary truncate",children:X(a)||s.issuer_name||"—"})},{key:"valid_to",header:"Expires",hideOnMobile:!0,sortable:!0,render:a=>e.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:fe(a)})},{key:"key_type",header:"Key",hideOnMobile:!0,render:(a,s)=>e.jsx("span",{className:"text-xs font-mono text-text-secondary",children:s.key_algorithm||a||"RSA"})}],[]),ne=o.useCallback(a=>[{label:"View Details",icon:je,onClick:()=>G(a)},{label:"Export PEM",icon:O,onClick:()=>oe(a,"pem")},...P("certificates")&&!a.revoked?[{label:"Revoke",icon:T,variant:"danger",onClick:()=>J(a.id)}]:[],...U("certificates")?[{label:"Delete",icon:ae,variant:"danger",onClick:()=>Q(a.id)}]:[]],[P,U]),oe=async(a,s)=>{try{const f=await N.export(a.id,s),x=URL.createObjectURL(f),V=document.createElement("a");V.href=x,V.download=`${a.common_name||a.cn||"certificate"}.${s}`,V.click(),URL.revokeObjectURL(x),D("Certificate exported")}catch{E("Export failed")}};o.useMemo(()=>[{key:"status",label:"Status",type:"select",value:v,onChange:R,placeholder:"All Status",options:[{value:"valid",label:"Valid"},{value:"expiring",label:"Expiring Soon"},{value:"expired",label:"Expired"},{value:"revoked",label:"Revoked"}]},{key:"ca",label:"Issuing CA",type:"select",value:k,onChange:q,placeholder:"All CAs",options:n.map(a=>({value:String(a.id),label:a.descr||a.common_name}))}],[v,k,n]);const ce=e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{title:"About Certificates",variant:"info",children:"Digital certificates authenticate identities and enable encrypted communications using PKI."}),e.jsx(H,{title:"Status Legend",variant:"info",children:e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"success",size:"sm",children:"Valid"}),e.jsx("span",{className:"text-xs",children:"Active and trusted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"warning",size:"sm",children:"Expiring"}),e.jsx("span",{className:"text-xs",children:"Expires within 30 days"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"danger",size:"sm",children:"Revoked"}),e.jsx("span",{className:"text-xs",children:"No longer valid"})]})]})}),e.jsx(H,{title:"Export Formats",variant:"tip",children:"PEM format is most common. Use DER for Java apps, PKCS#12 for Windows."})]}),de=i?e.jsx($e,{certificate:i,onExport:se,onRevoke:()=>J(i.id),onDelete:()=>Q(i.id),canWrite:P("certificates"),canDelete:U("certificates")}):null;return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{title:"Certificates",subtitle:`${C} certificate${C!==1?"s":""}`,icon:_,stats:re,helpContent:ce,helpTitle:"Certificates Help",splitView:!0,splitEmptyContent:e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-bg-tertiary flex items-center justify-center mb-3",children:e.jsx(_,{size:24,className:"text-text-tertiary"})}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Select a certificate to view details"})]}),slideOverOpen:!!i,slideOverTitle:i?.cn||i?.common_name||"Certificate Details",slideOverContent:de,slideOverWidth:"wide",onSlideOverClose:()=>b(null),children:e.jsx(Re,{data:ie,columns:le,loading:w,onRowClick:G,selectedId:i?.id,rowActions:ne,searchable:!0,searchPlaceholder:"Search certificates...",searchKeys:["cn","common_name","subject","issuer","serial"],toolbarFilters:[{key:"status",value:v,onChange:R,placeholder:"All Status",options:[{value:"valid",label:"Valid"},{value:"expiring",label:"Expiring"},{value:"expired",label:"Expired"},{value:"revoked",label:"Revoked"}]},{key:"ca",value:k,onChange:q,placeholder:"All CAs",options:n.map(a=>({value:String(a.id),label:a.descr||a.common_name}))}],toolbarActions:P("certificates")&&(d?e.jsx(p,{size:"lg",onClick:()=>h(!0),className:"w-11 h-11 p-0",children:e.jsx(K,{size:22,weight:"bold"})}):e.jsxs(p,{size:"sm",onClick:()=>h(!0),children:[e.jsx(K,{size:14,weight:"bold"}),"Issue"]})),sortable:!0,defaultSort:{key:"cn",direction:"asc"},pagination:{page:z,total:C,perPage:A,onChange:y,onPerPageChange:a=>{t(a),y(1)}},emptyIcon:_,emptyTitle:"No certificates",emptyDescription:"Issue your first certificate to get started",emptyAction:P("certificates")&&e.jsxs(p,{onClick:()=>h(!0),children:[e.jsx(K,{size:16})," Issue Certificate"]})})}),e.jsx(be,{open:L,onOpenChange:h,title:"Issue Certificate",size:"lg",children:e.jsx(Me,{cas:n,onSubmit:async a=>{try{await N.create(a),D("Certificate issued"),h(!1),F()}catch(s){E(s.message||"Failed to issue certificate")}},onCancel:()=>h(!1)})})]})}function Me({cas:d,onSubmit:c,onCancel:m}){const[n,u]=o.useState({ca_id:"",common_name:"",san:"",key_type:"rsa",key_size:"2048",validity_days:"365"}),w=l=>{l.preventDefault(),c(n)};return e.jsxs("form",{onSubmit:w,className:"p-4 space-y-4",children:[e.jsxs(B,{label:"Certificate Authority",value:n.ca_id,onChange:l=>u(i=>({...i,ca_id:l.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select a CA..."}),d.map(l=>e.jsx("option",{value:l.id,children:l.descr||l.common_name},l.id))]}),e.jsx(Y,{label:"Common Name",placeholder:"example.com",value:n.common_name,onChange:l=>u(i=>({...i,common_name:l.target.value})),required:!0}),e.jsx(ge,{label:"Subject Alternative Names",placeholder:`DNS:example.com
DNS:www.example.com
IP:192.168.1.1`,rows:3,value:n.san,onChange:l=>u(i=>({...i,san:l.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(B,{label:"Key Type",value:n.key_type,onChange:l=>u(i=>({...i,key_type:l.target.value})),children:[e.jsx("option",{value:"rsa",children:"RSA"}),e.jsx("option",{value:"ecdsa",children:"ECDSA"})]}),e.jsx(B,{label:"Key Size",value:n.key_size,onChange:l=>u(i=>({...i,key_size:l.target.value})),children:n.key_type==="rsa"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"256",children:"P-256"}),e.jsx("option",{value:"384",children:"P-384"})]})})]}),e.jsx(Y,{label:"Validity (days)",type:"number",placeholder:"365",value:n.validity_days,onChange:l=>u(i=>({...i,validity_days:l.target.value}))}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:m,children:"Cancel"}),e.jsxs(p,{type:"submit",children:[e.jsx(_,{size:16}),"Issue Certificate"]})]})]})}export{ot as default};
