import{r as d,j as e,B as m,z as p}from"./index-sh9svUN7.js";import{P as v}from"./PageTopBar-Bw4mdGQn.js";import{B as N}from"./Badge-CgwZri5j.js";import{u as z,M as R,a as G,b as D}from"./Modal-Bf_1TNwR.js";import{I as c}from"./Input-nM5afIEh.js";import"./useQuery-CSGc15Bo.js";import"./useMutation-CDnI93Q9.js";import"./api-ClVrI7m4.js";const k="_form_yeq9h_1",$="_section_yeq9h_7",F="_sectionTitle_yeq9h_13",P="_fieldGroup_yeq9h_22",L="_fieldRow_yeq9h_29",U="_label_yeq9h_35",O="_radioGroup_yeq9h_43",M="_radio_yeq9h_43",H="_select_yeq9h_67",a={form:k,section:$,sectionTitle:F,fieldGroup:P,fieldRow:L,label:U,radioGroup:O,radio:M,select:H};function V({isOpen:C,onClose:h}){const[n,j]=d.useState({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0}),x=z(),u=i=>{if(i.preventDefault(),!n.commonName){p.error("Common Name is required");return}x.mutate({common_name:n.commonName,organization:n.organization,organizational_unit:n.organizationalUnit,country:n.country,state:n.state,locality:n.locality,validity_days:parseInt(n.validityDays),key_size:parseInt(n.keySize),is_root:n.isRoot},{onSuccess:()=>{p.success("CA created successfully"),h(),j({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0})},onError:o=>{p.error(`Failed to create CA: ${o.message}`)}})},r=(i,o)=>{j(y=>({...y,[i]:o}))};return e.jsx(R,{isOpen:C,onClose:h,title:"Create Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"default",onClick:h,children:"Cancel"}),e.jsx(m,{variant:"primary",onClick:u,disabled:x.isPending,children:x.isPending?"Creating...":"Create CA"})]}),children:e.jsxs("form",{className:a.form,onSubmit:u,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"CA Type"}),e.jsxs("div",{className:a.radioGroup,children:[e.jsxs("label",{className:a.radio,children:[e.jsx("input",{type:"radio",checked:n.isRoot,onChange:()=>r("isRoot",!0)}),e.jsx("span",{children:"Root CA"})]}),e.jsxs("label",{className:a.radio,children:[e.jsx("input",{type:"radio",checked:!n.isRoot,onChange:()=>r("isRoot",!1)}),e.jsx("span",{children:"Intermediate CA"})]})]})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Common Name (CN) *"}),e.jsx(c,{value:n.commonName,onChange:i=>r("commonName",i.target.value),placeholder:"My Root CA",required:!0})]}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Organization (O)"}),e.jsx(c,{value:n.organization,onChange:i=>r("organization",i.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Organizational Unit (OU)"}),e.jsx(c,{value:n.organizationalUnit,onChange:i=>r("organizationalUnit",i.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Country (C)"}),e.jsx(c,{value:n.country,onChange:i=>r("country",i.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"State/Province (ST)"}),e.jsx(c,{value:n.state,onChange:i=>r("state",i.target.value),placeholder:"California"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"City/Locality (L)"}),e.jsx(c,{value:n.locality,onChange:i=>r("locality",i.target.value),placeholder:"San Francisco"})]})]})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Settings"}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Validity (days)"}),e.jsx(c,{type:"number",value:n.validityDays,onChange:i=>r("validityDays",i.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Key Size (bits)"}),e.jsxs("select",{className:a.select,value:n.keySize,onChange:i=>r("keySize",i.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]})]})})}const Y="_filtersSection_1nm9q_2",K="_filterGroup_1nm9q_13",Q="_tableContainer_1nm9q_56",X="_caNameCell_1nm9q_99",J="_caExpandBtn_1nm9q_105",W="_collapsed_1nm9q_123",Z="_noChildren_1nm9q_127",ee="_caTreeIndent_1nm9q_132",se="_caIcon_1nm9q_160",te="_root_1nm9q_165",ae="_intermediate_1nm9q_169",ne="_orphan_1nm9q_173",ie="_statusBadge_1nm9q_178",le="_actionsCell_1nm9q_201",re="_actionBtn_1nm9q_206",oe="_orphanedSection_1nm9q_231",ce="_orphanedHeader_1nm9q_239",de="_orphanedHeaderText_1nm9q_253",he="_orphanedTable_1nm9q_259",t={filtersSection:Y,filterGroup:K,tableContainer:Q,caNameCell:X,caExpandBtn:J,collapsed:W,noChildren:Z,caTreeIndent:ee,caIcon:se,root:te,intermediate:ae,orphan:ne,statusBadge:ie,actionsCell:le,actionBtn:re,orphanedSection:oe,orphanedHeader:ce,orphanedHeaderText:de,orphanedTable:he};function ve(){const[C,h]=d.useState("all"),[n,j]=d.useState("all"),[x,u]=d.useState("name"),[r,i]=d.useState(""),[o,y]=d.useState(new Set),[A,g]=d.useState(!1),{data:T,isLoading:w,error:f}=G(),q=D(),_=s=>{confirm(`Delete CA "${s.name}"? This cannot be undone.`)&&q.mutate(s.id,{onSuccess:()=>p.success("CA deleted"),onError:()=>p.error("Failed to delete CA")})},E=s=>{const l=new Set(o);l.has(s)?l.delete(s):l.add(s),y(l)};if(w)return e.jsxs("div",{className:t.caList,children:[e.jsx(v,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(N,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading CAs..."})]});if(f)return e.jsxs("div",{className:t.caList,children:[e.jsx(v,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(N,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading CAs: ",f.message]})]});const b=T?.data||[],S=[],B=b.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:t.caList,children:[e.jsx(v,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsxs(N,{variant:"success",children:[B," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:"ph ph-upload-simple",children:"Import"}),e.jsx(m,{icon:"ph ph-download-simple",children:"Export"}),e.jsx(m,{variant:"primary",icon:"ph ph-plus",onClick:()=>g(!0),children:"Create CA"})]})}),e.jsxs("div",{className:t.filtersSection,children:[e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{htmlFor:"type-filter",children:"TYPE"}),e.jsxs("select",{id:"type-filter",value:C,onChange:s=>h(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"root",children:"Root"}),e.jsx("option",{value:"intermediate",children:"Intermediate"})]})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{htmlFor:"status-filter",children:"STATUS"}),e.jsxs("select",{id:"status-filter",value:n,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{htmlFor:"sort-filter",children:"SORT BY"}),e.jsxs("select",{id:"sort-filter",value:x,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued Date"}),e.jsx("option",{value:"expires",children:"Expires Date"})]})]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{className:t.filterGroup,children:e.jsx("input",{type:"text",id:"search-filter",placeholder:"Search CAs...",value:r,onChange:s=>i(s.target.value)})})]}),e.jsx("div",{className:t.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.caNameCell,children:[e.jsx("button",{className:`${t.caExpandBtn} ${s.children?"":t.noChildren} ${o.has(s.id)?"":t.collapsed}`,onClick:()=>s.children&&E(s.id),children:e.jsx("i",{className:"ph ph-caret-down"})}),e.jsx("i",{className:`ph ph-bank ${t.caIcon} ${t.root}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:t.actionBtn,title:"Delete",onClick:l=>{l.stopPropagation(),_(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id),s.children&&o.has(s.id)&&s.children.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.caTreeIndent,children:[e.jsx("i",{className:`ph ph-git-branch ${t.caIcon} ${t.intermediate}`}),e.jsx("span",{children:l.name})]})}),e.jsx("td",{children:e.jsx("span",{children:l.type})}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${l.status.toLowerCase()}`,children:l.status})}),e.jsx("td",{children:l.issued}),e.jsx("td",{children:l.expires}),e.jsx("td",{children:l.certs}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:t.actionBtn,title:"Delete",onClick:I=>{I.stopPropagation(),_(l)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},l.id))]}))})]})}),S.length>0&&e.jsxs("div",{className:t.orphanedSection,children:[e.jsxs("div",{className:t.orphanedHeader,children:[e.jsx("i",{className:"ph ph-warning"}),e.jsx("span",{className:t.orphanedHeaderText,children:"Orphaned Intermediate CAs"})]}),e.jsx("div",{className:t.orphanedTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.caNameCell,children:[e.jsx("i",{className:`ph ph-warning ${t.caIcon} ${t.orphan}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:t.actionBtn,title:"Delete",onClick:l=>{l.stopPropagation(),_(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id))})]})})]}),e.jsx(V,{isOpen:A,onClose:()=>g(!1)})]})}export{ve as CAList,ve as default};
