import{a as K,r as R,j as e,B as I,z as A}from"./index-C-4zSNrs.js";import{P as g}from"./PageTopBar-b0Xgy9Vh.js";import{S as P,a as p}from"./StatsGrid-DKIroCSV.js";import{S as Q,T as y}from"./SectionTabs-R-lW3bmy.js";import{D as v}from"./DataTable-B1DYpURm.js";import{S as U}from"./SearchToolbar-CgUn_iN9.js";import{B as l}from"./Badge-Cl2Er17o.js";import{g as C}from"./getBadgeVariant-BF98r0-3.js";import{u as m}from"./useQuery-xIW_GXkH.js";import{u as V}from"./useMutation-Cl7ZHP5e.js";import{a as d}from"./api-ClVrI7m4.js";import"./Input-BySXXmx_.js";const u={getSettings:async()=>(await d.get("/api/v2/acme/settings")).data,updateSettings:async t=>(await d.patch("/api/v2/acme/settings",t)).data,getStats:async()=>{const a=(await d.get("/api/v2/acme/stats")).data||{};return{accounts:a.active_accounts||0,activeOrders:a.pending_orders||0,completedOrders:a.valid_orders||0,domains:0,_raw:a}},getAccounts:async(t={})=>{const a=await d.get("/api/v2/acme/accounts",{params:t}),n=(a.data||[]).map(s=>({id:s.id,email:s.email||s.contact_email||"N/A",status:(s.status||"ACTIVE").toUpperCase(),createdAt:s.created_at?s.created_at.split("T")[0]:"N/A",orders:s.total_orders||0,_raw:s}));return{data:n,meta:a.meta||{page:1,per_page:20,total:n.length}}},getOrders:async(t={})=>{const a=await d.get("/api/v2/acme/orders",{params:t}),n=(a.data||[]).map(s=>({id:s.id,domain:s.domain||s.identifier||"N/A",account:s.account_email||s.account_id||"N/A",status:(s.status||"PENDING").toUpperCase(),createdAt:s.created_at?s.created_at.split("T")[0]:"N/A",expiresAt:s.expires_at?s.expires_at.split("T")[0]:"N/A",_raw:s}));return{data:n,meta:a.meta||{page:1,per_page:20,total:n.length}}}},c={all:["acme"],settings:()=>[...c.all,"settings"],stats:()=>[...c.all,"stats"],accounts:t=>[...c.all,"accounts",t],orders:t=>[...c.all,"orders",t]},z=()=>m({queryKey:c.settings(),queryFn:u.getSettings}),G=()=>m({queryKey:c.stats(),queryFn:u.getStats}),H=(t={})=>m({queryKey:c.accounts(t),queryFn:()=>u.getAccounts(t)}),J=(t={})=>m({queryKey:c.orders(t),queryFn:()=>u.getOrders(t)}),W=()=>{const t=K();return V({mutationFn:u.updateSettings,onSuccess:()=>{t.invalidateQueries({queryKey:c.settings()})}})},X="_acmeDashboard_k0xpk_3",Y="_tabContent_k0xpk_8",Z="_section_k0xpk_14",$="_sectionTitle_k0xpk_20",o={acmeDashboard:X,tabContent:Y,section:Z,sectionTitle:$};function ge(){const[t,a]=R.useState("internal"),{data:n,isLoading:s,error:j}=z(),{data:ee,isLoading:S,error:_}=G(),{data:E,isLoading:k,error:f}=H(),{data:N,isLoading:M,error:T}=J(),D=W(),O=s||S||k||M,b=j||_||f||T,q=[{key:"email",label:"Email",sortable:!0},{key:"status",label:"Status",sortable:!0,render:r=>e.jsx(l,{variant:C("acme-status",r.status),children:r.status})},{key:"createdAt",label:"Created At",sortable:!0},{key:"orders",label:"Orders",sortable:!0,render:r=>e.jsx("span",{style:{color:"var(--text-tertiary)"},children:r.orders})}],w=[{key:"domain",label:"Domain",sortable:!0},{key:"account",label:"Account",sortable:!0},{key:"status",label:"Status",sortable:!0,render:r=>e.jsx(l,{variant:C("acme-status",r.status),children:r.status})},{key:"createdAt",label:"Created",sortable:!0},{key:"expiresAt",label:"Expires",sortable:!0}],F=[{label:"Status",options:["All Statuses","Valid","Pending","Invalid"]}],L=[{label:"New Account",icon:"ph ph-plus",variant:"primary"},{label:"New Order",icon:"ph ph-certificate",variant:"default"}];if(O)return e.jsxs("div",{className:o.acmeDashboard,children:[e.jsx(g,{icon:"ph ph-globe",title:"ACME",badge:e.jsx(l,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading ACME data..."})]});if(b)return e.jsxs("div",{className:o.acmeDashboard,children:[e.jsx(g,{icon:"ph ph-globe",title:"ACME",badge:e.jsx(l,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading ACME data: ",b.message]})]});const h={accounts:E?.data||[],orders:N?.data||[]},x=(r,te)=>e.jsxs("div",{className:o.tabContent,children:[e.jsxs(P,{columns:4,children:[e.jsx(p,{value:r.stats.accounts,label:"Accounts",icon:"ph ph-user"}),e.jsx(p,{value:r.stats.activeOrders,label:"Active Orders",icon:"ph ph-clock"}),e.jsx(p,{value:r.stats.completedOrders,label:"Completed Orders",icon:"ph ph-check-circle"}),e.jsx(p,{value:r.stats.domains,label:"Domains",icon:"ph ph-globe"})]}),e.jsxs("div",{className:o.section,children:[e.jsx("h3",{className:o.sectionTitle,children:"Accounts"}),e.jsx(U,{placeholder:"Search accounts...",filters:F,actions:L,onSearch:i=>console.log("Search:",i),onFilterChange:(i,B)=>console.log("Filter:",i,B)}),e.jsx(v,{columns:q,data:r.accounts,onRowClick:i=>console.log("Account clicked:",i)})]}),e.jsxs("div",{className:o.section,children:[e.jsx("h3",{className:o.sectionTitle,children:"Recent Orders"}),e.jsx(v,{columns:w,data:r.orders,onRowClick:i=>console.log("Order clicked:",i)})]})]});return e.jsxs("div",{className:o.acmeDashboard,children:[e.jsx(g,{icon:"ph ph-globe",title:"ACME",badge:e.jsx(l,{variant:n?.enabled?"success":"secondary",children:n?.enabled?"Enabled":"Disabled"}),actions:e.jsxs(I,{variant:n?.enabled?"secondary":"primary",onClick:()=>{D.mutate({enabled:!n?.enabled},{onSuccess:()=>A.success(n?.enabled?"ACME disabled":"ACME enabled"),onError:()=>A.error("Failed to update ACME")})},children:[n?.enabled?"Disable":"Enable"," ACME"]})}),e.jsxs(Q,{children:[e.jsx(y,{active:t==="internal",onClick:()=>a("internal"),children:"Internal ACME"}),e.jsx(y,{active:t==="letsencrypt",onClick:()=>a("letsencrypt"),children:"Let's Encrypt"})]}),e.jsxs("div",{className:o.tabContent,children:[t==="internal"&&x(h.internal),t==="letsencrypt"&&x(h.letsencrypt)]})]})}export{ge as ACMEDashboard,ge as default};
