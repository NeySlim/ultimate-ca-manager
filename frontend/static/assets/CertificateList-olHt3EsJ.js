import{r as f,j as e,B as m}from"./index-Bz_2fcyu.js";import{P as v}from"./PageTopBar-a3bUybbK.js";import{F as E,a as b}from"./FiltersBar-DZ3bgRwW.js";import{P as _,a as c}from"./PillFilter-D8zSM6Dg.js";import{B as n}from"./Badge-BJVTH_dQ.js";import{u as w}from"./useQuery-DpPME6wH.js";import{a as p}from"./api-ClVrI7m4.js";const I={getAll:async(a={})=>{const r=await p.get("/api/v2/certificates",{params:a}),l=(r.data||[]).map(i=>{const j=new Date(i.valid_to),d=Math.ceil((j-new Date)/(1e3*60*60*24));let o="ACTIVE";i.revoked?o="REVOKED":d<0?o="EXPIRED":d<=7?o="CRITICAL":d<=30&&(o="EXPIRING SOON");const h=i.subject?.match(/CN=([^,]+)/),g=h?h[1]:i.subject||"Unnamed Certificate",u=i.subject?.includes("Server")?"Server":"Client";return{id:i.id,name:g,serial:i.serial||"N/A",type:u,issuer:i.issuer||"Unknown",status:o,issued:i.valid_from?i.valid_from.split("T")[0]:"N/A",expires:i.valid_to?i.valid_to.split("T")[0]:"N/A",daysLeft:d>0?d:0,_raw:i}});return{data:l,meta:r.meta||{page:1,per_page:20,total:l.length}}},getById:async a=>(await p.get(`/api/v2/certificates/${a}`)).data,revoke:async(a,r)=>(await p.post(`/api/v2/certificates/${a}/revoke`,{reason:r})).data,renew:async a=>(await p.post(`/api/v2/certificates/${a}/renew`)).data,download:async(a,r="pem")=>await p.get(`/api/v2/certificates/${a}/download`,{params:{format:r},responseType:"blob"})},x={all:["certificates"],lists:()=>[...x.all,"list"],list:a=>[...x.lists(),a],details:()=>[...x.all,"detail"],detail:a=>[...x.details(),a]},T=(a={})=>w({queryKey:x.list(a),queryFn:()=>I.getAll(a)}),A="_tableContainer_2f75z_2",B="_certNameCell_2f75z_45",k="_certName_2f75z_45",z="_certSerial_2f75z_56",R="_badgeType_2f75z_63",D="_badgeInfo_2f75z_74",L="_badgeNeutral_2f75z_79",F="_badgeStatus_2f75z_84",P="_badgeSuccess_2f75z_95",$="_badgeWarning_2f75z_100",O="_badgeError_2f75z_105",U="_expiresCell_2f75z_111",M="_badgeDays_2f75z_117",W="_actionsCell_2f75z_130",K="_actionBtn_2f75z_135",t={tableContainer:A,certNameCell:B,certName:k,certSerial:z,badgeType:R,badgeInfo:D,badgeNeutral:L,badgeStatus:F,badgeSuccess:P,badgeWarning:$,badgeError:O,expiresCell:U,badgeDays:M,actionsCell:W,actionBtn:K};function J(){const[a,r]=f.useState("all"),[l,i]=f.useState("all"),[j,y]=f.useState("name"),{data:d,isLoading:o,error:h}=T(),g=s=>s<=7?t.badgeError:s<=30?t.badgeWarning:t.badgeSuccess,u=s=>s==="CRITICAL"?t.badgeError:s==="EXPIRING SOON"?t.badgeWarning:t.badgeSuccess,N=s=>s==="Server"||s==="Client"?t.badgeInfo:t.badgeNeutral;if(o)return e.jsxs("div",{className:t.certificateList,children:[e.jsx(v,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(n,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading certificates..."})]});if(h)return e.jsxs("div",{className:t.certificateList,children:[e.jsx(v,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(n,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading certificates: ",h.message]})]});const C=d?.data||[],S=C.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:t.certificateList,children:[e.jsx(v,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsxs(n,{variant:"success",children:[S," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:"ph ph-upload-simple",children:"Import"}),e.jsx(m,{icon:"ph ph-download-simple",children:"Export"}),e.jsx(m,{variant:"primary",icon:"ph ph-file-plus",children:"Issue Certificate"})]})}),e.jsxs(E,{children:[e.jsx(b,{label:"TYPE",children:e.jsxs(_,{children:[e.jsxs(c,{active:a==="all",onClick:()=>r("all"),children:["All ",e.jsx(n,{variant:"secondary",children:"(247)"})]}),e.jsxs(c,{active:a==="server",onClick:()=>r("server"),children:["Server ",e.jsx(n,{variant:"secondary",children:"(89)"})]}),e.jsxs(c,{active:a==="client",onClick:()=>r("client"),children:["Client ",e.jsx(n,{variant:"secondary",children:"(158)"})]}),e.jsxs(c,{active:a==="acme",onClick:()=>r("acme"),children:["ACME ",e.jsx(n,{variant:"secondary",children:"(34)"})]})]})}),e.jsx(b,{label:"STATUS",children:e.jsxs(_,{children:[e.jsxs(c,{active:l==="all",onClick:()=>i("all"),children:["All ",e.jsx(n,{variant:"secondary",children:"(247)"})]}),e.jsxs(c,{active:l==="active",onClick:()=>i("active"),children:["Active ",e.jsx(n,{variant:"secondary",children:"(235)"})]}),e.jsxs(c,{active:l==="expiring",onClick:()=>i("expiring"),children:["Expiring ",e.jsx(n,{variant:"secondary",children:"(12)"})]}),e.jsxs(c,{active:l==="expired",onClick:()=>i("expired"),children:["Expired ",e.jsx(n,{variant:"secondary",children:"(0)"})]}),e.jsxs(c,{active:l==="revoked",onClick:()=>i("revoked"),children:["Revoked ",e.jsx(n,{variant:"secondary",children:"(0)"})]})]})}),e.jsx(b,{label:"SORT",children:e.jsxs("select",{value:j,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"expires",children:"Expires"})]})})]}),e.jsx("div",{className:t.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"10%"},children:"TYPE"}),e.jsx("th",{style:{width:"15%"},children:"ISSUER"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"10%"},children:"ISSUED"}),e.jsx("th",{style:{width:"10%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"5%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.certNameCell,children:[e.jsx("span",{className:t.certName,children:s.name}),e.jsxs("span",{className:t.certSerial,children:["Serial: ",s.serial]})]})}),e.jsx("td",{children:e.jsx("span",{className:`${t.badgeType} ${N(s.type)}`,children:s.type})}),e.jsx("td",{children:s.issuer}),e.jsx("td",{children:e.jsx("span",{className:`${t.badgeStatus} ${u(s.status)}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:e.jsxs("div",{className:t.expiresCell,children:[e.jsx("span",{children:s.expires}),e.jsxs("span",{className:`${t.badgeDays} ${g(s.daysLeft)}`,children:[s.daysLeft," DAYS"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"Download",children:e.jsx("i",{className:"ph ph-download-simple"})}),e.jsx("button",{className:t.actionBtn,title:"Renew",children:e.jsx("i",{className:"ph ph-arrow-clockwise"})}),e.jsx("button",{className:t.actionBtn,title:"More",children:e.jsx("i",{className:"ph ph-dots-three-outline-vertical"})})]})})]},s.id))})]})})]})}export{J as CertificateList,J as default};
