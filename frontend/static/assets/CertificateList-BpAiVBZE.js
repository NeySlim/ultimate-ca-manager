import{a as A,r as b,j as e,B as k,z as C}from"./index-sh9svUN7.js";import{P as I}from"./PageTopBar-Bw4mdGQn.js";import{F as L,a as E}from"./FiltersBar-DBNhNtjo.js";import{P as T,a as m}from"./PillFilter-QgFzOUx2.js";import{B as h}from"./Badge-CgwZri5j.js";import{u as q}from"./useQuery-CSGc15Bo.js";import{u as R}from"./useMutation-CDnI93Q9.js";import{a as v}from"./api-ClVrI7m4.js";import{a as B,M as P}from"./Modal-Bf_1TNwR.js";import{I as g}from"./Input-nM5afIEh.js";const z={getAll:async(n={})=>{const r=await v.get("/api/v2/certificates",{params:n}),s=(r.data||[]).map(l=>{const j=new Date(l.valid_to),u=Math.ceil((j-new Date)/(1e3*60*60*24));let o="ACTIVE";l.revoked?o="REVOKED":u<0?o="EXPIRED":u<=7?o="CRITICAL":u<=30&&(o="EXPIRING SOON");const f=l.subject?.match(/CN=([^,]+)/),N=f?f[1]:l.subject||"Unnamed Certificate",d=l.subject?.includes("Server")?"Server":"Client";return{id:l.id,name:N,serial:l.serial||"N/A",type:d,issuer:l.issuer||"Unknown",status:o,issued:l.valid_from?l.valid_from.split("T")[0]:"N/A",expires:l.valid_to?l.valid_to.split("T")[0]:"N/A",daysLeft:u>0?u:0,_raw:l}});return{data:s,meta:r.meta||{page:1,per_page:20,total:s.length}}},getById:async n=>(await v.get(`/api/v2/certificates/${n}`)).data,revoke:async(n,r)=>(await v.post(`/api/v2/certificates/${n}/revoke`,{reason:r})).data,renew:async n=>(await v.post(`/api/v2/certificates/${n}/renew`)).data,download:async(n,r="pem")=>await v.get(`/api/v2/certificates/${n}/download`,{params:{format:r},responseType:"blob"}),issue:async n=>(await v.post("/api/v2/certificates",n)).data},_={all:["certificates"],lists:()=>[..._.all,"list"],list:n=>[..._.lists(),n],details:()=>[..._.all,"detail"],detail:n=>[..._.details(),n]},$=(n={})=>q({queryKey:_.list(n),queryFn:()=>z.getAll(n)}),O=()=>{const n=A();return R({mutationFn:({id:r,reason:s})=>z.revoke(r,s),onSuccess:()=>{n.invalidateQueries({queryKey:_.all})}})},M=()=>{const n=A();return R({mutationFn:z.issue,onSuccess:()=>{n.invalidateQueries({queryKey:_.all})}})},K="_form_7q3s3_1",U="_section_7q3s3_7",W="_sectionTitle_7q3s3_13",H="_fieldGroup_7q3s3_22",Q="_fieldRow_7q3s3_29",V="_label_7q3s3_35",X="_fieldHint_7q3s3_43",Y="_select_7q3s3_49",J="_checkboxGroup_7q3s3_75",Z="_checkbox_7q3s3_75",a={form:K,section:U,sectionTitle:W,fieldGroup:H,fieldRow:Q,label:V,fieldHint:X,select:Y,checkboxGroup:J,checkbox:Z};function ee({isOpen:n,onClose:r}){const[s,l]=b.useState({ca_id:"",common_name:"",organization:"",organizational_unit:"",country:"",state:"",locality:"",san:"",validity_days:"365",key_size:"2048",key_usage:["digitalSignature","keyEncipherment"]}),j=M(),{data:S,isLoading:u}=B(),o=S?.data||[];b.useEffect(()=>{o.length>0&&!s.ca_id&&l(i=>({...i,ca_id:o[0].id.toString()}))},[o,s.ca_id]);const f=i=>{if(i.preventDefault(),!s.ca_id){C.error("Please select a Certificate Authority");return}if(!s.common_name){C.error("Common Name is required");return}const x={ca_id:parseInt(s.ca_id),common_name:s.common_name,organization:s.organization,organizational_unit:s.organizational_unit,country:s.country,state:s.state,locality:s.locality,san:s.san,validity_days:parseInt(s.validity_days),key_size:parseInt(s.key_size),key_usage:s.key_usage};j.mutate(x,{onSuccess:()=>{C.success("Certificate issued successfully"),r(),N()},onError:y=>{C.error(`Failed to issue certificate: ${y.message}`)}})},N=()=>{l({ca_id:o.length>0?o[0].id.toString():"",common_name:"",organization:"",organizational_unit:"",country:"",state:"",locality:"",san:"",validity_days:"365",key_size:"2048",key_usage:["digitalSignature","keyEncipherment"]})},d=(i,x)=>{l(y=>({...y,[i]:x}))},p=i=>{l(x=>({...x,key_usage:x.key_usage.includes(i)?x.key_usage.filter(y=>y!==i):[...x.key_usage,i]}))};return e.jsx(P,{isOpen:n,onClose:r,title:"Issue Certificate",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"default",onClick:r,children:"Cancel"}),e.jsx(k,{variant:"primary",onClick:f,disabled:j.isPending,children:j.isPending?"Issuing...":"Issue Certificate"})]}),children:e.jsxs("form",{className:a.form,onSubmit:f,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Certificate Authority *"}),e.jsx("select",{className:a.select,value:s.ca_id,onChange:i=>d("ca_id",i.target.value),disabled:u,children:u?e.jsx("option",{children:"Loading CAs..."}):o.length===0?e.jsx("option",{children:"No CAs available"}):o.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Common Name (CN) *"}),e.jsx(g,{value:s.common_name,onChange:i=>d("common_name",i.target.value),placeholder:"example.com",required:!0})]}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Organization (O)"}),e.jsx(g,{value:s.organization,onChange:i=>d("organization",i.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Organizational Unit (OU)"}),e.jsx(g,{value:s.organizational_unit,onChange:i=>d("organizational_unit",i.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Country (C)"}),e.jsx(g,{value:s.country,onChange:i=>d("country",i.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"State/Province (ST)"}),e.jsx(g,{value:s.state,onChange:i=>d("state",i.target.value),placeholder:"California"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"City/Locality (L)"}),e.jsx(g,{value:s.locality,onChange:i=>d("locality",i.target.value),placeholder:"San Francisco"})]})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Subject Alternative Names (SAN)"}),e.jsx(g,{value:s.san,onChange:i=>d("san",i.target.value),placeholder:"DNS:example.com, DNS:*.example.com, IP:192.168.1.1"}),e.jsx("span",{className:a.fieldHint,children:"Comma-separated list (e.g., DNS:example.com, IP:192.168.1.1)"})]})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Settings"}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Validity (days)"}),e.jsx(g,{type:"number",value:s.validity_days,onChange:i=>d("validity_days",i.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Key Size (bits)"}),e.jsxs("select",{className:a.select,value:s.key_size,onChange:i=>d("key_size",i.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:a.checkboxGroup,children:[e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("digitalSignature"),onChange:()=>p("digitalSignature")}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("keyEncipherment"),onChange:()=>p("keyEncipherment")}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("dataEncipherment"),onChange:()=>p("dataEncipherment")}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("keyAgreement"),onChange:()=>p("keyAgreement")}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("keyCertSign"),onChange:()=>p("keyCertSign")}),e.jsx("span",{children:"Certificate Signing"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("crlSign"),onChange:()=>p("crlSign")}),e.jsx("span",{children:"CRL Signing"})]})]})]})]})})}const se="_tableContainer_2f75z_2",ae="_certNameCell_2f75z_45",ie="_certName_2f75z_45",te="_certSerial_2f75z_56",ne="_badgeType_2f75z_63",le="_badgeInfo_2f75z_74",ce="_badgeNeutral_2f75z_79",re="_badgeStatus_2f75z_84",oe="_badgeSuccess_2f75z_95",de="_badgeWarning_2f75z_100",he="_badgeError_2f75z_105",ue="_expiresCell_2f75z_111",xe="_badgeDays_2f75z_117",me="_actionsCell_2f75z_130",pe="_actionBtn_2f75z_135",c={tableContainer:se,certNameCell:ae,certName:ie,certSerial:te,badgeType:ne,badgeInfo:le,badgeNeutral:ce,badgeStatus:re,badgeSuccess:oe,badgeWarning:de,badgeError:he,expiresCell:ue,badgeDays:xe,actionsCell:me,actionBtn:pe};function Se(){const[n,r]=b.useState("all"),[s,l]=b.useState("all"),[j,S]=b.useState("name"),[u,o]=b.useState(!1),{data:f,isLoading:N,error:d}=$(),{mutate:p}=O(),i=t=>{window.confirm(`Revoke certificate ${t.name}?`)&&p({id:t.id,reason:"Revoked by administrator"},{onSuccess:()=>C.success(`Certificate ${t.name} revoked successfully`),onError:G=>C.error(`Failed to revoke certificate: ${G.message}`)})},x=t=>t<=7?c.badgeError:t<=30?c.badgeWarning:c.badgeSuccess,y=t=>t==="CRITICAL"?c.badgeError:t==="EXPIRING SOON"?c.badgeWarning:c.badgeSuccess,D=t=>t==="Server"||t==="Client"?c.badgeInfo:c.badgeNeutral;if(N)return e.jsxs("div",{className:c.certificateList,children:[e.jsx(I,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(h,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading certificates..."})]});if(d)return e.jsxs("div",{className:c.certificateList,children:[e.jsx(I,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(h,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading certificates: ",d.message]})]});const w=f?.data||[],F=w.filter(t=>t.status==="ACTIVE").length;return e.jsxs("div",{className:c.certificateList,children:[e.jsx(I,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsxs(h,{variant:"success",children:[F," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(k,{icon:"ph ph-upload-simple",children:"Import"}),e.jsx(k,{icon:"ph ph-download-simple",children:"Export"}),e.jsx(k,{variant:"primary",icon:"ph ph-file-plus",onClick:()=>o(!0),children:"Issue Certificate"})]})}),e.jsxs(L,{children:[e.jsx(E,{label:"TYPE",children:e.jsxs(T,{children:[e.jsxs(m,{active:n==="all",onClick:()=>r("all"),children:["All ",e.jsx(h,{variant:"secondary",children:"(247)"})]}),e.jsxs(m,{active:n==="server",onClick:()=>r("server"),children:["Server ",e.jsx(h,{variant:"secondary",children:"(89)"})]}),e.jsxs(m,{active:n==="client",onClick:()=>r("client"),children:["Client ",e.jsx(h,{variant:"secondary",children:"(158)"})]}),e.jsxs(m,{active:n==="acme",onClick:()=>r("acme"),children:["ACME ",e.jsx(h,{variant:"secondary",children:"(34)"})]})]})}),e.jsx(E,{label:"STATUS",children:e.jsxs(T,{children:[e.jsxs(m,{active:s==="all",onClick:()=>l("all"),children:["All ",e.jsx(h,{variant:"secondary",children:"(247)"})]}),e.jsxs(m,{active:s==="active",onClick:()=>l("active"),children:["Active ",e.jsx(h,{variant:"secondary",children:"(235)"})]}),e.jsxs(m,{active:s==="expiring",onClick:()=>l("expiring"),children:["Expiring ",e.jsx(h,{variant:"secondary",children:"(12)"})]}),e.jsxs(m,{active:s==="expired",onClick:()=>l("expired"),children:["Expired ",e.jsx(h,{variant:"secondary",children:"(0)"})]}),e.jsxs(m,{active:s==="revoked",onClick:()=>l("revoked"),children:["Revoked ",e.jsx(h,{variant:"secondary",children:"(0)"})]})]})}),e.jsx(E,{label:"SORT",children:e.jsxs("select",{value:j,onChange:t=>S(t.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"expires",children:"Expires"})]})})]}),e.jsx("div",{className:c.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"10%"},children:"TYPE"}),e.jsx("th",{style:{width:"15%"},children:"ISSUER"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"10%"},children:"ISSUED"}),e.jsx("th",{style:{width:"10%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"5%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:w.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:c.certNameCell,children:[e.jsx("span",{className:c.certName,children:t.name}),e.jsxs("span",{className:c.certSerial,children:["Serial: ",t.serial]})]})}),e.jsx("td",{children:e.jsx("span",{className:`${c.badgeType} ${D(t.type)}`,children:t.type})}),e.jsx("td",{children:t.issuer}),e.jsx("td",{children:e.jsx("span",{className:`${c.badgeStatus} ${y(t.status)}`,children:t.status})}),e.jsx("td",{children:t.issued}),e.jsx("td",{children:e.jsxs("div",{className:c.expiresCell,children:[e.jsx("span",{children:t.expires}),e.jsxs("span",{className:`${c.badgeDays} ${x(t.daysLeft)}`,children:[t.daysLeft," DAYS"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:c.actionsCell,children:[e.jsx("button",{className:c.actionBtn,title:"Download",children:e.jsx("i",{className:"ph ph-download-simple"})}),e.jsx("button",{className:c.actionBtn,title:"Revoke",onClick:()=>i(t),children:e.jsx("i",{className:"ph ph-x-circle"})}),e.jsx("button",{className:c.actionBtn,title:"More",children:e.jsx("i",{className:"ph ph-dots-three-outline-vertical"})})]})})]},t.id))})]})}),e.jsx(ee,{isOpen:u,onClose:()=>o(!1)})]})}export{Se as CertificateList,Se as default};
