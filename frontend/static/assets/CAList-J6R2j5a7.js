import{r as d,j as e,B as g,z as h}from"./index-UTmuML2r.js";import{P as k}from"./PageTopBar-BKQ-nPnk.js";import{B as F}from"./Badge-2m5LDYn9.js";import{u as G,a as M,b as $}from"./useCAs-DuEkXaBR.js";import{M as q}from"./Modal-Co5LAPRO.js";import{I as y}from"./Input-xYUki4E1.js";import{s as t}from"./CreateCAModal.module-DdQgTClK.js";import{s as i,F as L}from"./ImportCAModal.module-BnFulaj1.js";import{a as U}from"./api-ClVrI7m4.js";import{e as O}from"./export-BEFxFx9V.js";import"./useQuery-C7Pv5dto.js";import"./useMutation-CaNT3-Tv.js";function H({isOpen:S,onClose:v}){const[n,j]=d.useState({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0}),x=G(),p=l=>{if(l.preventDefault(),!n.commonName){h.error("Common Name is required");return}x.mutate({common_name:n.commonName,organization:n.organization,organizational_unit:n.organizationalUnit,country:n.country,state:n.state,locality:n.locality,validity_days:parseInt(n.validityDays),key_size:parseInt(n.keySize),is_root:n.isRoot},{onSuccess:()=>{h.success("CA created successfully"),v(),j({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0})},onError:m=>{h.error(`Failed to create CA: ${m.message}`)}})},c=(l,m)=>{j(b=>({...b,[l]:m}))};return e.jsx(q,{isOpen:S,onClose:v,title:"Create Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"default",onClick:v,children:"Cancel"}),e.jsx(g,{variant:"primary",onClick:p,disabled:x.isPending,children:x.isPending?"Creating...":"Create CA"})]}),children:e.jsxs("form",{className:t.form,onSubmit:p,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"CA Type"}),e.jsxs("div",{className:t.radioGroup,children:[e.jsxs("label",{className:t.radio,children:[e.jsx("input",{type:"radio",checked:n.isRoot,onChange:()=>c("isRoot",!0)}),e.jsx("span",{children:"Root CA"})]}),e.jsxs("label",{className:t.radio,children:[e.jsx("input",{type:"radio",checked:!n.isRoot,onChange:()=>c("isRoot",!1)}),e.jsx("span",{children:"Intermediate CA"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Common Name (CN) *"}),e.jsx(y,{value:n.commonName,onChange:l=>c("commonName",l.target.value),placeholder:"My Root CA",required:!0})]}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Organization (O)"}),e.jsx(y,{value:n.organization,onChange:l=>c("organization",l.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Organizational Unit (OU)"}),e.jsx(y,{value:n.organizationalUnit,onChange:l=>c("organizationalUnit",l.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Country (C)"}),e.jsx(y,{value:n.country,onChange:l=>c("country",l.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"State/Province (ST)"}),e.jsx(y,{value:n.state,onChange:l=>c("state",l.target.value),placeholder:"California"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"City/Locality (L)"}),e.jsx(y,{value:n.locality,onChange:l=>c("locality",l.target.value),placeholder:"San Francisco"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Settings"}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Validity (days)"}),e.jsx(y,{type:"number",value:n.validityDays,onChange:l=>c("validityDays",l.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Key Size (bits)"}),e.jsxs("select",{className:t.select,value:n.keySize,onChange:l=>c("keySize",l.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]})]})})}function K({isOpen:S,onClose:v,onSuccess:n}){const[j,x]=d.useState(null),[p,c]=d.useState("PEM"),[l,m]=d.useState(""),[b,_]=d.useState(null),[u,T]=d.useState(!1),[N,f]=d.useState(null),D=(r,C)=>{if(x(r),_(C),f(null),r&&p==="PEM"){const B=new FileReader;B.onload=R=>{const A=R.target.result;if(A.includes("BEGIN CERTIFICATE")){const z=A.split(`
`),s=z.findIndex(E=>E.includes("BEGIN CERTIFICATE")),o=z.findIndex(E=>E.includes("END CERTIFICATE"));s>=0&&o>s&&f({type:"PEM Certificate",lines:o-s+1,size:r.size})}},B.readAsText(r)}},I=async()=>{if(!j){h.error("Please select a file to upload");return}if(p==="PKCS12"&&!l){h.error("Password is required for PKCS12 format");return}T(!0);const r=new FormData;r.append("file",j),r.append("format",p),l&&r.append("password",l);try{const C=await U.post("/api/v2/certificates/import",r,{headers:{"Content-Type":"multipart/form-data"}});h.success("CA imported successfully"),x(null),c("PEM"),m(""),f(null),_(null),n&&n(C),v()}catch(C){h.error(`Import failed: ${C.message||"Unknown error"}`)}finally{T(!1)}},P=()=>{u||(x(null),c("PEM"),m(""),f(null),_(null),v())},w={PEM:".pem,.crt,.cer",DER:".der,.cer",PKCS12:".p12,.pfx"};return e.jsx(q,{isOpen:S,onClose:P,title:"Import Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"default",onClick:P,disabled:u,children:"Cancel"}),e.jsx(g,{variant:"primary",onClick:I,disabled:!j||u||!!b,children:u?"Importing...":"Import CA"})]}),children:e.jsxs("div",{className:i.form,children:[e.jsxs("div",{className:i.fieldGroup,children:[e.jsx("label",{className:i.label,children:"Certificate Format"}),e.jsx("div",{className:i.formatSelector,children:["PEM","DER","PKCS12"].map(r=>e.jsxs("label",{className:i.formatOption,children:[e.jsx("input",{type:"radio",name:"format",value:r,checked:p===r,onChange:C=>{c(C.target.value),x(null),f(null)},disabled:u}),e.jsx("span",{className:i.formatLabel,children:r}),e.jsxs("span",{className:i.formatHint,children:[r==="PEM"&&"Base64 encoded, most common",r==="DER"&&"Binary format",r==="PKCS12"&&"Password protected bundle"]})]},r))})]}),e.jsxs("div",{className:i.fieldGroup,children:[e.jsx("label",{className:i.label,children:"Certificate File"}),e.jsx(L,{value:j,onChange:D,accept:w[p],maxSize:5*1024*1024,disabled:u,error:b})]}),p==="PKCS12"&&e.jsxs("div",{className:i.fieldGroup,children:[e.jsx("label",{className:i.label,children:"Password"}),e.jsx(y,{type:"password",value:l,onChange:r=>m(r.target.value),placeholder:"Enter PKCS12 password",disabled:u})]}),N&&e.jsxs("div",{className:i.preview,children:[e.jsx("h4",{className:i.previewTitle,children:"Certificate Preview"}),e.jsxs("div",{className:i.previewContent,children:[e.jsxs("div",{className:i.previewRow,children:[e.jsx("span",{className:i.previewLabel,children:"Type:"}),e.jsx("span",{className:i.previewValue,children:N.type})]}),e.jsxs("div",{className:i.previewRow,children:[e.jsx("span",{className:i.previewLabel,children:"Size:"}),e.jsxs("span",{className:i.previewValue,children:[N.size," bytes"]})]}),N.lines&&e.jsxs("div",{className:i.previewRow,children:[e.jsx("span",{className:i.previewLabel,children:"Lines:"}),e.jsx("span",{className:i.previewValue,children:N.lines})]})]})]}),e.jsx("div",{className:i.helpText,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The CA certificate will be validated and imported into the system. Make sure the file format matches the selected type."]})})]})})}const V="_filtersSection_1nm9q_2",Y="_filterGroup_1nm9q_13",Q="_tableContainer_1nm9q_56",X="_caNameCell_1nm9q_99",J="_caExpandBtn_1nm9q_105",W="_collapsed_1nm9q_123",Z="_noChildren_1nm9q_127",ee="_caTreeIndent_1nm9q_132",se="_caIcon_1nm9q_160",ae="_root_1nm9q_165",te="_intermediate_1nm9q_169",le="_orphan_1nm9q_173",ne="_statusBadge_1nm9q_178",ie="_actionsCell_1nm9q_201",re="_actionBtn_1nm9q_206",oe="_orphanedSection_1nm9q_231",ce="_orphanedHeader_1nm9q_239",de="_orphanedHeaderText_1nm9q_253",he="_orphanedTable_1nm9q_259",a={filtersSection:V,filterGroup:Y,tableContainer:Q,caNameCell:X,caExpandBtn:J,collapsed:W,noChildren:Z,caTreeIndent:ee,caIcon:se,root:ae,intermediate:te,orphan:le,statusBadge:ne,actionsCell:ie,actionBtn:re,orphanedSection:oe,orphanedHeader:ce,orphanedHeaderText:de,orphanedTable:he};function Se(){const[S,v]=d.useState("all"),[n,j]=d.useState("all"),[x,p]=d.useState("name"),[c,l]=d.useState(""),[m,b]=d.useState(new Set),[_,u]=d.useState(!1),[T,N]=d.useState(!1),{data:f,isLoading:D,error:I}=M(),P=$(),w=s=>{confirm(`Delete CA "${s.name}"? This cannot be undone.`)&&P.mutate(s.id,{onSuccess:()=>h.success("CA deleted"),onError:()=>h.error("Failed to delete CA")})},r=s=>{const o=new Set(m);o.has(s)?o.delete(s):o.add(s),b(o)},C=()=>{const s=f?.data||[];if(s.length===0){h.error("No data to export");return}O(s,"cas-export",{format:"csv",columns:["id","name","type","status","issued","expires","certs"]}),h.success("CAs exported successfully")},B=()=>{h.success("CA imported successfully")};if(D)return e.jsxs("div",{className:a.caList,children:[e.jsx(k,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(F,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading CAs..."})]});if(I)return e.jsxs("div",{className:a.caList,children:[e.jsx(k,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(F,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading CAs: ",I.message]})]});const R=f?.data||[],A=[],z=R.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:a.caList,children:[e.jsx(k,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsxs(F,{variant:"success",children:[z," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:"ph ph-upload-simple",onClick:()=>N(!0),children:"Import"}),e.jsx(g,{icon:"ph ph-download-simple",onClick:C,children:"Export"}),e.jsx(g,{variant:"primary",icon:"ph ph-plus",onClick:()=>u(!0),children:"Create CA"})]})}),e.jsxs("div",{className:a.filtersSection,children:[e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"type-filter",children:"TYPE"}),e.jsxs("select",{id:"type-filter",value:S,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"root",children:"Root"}),e.jsx("option",{value:"intermediate",children:"Intermediate"})]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"status-filter",children:"STATUS"}),e.jsxs("select",{id:"status-filter",value:n,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"sort-filter",children:"SORT BY"}),e.jsxs("select",{id:"sort-filter",value:x,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued Date"}),e.jsx("option",{value:"expires",children:"Expires Date"})]})]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{className:a.filterGroup,children:e.jsx("input",{type:"text",id:"search-filter",placeholder:"Search CAs...",value:c,onChange:s=>l(s.target.value)})})]}),e.jsx("div",{className:a.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caNameCell,children:[e.jsx("button",{className:`${a.caExpandBtn} ${s.children?"":a.noChildren} ${m.has(s.id)?"":a.collapsed}`,onClick:()=>s.children&&r(s.id),children:e.jsx("i",{className:"ph ph-caret-down"})}),e.jsx("i",{className:`ph ph-bank ${a.caIcon} ${a.root}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:o=>{o.stopPropagation(),w(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id),s.children&&m.has(s.id)&&s.children.map(o=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caTreeIndent,children:[e.jsx("i",{className:`ph ph-git-branch ${a.caIcon} ${a.intermediate}`}),e.jsx("span",{children:o.name})]})}),e.jsx("td",{children:e.jsx("span",{children:o.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${o.status.toLowerCase()}`,children:o.status})}),e.jsx("td",{children:o.issued}),e.jsx("td",{children:o.expires}),e.jsx("td",{children:o.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:E=>{E.stopPropagation(),w(o)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},o.id))]}))})]})}),A.length>0&&e.jsxs("div",{className:a.orphanedSection,children:[e.jsxs("div",{className:a.orphanedHeader,children:[e.jsx("i",{className:"ph ph-warning"}),e.jsx("span",{className:a.orphanedHeaderText,children:"Orphaned Intermediate CAs"})]}),e.jsx("div",{className:a.orphanedTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:A.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caNameCell,children:[e.jsx("i",{className:`ph ph-warning ${a.caIcon} ${a.orphan}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:o=>{o.stopPropagation(),w(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id))})]})})]}),e.jsx(H,{isOpen:_,onClose:()=>u(!1)}),e.jsx(K,{isOpen:T,onClose:()=>N(!1),onSuccess:B})]})}export{Se as CAList,Se as default};
