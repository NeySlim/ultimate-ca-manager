import{a as A,r as g,j as e,B as m,z as _}from"./index-C-4zSNrs.js";import{P as v}from"./PageTopBar-b0Xgy9Vh.js";import{F as R,a as C}from"./FiltersBar-CFN5jT_-.js";import{P as S,a as c}from"./PillFilter-DYY8ZSlk.js";import{B as l}from"./Badge-Cl2Er17o.js";import{u as B}from"./useQuery-xIW_GXkH.js";import{u as z}from"./useMutation-Cl7ZHP5e.js";import{a as x}from"./api-ClVrI7m4.js";const N={getAll:async(a={})=>{const r=await x.get("/api/v2/certificates",{params:a}),n=(r.data||[]).map(i=>{const u=new Date(i.valid_to),d=Math.ceil((u-new Date)/(1e3*60*60*24));let o="ACTIVE";i.revoked?o="REVOKED":d<0?o="EXPIRED":d<=7?o="CRITICAL":d<=30&&(o="EXPIRING SOON");const p=i.subject?.match(/CN=([^,]+)/),f=p?p[1]:i.subject||"Unnamed Certificate",j=i.subject?.includes("Server")?"Server":"Client";return{id:i.id,name:f,serial:i.serial||"N/A",type:j,issuer:i.issuer||"Unknown",status:o,issued:i.valid_from?i.valid_from.split("T")[0]:"N/A",expires:i.valid_to?i.valid_to.split("T")[0]:"N/A",daysLeft:d>0?d:0,_raw:i}});return{data:n,meta:r.meta||{page:1,per_page:20,total:n.length}}},getById:async a=>(await x.get(`/api/v2/certificates/${a}`)).data,revoke:async(a,r)=>(await x.post(`/api/v2/certificates/${a}/revoke`,{reason:r})).data,renew:async a=>(await x.post(`/api/v2/certificates/${a}/renew`)).data,download:async(a,r="pem")=>await x.get(`/api/v2/certificates/${a}/download`,{params:{format:r},responseType:"blob"})},h={all:["certificates"],lists:()=>[...h.all,"list"],list:a=>[...h.lists(),a],details:()=>[...h.all,"detail"],detail:a=>[...h.details(),a]},F=(a={})=>B({queryKey:h.list(a),queryFn:()=>N.getAll(a)}),D=()=>{const a=A();return z({mutationFn:({id:r,reason:n})=>N.revoke(r,n),onSuccess:()=>{a.invalidateQueries({queryKey:h.all})}})},L="_tableContainer_2f75z_2",$="_certNameCell_2f75z_45",P="_certName_2f75z_45",O="_certSerial_2f75z_56",M="_badgeType_2f75z_63",U="_badgeInfo_2f75z_74",K="_badgeNeutral_2f75z_79",W="_badgeStatus_2f75z_84",q="_badgeSuccess_2f75z_95",X="_badgeWarning_2f75z_100",G="_badgeError_2f75z_105",Q="_expiresCell_2f75z_111",V="_badgeDays_2f75z_117",Y="_actionsCell_2f75z_130",H="_actionBtn_2f75z_135",t={tableContainer:L,certNameCell:$,certName:P,certSerial:O,badgeType:M,badgeInfo:U,badgeNeutral:K,badgeStatus:W,badgeSuccess:q,badgeWarning:X,badgeError:G,expiresCell:Q,badgeDays:V,actionsCell:Y,actionBtn:H};function ne(){const[a,r]=g.useState("all"),[n,i]=g.useState("all"),[u,y]=g.useState("name"),{data:d,isLoading:o,error:p}=F(),{mutate:f}=D(),j=s=>{window.confirm(`Revoke certificate ${s.name}?`)&&f({id:s.id,reason:"Revoked by administrator"},{onSuccess:()=>_.success(`Certificate ${s.name} revoked successfully`),onError:T=>_.error(`Failed to revoke certificate: ${T.message}`)})},E=s=>s<=7?t.badgeError:s<=30?t.badgeWarning:t.badgeSuccess,I=s=>s==="CRITICAL"?t.badgeError:s==="EXPIRING SOON"?t.badgeWarning:t.badgeSuccess,w=s=>s==="Server"||s==="Client"?t.badgeInfo:t.badgeNeutral;if(o)return e.jsxs("div",{className:t.certificateList,children:[e.jsx(v,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(l,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading certificates..."})]});if(p)return e.jsxs("div",{className:t.certificateList,children:[e.jsx(v,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(l,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading certificates: ",p.message]})]});const b=d?.data||[],k=b.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:t.certificateList,children:[e.jsx(v,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsxs(l,{variant:"success",children:[k," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:"ph ph-upload-simple",children:"Import"}),e.jsx(m,{icon:"ph ph-download-simple",children:"Export"}),e.jsx(m,{variant:"primary",icon:"ph ph-file-plus",children:"Issue Certificate"})]})}),e.jsxs(R,{children:[e.jsx(C,{label:"TYPE",children:e.jsxs(S,{children:[e.jsxs(c,{active:a==="all",onClick:()=>r("all"),children:["All ",e.jsx(l,{variant:"secondary",children:"(247)"})]}),e.jsxs(c,{active:a==="server",onClick:()=>r("server"),children:["Server ",e.jsx(l,{variant:"secondary",children:"(89)"})]}),e.jsxs(c,{active:a==="client",onClick:()=>r("client"),children:["Client ",e.jsx(l,{variant:"secondary",children:"(158)"})]}),e.jsxs(c,{active:a==="acme",onClick:()=>r("acme"),children:["ACME ",e.jsx(l,{variant:"secondary",children:"(34)"})]})]})}),e.jsx(C,{label:"STATUS",children:e.jsxs(S,{children:[e.jsxs(c,{active:n==="all",onClick:()=>i("all"),children:["All ",e.jsx(l,{variant:"secondary",children:"(247)"})]}),e.jsxs(c,{active:n==="active",onClick:()=>i("active"),children:["Active ",e.jsx(l,{variant:"secondary",children:"(235)"})]}),e.jsxs(c,{active:n==="expiring",onClick:()=>i("expiring"),children:["Expiring ",e.jsx(l,{variant:"secondary",children:"(12)"})]}),e.jsxs(c,{active:n==="expired",onClick:()=>i("expired"),children:["Expired ",e.jsx(l,{variant:"secondary",children:"(0)"})]}),e.jsxs(c,{active:n==="revoked",onClick:()=>i("revoked"),children:["Revoked ",e.jsx(l,{variant:"secondary",children:"(0)"})]})]})}),e.jsx(C,{label:"SORT",children:e.jsxs("select",{value:u,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"expires",children:"Expires"})]})})]}),e.jsx("div",{className:t.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"10%"},children:"TYPE"}),e.jsx("th",{style:{width:"15%"},children:"ISSUER"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"10%"},children:"ISSUED"}),e.jsx("th",{style:{width:"10%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"5%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.certNameCell,children:[e.jsx("span",{className:t.certName,children:s.name}),e.jsxs("span",{className:t.certSerial,children:["Serial: ",s.serial]})]})}),e.jsx("td",{children:e.jsx("span",{className:`${t.badgeType} ${w(s.type)}`,children:s.type})}),e.jsx("td",{children:s.issuer}),e.jsx("td",{children:e.jsx("span",{className:`${t.badgeStatus} ${I(s.status)}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:e.jsxs("div",{className:t.expiresCell,children:[e.jsx("span",{children:s.expires}),e.jsxs("span",{className:`${t.badgeDays} ${E(s.daysLeft)}`,children:[s.daysLeft," DAYS"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"Download",children:e.jsx("i",{className:"ph ph-download-simple"})}),e.jsx("button",{className:t.actionBtn,title:"Revoke",onClick:()=>j(s),children:e.jsx("i",{className:"ph ph-x-circle"})}),e.jsx("button",{className:t.actionBtn,title:"More",children:e.jsx("i",{className:"ph ph-dots-three-outline-vertical"})})]})})]},s.id))})]})})]})}export{ne as CertificateList,ne as default};
