import{a as A,r as C,j as e,B as k,z as f}from"./index-BWDmoKA7.js";import{P as E}from"./PageTopBar-Ce7PBM4r.js";import{F as q,a as I}from"./FiltersBar-Ujgmyon6.js";import{P as T,a as m}from"./PillFilter-B1hXcMnX.js";import{B as h}from"./Badge-BFuVPCyZ.js";import{u as P}from"./useQuery-gjiR4eck.js";import{u as R}from"./useMutation-BNvbrO0b.js";import{a as b}from"./api-ClVrI7m4.js";import{a as $,M as O}from"./Modal-4XzzdvWm.js";import{I as j}from"./Input-M6RyvAtx.js";import{e as M}from"./export-BEFxFx9V.js";const w={getAll:async(n={})=>{const r=await b.get("/api/v2/certificates",{params:n}),s=(r.data||[]).map(l=>{const y=new Date(l.valid_to),u=Math.ceil((y-new Date)/(1e3*60*60*24));let o="ACTIVE";l.revoked?o="REVOKED":u<0?o="EXPIRED":u<=7?o="CRITICAL":u<=30&&(o="EXPIRING SOON");const p=l.subject?.match(/CN=([^,]+)/),N=p?p[1]:l.subject||"Unnamed Certificate",d=l.subject?.includes("Server")?"Server":"Client";return{id:l.id,name:N,serial:l.serial||"N/A",type:d,issuer:l.issuer||"Unknown",status:o,issued:l.valid_from?l.valid_from.split("T")[0]:"N/A",expires:l.valid_to?l.valid_to.split("T")[0]:"N/A",daysLeft:u>0?u:0,_raw:l}});return{data:s,meta:r.meta||{page:1,per_page:20,total:s.length}}},getById:async n=>(await b.get(`/api/v2/certificates/${n}`)).data,revoke:async(n,r)=>(await b.post(`/api/v2/certificates/${n}/revoke`,{reason:r})).data,renew:async n=>(await b.post(`/api/v2/certificates/${n}/renew`)).data,download:async(n,r="pem")=>await b.get(`/api/v2/certificates/${n}/download`,{params:{format:r},responseType:"blob"}),issue:async n=>(await b.post("/api/v2/certificates",n)).data},v={all:["certificates"],lists:()=>[...v.all,"list"],list:n=>[...v.lists(),n],details:()=>[...v.all,"detail"],detail:n=>[...v.details(),n]},K=(n={})=>P({queryKey:v.list(n),queryFn:()=>w.getAll(n)}),U=()=>{const n=A();return R({mutationFn:({id:r,reason:s})=>w.revoke(r,s),onSuccess:()=>{n.invalidateQueries({queryKey:v.all})}})},W=()=>{const n=A();return R({mutationFn:w.issue,onSuccess:()=>{n.invalidateQueries({queryKey:v.all})}})},H="_form_7q3s3_1",Q="_section_7q3s3_7",V="_sectionTitle_7q3s3_13",X="_fieldGroup_7q3s3_22",Y="_fieldRow_7q3s3_29",J="_label_7q3s3_35",Z="_fieldHint_7q3s3_43",ee="_select_7q3s3_49",se="_checkboxGroup_7q3s3_75",ae="_checkbox_7q3s3_75",a={form:H,section:Q,sectionTitle:V,fieldGroup:X,fieldRow:Y,label:J,fieldHint:Z,select:ee,checkboxGroup:se,checkbox:ae};function ie({isOpen:n,onClose:r}){const[s,l]=C.useState({ca_id:"",common_name:"",organization:"",organizational_unit:"",country:"",state:"",locality:"",san:"",validity_days:"365",key_size:"2048",key_usage:["digitalSignature","keyEncipherment"]}),y=W(),{data:S,isLoading:u}=$(),o=S?.data||[];C.useEffect(()=>{o.length>0&&!s.ca_id&&l(t=>({...t,ca_id:o[0].id.toString()}))},[o,s.ca_id]);const p=t=>{if(t.preventDefault(),!s.ca_id){f.error("Please select a Certificate Authority");return}if(!s.common_name){f.error("Common Name is required");return}const x={ca_id:parseInt(s.ca_id),common_name:s.common_name,organization:s.organization,organizational_unit:s.organizational_unit,country:s.country,state:s.state,locality:s.locality,san:s.san,validity_days:parseInt(s.validity_days),key_size:parseInt(s.key_size),key_usage:s.key_usage};y.mutate(x,{onSuccess:()=>{f.success("Certificate issued successfully"),r(),N()},onError:_=>{f.error(`Failed to issue certificate: ${_.message}`)}})},N=()=>{l({ca_id:o.length>0?o[0].id.toString():"",common_name:"",organization:"",organizational_unit:"",country:"",state:"",locality:"",san:"",validity_days:"365",key_size:"2048",key_usage:["digitalSignature","keyEncipherment"]})},d=(t,x)=>{l(_=>({..._,[t]:x}))},g=t=>{l(x=>({...x,key_usage:x.key_usage.includes(t)?x.key_usage.filter(_=>_!==t):[...x.key_usage,t]}))};return e.jsx(O,{isOpen:n,onClose:r,title:"Issue Certificate",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"default",onClick:r,children:"Cancel"}),e.jsx(k,{variant:"primary",onClick:p,disabled:y.isPending,children:y.isPending?"Issuing...":"Issue Certificate"})]}),children:e.jsxs("form",{className:a.form,onSubmit:p,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Certificate Authority *"}),e.jsx("select",{className:a.select,value:s.ca_id,onChange:t=>d("ca_id",t.target.value),disabled:u,children:u?e.jsx("option",{children:"Loading CAs..."}):o.length===0?e.jsx("option",{children:"No CAs available"}):o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Common Name (CN) *"}),e.jsx(j,{value:s.common_name,onChange:t=>d("common_name",t.target.value),placeholder:"example.com",required:!0})]}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Organization (O)"}),e.jsx(j,{value:s.organization,onChange:t=>d("organization",t.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Organizational Unit (OU)"}),e.jsx(j,{value:s.organizational_unit,onChange:t=>d("organizational_unit",t.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Country (C)"}),e.jsx(j,{value:s.country,onChange:t=>d("country",t.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"State/Province (ST)"}),e.jsx(j,{value:s.state,onChange:t=>d("state",t.target.value),placeholder:"California"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"City/Locality (L)"}),e.jsx(j,{value:s.locality,onChange:t=>d("locality",t.target.value),placeholder:"San Francisco"})]})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Subject Alternative Names (SAN)"}),e.jsx(j,{value:s.san,onChange:t=>d("san",t.target.value),placeholder:"DNS:example.com, DNS:*.example.com, IP:192.168.1.1"}),e.jsx("span",{className:a.fieldHint,children:"Comma-separated list (e.g., DNS:example.com, IP:192.168.1.1)"})]})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Settings"}),e.jsxs("div",{className:a.fieldRow,children:[e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Validity (days)"}),e.jsx(j,{type:"number",value:s.validity_days,onChange:t=>d("validity_days",t.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:a.fieldGroup,children:[e.jsx("label",{className:a.label,children:"Key Size (bits)"}),e.jsxs("select",{className:a.select,value:s.key_size,onChange:t=>d("key_size",t.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]}),e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:a.checkboxGroup,children:[e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("digitalSignature"),onChange:()=>g("digitalSignature")}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("keyEncipherment"),onChange:()=>g("keyEncipherment")}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("dataEncipherment"),onChange:()=>g("dataEncipherment")}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("keyAgreement"),onChange:()=>g("keyAgreement")}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("keyCertSign"),onChange:()=>g("keyCertSign")}),e.jsx("span",{children:"Certificate Signing"})]}),e.jsxs("label",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",checked:s.key_usage.includes("crlSign"),onChange:()=>g("crlSign")}),e.jsx("span",{children:"CRL Signing"})]})]})]})]})})}const te="_tableContainer_2f75z_2",ne="_certNameCell_2f75z_45",le="_certName_2f75z_45",ce="_certSerial_2f75z_56",re="_badgeType_2f75z_63",oe="_badgeInfo_2f75z_74",de="_badgeNeutral_2f75z_79",he="_badgeStatus_2f75z_84",ue="_badgeSuccess_2f75z_95",xe="_badgeWarning_2f75z_100",me="_badgeError_2f75z_105",pe="_expiresCell_2f75z_111",ge="_badgeDays_2f75z_117",je="_actionsCell_2f75z_130",fe="_actionBtn_2f75z_135",c={tableContainer:te,certNameCell:ne,certName:le,certSerial:ce,badgeType:re,badgeInfo:oe,badgeNeutral:de,badgeStatus:he,badgeSuccess:ue,badgeWarning:xe,badgeError:me,expiresCell:pe,badgeDays:ge,actionsCell:je,actionBtn:fe};function ze(){const[n,r]=C.useState("all"),[s,l]=C.useState("all"),[y,S]=C.useState("name"),[u,o]=C.useState(!1),{data:p,isLoading:N,error:d}=K(),{mutate:g}=U(),t=i=>{window.confirm(`Revoke certificate ${i.name}?`)&&g({id:i.id,reason:"Revoked by administrator"},{onSuccess:()=>f.success(`Certificate ${i.name} revoked successfully`),onError:B=>f.error(`Failed to revoke certificate: ${B.message}`)})},x=()=>{const i=p?.data||[];if(i.length===0){f.error("No data to export");return}M(i,"certificates-export",{format:"csv",columns:["id","name","type","status","issuedBy","daysLeft","issued","expires"]}),f.success("Certificates exported successfully")},_=i=>{window.open(`/api/v2/certificates/${i.id}/download`,"_blank")},D=i=>i<=7?c.badgeError:i<=30?c.badgeWarning:c.badgeSuccess,F=i=>i==="CRITICAL"?c.badgeError:i==="EXPIRING SOON"?c.badgeWarning:c.badgeSuccess,L=i=>i==="Server"||i==="Client"?c.badgeInfo:c.badgeNeutral;if(N)return e.jsxs("div",{className:c.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(h,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading certificates..."})]});if(d)return e.jsxs("div",{className:c.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(h,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading certificates: ",d.message]})]});const z=p?.data||[],G=z.filter(i=>i.status==="ACTIVE").length;return e.jsxs("div",{className:c.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsxs(h,{variant:"success",children:[G," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(k,{icon:"ph ph-upload-simple",children:"Import"}),e.jsx(k,{icon:"ph ph-download-simple",onClick:x,children:"Export"}),e.jsx(k,{variant:"primary",icon:"ph ph-file-plus",onClick:()=>o(!0),children:"Issue Certificate"})]})}),e.jsxs(q,{children:[e.jsx(I,{label:"TYPE",children:e.jsxs(T,{children:[e.jsxs(m,{active:n==="all",onClick:()=>r("all"),children:["All ",e.jsx(h,{variant:"secondary",children:"(247)"})]}),e.jsxs(m,{active:n==="server",onClick:()=>r("server"),children:["Server ",e.jsx(h,{variant:"secondary",children:"(89)"})]}),e.jsxs(m,{active:n==="client",onClick:()=>r("client"),children:["Client ",e.jsx(h,{variant:"secondary",children:"(158)"})]}),e.jsxs(m,{active:n==="acme",onClick:()=>r("acme"),children:["ACME ",e.jsx(h,{variant:"secondary",children:"(34)"})]})]})}),e.jsx(I,{label:"STATUS",children:e.jsxs(T,{children:[e.jsxs(m,{active:s==="all",onClick:()=>l("all"),children:["All ",e.jsx(h,{variant:"secondary",children:"(247)"})]}),e.jsxs(m,{active:s==="active",onClick:()=>l("active"),children:["Active ",e.jsx(h,{variant:"secondary",children:"(235)"})]}),e.jsxs(m,{active:s==="expiring",onClick:()=>l("expiring"),children:["Expiring ",e.jsx(h,{variant:"secondary",children:"(12)"})]}),e.jsxs(m,{active:s==="expired",onClick:()=>l("expired"),children:["Expired ",e.jsx(h,{variant:"secondary",children:"(0)"})]}),e.jsxs(m,{active:s==="revoked",onClick:()=>l("revoked"),children:["Revoked ",e.jsx(h,{variant:"secondary",children:"(0)"})]})]})}),e.jsx(I,{label:"SORT",children:e.jsxs("select",{value:y,onChange:i=>S(i.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"expires",children:"Expires"})]})})]}),e.jsx("div",{className:c.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"10%"},children:"TYPE"}),e.jsx("th",{style:{width:"15%"},children:"ISSUER"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"10%"},children:"ISSUED"}),e.jsx("th",{style:{width:"10%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"5%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:z.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:c.certNameCell,children:[e.jsx("span",{className:c.certName,children:i.name}),e.jsxs("span",{className:c.certSerial,children:["Serial: ",i.serial]})]})}),e.jsx("td",{children:e.jsx("span",{className:`${c.badgeType} ${L(i.type)}`,children:i.type})}),e.jsx("td",{children:i.issuer}),e.jsx("td",{children:e.jsx("span",{className:`${c.badgeStatus} ${F(i.status)}`,children:i.status})}),e.jsx("td",{children:i.issued}),e.jsx("td",{children:e.jsxs("div",{className:c.expiresCell,children:[e.jsx("span",{children:i.expires}),e.jsxs("span",{className:`${c.badgeDays} ${D(i.daysLeft)}`,children:[i.daysLeft," DAYS"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:c.actionsCell,children:[e.jsx("button",{className:c.actionBtn,title:"Download",onClick:()=>_(i),children:e.jsx("i",{className:"ph ph-download-simple"})}),e.jsx("button",{className:c.actionBtn,title:"Revoke",onClick:()=>t(i),children:e.jsx("i",{className:"ph ph-x-circle"})}),e.jsx("button",{className:c.actionBtn,title:"More",children:e.jsx("i",{className:"ph ph-dots-three-outline-vertical"})})]})})]},i.id))})]})}),e.jsx(ie,{isOpen:u,onClose:()=>o(!1)})]})}export{ze as CertificateList,ze as default};
