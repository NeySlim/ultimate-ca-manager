import{j as e,r as u,B as l,C as x,z as n,b as R}from"./index-07BoWWAq.js";import{P as y}from"./PageTopBar-DOI4vcQk.js";import{S as _,a as c}from"./StatsGrid-CKqOj6LJ.js";import{D as k}from"./DataTable-KxVBW3v-.js";import{B as i}from"./Badge-BLJ5U_u7.js";import{M as A}from"./Modal-Cni74-1Y.js";import{g as p}from"./getBadgeVariant-BF98r0-3.js";import{e as L}from"./export-BEFxFx9V.js";const w="_container_1rlrn_1",M="_section_1rlrn_7",G="_sectionTitle_1rlrn_13",T="_grid_1rlrn_22",U="_field_1rlrn_28",I="_value_1rlrn_42",D="_mono_1rlrn_47",a={container:w,section:M,sectionTitle:G,grid:T,field:U,value:I,mono:D};function F({isOpen:o,onClose:r,ca:s}){return s?e.jsx(A,{isOpen:o,onClose:r,title:"CA Details",size:"large",children:e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Basic Information"}),e.jsxs("div",{className:a.grid,children:[e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Common Name"}),e.jsx("div",{className:a.value,children:s.name||s.commonName})]}),e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Type"}),e.jsx(i,{variant:p("ca-type",s.type),children:s.type})]}),e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Status"}),e.jsx(i,{variant:p("ca-status",s.status||s.crlStatus),children:s.status||s.crlStatus})]}),s.issuer&&e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Issuer"}),e.jsx("div",{className:a.value,children:s.issuer})]})]})]}),s.validFrom&&e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Validity"}),e.jsxs("div",{className:a.grid,children:[e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Valid From"}),e.jsx("div",{className:a.value,children:s.validFrom})]}),e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Valid Until"}),e.jsx("div",{className:a.value,children:s.validUntil})]})]})]}),(s.fingerprint||s.serialNumber)&&e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"Identification"}),e.jsxs("div",{className:a.grid,children:[s.serialNumber&&e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Serial Number"}),e.jsx("div",{className:a.mono,children:s.serialNumber})]}),s.fingerprint&&e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Fingerprint (SHA-256)"}),e.jsx("div",{className:a.mono,children:s.fingerprint})]})]})]}),(s.ocspStatus||s.lastGenerated||s.nextUpdate)&&e.jsxs("div",{className:a.section,children:[e.jsx("h3",{className:a.sectionTitle,children:"CRL/OCSP Information"}),e.jsxs("div",{className:a.grid,children:[s.lastGenerated&&e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Last Generated"}),e.jsx("div",{className:a.value,children:s.lastGenerated})]}),s.nextUpdate&&e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"Next Update"}),e.jsx("div",{className:a.value,children:s.nextUpdate})]}),s.ocspStatus&&e.jsxs("div",{className:a.field,children:[e.jsx("label",{children:"OCSP Status"}),e.jsx(i,{variant:p("ocsp-status",s.ocspStatus),children:s.ocspStatus})]})]})]})]})}):null}const z="_crlManagement_yal1l_1",B={crlManagement:z};function K(){const[o,r]=u.useState(!1),[s,j]=u.useState(null),[f,v]=u.useState(!1),b=t=>{window.open(`/api/v2/crl/download/${t}`,"_blank"),n.success("CRL download started")},C=async t=>{if(confirm(`Regenerate CRL for ${t.name}? This may take a moment.`)){r(!0);try{await R.post(`/api/v2/crl/regenerate/${t.id}`),n.success("CRL regenerated successfully")}catch{n.error("Failed to regenerate CRL")}finally{r(!1)}}},g=t=>{j(t),v(!0)},S=()=>{if(h.length===0){n.error("No CRL data to export");return}L(h,"crls-export",{format:"csv",columns:["id","name","crlStatus","lastGenerated","nextUpdate","ocspStatus"]}),n.success("CRLs exported successfully")},h=[{id:1,name:"Internal Root CA",crlStatus:"active",lastGenerated:"2 hours ago",nextUpdate:"In 22 hours",ocspStatus:"enabled",revokedCerts:3},{id:2,name:"Production Intermediate CA",crlStatus:"active",lastGenerated:"3 hours ago",nextUpdate:"In 21 hours",ocspStatus:"enabled",revokedCerts:12},{id:3,name:"Development Intermediate CA",crlStatus:"active",lastGenerated:"1 hour ago",nextUpdate:"In 23 hours",ocspStatus:"enabled",revokedCerts:8},{id:4,name:"ECDSA Root CA",crlStatus:"stale",lastGenerated:"3 days ago",nextUpdate:"Overdue",ocspStatus:"enabled",revokedCerts:1},{id:5,name:"Testing Root CA",crlStatus:"disabled",lastGenerated:"-",nextUpdate:"-",ocspStatus:"disabled",revokedCerts:0}],N=[{key:"name",label:"CA Name",sortable:!0,render:t=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"12px"},children:t.name})},{key:"crlStatus",label:"CRL Status",sortable:!0,render:t=>{const d={active:"success",stale:"warning",disabled:"info"},m={active:"Active",stale:"Stale",disabled:"Disabled"};return e.jsx(i,{variant:d[t.crlStatus],children:m[t.crlStatus]})}},{key:"lastGenerated",label:"Last Generated",sortable:!0},{key:"nextUpdate",label:"Next Update",sortable:!0},{key:"ocspStatus",label:"OCSP",sortable:!0,render:t=>{const d={enabled:"success",disabled:"info"},m={enabled:"Enabled",disabled:"Disabled"};return e.jsx(i,{variant:d[t.ocspStatus],children:m[t.ocspStatus]})}},{key:"revokedCerts",label:"Revoked Certs",sortable:!0},{key:"actions",label:"Actions",render:t=>e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.crlStatus!=="disabled"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"default",size:"sm",icon:"ph ph-arrows-clockwise",onClick:()=>C(t),disabled:o}),e.jsx(l,{variant:"default",size:"sm",icon:"ph ph-download-simple",onClick:()=>b(t.id)})]}),t.crlStatus==="disabled"&&e.jsx(l,{variant:"default",size:"sm",icon:"ph ph-gear",onClick:()=>{window.location.href="/settings#crl",n.info("Redirecting to CRL configuration...")}})]})}];return e.jsxs("div",{className:B.crlManagement,children:[e.jsx(y,{icon:"ph ph-list-checks",title:"CRL Management",badge:e.jsx(i,{variant:"success",children:"5 Active CAs"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"ph ph-arrows-clockwise",children:"Regenerate All"}),e.jsx(l,{icon:"ph ph-download-simple",onClick:S,children:"Export CRLs"})]})}),e.jsxs(_,{columns:4,children:[e.jsx(c,{value:"23",label:"CRLs Generated",icon:"ph ph-file-text"}),e.jsx(c,{value:"14,523",label:"OCSP Requests (24h)",icon:"ph ph-chart-line"}),e.jsx(c,{value:"5",label:"Active CAs",icon:"ph ph-certificate"}),e.jsx(c,{value:"12ms",label:"Avg Response Time",icon:"ph ph-timer"})]}),e.jsxs(x,{children:[e.jsxs(x.Header,{children:[e.jsx("h3",{children:"Certificate Authorities"}),e.jsx(l,{variant:"default",icon:"ph ph-funnel",children:"Filter"})]}),e.jsx(x.Body,{children:e.jsx(k,{columns:N,data:h,onRowClick:g,pageSize:10})})]}),e.jsx(F,{isOpen:f,onClose:()=>v(!1),ca:s})]})}export{K as CRLManagement,K as default};
