import{r as d,j as e,B as E,z as m,b as $}from"./index-BQtdbJE4.js";import{P as D}from"./PageTopBar-CfCXLbty.js";import{B as F}from"./Badge-CVosZ2cQ.js";import{a as U,E as L}from"./ErrorState-Ctr4Ku5q.js";import{E as O}from"./EmptyState-DMoVcNHX.js";import{u as H,a as K,b as V}from"./useCAs-CkI2Ojeq.js";import{M}from"./Modal-BqSsg99i.js";import{I as w}from"./Input-YitDaEWS.js";import{s as n,F as Y}from"./ImportCAModal.module-DWglc2ZL.js";import{e as q}from"./export-BEFxFx9V.js";import"./useQuery-CEKymAUN.js";import"./useMutation-CVmrlIxw.js";const Q="_container_1nsix_1",X="_checkmark_1nsix_10",J="_circle_1nsix_17",W="_check_1nsix_10",Z="_message_1nsix_55",I={container:Q,checkmark:X,circle:J,check:W,message:Z},ee=({size:y=80,message:u="Success!",duration:C=2e3,onComplete:h,className:l=""})=>{const[p,j]=d.useState(!0);return d.useEffect(()=>{if(C>0){const f=setTimeout(()=>{j(!1),h?.()},C);return()=>clearTimeout(f)}},[C,h]),p?e.jsxs("div",{className:`${I.container} ${l}`,children:[e.jsxs("svg",{className:I.checkmark,width:y,height:y,viewBox:"0 0 52 52",children:[e.jsx("circle",{className:I.circle,cx:"26",cy:"26",r:"25",fill:"none"}),e.jsx("path",{className:I.check,fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),u&&e.jsx("p",{className:I.message,children:u})]}):null},se="_form_p6l90_1",ae="_section_p6l90_7",te="_sectionTitle_p6l90_13",le="_fieldGroup_p6l90_22",ie="_fieldRow_p6l90_29",ne="_label_p6l90_35",re="_radioGroup_p6l90_43",ce="_radio_p6l90_43",oe="_select_p6l90_67",t={form:se,section:ae,sectionTitle:te,fieldGroup:le,fieldRow:ie,label:ne,radioGroup:re,radio:ce,select:oe};function de({isOpen:y,onClose:u}){const[C,h]=d.useState(!1),[l,p]=d.useState({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0}),j=H(),f=i=>{if(i.preventDefault(),!l.commonName){m.error("Common Name is required");return}j.mutate({common_name:l.commonName,organization:l.organization,organizational_unit:l.organizationalUnit,country:l.country,state:l.state,locality:l.locality,validity_days:parseInt(l.validityDays),key_size:parseInt(l.keySize),is_root:l.isRoot},{onSuccess:()=>{h(!0),m.success("CA created successfully"),setTimeout(()=>{u(),h(!1),p({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0})},2e3)},onError:v=>{m.error(`Failed to create CA: ${v.message}`)}})},o=(i,v)=>{p(x=>({...x,[i]:v}))};return e.jsxs(M,{isOpen:y,onClose:u,title:"Create Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"default",onClick:u,children:"Cancel"}),e.jsx(E,{variant:"primary",onClick:f,disabled:j.isPending,children:j.isPending?"Creating...":"Create CA"})]}),children:[e.jsxs("form",{className:t.form,onSubmit:f,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"CA Type"}),e.jsxs("div",{className:t.radioGroup,children:[e.jsxs("label",{className:t.radio,children:[e.jsx("input",{type:"radio",checked:l.isRoot,onChange:()=>o("isRoot",!0)}),e.jsx("span",{children:"Root CA"})]}),e.jsxs("label",{className:t.radio,children:[e.jsx("input",{type:"radio",checked:!l.isRoot,onChange:()=>o("isRoot",!1)}),e.jsx("span",{children:"Intermediate CA"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Common Name (CN) *"}),e.jsx(w,{value:l.commonName,onChange:i=>o("commonName",i.target.value),placeholder:"My Root CA",required:!0})]}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Organization (O)"}),e.jsx(w,{value:l.organization,onChange:i=>o("organization",i.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Organizational Unit (OU)"}),e.jsx(w,{value:l.organizationalUnit,onChange:i=>o("organizationalUnit",i.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Country (C)"}),e.jsx(w,{value:l.country,onChange:i=>o("country",i.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"State/Province (ST)"}),e.jsx(w,{value:l.state,onChange:i=>o("state",i.target.value),placeholder:"California"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"City/Locality (L)"}),e.jsx(w,{value:l.locality,onChange:i=>o("locality",i.target.value),placeholder:"San Francisco"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Settings"}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Validity (days)"}),e.jsx(w,{type:"number",value:l.validityDays,onChange:i=>o("validityDays",i.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Key Size (bits)"}),e.jsxs("select",{className:t.select,value:l.keySize,onChange:i=>o("keySize",i.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]})]}),C&&e.jsx(ee,{message:"CA Created!",onComplete:()=>h(!1)})]})}function he({isOpen:y,onClose:u,onSuccess:C}){const[h,l]=d.useState(null),[p,j]=d.useState("PEM"),[f,o]=d.useState(""),[i,v]=d.useState(null),[x,k]=d.useState(!1),[g,_]=d.useState(null),G=(c,N)=>{if(l(c),v(N),_(null),c&&p==="PEM"){const R=new FileReader;R.onload=b=>{const S=b.target.result;if(S.includes("BEGIN CERTIFICATE")){const z=S.split(`
`),s=z.findIndex(T=>T.includes("BEGIN CERTIFICATE")),r=z.findIndex(T=>T.includes("END CERTIFICATE"));s>=0&&r>s&&_({type:"PEM Certificate",lines:r-s+1,size:c.size})}},R.readAsText(c)}},P=async()=>{if(!h){m.error("Please select a file to upload");return}if(p==="PKCS12"&&!f){m.error("Password is required for PKCS12 format");return}k(!0);const c=new FormData;c.append("file",h),c.append("format",p),f&&c.append("password",f);try{const N=await $.post("/api/v2/certificates/import",c,{headers:{"Content-Type":"multipart/form-data"}});m.success("CA imported successfully"),l(null),j("PEM"),o(""),_(null),v(null),C&&C(N),u()}catch(N){m.error(`Import failed: ${N.message||"Unknown error"}`)}finally{k(!1)}},B=()=>{x||(l(null),j("PEM"),o(""),_(null),v(null),u())},A={PEM:".pem,.crt,.cer",DER:".der,.cer",PKCS12:".p12,.pfx"};return e.jsx(M,{isOpen:y,onClose:B,title:"Import Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"default",onClick:B,disabled:x,children:"Cancel"}),e.jsx(E,{variant:"primary",onClick:P,disabled:!h||x||!!i,children:x?"Importing...":"Import CA"})]}),children:e.jsxs("div",{className:n.form,children:[e.jsxs("div",{className:n.fieldGroup,children:[e.jsx("label",{className:n.label,children:"Certificate Format"}),e.jsx("div",{className:n.formatSelector,children:["PEM","DER","PKCS12"].map(c=>e.jsxs("label",{className:n.formatOption,children:[e.jsx("input",{type:"radio",name:"format",value:c,checked:p===c,onChange:N=>{j(N.target.value),l(null),_(null)},disabled:x}),e.jsx("span",{className:n.formatLabel,children:c}),e.jsxs("span",{className:n.formatHint,children:[c==="PEM"&&"Base64 encoded, most common",c==="DER"&&"Binary format",c==="PKCS12"&&"Password protected bundle"]})]},c))})]}),e.jsxs("div",{className:n.fieldGroup,children:[e.jsx("label",{className:n.label,children:"Certificate File"}),e.jsx(Y,{value:h,onChange:G,accept:A[p],maxSize:5*1024*1024,disabled:x,error:i})]}),p==="PKCS12"&&e.jsxs("div",{className:n.fieldGroup,children:[e.jsx("label",{className:n.label,children:"Password"}),e.jsx(w,{type:"password",value:f,onChange:c=>o(c.target.value),placeholder:"Enter PKCS12 password",disabled:x})]}),g&&e.jsxs("div",{className:n.preview,children:[e.jsx("h4",{className:n.previewTitle,children:"Certificate Preview"}),e.jsxs("div",{className:n.previewContent,children:[e.jsxs("div",{className:n.previewRow,children:[e.jsx("span",{className:n.previewLabel,children:"Type:"}),e.jsx("span",{className:n.previewValue,children:g.type})]}),e.jsxs("div",{className:n.previewRow,children:[e.jsx("span",{className:n.previewLabel,children:"Size:"}),e.jsxs("span",{className:n.previewValue,children:[g.size," bytes"]})]}),g.lines&&e.jsxs("div",{className:n.previewRow,children:[e.jsx("span",{className:n.previewLabel,children:"Lines:"}),e.jsx("span",{className:n.previewValue,children:g.lines})]})]})]}),e.jsx("div",{className:n.helpText,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The CA certificate will be validated and imported into the system. Make sure the file format matches the selected type."]})})]})})}const pe="_filtersSection_10a3w_2",xe="_filterGroup_10a3w_13",me="_tableContainer_10a3w_56",ue="_caNameCell_10a3w_99",je="_caExpandBtn_10a3w_105",fe="_collapsed_10a3w_124",Ce="_caExpandSpacer_10a3w_128",ve="_caTreeIndent_10a3w_135",Ne="_caIcon_10a3w_163",ye="_root_10a3w_168",ge="_intermediate_10a3w_172",_e="_orphan_10a3w_176",Se="_statusBadge_10a3w_181",we="_actionsCell_10a3w_204",be="_actionBtn_10a3w_209",Ee="_orphanedSection_10a3w_234",Ae="_orphanedHeader_10a3w_242",Te="_orphanedHeaderText_10a3w_256",Ie="_orphanedTable_10a3w_262",a={filtersSection:pe,filterGroup:xe,tableContainer:me,caNameCell:ue,caExpandBtn:je,collapsed:fe,caExpandSpacer:Ce,caTreeIndent:ve,caIcon:Ne,root:ye,intermediate:ge,orphan:_e,statusBadge:Se,actionsCell:we,actionBtn:be,orphanedSection:Ee,orphanedHeader:Ae,orphanedHeaderText:Te,orphanedTable:Ie};function Oe(){const[y,u]=d.useState("all"),[C,h]=d.useState("all"),[l,p]=d.useState("name"),[j,f]=d.useState(""),[o,i]=d.useState(new Set),[v,x]=d.useState(!1),[k,g]=d.useState(!1),{data:_,isLoading:G,error:P}=K(),B=V(),A=s=>{confirm(`Delete CA "${s.name}"? This cannot be undone.`)&&B.mutate(s.id,{onSuccess:()=>m.success("CA deleted"),onError:()=>m.error("Failed to delete CA")})},c=s=>{const r=new Set(o);r.has(s)?r.delete(s):r.add(s),i(r)},N=()=>{const s=[...b,...S];if(s.length===0){m.error("No data to export");return}q(s,"cas-export",{format:"csv",columns:["id","name","type","status","issued","expires","certs"]}),m.success("CAs exported successfully")},R=()=>{m.success("CA imported successfully")};if(G)return e.jsxs("div",{className:a.caList,children:[e.jsx(D,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(F,{variant:"neutral",children:"Loading..."})}),Array.from({length:5}).map((s,r)=>e.jsx(U,{width:"100%",height:80,style:{marginBottom:"12px"}},r))]});if(P)return e.jsxs("div",{className:a.caList,children:[e.jsx(D,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(F,{variant:"danger",children:"Error"})}),e.jsx(L,{error:P,shake:!0})]});const b=_?.roots||[],S=_?.orphans||[],z=[...b,...S].filter(s=>s.status==="Active").length;return e.jsxs("div",{className:a.caList,children:[e.jsx(D,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsxs(F,{variant:"success",children:[z," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(E,{icon:"ph ph-upload-simple",onClick:()=>g(!0),children:"Import"}),e.jsx(E,{icon:"ph ph-download-simple",onClick:N,children:"Export"}),e.jsx(E,{variant:"primary",icon:"ph ph-plus",onClick:()=>x(!0),children:"Create CA"})]})}),e.jsxs("div",{className:a.filtersSection,children:[e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"type-filter",children:"TYPE"}),e.jsxs("select",{id:"type-filter",value:y,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"root",children:"Root"}),e.jsx("option",{value:"intermediate",children:"Intermediate"})]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"status-filter",children:"STATUS"}),e.jsxs("select",{id:"status-filter",value:C,onChange:s=>h(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"sort-filter",children:"SORT BY"}),e.jsxs("select",{id:"sort-filter",value:l,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued Date"}),e.jsx("option",{value:"expires",children:"Expires Date"})]})]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{className:a.filterGroup,children:e.jsx("input",{type:"text",id:"search-filter",placeholder:"Search CAs...",value:j,onChange:s=>f(s.target.value)})})]}),e.jsx("div",{className:a.tableContainer,children:b.length===0&&S.length===0?e.jsx(O,{icon:"ph ph-bank",title:"No Certificate Authorities",message:"Create your first Root CA to start issuing certificates",action:{label:"Create CA",onClick:()=>x(!0)}}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caNameCell,children:[s.children&&s.children.length>0?e.jsx("button",{className:`${a.caExpandBtn} ${o.has(s.id)?"":a.collapsed}`,onClick:()=>c(s.id),children:e.jsx("i",{className:"ph ph-caret-down"})}):e.jsx("span",{className:a.caExpandSpacer}),e.jsx("i",{className:`ph ph-bank ${a.caIcon} ${a.root}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:r=>{r.stopPropagation(),A(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id),s.children&&o.has(s.id)&&s.children.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caTreeIndent,children:[e.jsx("i",{className:`ph ph-git-branch ${a.caIcon} ${a.intermediate}`}),e.jsx("span",{children:r.name})]})}),e.jsx("td",{children:e.jsx("span",{children:r.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${r.status.toLowerCase()}`,children:r.status})}),e.jsx("td",{children:r.issued}),e.jsx("td",{children:r.expires}),e.jsx("td",{children:r.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:T=>{T.stopPropagation(),A(r)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},r.id))]}))})]})}),S.length>0&&b.length>0&&e.jsxs("div",{className:a.orphanedSection,children:[e.jsxs("div",{className:a.orphanedHeader,children:[e.jsx("i",{className:"ph ph-warning"}),e.jsx("span",{className:a.orphanedHeaderText,children:"Orphaned Intermediate CAs"})]}),e.jsx("div",{className:a.orphanedTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caNameCell,children:[e.jsx("i",{className:`ph ph-warning ${a.caIcon} ${a.orphan}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:r=>{r.stopPropagation(),A(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id))})]})})]}),e.jsx(de,{isOpen:v,onClose:()=>x(!1)}),e.jsx(he,{isOpen:k,onClose:()=>g(!1),onSuccess:R})]})}export{Oe as CAList,Oe as default};
