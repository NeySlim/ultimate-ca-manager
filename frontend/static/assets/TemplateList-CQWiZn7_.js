import{r as k,j as e,B as S,z as o,a as E}from"./index-CLfQR7T-.js";import{P as A}from"./PageTopBar-mBp7JZab.js";import{B as T}from"./Badge-DzgKm8mg.js";import{M as w}from"./Modal-CZIPJ5O_.js";import{I as _}from"./Input-DAUOVlrV.js";import{s}from"./CreateCAModal.module-DdQgTClK.js";import{u as K}from"./useQuery-BjQIvO-q.js";import{u as L}from"./useMutation-BgAHbNVW.js";import{a as f}from"./api-ClVrI7m4.js";import{e as B}from"./export-BEFxFx9V.js";function P({isOpen:n,onClose:c}){const[a,h]=k.useState({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),[m,b]=k.useState(!1),u=async t=>{if(t.preventDefault(),!a.name){o.error("Template name is required");return}b(!0);try{const i=Object.entries(a.keyUsage).filter(([d,j])=>j).map(([d,j])=>d),y=Object.entries(a.extendedKeyUsage).filter(([d,j])=>j).map(([d,j])=>d),x=await fetch("/api/v2/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name,description:a.description,type:a.type,validity_days:parseInt(a.validityDays),key_size:parseInt(a.keySize),key_usage:i,extended_key_usage:y})});if(!x.ok){const d=await x.json();throw new Error(d.message||"Failed to create template")}o.success("Template created successfully"),c(),h({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),window.location.reload()}catch(i){o.error(i.message||"Failed to create template")}finally{b(!1)}},g=t=>{h(i=>({...i,[t.target.name]:t.target.value}))},p=t=>{h(i=>({...i,keyUsage:{...i.keyUsage,[t]:!i.keyUsage[t]}}))},r=t=>{h(i=>({...i,extendedKeyUsage:{...i.extendedKeyUsage,[t]:!i.extendedKeyUsage[t]}}))},N=t=>{const i=t.target.value;let y={...a.keyUsage},x={...a.extendedKeyUsage};i==="server"?(y={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},x={serverAuth:!0,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}):i==="client"?(y={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},x={serverAuth:!1,clientAuth:!0,codeSigning:!1,emailProtection:!1,timeStamping:!1}):i==="ca"&&(y={digitalSignature:!0,keyEncipherment:!1,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!0,crlSign:!0},x={serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}),h(d=>({...d,type:i,keyUsage:y,extendedKeyUsage:x}))},C=e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"secondary",onClick:c,disabled:m,children:"Cancel"}),e.jsx(S,{variant:"primary",onClick:u,disabled:m,children:m?"Creating...":"Create Template"})]});return e.jsx(w,{isOpen:n,onClose:c,title:"New Certificate Template",size:"md",footer:C,children:e.jsxs("form",{onSubmit:u,className:s.form,children:[e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Template Information"}),e.jsx(_,{label:"Template Name",name:"name",value:a.name,onChange:g,placeholder:"Web Server Template",required:!0}),e.jsx(_,{label:"Description",name:"description",value:a.description,onChange:g,placeholder:"Template for web server certificates"}),e.jsxs("div",{className:s.field,children:[e.jsx("label",{className:s.label,children:"Template Type"}),e.jsxs("select",{name:"type",value:a.type,onChange:N,className:s.select,children:[e.jsx("option",{value:"server",children:"Server Authentication"}),e.jsx("option",{value:"client",children:"Client Authentication"}),e.jsx("option",{value:"ca",children:"Certificate Authority"}),e.jsx("option",{value:"code-signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Certificate Settings"}),e.jsxs("div",{className:s.row,children:[e.jsx(_,{label:"Validity Period (Days)",name:"validityDays",type:"number",value:a.validityDays,onChange:g,min:"1",max:"3650"}),e.jsxs("div",{className:s.field,children:[e.jsx("label",{className:s.label,children:"Key Size"}),e.jsxs("select",{name:"keySize",value:a.keySize,onChange:g,className:s.select,children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:s.permissionsGrid,children:[e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.digitalSignature,onChange:()=>p("digitalSignature"),className:s.checkbox}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.keyEncipherment,onChange:()=>p("keyEncipherment"),className:s.checkbox}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.dataEncipherment,onChange:()=>p("dataEncipherment"),className:s.checkbox}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.keyAgreement,onChange:()=>p("keyAgreement"),className:s.checkbox}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.keyCertSign,onChange:()=>p("keyCertSign"),className:s.checkbox}),e.jsx("span",{children:"Certificate Sign"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.crlSign,onChange:()=>p("crlSign"),className:s.checkbox}),e.jsx("span",{children:"CRL Sign"})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Extended Key Usage"}),e.jsxs("div",{className:s.permissionsGrid,children:[e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.serverAuth,onChange:()=>r("serverAuth"),className:s.checkbox}),e.jsx("span",{children:"TLS Web Server Authentication"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.clientAuth,onChange:()=>r("clientAuth"),className:s.checkbox}),e.jsx("span",{children:"TLS Web Client Authentication"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.codeSigning,onChange:()=>r("codeSigning"),className:s.checkbox}),e.jsx("span",{children:"Code Signing"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.emailProtection,onChange:()=>r("emailProtection"),className:s.checkbox}),e.jsx("span",{children:"Email Protection"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.timeStamping,onChange:()=>r("timeStamping"),className:s.checkbox}),e.jsx("span",{children:"Time Stamping"})]})]})]})]})})}const U={getTemplates:async(n={})=>(await f.get("/api/v2/templates",{params:n})).data,createTemplate:async n=>(await f.post("/api/v2/templates",n)).data,updateTemplate:async({id:n,...c})=>(await f.put(`/api/v2/templates/${n}`,c)).data,deleteTemplate:async n=>(await f.delete(`/api/v2/templates/${n}`)).data},v={all:["templates"],lists:()=>[...v.all,"list"],list:n=>[...v.lists(),n]},D=(n={})=>K({queryKey:v.list(n),queryFn:()=>U.getTemplates(n)}),F=()=>{const n=E();return L({mutationFn:U.deleteTemplate,onSuccess:()=>{n.invalidateQueries({queryKey:v.all}),o.success("Template deleted successfully")},onError:c=>{o.error(c.response?.data?.message||"Failed to delete template")}})},I="_sectionHeader_1humx_2",z="_sectionTitle_1humx_10",M="_filterBtn_1humx_16",O="_tableContainer_1humx_42",$="_templateName_1humx_85",q="_keyUsage_1humx_91",H="_subjectPattern_1humx_97",V="_statusBadge_1humx_107",G="_badgeActive_1humx_118",Q="_badgeSystem_1humx_123",R="_actionsCell_1humx_129",W="_actionBtn_1humx_134",l={sectionHeader:I,sectionTitle:z,filterBtn:M,tableContainer:O,templateName:$,keyUsage:q,subjectPattern:H,statusBadge:V,badgeActive:G,badgeSystem:Q,actionsCell:R,actionBtn:W};function le(){const[n,c]=k.useState(!1),[a,h]=k.useState(!1),{data:m,isLoading:b,error:u}=D(),g=F(),r=(Array.isArray(m)?m:m?.data||[]).map(t=>({id:t.id,name:t.name,keyUsage:t.extensions_template?.key_usage?.join(", ")||"N/A",validity:`${t.validity_days} days`,subjectPattern:t.dn_template||"N/A",usedBy:"0 certs",status:"ACTIVE",isSystem:t.is_system})),N=()=>{if(r.length===0){o.error("No templates to export");return}B(r,"templates-export",{format:"csv",columns:["id","name","keyUsage","validity","subjectPattern","usedBy","status"]}),o.success("Templates exported successfully")},C=t=>{if(t.isSystem){o.error("Cannot delete system template");return}confirm(`Delete template "${t.name}"?`)&&g.mutate(t.id)};return u?e.jsxs("div",{className:l.templateList,children:[e.jsx(A,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsx(T,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading templates: ",u.message]})]}):e.jsxs("div",{className:l.templateList,children:[e.jsx(A,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsxs(T,{variant:"success",children:[r.length," Templates"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:"ph ph-download-simple",onClick:N,children:"Export"}),e.jsx(S,{variant:"primary",icon:"ph ph-plus",onClick:()=>c(!0),children:"New Template"})]})}),e.jsxs("div",{className:l.sectionHeader,children:[e.jsx("span",{className:l.sectionTitle,children:"Available Templates"}),e.jsxs("button",{className:l.filterBtn,onClick:()=>h(!a),children:[e.jsx("i",{className:"ph ph-funnel"}),"Filter"]})]}),e.jsx("div",{className:l.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"},children:"TEMPLATE NAME"}),e.jsx("th",{style:{width:"25%"},children:"KEY USAGE"}),e.jsx("th",{style:{width:"10%"},children:"VALIDITY"}),e.jsx("th",{style:{width:"20%"},children:"SUBJECT PATTERN"}),e.jsx("th",{style:{width:"12%"},children:"USED BY"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"8%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"Loading templates..."})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"No templates found"})}):r.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:l.templateName,children:t.name}),t.isSystem&&e.jsx(T,{variant:"info",style:{marginLeft:"0.5rem"},children:"System"})]}),e.jsx("td",{children:e.jsx("span",{className:l.keyUsage,children:t.keyUsage})}),e.jsx("td",{children:t.validity}),e.jsx("td",{children:e.jsx("code",{className:l.subjectPattern,children:t.subjectPattern})}),e.jsx("td",{children:t.usedBy}),e.jsx("td",{children:e.jsx("span",{className:`${l.statusBadge} ${t.status==="ACTIVE"?l.badgeActive:l.badgeSystem}`,children:t.status})}),e.jsx("td",{children:e.jsx("div",{className:l.actionsCell,children:!t.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:l.actionBtn,title:"Edit",children:e.jsx("i",{className:"ph ph-pencil"})}),e.jsx("button",{className:l.actionBtn,title:"Delete",onClick:()=>C(t),children:e.jsx("i",{className:"ph ph-trash"})})]})})})]},t.id))})]})}),e.jsx(P,{isOpen:n,onClose:()=>c(!1)})]})}export{le as TemplateList,le as default};
