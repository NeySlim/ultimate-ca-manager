import{j as e,B as p,z as u}from"./index-BWDmoKA7.js";import{P as m}from"./PageTopBar-Ce7PBM4r.js";import{B as _}from"./Badge-BFuVPCyZ.js";import{u as N}from"./useQuery-gjiR4eck.js";import{a as r}from"./api-ClVrI7m4.js";import{e as g}from"./export-BEFxFx9V.js";const y={getAll:async(n={})=>{const a=await r.get("/api/v2/csrs",{params:n}),c=(a.data||[]).map(i=>{const o=i.subject?.match(/CN=([^,]+)/),l=o?o[1]:i.subject||"Unnamed CSR",x=i.key_type&&i.key_size?`${i.key_type.toUpperCase()} ${i.key_size}`:"Unknown",j=i.created_at?i.created_at.split("T")[0]:"N/A",h=i.priority||"NORMAL";return{id:i.id,subject:l,key:x,status:(i.status||"PENDING").toUpperCase(),submitted:j,requester:i.requester||"Unknown",priority:h,_raw:i}});return{data:c,meta:a.meta||{page:1,per_page:20,total:c.length}}},getById:async n=>(await r.get(`/api/v2/csrs/${n}`)).data,approve:async(n,a)=>(await r.post(`/api/v2/csrs/${n}/approve`,{ca_id:a})).data,reject:async(n,a)=>(await r.post(`/api/v2/csrs/${n}/reject`,{reason:a})).data,delete:async n=>(await r.delete(`/api/v2/csrs/${n}`)).data},d={all:["csrs"],lists:()=>[...d.all,"list"],list:n=>[...d.lists(),n],details:()=>[...d.all,"detail"],detail:n=>[...d.details(),n]},b=(n={})=>N({queryKey:d.list(n),queryFn:()=>y.getAll(n)}),C="_section_xet4x_2",v="_sectionHeader_xet4x_6",E="_sectionIconWarning_xet4x_13",R="_sectionIconSuccess_xet4x_14",f="_sectionIconError_xet4x_15",w="_sectionTitle_xet4x_46",B="_tableContainer_xet4x_53",I="_subjectCell_xet4x_95",A="_cn_xet4x_101",S="_email_xet4x_106",T="_requestedCell_xet4x_112",k="_approvedCell_xet4x_113",L="_date_xet4x_119",D="_ago_xet4x_123",P="_by_xet4x_124",q="_priorityBadge_xet4x_130",O="_badgeHigh_xet4x_141",H="_badgeNormal_xet4x_146",$="_badgeLow_xet4x_151",U="_certificateLink_xet4x_157",K="_reason_xet4x_169",J="_actionsCell_xet4x_175",M="_actionBtn_xet4x_180",z="_btnApprove_xet4x_198",G="_btnReject_xet4x_208",s={section:C,sectionHeader:v,sectionIconWarning:E,sectionIconSuccess:R,sectionIconError:f,sectionTitle:w,tableContainer:B,subjectCell:I,cn:A,email:S,requestedCell:T,approvedCell:k,date:L,ago:D,by:P,priorityBadge:q,badgeHigh:O,badgeNormal:H,badgeLow:$,certificateLink:U,reason:K,actionsCell:J,actionBtn:M,btnApprove:z,btnReject:G};function Z(){const{data:n,isLoading:a,error:c}=b(),i=()=>{const t=n?.data||[];if(t.length===0){u.error("No data to export");return}g(t,"csrs-export",{format:"csv",columns:["id","commonName","requestedBy","status","priority","createdAt"]}),u.success("CSRs exported successfully")},o=t=>t==="HIGH"?s.badgeHigh:t==="NORMAL"?s.badgeNormal:s.badgeLow;if(a)return e.jsxs("div",{className:s.csrList,children:[e.jsx(m,{icon:"ph ph-file-text",title:"Certificate Signing Requests",badge:e.jsx(_,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading CSRs..."})]});if(c)return e.jsxs("div",{className:s.csrList,children:[e.jsx(m,{icon:"ph ph-file-text",title:"Certificate Signing Requests",badge:e.jsx(_,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading CSRs: ",c.message]})]});const l=n?.data||[],x=l.filter(t=>t.status==="PENDING"),j=l.filter(t=>t.status==="APPROVED"),h=l.filter(t=>t.status==="REJECTED");return e.jsxs("div",{className:s.csrList,children:[e.jsx(m,{icon:"ph ph-file-text",title:"Certificate Signing Requests",badge:e.jsxs(_,{variant:"warning",children:[x.length," Pending"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:"ph ph-upload-simple",children:"Import CSR"}),e.jsx(p,{icon:"ph ph-download-simple",onClick:i,children:"Export"}),e.jsx(p,{variant:"primary",icon:"ph ph-file-plus",children:"Create CSR"})]})}),e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("div",{className:s.sectionIconWarning,children:e.jsx("i",{className:"ph ph-clock"})}),e.jsx("span",{className:s.sectionTitle,children:"Pending Approval"})]}),e.jsx("div",{className:s.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"SUBJECT"}),e.jsx("th",{style:{width:"15%"},children:"KEY"}),e.jsx("th",{style:{width:"15%"},children:"REQUESTED"}),e.jsx("th",{style:{width:"15%"},children:"PRIORITY"}),e.jsx("th",{style:{width:"25%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:s.subjectCell,children:[e.jsx("span",{className:s.cn,children:t.cn}),e.jsx("span",{className:s.email,children:t.email})]})}),e.jsx("td",{children:t.key}),e.jsx("td",{children:e.jsxs("div",{className:s.requestedCell,children:[e.jsx("span",{className:s.date,children:t.requested}),e.jsx("span",{className:s.ago,children:t.requestedAgo})]})}),e.jsx("td",{children:e.jsx("span",{className:`${s.priorityBadge} ${o(t.priority)}`,children:t.priority})}),e.jsx("td",{children:e.jsxs("div",{className:s.actionsCell,children:[e.jsx("button",{className:`${s.actionBtn} ${s.btnApprove}`,children:"Approve"}),e.jsx("button",{className:`${s.actionBtn} ${s.btnReject}`,children:"Reject"}),e.jsx("button",{className:s.actionBtn,children:"Details"})]})})]},t.id))})]})})]}),e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("div",{className:s.sectionIconSuccess,children:e.jsx("i",{className:"ph ph-check-circle"})}),e.jsx("span",{className:s.sectionTitle,children:"Recently Approved"})]}),e.jsx("div",{className:s.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"SUBJECT"}),e.jsx("th",{style:{width:"15%"},children:"KEY"}),e.jsx("th",{style:{width:"15%"},children:"APPROVED"}),e.jsx("th",{style:{width:"15%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"25%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:j.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:s.subjectCell,children:[e.jsx("span",{className:s.cn,children:t.cn}),e.jsx("span",{className:s.email,children:t.email})]})}),e.jsx("td",{children:t.key}),e.jsx("td",{children:e.jsxs("div",{className:s.approvedCell,children:[e.jsx("span",{className:s.date,children:t.approved}),e.jsxs("span",{className:s.by,children:["by ",t.approvedBy]})]})}),e.jsx("td",{children:e.jsx("a",{href:"#",className:s.certificateLink,children:t.certificateId})}),e.jsx("td",{children:e.jsxs("div",{className:s.actionsCell,children:[e.jsx("button",{className:s.actionBtn,children:"View"}),e.jsx("button",{className:s.actionBtn,children:"Download"}),e.jsx("button",{className:s.actionBtn,children:"Details"})]})})]},t.id))})]})})]}),h.length>0&&e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("div",{className:s.sectionIconError,children:e.jsx("i",{className:"ph ph-x-circle"})}),e.jsx("span",{className:s.sectionTitle,children:"Rejected"})]}),e.jsx("div",{className:s.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"SUBJECT"}),e.jsx("th",{style:{width:"15%"},children:"KEY"}),e.jsx("th",{style:{width:"15%"},children:"REJECTED"}),e.jsx("th",{style:{width:"20%"},children:"REASON"}),e.jsx("th",{style:{width:"20%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:s.subjectCell,children:[e.jsx("span",{className:s.cn,children:t.cn}),e.jsx("span",{className:s.email,children:t.email})]})}),e.jsx("td",{children:t.key}),e.jsx("td",{children:e.jsxs("div",{className:s.approvedCell,children:[e.jsx("span",{className:s.date,children:t.rejected}),e.jsxs("span",{className:s.by,children:["by ",t.rejectedBy]})]})}),e.jsx("td",{children:e.jsx("span",{className:s.reason,children:t.reason})}),e.jsx("td",{children:e.jsx("div",{className:s.actionsCell,children:e.jsx("button",{className:s.actionBtn,children:"Details"})})})]},t.id))})]})})]})]})}export{Z as CSRList,Z as default};
