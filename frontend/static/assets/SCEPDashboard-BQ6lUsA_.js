import{a as y,r as R,j as e,B as i,C as l,z as p}from"./index-MwwIjCts.js";import{P as v}from"./PageTopBar-BUGksJC2.js";import{S as T,a as u}from"./StatsGrid--HOFLWII.js";import{S as D,T as b}from"./SectionTabs-DlTnfjpL.js";import{D as B}from"./DataTable-CCltc04R.js";import{S as w}from"./SearchToolbar-Bl0iFvTB.js";import{B as j}from"./Badge-BSGVRu21.js";import{I as h}from"./Input-DqNOxUOF.js";import{g as I}from"./getBadgeVariant-BF98r0-3.js";import{u as C}from"./useQuery-CXPF-X9-.js";import{u as _}from"./useMutation-L-oE-0OL.js";import{a as m}from"./api-ClVrI7m4.js";const f={getSettings:async()=>(await m.get("/api/v2/scep/config")).data,getStats:async()=>{const a=(await m.get("/api/v2/scep/requests")).data||[],x=a.filter(r=>r.status==="pending").length,d=a.filter(r=>r.status==="approved").length,g=a.filter(r=>r.status==="rejected").length;return{total_requests:a.length,pending:x,approved:d,rejected:g,total_enrollments:d}},approveRequest:async t=>(await m.post(`/api/v2/scep/${t}/approve`)).data,rejectRequest:async t=>(await m.post(`/api/v2/scep/${t}/reject`)).data},c={all:["scep"],settings:()=>[...c.all,"settings"],stats:()=>[...c.all,"stats"],requests:t=>[...c.all,"requests",t]},F=()=>C({queryKey:c.settings(),queryFn:f.getSettings}),L=()=>C({queryKey:c.stats(),queryFn:f.getStats}),O=()=>{const t=y();return _({mutationFn:f.approveRequest,onSuccess:()=>{t.invalidateQueries({queryKey:c.all})}})},G=()=>{const t=y();return _({mutationFn:f.rejectRequest,onSuccess:()=>{t.invalidateQueries({queryKey:c.all})}})},K="_scepDashboard_rp4o0_3",Q="_tabContent_rp4o0_8",$="_form_rp4o0_14",V="_checkboxGroup_rp4o0_21",z="_checkbox_rp4o0_21",H="_formActions_rp4o0_42",M="_actions_rp4o0_48",U="_statusBadge_rp4o0_53",J="_statusDot_rp4o0_67",W="_infoBox_rp4o0_78",X="_infoContent_rp4o0_82",Y="_infoIcon_rp4o0_87",Z="_infoTitle_rp4o0_100",ee="_infoText_rp4o0_107",s={scepDashboard:K,tabContent:Q,form:$,checkboxGroup:V,checkbox:z,formActions:H,actions:M,statusBadge:U,statusDot:J,infoBox:W,infoContent:X,infoIcon:Y,infoTitle:Z,infoText:ee};function he(){const[t,a]=R.useState("config"),{data:x,isLoading:d}=F(),{data:g,isLoading:r}=L(),S=O(),k=G(),E=d||r,o={config:x||{},stats:g||{},enrollments:[]},A=[{key:"deviceId",label:"Device ID",sortable:!0},{key:"commonName",label:"Common Name",sortable:!0},{key:"status",label:"Status",sortable:!0,render:n=>e.jsx(j,{variant:I("scep-status",n.status),children:n.status})},{key:"requestedAt",label:"Requested At",sortable:!0},{key:"approvedAt",label:"Approved At",render:n=>n.approvedAt||e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"â€”"})},{key:"actions",label:"Actions",render:n=>n.status==="pending"?e.jsxs("div",{className:s.actions,children:[e.jsx(i,{variant:"success",icon:"ph ph-check",onClick:()=>{confirm(`Approve enrollment for ${n.deviceId}?`)&&S.mutate(n.id,{onSuccess:()=>p.success("Enrollment approved"),onError:()=>p.error("Failed to approve")})},children:"Approve"}),e.jsx(i,{variant:"danger",icon:"ph ph-x",onClick:()=>{confirm(`Reject enrollment for ${n.deviceId}?`)&&k.mutate(n.id,{onSuccess:()=>p.success("Enrollment rejected"),onError:()=>p.error("Failed to reject")})},children:"Reject"})]}):null}],q=[{label:"Status",options:["All Statuses","Pending","Completed","Rejected"]}],P=[{label:"Export List",icon:"ph ph-download-simple",variant:"default"}];return E?e.jsxs("div",{className:s.scepDashboard,children:[e.jsx(v,{icon:"ph ph-device-mobile",title:"SCEP",badge:e.jsx(j,{variant:"secondary",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-tertiary)"},children:"Loading SCEP data..."})]}):e.jsxs("div",{className:s.scepDashboard,children:[e.jsx(v,{icon:"ph ph-device-mobile",title:"SCEP",badge:e.jsx(j,{variant:o.config.enabled?"success":"secondary",children:o.config.enabled?"Enabled":"Disabled"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:"ph ph-arrows-clockwise",children:"Refresh"}),e.jsx(i,{variant:"primary",icon:"ph ph-gear",children:"Configure"})]})}),e.jsxs(T,{columns:4,children:[e.jsx(u,{value:o.stats.total_enrollments||0,label:"Total Enrollments",icon:"ph ph-certificate"}),e.jsx(u,{value:o.stats.pending||0,label:"Pending Approvals",icon:"ph ph-clock"}),e.jsx(u,{value:o.stats.approved||0,label:"Completed Today",icon:"ph ph-check-circle"}),e.jsx(u,{value:o.stats.rejected||0,label:"Rejected Today",icon:"ph ph-x-circle"})]}),e.jsxs(D,{children:[e.jsx(b,{active:t==="config",onClick:()=>a("config"),children:"Configuration"}),e.jsx(b,{active:t==="enrollments",onClick:()=>a("enrollments"),children:"Enrollments"})]}),t==="config"&&e.jsxs("div",{className:s.tabContent,children:[e.jsxs(l,{children:[e.jsxs(l.Header,{children:[e.jsx("h3",{children:"SCEP Server Configuration"}),e.jsxs("div",{className:s.statusBadge,children:[e.jsx("span",{className:s.statusDot,"data-status":o.config.enabled?"enabled":"disabled"}),e.jsx("span",{children:o.config.enabled?"Enabled":"Disabled"})]})]}),e.jsx(l.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsx(h,{label:"SCEP URL",value:o.config.url,readOnly:!0}),e.jsx(h,{label:"CA Identifier",value:o.config.caIdentifier,readOnly:!0}),e.jsx(h,{label:"Challenge Password",type:"password",value:o.config.challengePassword,readOnly:!0}),e.jsx(h,{label:"Certificate Validity (days)",value:o.config.certificateValidity,readOnly:!0}),e.jsxs("div",{className:s.checkboxGroup,children:[e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:o.config.allowRenewal,readOnly:!0}),e.jsx("span",{children:"Allow Certificate Renewal"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:o.config.autoApprove,readOnly:!0}),e.jsx("span",{children:"Auto-Approve Enrollments"})]})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx(i,{variant:"primary",icon:"ph ph-floppy-disk",children:"Save Configuration"}),e.jsx(i,{variant:"default",icon:"ph ph-arrow-clockwise",children:"Reset"})]})]})})]}),e.jsx(l,{className:s.infoBox,children:e.jsx(l.Body,{children:e.jsxs("div",{className:s.infoContent,children:[e.jsx("div",{className:s.infoIcon,children:e.jsx("i",{className:"ph ph-info"})}),e.jsxs("div",{children:[e.jsx("div",{className:s.infoTitle,children:"SCEP Enrollment"}),e.jsx("div",{className:s.infoText,children:"SCEP (Simple Certificate Enrollment Protocol) allows devices to automatically request and receive certificates. Common use cases include mobile devices (iOS, Android) and network equipment."})]})]})})})]}),t==="enrollments"&&e.jsxs("div",{className:s.tabContent,children:[e.jsx(w,{placeholder:"Search enrollments...",filters:q,actions:P,onSearch:n=>console.log("Search:",n),onFilterChange:(n,N)=>console.log("Filter:",n,N)}),e.jsx(B,{columns:A,data:o.enrollments,onRowClick:n=>console.log("Enrollment clicked:",n)})]})]})}export{he as SCEPDashboard,he as default};
