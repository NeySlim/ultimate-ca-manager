import{r as b,j as e,B as k,z as u}from"./index-o7ZMqN8r.js";import{P as T}from"./PageTopBar-CXSdBZ8_.js";import{B as U}from"./Badge-CFBFbLcV.js";import{M as E}from"./Modal-D8NPEdUe.js";import{I as S}from"./Input-DtrbcUDU.js";import{s as t}from"./CreateCAModal.module-DdQgTClK.js";import{e as A}from"./export-BEFxFx9V.js";function _({isOpen:f,onClose:m}){const[a,r]=b.useState({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),[g,n]=b.useState(!1),C=async c=>{if(c.preventDefault(),!a.name){u.error("Template name is required");return}n(!0);try{const s=Object.entries(a.keyUsage).filter(([l,y])=>y).map(([l,y])=>l),h=Object.entries(a.extendedKeyUsage).filter(([l,y])=>y).map(([l,y])=>l),d=await fetch("/api/v2/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name,description:a.description,type:a.type,validity_days:parseInt(a.validityDays),key_size:parseInt(a.keySize),key_usage:s,extended_key_usage:h})});if(!d.ok){const l=await d.json();throw new Error(l.message||"Failed to create template")}u.success("Template created successfully"),m(),r({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),window.location.reload()}catch(s){u.error(s.message||"Failed to create template")}finally{n(!1)}},p=c=>{r(s=>({...s,[c.target.name]:c.target.value}))},o=c=>{r(s=>({...s,keyUsage:{...s.keyUsage,[c]:!s.keyUsage[c]}}))},x=c=>{r(s=>({...s,extendedKeyUsage:{...s.extendedKeyUsage,[c]:!s.extendedKeyUsage[c]}}))},N=c=>{const s=c.target.value;let h={...a.keyUsage},d={...a.extendedKeyUsage};s==="server"?(h={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},d={serverAuth:!0,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}):s==="client"?(h={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},d={serverAuth:!1,clientAuth:!0,codeSigning:!1,emailProtection:!1,timeStamping:!1}):s==="ca"&&(h={digitalSignature:!0,keyEncipherment:!1,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!0,crlSign:!0},d={serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}),r(l=>({...l,type:s,keyUsage:h,extendedKeyUsage:d}))},v=e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"secondary",onClick:m,disabled:g,children:"Cancel"}),e.jsx(k,{variant:"primary",onClick:C,disabled:g,children:g?"Creating...":"Create Template"})]});return e.jsx(E,{isOpen:f,onClose:m,title:"New Certificate Template",size:"md",footer:v,children:e.jsxs("form",{onSubmit:C,className:t.form,children:[e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Template Information"}),e.jsx(S,{label:"Template Name",name:"name",value:a.name,onChange:p,placeholder:"Web Server Template",required:!0}),e.jsx(S,{label:"Description",name:"description",value:a.description,onChange:p,placeholder:"Template for web server certificates"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Template Type"}),e.jsxs("select",{name:"type",value:a.type,onChange:N,className:t.select,children:[e.jsx("option",{value:"server",children:"Server Authentication"}),e.jsx("option",{value:"client",children:"Client Authentication"}),e.jsx("option",{value:"ca",children:"Certificate Authority"}),e.jsx("option",{value:"code-signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Certificate Settings"}),e.jsxs("div",{className:t.row,children:[e.jsx(S,{label:"Validity Period (Days)",name:"validityDays",type:"number",value:a.validityDays,onChange:p,min:"1",max:"3650"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Key Size"}),e.jsxs("select",{name:"keySize",value:a.keySize,onChange:p,className:t.select,children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.digitalSignature,onChange:()=>o("digitalSignature"),className:t.checkbox}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.keyEncipherment,onChange:()=>o("keyEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.dataEncipherment,onChange:()=>o("dataEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.keyAgreement,onChange:()=>o("keyAgreement"),className:t.checkbox}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.keyCertSign,onChange:()=>o("keyCertSign"),className:t.checkbox}),e.jsx("span",{children:"Certificate Sign"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.keyUsage.crlSign,onChange:()=>o("crlSign"),className:t.checkbox}),e.jsx("span",{children:"CRL Sign"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Extended Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.serverAuth,onChange:()=>x("serverAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Server Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.clientAuth,onChange:()=>x("clientAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Client Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.codeSigning,onChange:()=>x("codeSigning"),className:t.checkbox}),e.jsx("span",{children:"Code Signing"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.emailProtection,onChange:()=>x("emailProtection"),className:t.checkbox}),e.jsx("span",{children:"Email Protection"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:a.extendedKeyUsage.timeStamping,onChange:()=>x("timeStamping"),className:t.checkbox}),e.jsx("span",{children:"Time Stamping"})]})]})]})]})})}const P="_sectionHeader_1humx_2",B="_sectionTitle_1humx_10",K="_filterBtn_1humx_16",D="_tableContainer_1humx_42",L="_templateName_1humx_85",w="_keyUsage_1humx_91",I="_subjectPattern_1humx_97",O="_statusBadge_1humx_107",V="_badgeActive_1humx_118",z="_badgeSystem_1humx_123",M="_actionsCell_1humx_129",F="_actionBtn_1humx_134",i={sectionHeader:P,sectionTitle:B,filterBtn:K,tableContainer:D,templateName:L,keyUsage:w,subjectPattern:I,statusBadge:O,badgeActive:V,badgeSystem:z,actionsCell:M,actionBtn:F},j=[{id:1,name:"Server Certificate",keyUsage:"Digital Signature, Key Encipherment",validity:"1 year",subjectPattern:"CN={hostname}, O=Company",usedBy:"142 certs",status:"ACTIVE"},{id:2,name:"Client Authentication",keyUsage:"Digital Signature, Non Repudiation",validity:"2 years",subjectPattern:"CN={username}, OU=Users",usedBy:"87 certs",status:"ACTIVE"},{id:3,name:"Code Signing",keyUsage:"Digital Signature",validity:"3 years",subjectPattern:"CN={developer}, O=Company",usedBy:"12 certs",status:"ACTIVE"},{id:4,name:"Email Protection",keyUsage:"Digital Signature, Key Encipherment",validity:"1 year",subjectPattern:"CN={email}, OU=Email",usedBy:"234 certs",status:"ACTIVE"},{id:5,name:"Wildcard SSL",keyUsage:"Digital Signature, Key Encipherment",validity:"90 days",subjectPattern:"CN=*.{domain}",usedBy:"45 certs",status:"ACTIVE"},{id:6,name:"VPN Gateway",keyUsage:"Digital Signature, Key Encipherment, TLS Server",validity:"2 years",subjectPattern:"CN={gateway}, OU=VPN",usedBy:"8 certs",status:"ACTIVE"},{id:7,name:"IoT Device",keyUsage:"Digital Signature",validity:"5 years",subjectPattern:"CN={device_id}, OU=IoT",usedBy:"567 certs",status:"ACTIVE"},{id:8,name:"Intermediate CA",keyUsage:"Certificate Sign, CRL Sign",validity:"10 years",subjectPattern:"CN={ca_name}, O=Company",usedBy:"3 certs",status:"SYSTEM"}];function J(){const[f,m]=b.useState(!1),[a,r]=b.useState(!1),g=()=>{if(j.length===0){u.error("No templates to export");return}A(j,"templates-export",{format:"csv",columns:["id","name","keyUsage","validity","subjectPattern","usedBy","status"]}),u.success("Templates exported successfully")};return e.jsxs("div",{className:i.templateList,children:[e.jsx(T,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsxs(U,{variant:"success",children:[j.length," Templates"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(k,{icon:"ph ph-download-simple",onClick:g,children:"Export"}),e.jsx(k,{variant:"primary",icon:"ph ph-plus",onClick:()=>r(!0),children:"New Template"})]})}),e.jsxs("div",{className:i.sectionHeader,children:[e.jsx("span",{className:i.sectionTitle,children:"Available Templates"}),e.jsxs("button",{className:i.filterBtn,onClick:()=>m(!f),children:[e.jsx("i",{className:"ph ph-funnel"}),"Filter"]})]}),e.jsx("div",{className:i.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"},children:"TEMPLATE NAME"}),e.jsx("th",{style:{width:"25%"},children:"KEY USAGE"}),e.jsx("th",{style:{width:"10%"},children:"VALIDITY"}),e.jsx("th",{style:{width:"20%"},children:"SUBJECT PATTERN"}),e.jsx("th",{style:{width:"12%"},children:"USED BY"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"8%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:j.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:i.templateName,children:n.name})}),e.jsx("td",{children:e.jsx("span",{className:i.keyUsage,children:n.keyUsage})}),e.jsx("td",{children:n.validity}),e.jsx("td",{children:e.jsx("code",{className:i.subjectPattern,children:n.subjectPattern})}),e.jsx("td",{children:n.usedBy}),e.jsx("td",{children:e.jsx("span",{className:`${i.statusBadge} ${n.status==="ACTIVE"?i.badgeActive:i.badgeSystem}`,children:n.status})}),e.jsx("td",{children:e.jsx("div",{className:i.actionsCell,children:n.status==="ACTIVE"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:i.actionBtn,title:"Edit",children:e.jsx("i",{className:"ph ph-pencil"})}),e.jsx("button",{className:i.actionBtn,title:"Duplicate",children:e.jsx("i",{className:"ph ph-copy"})})]}):e.jsx("button",{className:i.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})})})})]},n.id))})]})}),e.jsx(_,{isOpen:a,onClose:()=>r(!1)})]})}export{J as TemplateList,J as default};
