import{r as N,j as e,B as y,z as j}from"./index-DvblE3fx.js";import{P as v}from"./PageTopBar-BwgB73XK.js";import{B as f}from"./Badge-B80MzN2D.js";import{u as R}from"./useQuery-B28DX-fo.js";import{a as b}from"./api-ClVrI7m4.js";import{e as E}from"./export-BEFxFx9V.js";import{M as w}from"./Modal-3iP6FGKu.js";import{I as p}from"./Input-RIgYiBtS.js";import{s as c}from"./CreateCAModal.module-DdQgTClK.js";import{s as S,F as k}from"./ImportCAModal.module-DFzn1ErV.js";const I={getAll:async(n={})=>{const l=await b.get("/api/v2/csrs",{params:n}),a=(l.data||[]).map(i=>{const o=i.subject?.match(/CN=([^,]+)/),x=o?o[1]:i.subject||"Unnamed CSR",m=i.key_type&&i.key_size?`${i.key_type.toUpperCase()} ${i.key_size}`:"Unknown",r=i.created_at?i.created_at.split("T")[0]:"N/A",u=i.priority||"NORMAL";return{id:i.id,subject:x,key:m,status:(i.status||"PENDING").toUpperCase(),submitted:r,requester:i.requester||"Unknown",priority:u,_raw:i}});return{data:a,meta:l.meta||{page:1,per_page:20,total:a.length}}},getById:async n=>(await b.get(`/api/v2/csrs/${n}`)).data,approve:async(n,l)=>(await b.post(`/api/v2/csrs/${n}/approve`,{ca_id:l})).data,reject:async(n,l)=>(await b.post(`/api/v2/csrs/${n}/reject`,{reason:l})).data,delete:async n=>(await b.delete(`/api/v2/csrs/${n}`)).data},_={all:["csrs"],lists:()=>[..._.all,"list"],list:n=>[..._.lists(),n],details:()=>[..._.all,"detail"],detail:n=>[..._.details(),n]},T=(n={})=>R({queryKey:_.list(n),queryFn:()=>I.getAll(n)});function A({isOpen:n,onClose:l}){const[a,i]=N.useState({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",email:"",keySize:"2048",keyType:"RSA",sans:""}),[o,x]=N.useState(!1),m=async d=>{if(d.preventDefault(),!a.commonName){j.error("Common Name is required");return}x(!0);try{const h={subject:{common_name:a.commonName,organization:a.organization,organizational_unit:a.organizationalUnit,country:a.country,state:a.state,locality:a.locality,email:a.email},key_size:parseInt(a.keySize),key_type:a.keyType.toLowerCase()};a.sans.trim()&&(h.sans=a.sans.split(",").map(C=>C.trim()).filter(Boolean));const g=await fetch("/api/v2/csrs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!g.ok){const C=await g.json();throw new Error(C.message||"Failed to create CSR")}j.success("CSR created successfully"),l(),i({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",email:"",keySize:"2048",keyType:"RSA",sans:""}),window.location.reload()}catch(h){j.error(h.message||"Failed to create CSR")}finally{x(!1)}},r=d=>{i(h=>({...h,[d.target.name]:d.target.value}))},u=e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"secondary",onClick:l,disabled:o,children:"Cancel"}),e.jsx(y,{variant:"primary",onClick:m,disabled:o,children:o?"Creating...":"Create CSR"})]});return e.jsx(w,{isOpen:n,onClose:l,title:"Create Certificate Signing Request",size:"md",footer:u,children:e.jsxs("form",{onSubmit:m,className:c.form,children:[e.jsxs("div",{className:c.section,children:[e.jsx("h3",{className:c.sectionTitle,children:"Subject Information"}),e.jsx(p,{label:"Common Name (CN)",name:"commonName",value:a.commonName,onChange:r,placeholder:"example.com",required:!0}),e.jsx(p,{label:"Organization (O)",name:"organization",value:a.organization,onChange:r,placeholder:"My Organization"}),e.jsx(p,{label:"Organizational Unit (OU)",name:"organizationalUnit",value:a.organizationalUnit,onChange:r,placeholder:"IT Department"}),e.jsxs("div",{className:c.row,children:[e.jsx(p,{label:"Country (C)",name:"country",value:a.country,onChange:r,placeholder:"US",maxLength:2}),e.jsx(p,{label:"State (ST)",name:"state",value:a.state,onChange:r,placeholder:"California"}),e.jsx(p,{label:"Locality (L)",name:"locality",value:a.locality,onChange:r,placeholder:"San Francisco"})]}),e.jsx(p,{label:"Email Address",name:"email",type:"email",value:a.email,onChange:r,placeholder:"admin@example.com"})]}),e.jsxs("div",{className:c.section,children:[e.jsx("h3",{className:c.sectionTitle,children:"Key Settings"}),e.jsxs("div",{className:c.row,children:[e.jsxs("div",{className:c.field,children:[e.jsx("label",{className:c.label,children:"Key Type"}),e.jsxs("select",{name:"keyType",value:a.keyType,onChange:r,className:c.select,children:[e.jsx("option",{value:"RSA",children:"RSA"}),e.jsx("option",{value:"ECDSA",children:"ECDSA"})]})]}),e.jsxs("div",{className:c.field,children:[e.jsx("label",{className:c.label,children:"Key Size"}),e.jsx("select",{name:"keySize",value:a.keySize,onChange:r,className:c.select,children:a.keyType==="RSA"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"256",children:"P-256"}),e.jsx("option",{value:"384",children:"P-384"}),e.jsx("option",{value:"521",children:"P-521"})]})})]})]})]}),e.jsxs("div",{className:c.section,children:[e.jsx("h3",{className:c.sectionTitle,children:"Extensions"}),e.jsx(p,{label:"Subject Alternative Names (SANs)",name:"sans",value:a.sans,onChange:r,placeholder:"example.com, www.example.com, *.example.com",helpText:"Comma-separated list of additional domains"})]})]})})}function z({isOpen:n,onClose:l}){const[a,i]=N.useState(null),[o,x]=N.useState(!1),m=async u=>{if(u.preventDefault(),!a){j.error("Please select a CSR file to import");return}x(!0);try{const d=new FormData;d.append("file",a);const h=await fetch("/api/v2/csrs/import",{method:"POST",body:d});if(!h.ok){const g=await h.json();throw new Error(g.message||"Failed to import CSR")}j.success("CSR imported successfully"),l(),i(null),window.location.reload()}catch(d){j.error(d.message||"Failed to import CSR")}finally{x(!1)}},r=e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"secondary",onClick:l,disabled:o,children:"Cancel"}),e.jsx(y,{variant:"primary",onClick:m,disabled:o,children:o?"Importing...":"Import CSR"})]});return e.jsx(w,{isOpen:n,onClose:l,title:"Import Certificate Signing Request",size:"md",footer:r,children:e.jsxs("form",{onSubmit:m,className:S.form,children:[e.jsx(k,{file:a,onFileChange:i,accept:".csr,.pem",maxSize:10*1024*1024}),e.jsxs("div",{className:S.infoBox,children:[e.jsx("i",{className:"ph ph-info"}),e.jsx("p",{children:"CSR files must be in PEM format. After import, you can sign the CSR to issue a certificate."})]})]})})}const B="_section_xet4x_2",D="_sectionHeader_xet4x_6",O="_sectionIconWarning_xet4x_13",P="_sectionIconSuccess_xet4x_14",L="_sectionIconError_xet4x_15",q="_sectionTitle_xet4x_46",F="_tableContainer_xet4x_53",U="_subjectCell_xet4x_95",M="_cn_xet4x_101",$="_email_xet4x_106",H="_requestedCell_xet4x_112",K="_approvedCell_xet4x_113",J="_date_xet4x_119",G="_ago_xet4x_123",V="_by_xet4x_124",W="_priorityBadge_xet4x_130",Y="_badgeHigh_xet4x_141",Q="_badgeNormal_xet4x_146",X="_badgeLow_xet4x_151",Z="_certificateLink_xet4x_157",ee="_reason_xet4x_169",se="_actionsCell_xet4x_175",te="_actionBtn_xet4x_180",ae="_btnApprove_xet4x_198",ne="_btnReject_xet4x_208",s={section:B,sectionHeader:D,sectionIconWarning:O,sectionIconSuccess:P,sectionIconError:L,sectionTitle:q,tableContainer:F,subjectCell:U,cn:M,email:$,requestedCell:H,approvedCell:K,date:J,ago:G,by:V,priorityBadge:W,badgeHigh:Y,badgeNormal:Q,badgeLow:X,certificateLink:Z,reason:ee,actionsCell:se,actionBtn:te,btnApprove:ae,btnReject:ne};function je(){const{data:n,isLoading:l,error:a}=T(),[i,o]=N.useState(!1),[x,m]=N.useState(!1),r=()=>{const t=n?.data||[];if(t.length===0){j.error("No data to export");return}E(t,"csrs-export",{format:"csv",columns:["id","commonName","requestedBy","status","priority","createdAt"]}),j.success("CSRs exported successfully")},u=t=>t==="HIGH"?s.badgeHigh:t==="NORMAL"?s.badgeNormal:s.badgeLow;if(l)return e.jsxs("div",{className:s.csrList,children:[e.jsx(v,{icon:"ph ph-file-text",title:"Certificate Signing Requests",badge:e.jsx(f,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading CSRs..."})]});if(a)return e.jsxs("div",{className:s.csrList,children:[e.jsx(v,{icon:"ph ph-file-text",title:"Certificate Signing Requests",badge:e.jsx(f,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading CSRs: ",a.message]})]});const d=n?.data||[],h=d.filter(t=>t.status==="PENDING"),g=d.filter(t=>t.status==="APPROVED"),C=d.filter(t=>t.status==="REJECTED");return e.jsxs("div",{className:s.csrList,children:[e.jsx(v,{icon:"ph ph-file-text",title:"Certificate Signing Requests",badge:e.jsxs(f,{variant:"warning",children:[h.length," Pending"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(y,{icon:"ph ph-upload-simple",onClick:()=>m(!0),children:"Import CSR"}),e.jsx(y,{icon:"ph ph-download-simple",onClick:r,children:"Export"}),e.jsx(y,{variant:"primary",icon:"ph ph-file-plus",onClick:()=>o(!0),children:"Create CSR"})]})}),e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("div",{className:s.sectionIconWarning,children:e.jsx("i",{className:"ph ph-clock"})}),e.jsx("span",{className:s.sectionTitle,children:"Pending Approval"})]}),e.jsx("div",{className:s.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"SUBJECT"}),e.jsx("th",{style:{width:"15%"},children:"KEY"}),e.jsx("th",{style:{width:"15%"},children:"REQUESTED"}),e.jsx("th",{style:{width:"15%"},children:"PRIORITY"}),e.jsx("th",{style:{width:"25%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:s.subjectCell,children:[e.jsx("span",{className:s.cn,children:t.cn}),e.jsx("span",{className:s.email,children:t.email})]})}),e.jsx("td",{children:t.key}),e.jsx("td",{children:e.jsxs("div",{className:s.requestedCell,children:[e.jsx("span",{className:s.date,children:t.requested}),e.jsx("span",{className:s.ago,children:t.requestedAgo})]})}),e.jsx("td",{children:e.jsx("span",{className:`${s.priorityBadge} ${u(t.priority)}`,children:t.priority})}),e.jsx("td",{children:e.jsxs("div",{className:s.actionsCell,children:[e.jsx("button",{className:`${s.actionBtn} ${s.btnApprove}`,children:"Approve"}),e.jsx("button",{className:`${s.actionBtn} ${s.btnReject}`,children:"Reject"}),e.jsx("button",{className:s.actionBtn,children:"Details"})]})})]},t.id))})]})})]}),e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("div",{className:s.sectionIconSuccess,children:e.jsx("i",{className:"ph ph-check-circle"})}),e.jsx("span",{className:s.sectionTitle,children:"Recently Approved"})]}),e.jsx("div",{className:s.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"SUBJECT"}),e.jsx("th",{style:{width:"15%"},children:"KEY"}),e.jsx("th",{style:{width:"15%"},children:"APPROVED"}),e.jsx("th",{style:{width:"15%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"25%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:s.subjectCell,children:[e.jsx("span",{className:s.cn,children:t.cn}),e.jsx("span",{className:s.email,children:t.email})]})}),e.jsx("td",{children:t.key}),e.jsx("td",{children:e.jsxs("div",{className:s.approvedCell,children:[e.jsx("span",{className:s.date,children:t.approved}),e.jsxs("span",{className:s.by,children:["by ",t.approvedBy]})]})}),e.jsx("td",{children:e.jsx("a",{href:"#",className:s.certificateLink,children:t.certificateId})}),e.jsx("td",{children:e.jsxs("div",{className:s.actionsCell,children:[e.jsx("button",{className:s.actionBtn,children:"View"}),e.jsx("button",{className:s.actionBtn,children:"Download"}),e.jsx("button",{className:s.actionBtn,children:"Details"})]})})]},t.id))})]})})]}),C.length>0&&e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("div",{className:s.sectionIconError,children:e.jsx("i",{className:"ph ph-x-circle"})}),e.jsx("span",{className:s.sectionTitle,children:"Rejected"})]}),e.jsx("div",{className:s.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"SUBJECT"}),e.jsx("th",{style:{width:"15%"},children:"KEY"}),e.jsx("th",{style:{width:"15%"},children:"REJECTED"}),e.jsx("th",{style:{width:"20%"},children:"REASON"}),e.jsx("th",{style:{width:"20%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:C.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:s.subjectCell,children:[e.jsx("span",{className:s.cn,children:t.cn}),e.jsx("span",{className:s.email,children:t.email})]})}),e.jsx("td",{children:t.key}),e.jsx("td",{children:e.jsxs("div",{className:s.approvedCell,children:[e.jsx("span",{className:s.date,children:t.rejected}),e.jsxs("span",{className:s.by,children:["by ",t.rejectedBy]})]})}),e.jsx("td",{children:e.jsx("span",{className:s.reason,children:t.reason})}),e.jsx("td",{children:e.jsx("div",{className:s.actionsCell,children:e.jsx("button",{className:s.actionBtn,children:"Details"})})})]},t.id))})]})})]}),e.jsx(A,{isOpen:i,onClose:()=>o(!1)}),e.jsx(z,{isOpen:x,onClose:()=>m(!1)})]})}export{je as CSRList,je as default};
