import{b as B,r as K,j as e,B as R,z as h}from"./index-DdQHJRZe.js";import{P as g}from"./PageTopBar-CMHHaflg.js";import{S as I,a as p}from"./StatsGrid-CgYomZaz.js";import{S as P,T as x}from"./SectionTabs-O0CJsR2g.js";import{D as A}from"./DataTable-C5P1CUA9.js";import{S as Q}from"./SearchToolbar-DkYY9PAM.js";import{B as l}from"./Badge-Ds7r_Uvs.js";import{g as y}from"./getBadgeVariant-BF98r0-3.js";import{u as m}from"./useQuery-BEwfEIYw.js";import{u as U}from"./useMutation-CjjNH16L.js";import{a as d}from"./api-ClVrI7m4.js";import"./Input-BelVwKmg.js";const u={getSettings:async()=>(await d.get("/api/v2/acme/settings")).data,updateSettings:async t=>(await d.patch("/api/v2/acme/settings",t)).data,getStats:async()=>{const a=(await d.get("/api/v2/acme/stats")).data||{};return{accounts:a.active_accounts||0,activeOrders:a.pending_orders||0,completedOrders:a.valid_orders||0,domains:0,_raw:a}},getAccounts:async(t={})=>{const a=await d.get("/api/v2/acme/accounts",{params:t}),n=(a.data||[]).map(s=>({id:s.id,email:s.email||s.contact_email||"N/A",status:(s.status||"ACTIVE").toUpperCase(),createdAt:s.created_at?s.created_at.split("T")[0]:"N/A",orders:s.total_orders||0,_raw:s}));return{data:n,meta:a.meta||{page:1,per_page:20,total:n.length}}},getOrders:async(t={})=>{const a=await d.get("/api/v2/acme/orders",{params:t}),n=(a.data||[]).map(s=>({id:s.id,domain:s.domain||s.identifier||"N/A",account:s.account_email||s.account_id||"N/A",status:(s.status||"PENDING").toUpperCase(),createdAt:s.created_at?s.created_at.split("T")[0]:"N/A",expiresAt:s.expires_at?s.expires_at.split("T")[0]:"N/A",_raw:s}));return{data:n,meta:a.meta||{page:1,per_page:20,total:n.length}}}},c={all:["acme"],settings:()=>[...c.all,"settings"],stats:()=>[...c.all,"stats"],accounts:t=>[...c.all,"accounts",t],orders:t=>[...c.all,"orders",t]},V=()=>m({queryKey:c.settings(),queryFn:u.getSettings}),z=()=>m({queryKey:c.stats(),queryFn:u.getStats}),G=(t={})=>m({queryKey:c.accounts(t),queryFn:()=>u.getAccounts(t)}),H=(t={})=>m({queryKey:c.orders(t),queryFn:()=>u.getOrders(t)}),J=()=>{const t=B();return U({mutationFn:u.updateSettings,onSuccess:()=>{t.invalidateQueries({queryKey:c.settings()})}})},W="_acmeDashboard_k0xpk_3",X="_tabContent_k0xpk_8",Y="_section_k0xpk_14",Z="_sectionTitle_k0xpk_20",o={acmeDashboard:W,tabContent:X,section:Y,sectionTitle:Z};function me(){const[t,a]=K.useState("internal"),{data:n,isLoading:s,error:v}=V(),{data:$,isLoading:C,error:j}=z(),{data:S,isLoading:_,error:E}=G(),{data:k,isLoading:f,error:N}=H(),M=J(),T=s||C||_||f,b=v||j||E||N,D=[{key:"email",label:"Email",sortable:!0},{key:"status",label:"Status",sortable:!0,render:r=>e.jsx(l,{variant:y("acme-status",r.status),children:r.status})},{key:"createdAt",label:"Created At",sortable:!0},{key:"orders",label:"Orders",sortable:!0,render:r=>e.jsx("span",{style:{color:"var(--text-tertiary)"},children:r.orders})}],O=[{key:"domain",label:"Domain",sortable:!0},{key:"account",label:"Account",sortable:!0},{key:"status",label:"Status",sortable:!0,render:r=>e.jsx(l,{variant:y("acme-status",r.status),children:r.status})},{key:"createdAt",label:"Created",sortable:!0},{key:"expiresAt",label:"Expires",sortable:!0}],q=[{label:"Status",options:["All Statuses","Valid","Pending","Invalid"]}],w=[{label:"New Account",icon:"ph ph-plus",variant:"primary"},{label:"New Order",icon:"ph ph-certificate",variant:"default"}];if(T)return e.jsxs("div",{className:o.acmeDashboard,children:[e.jsx(g,{icon:"ph ph-globe",title:"ACME",badge:e.jsx(l,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading ACME data..."})]});if(b)return e.jsxs("div",{className:o.acmeDashboard,children:[e.jsx(g,{icon:"ph ph-globe",title:"ACME",badge:e.jsx(l,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading ACME data: ",b.message]})]});S?.data,k?.data;const F=(r,ee)=>e.jsxs("div",{className:o.tabContent,children:[e.jsxs(I,{columns:4,children:[e.jsx(p,{value:r.stats.accounts,label:"Accounts",icon:"ph ph-user"}),e.jsx(p,{value:r.stats.activeOrders,label:"Active Orders",icon:"ph ph-clock"}),e.jsx(p,{value:r.stats.completedOrders,label:"Completed Orders",icon:"ph ph-check-circle"}),e.jsx(p,{value:r.stats.domains,label:"Domains",icon:"ph ph-globe"})]}),e.jsxs("div",{className:o.section,children:[e.jsx("h3",{className:o.sectionTitle,children:"Accounts"}),e.jsx(Q,{placeholder:"Search accounts...",filters:q,actions:w,onSearch:i=>console.log("Search:",i),onFilterChange:(i,L)=>console.log("Filter:",i,L)}),e.jsx(A,{columns:D,data:r.accounts,onRowClick:i=>console.log("Account clicked:",i)})]}),e.jsxs("div",{className:o.section,children:[e.jsx("h3",{className:o.sectionTitle,children:"Recent Orders"}),e.jsx(A,{columns:O,data:r.orders,onRowClick:i=>console.log("Order clicked:",i)})]})]});return e.jsxs("div",{className:o.acmeDashboard,children:[e.jsx(g,{icon:"ph ph-globe",title:"ACME",badge:e.jsx(l,{variant:n?.enabled?"success":"secondary",children:n?.enabled?"Enabled":"Disabled"}),actions:e.jsxs(R,{variant:n?.enabled?"secondary":"primary",onClick:()=>{M.mutate({enabled:!n?.enabled},{onSuccess:()=>h.success(n?.enabled?"ACME disabled":"ACME enabled"),onError:()=>h.error("Failed to update ACME")})},children:[n?.enabled?"Disable":"Enable"," ACME"]})}),e.jsxs(P,{children:[e.jsx(x,{active:t==="internal",onClick:()=>a("internal"),children:"Internal ACME"}),e.jsx(x,{active:t==="letsencrypt",onClick:()=>a("letsencrypt"),children:"Let's Encrypt"})]}),e.jsx("div",{className:o.tabContent,children:F()})]})}export{me as ACMEDashboard,me as default};
