import{r as a,p as G,j as e,B as o,C as r}from"./index-BE1z_aYO.js";import{P as O}from"./PageTopBar-BAV80wbJ.js";import{S as R,T as N}from"./SectionTabs-DEbZ7Uxk.js";import{I as i}from"./Input-D_X2olIn.js";import{B as I}from"./Badge-QWH1n5QJ.js";import{D as K}from"./DataTable-CRhd2w3Y.js";import{M as D}from"./Modal-BqmMoIHR.js";import{u as M}from"./useMutation-De0MMW17.js";import{a as _}from"./api-ClVrI7m4.js";import{c as U}from"./Warning.es-DeN131Ou.js";const V=new Map([["bold",a.createElement(a.Fragment,null,a.createElement("path",{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"}))],["duotone",a.createElement(a.Fragment,null,a.createElement("path",{d:"M232,56V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56Z",opacity:"0.2"}),a.createElement("path",{d:"M205.66,85.66l-96,96a8,8,0,0,1-11.32,0l-40-40a8,8,0,0,1,11.32-11.32L104,164.69l90.34-90.35a8,8,0,0,1,11.32,11.32Z"}))],["fill",a.createElement(a.Fragment,null,a.createElement("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM205.66,85.66l-96,96a8,8,0,0,1-11.32,0l-40-40a8,8,0,0,1,11.32-11.32L104,164.69l90.34-90.35a8,8,0,0,1,11.32,11.32Z"}))],["light",a.createElement(a.Fragment,null,a.createElement("path",{d:"M228.24,76.24l-128,128a6,6,0,0,1-8.48,0l-56-56a6,6,0,0,1,8.48-8.48L96,191.51,219.76,67.76a6,6,0,0,1,8.48,8.48Z"}))],["regular",a.createElement(a.Fragment,null,a.createElement("path",{d:"M229.66,77.66l-128,128a8,8,0,0,1-11.32,0l-56-56a8,8,0,0,1,11.32-11.32L96,188.69,218.34,66.34a8,8,0,0,1,11.32,11.32Z"}))],["thin",a.createElement(a.Fragment,null,a.createElement("path",{d:"M226.83,74.83l-128,128a4,4,0,0,1-5.66,0l-56-56a4,4,0,0,1,5.66-5.66L96,194.34,221.17,69.17a4,4,0,1,1,5.66,5.66Z"}))]]),T=a.forwardRef((n,p)=>a.createElement(G,{ref:p,...n,weights:V}));T.displayName="CheckIcon";const Z=T;function Q(){return M({mutationFn:async n=>await _.post("/api/v2/import/opnsense/test",n)})}function Y(){return M({mutationFn:async n=>await _.post("/api/v2/import/opnsense/import",n)})}const $="_importPage_17krz_1",q="_tabContent_17krz_6",X="_subMethods_17krz_12",J="_subMethod_17krz_12",W="_active_17krz_33",ee="_subMethodTitle_17krz_49",se="_form_17krz_58",te="_formGroup_17krz_64",ae="_formLabel_17krz_70",re="_formInput_17krz_78",le="_formTextarea_17krz_92",oe="_formHelp_17krz_113",ne="_formCheckbox_17krz_118",s={importPage:$,tabContent:q,subMethods:X,subMethod:J,active:W,subMethodTitle:ee,form:se,formGroup:te,formLabel:ae,formInput:re,formTextarea:le,formHelp:oe,formCheckbox:ne};function Ce(){const[n,p]=a.useState("ca"),[j,F]=a.useState(0),[u,S]=a.useState(0),[l,h]=a.useState({host:"",port:"443",api_key:"",api_secret:"",verify_ssl:!1}),[x,g]=a.useState([]),[A,E]=a.useState(null),[w,C]=a.useState(!1),[d,f]=a.useState([]),c=Q(),b=Y(),H=async()=>{try{const t=await c.mutateAsync(l);t.success&&(g(t.items),E(`${l.host}:${l.port}`),f(t.items.map(m=>m.id)))}catch(t){console.error("Connection test failed:",t)}},B=async()=>{try{(await b.mutateAsync({...l,items:d})).success&&(C(!1),f([]),g([]),E(null))}catch(t){console.error("Import failed:",t)}},z=t=>{f(m=>m.includes(t)?m.filter(y=>y!==t):[...m,t])},L=[{key:"selected",label:"",render:t=>e.jsx("input",{type:"checkbox",checked:d.includes(t.id),onChange:()=>z(t.id)})},{key:"type",label:"Type",render:t=>e.jsx(I,{variant:t.type==="CA"?"info":"success",children:t.type})},{key:"name",label:"Name"},{key:"subject",label:"Subject",render:t=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"12px"},children:t.subject})},{key:"validUntil",label:"Valid Until"}],P=(t,m,y)=>e.jsx("div",{className:s.subMethods,children:t.map((k,v)=>e.jsxs("div",{className:`${s.subMethod} ${m===v?s.active:""}`,onClick:()=>y(v),children:[e.jsx("i",{className:k.icon}),e.jsx("div",{className:s.subMethodTitle,children:k.title})]},v))});return e.jsxs("div",{className:s.importPage,children:[e.jsx(O,{icon:"ph ph-upload",title:"Import",badge:e.jsx(I,{variant:"info",children:"Multiple Formats"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(o,{icon:"ph ph-question",children:"Help"}),e.jsx(o,{variant:"primary",icon:"ph ph-upload-simple",children:"Upload Files"})]})}),e.jsxs(R,{children:[e.jsx(N,{active:n==="ca",onClick:()=>p("ca"),children:"CA Import"}),e.jsx(N,{active:n==="cert",onClick:()=>p("cert"),children:"Certificate Import"}),e.jsx(N,{active:n==="opnsense",onClick:()=>p("opnsense"),children:"OPNsense Import"})]}),n==="ca"&&e.jsxs("div",{className:s.tabContent,children:[P([{icon:"ph ph-clipboard-text",title:"Paste PEM"},{icon:"ph ph-upload",title:"Upload Files"},{icon:"ph ph-package",title:"Container P12/PFX"}],j,F),j===0&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Paste PEM Encoded CA"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"CA Certificate (PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
...
-----END CERTIFICATE-----`}),e.jsx("div",{className:s.formHelp,children:"Paste the PEM-encoded CA certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key (Optional, PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC7VJ...
-----END PRIVATE KEY-----`}),e.jsx("div",{className:s.formHelp,children:"Only required if this CA will issue certificates"})]}),e.jsx(i,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust"}),e.jsx("label",{htmlFor:"ca-trust",children:"Add to Trust Store"})]}),e.jsx(o,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]}),j===1&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Upload CA Files"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"CA Certificate File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt,.cer"}),e.jsx("div",{className:s.formHelp,children:"Upload PEM or DER encoded certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key File (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.key"}),e.jsx("div",{className:s.formHelp,children:"Only required if this CA will issue certificates"})]}),e.jsx(i,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust-upload"}),e.jsx("label",{htmlFor:"ca-trust-upload",children:"Add to Trust Store"})]}),e.jsx(o,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]}),j===2&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Import from P12/PFX Container"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"P12/PFX File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".p12,.pfx"}),e.jsx("div",{className:s.formHelp,children:"PKCS#12 container with CA certificate and private key"})]}),e.jsx(i,{label:"Container Password",type:"password",placeholder:"Enter password"}),e.jsx(i,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust-p12"}),e.jsx("label",{htmlFor:"ca-trust-p12",children:"Add to Trust Store"})]}),e.jsx(o,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]})]}),n==="cert"&&e.jsxs("div",{className:s.tabContent,children:[P([{icon:"ph ph-clipboard-text",title:"Paste PEM"},{icon:"ph ph-upload",title:"Upload Files"},{icon:"ph ph-package",title:"Container"}],u,S),u===0&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Paste PEM Encoded Certificate"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate (PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN CERTIFICATE-----
...`})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key (Optional, PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN PRIVATE KEY-----
...`})]}),e.jsx(i,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(o,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]}),u===1&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Upload Certificate Files"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt,.cer"}),e.jsx("div",{className:s.formHelp,children:"Upload PEM or DER encoded certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key File (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.key"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate Chain (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt"}),e.jsx("div",{className:s.formHelp,children:"Intermediate certificates"})]}),e.jsx(i,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(o,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]}),u===2&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Import from Container"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"P12/PFX File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".p12,.pfx"}),e.jsx("div",{className:s.formHelp,children:"PKCS#12 container with certificate and private key"})]}),e.jsx(i,{label:"Container Password",type:"password",placeholder:"Enter password"}),e.jsx(i,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(o,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]})]}),n==="opnsense"&&e.jsxs("div",{className:s.tabContent,children:[e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"OPNsense Connection"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,onSubmit:t=>{t.preventDefault(),H()},children:[e.jsx(i,{label:"Host",placeholder:"192.168.1.1",value:l.host,onChange:t=>h({...l,host:t.target.value})}),e.jsx(i,{label:"Port",type:"number",placeholder:"443",value:l.port,onChange:t=>h({...l,port:t.target.value})}),e.jsx(i,{label:"API Key",placeholder:"Enter API key",value:l.api_key,onChange:t=>h({...l,api_key:t.target.value})}),e.jsx(i,{label:"API Secret",type:"password",placeholder:"Enter API secret",value:l.api_secret,onChange:t=>h({...l,api_secret:t.target.value})}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"verify-ssl",checked:l.verify_ssl,onChange:t=>h({...l,verify_ssl:t.target.checked})}),e.jsx("label",{htmlFor:"verify-ssl",children:"Verify SSL Certificate"})]}),e.jsx(o,{type:"submit",variant:"primary",icon:"ph ph-plug",disabled:c.isPending,children:c.isPending?"Testing...":"Test Connection"}),c.isError&&e.jsxs("div",{style:{color:"var(--status-danger)",fontSize:"13px",marginTop:"8px"},children:[e.jsx(U,{size:16})," ",c.error?.response?.data?.error||"Connection failed"]}),c.isSuccess&&c.data?.success&&e.jsxs("div",{style:{color:"var(--status-success)",fontSize:"13px",marginTop:"8px"},children:[e.jsx(Z,{size:16})," Connected! Found ",c.data.stats.cas," CAs and ",c.data.stats.certificates," certificates"]})]})})]}),x.length>0&&e.jsxs(r,{children:[e.jsxs(r.Header,{children:[e.jsx("h3",{children:"Available Items"}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-tertiary)"},children:["Connected to ",A," â€¢ ",d.length," of ",x.length," selected"]})]}),e.jsxs(r.Body,{children:[e.jsx(K,{columns:L,data:x,pageSize:10}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:[e.jsxs(o,{variant:"primary",icon:"ph ph-download-simple",disabled:d.length===0,onClick:()=>C(!0),children:["Import Selected (",d.length,")"]}),e.jsx(o,{onClick:()=>f(x.map(t=>t.id)),children:"Select All"}),e.jsx(o,{onClick:()=>f([]),children:"Deselect All"})]})]})]})]}),e.jsxs(D,{isOpen:w,onClose:()=>C(!1),title:"Confirm Import",footer:e.jsxs(e.Fragment,{children:[e.jsx(o,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(o,{variant:"primary",onClick:B,disabled:b.isPending,children:b.isPending?"Importing...":`Import ${d.length} Items`})]}),children:[e.jsxs("p",{children:["You are about to import ",d.length," items from OPNsense (",A,"):"]}),e.jsx("ul",{style:{marginTop:"12px",paddingLeft:"20px"},children:x.filter(t=>d.includes(t.id)).map(t=>e.jsxs("li",{style:{marginBottom:"4px"},children:[e.jsx(I,{variant:t.type==="CA"?"info":"success",children:t.type})," ",t.name]},t.id))}),e.jsx("p",{style:{marginTop:"12px",color:"var(--text-tertiary)",fontSize:"12px"},children:"This action will add these items to your UCM trust store."})]})]})}export{Ce as ImportPage,Ce as default};
