import{r as S,j as e,B as v,z as h,a as E}from"./index-B6GeC02O.js";import{P as A}from"./PageTopBar-B7-KssU0.js";import{B as T}from"./Badge-B4wOg9Y0.js";import{M as K}from"./Modal-KmP21bza.js";import{I as _}from"./Input-mmVVNbON.js";import{s}from"./CreateCAModal.module-DdQgTClK.js";import{u as w}from"./useQuery-zbqCni-Q.js";import{u as L}from"./useMutation-BXE9twtt.js";import{a as k}from"./api-ClVrI7m4.js";import{e as B}from"./export-BEFxFx9V.js";function P({isOpen:n,onClose:c}){const[t,m]=S.useState({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),[u,f]=S.useState(!1),j=async d=>{if(d.preventDefault(),!t.name){h.error("Template name is required");return}f(!0);try{const i=Object.entries(t.keyUsage).filter(([o,b])=>b).map(([o,b])=>o),y=Object.entries(t.extendedKeyUsage).filter(([o,b])=>b).map(([o,b])=>o),x=await fetch("/api/v2/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,description:t.description,type:t.type,validity_days:parseInt(t.validityDays),key_size:parseInt(t.keySize),key_usage:i,extended_key_usage:y})});if(!x.ok){const o=await x.json();throw new Error(o.message||"Failed to create template")}h.success("Template created successfully"),c(),m({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),window.location.reload()}catch(i){h.error(i.message||"Failed to create template")}finally{f(!1)}},g=d=>{m(i=>({...i,[d.target.name]:d.target.value}))},r=d=>{m(i=>({...i,keyUsage:{...i.keyUsage,[d]:!i.keyUsage[d]}}))},p=d=>{m(i=>({...i,extendedKeyUsage:{...i.extendedKeyUsage,[d]:!i.extendedKeyUsage[d]}}))},C=d=>{const i=d.target.value;let y={...t.keyUsage},x={...t.extendedKeyUsage};i==="server"?(y={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},x={serverAuth:!0,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}):i==="client"?(y={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},x={serverAuth:!1,clientAuth:!0,codeSigning:!1,emailProtection:!1,timeStamping:!1}):i==="ca"&&(y={digitalSignature:!0,keyEncipherment:!1,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!0,crlSign:!0},x={serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}),m(o=>({...o,type:i,keyUsage:y,extendedKeyUsage:x}))},a=e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"secondary",onClick:c,disabled:u,children:"Cancel"}),e.jsx(v,{variant:"primary",onClick:j,disabled:u,children:u?"Creating...":"Create Template"})]});return e.jsx(K,{isOpen:n,onClose:c,title:"New Certificate Template",size:"md",footer:a,children:e.jsxs("form",{onSubmit:j,className:s.form,children:[e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Template Information"}),e.jsx(_,{label:"Template Name",name:"name",value:t.name,onChange:g,placeholder:"Web Server Template",required:!0}),e.jsx(_,{label:"Description",name:"description",value:t.description,onChange:g,placeholder:"Template for web server certificates"}),e.jsxs("div",{className:s.field,children:[e.jsx("label",{className:s.label,children:"Template Type"}),e.jsxs("select",{name:"type",value:t.type,onChange:C,className:s.select,children:[e.jsx("option",{value:"server",children:"Server Authentication"}),e.jsx("option",{value:"client",children:"Client Authentication"}),e.jsx("option",{value:"ca",children:"Certificate Authority"}),e.jsx("option",{value:"code-signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Certificate Settings"}),e.jsxs("div",{className:s.row,children:[e.jsx(_,{label:"Validity Period (Days)",name:"validityDays",type:"number",value:t.validityDays,onChange:g,min:"1",max:"3650"}),e.jsxs("div",{className:s.field,children:[e.jsx("label",{className:s.label,children:"Key Size"}),e.jsxs("select",{name:"keySize",value:t.keySize,onChange:g,className:s.select,children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:s.permissionsGrid,children:[e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.keyUsage.digitalSignature,onChange:()=>r("digitalSignature"),className:s.checkbox}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.keyUsage.keyEncipherment,onChange:()=>r("keyEncipherment"),className:s.checkbox}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.keyUsage.dataEncipherment,onChange:()=>r("dataEncipherment"),className:s.checkbox}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.keyUsage.keyAgreement,onChange:()=>r("keyAgreement"),className:s.checkbox}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.keyUsage.keyCertSign,onChange:()=>r("keyCertSign"),className:s.checkbox}),e.jsx("span",{children:"Certificate Sign"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.keyUsage.crlSign,onChange:()=>r("crlSign"),className:s.checkbox}),e.jsx("span",{children:"CRL Sign"})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Extended Key Usage"}),e.jsxs("div",{className:s.permissionsGrid,children:[e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.extendedKeyUsage.serverAuth,onChange:()=>p("serverAuth"),className:s.checkbox}),e.jsx("span",{children:"TLS Web Server Authentication"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.extendedKeyUsage.clientAuth,onChange:()=>p("clientAuth"),className:s.checkbox}),e.jsx("span",{children:"TLS Web Client Authentication"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.extendedKeyUsage.codeSigning,onChange:()=>p("codeSigning"),className:s.checkbox}),e.jsx("span",{children:"Code Signing"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.extendedKeyUsage.emailProtection,onChange:()=>p("emailProtection"),className:s.checkbox}),e.jsx("span",{children:"Email Protection"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:t.extendedKeyUsage.timeStamping,onChange:()=>p("timeStamping"),className:s.checkbox}),e.jsx("span",{children:"Time Stamping"})]})]})]})]})})}const U={getTemplates:async(n={})=>(await k.get("/api/v2/templates",{params:n})).data,createTemplate:async n=>(await k.post("/api/v2/templates",n)).data,updateTemplate:async({id:n,...c})=>(await k.put(`/api/v2/templates/${n}`,c)).data,deleteTemplate:async n=>(await k.delete(`/api/v2/templates/${n}`)).data},N={all:["templates"],lists:()=>[...N.all,"list"],list:n=>[...N.lists(),n]},D=(n={})=>w({queryKey:N.list(n),queryFn:()=>U.getTemplates(n)}),F=()=>{const n=E();return L({mutationFn:U.deleteTemplate,onSuccess:()=>{n.invalidateQueries({queryKey:N.all}),h.success("Template deleted successfully")},onError:c=>{h.error(c.response?.data?.message||"Failed to delete template")}})},I="_sectionHeader_1humx_2",z="_sectionTitle_1humx_10",M="_filterBtn_1humx_16",O="_tableContainer_1humx_42",$="_templateName_1humx_85",q="_keyUsage_1humx_91",H="_subjectPattern_1humx_97",V="_statusBadge_1humx_107",G="_badgeActive_1humx_118",Q="_badgeSystem_1humx_123",R="_actionsCell_1humx_129",W="_actionBtn_1humx_134",l={sectionHeader:I,sectionTitle:z,filterBtn:M,tableContainer:O,templateName:$,keyUsage:q,subjectPattern:H,statusBadge:V,badgeActive:G,badgeSystem:Q,actionsCell:R,actionBtn:W};function le(){const[n,c]=S.useState(!1),[t,m]=S.useState(!1),{data:u,isLoading:f,error:j}=D(),g=F(),r=(u?.data||[]).map(a=>({id:a.id,name:a.name,keyUsage:a.extensions_template?.key_usage?.join(", ")||"N/A",validity:`${a.validity_days} days`,subjectPattern:a.dn_template||"N/A",usedBy:"0 certs",status:"ACTIVE",isSystem:a.is_system})),p=()=>{if(r.length===0){h.error("No templates to export");return}B(r,"templates-export",{format:"csv",columns:["id","name","keyUsage","validity","subjectPattern","usedBy","status"]}),h.success("Templates exported successfully")},C=a=>{if(a.isSystem){h.error("Cannot delete system template");return}confirm(`Delete template "${a.name}"?`)&&g.mutate(a.id)};return j?e.jsxs("div",{className:l.templateList,children:[e.jsx(A,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsx(T,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading templates: ",j.message]})]}):e.jsxs("div",{className:l.templateList,children:[e.jsx(A,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsxs(T,{variant:"success",children:[r.length," Templates"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(v,{icon:"ph ph-download-simple",onClick:p,children:"Export"}),e.jsx(v,{variant:"primary",icon:"ph ph-plus",onClick:()=>c(!0),children:"New Template"})]})}),e.jsxs("div",{className:l.sectionHeader,children:[e.jsx("span",{className:l.sectionTitle,children:"Available Templates"}),e.jsxs("button",{className:l.filterBtn,onClick:()=>m(!t),children:[e.jsx("i",{className:"ph ph-funnel"}),"Filter"]})]}),e.jsx("div",{className:l.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"},children:"TEMPLATE NAME"}),e.jsx("th",{style:{width:"25%"},children:"KEY USAGE"}),e.jsx("th",{style:{width:"10%"},children:"VALIDITY"}),e.jsx("th",{style:{width:"20%"},children:"SUBJECT PATTERN"}),e.jsx("th",{style:{width:"12%"},children:"USED BY"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"8%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"Loading templates..."})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"No templates found"})}):r.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:l.templateName,children:a.name}),a.isSystem&&e.jsx(T,{variant:"info",style:{marginLeft:"0.5rem"},children:"System"})]}),e.jsx("td",{children:e.jsx("span",{className:l.keyUsage,children:a.keyUsage})}),e.jsx("td",{children:a.validity}),e.jsx("td",{children:e.jsx("code",{className:l.subjectPattern,children:a.subjectPattern})}),e.jsx("td",{children:a.usedBy}),e.jsx("td",{children:e.jsx("span",{className:`${l.statusBadge} ${a.status==="ACTIVE"?l.badgeActive:l.badgeSystem}`,children:a.status})}),e.jsx("td",{children:e.jsx("div",{className:l.actionsCell,children:!a.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:l.actionBtn,title:"Edit",children:e.jsx("i",{className:"ph ph-pencil"})}),e.jsx("button",{className:l.actionBtn,title:"Delete",onClick:()=>C(a),children:e.jsx("i",{className:"ph ph-trash"})})]})})})]},a.id))})]})}),e.jsx(P,{isOpen:n,onClose:()=>c(!1)})]})}export{le as TemplateList,le as default};
