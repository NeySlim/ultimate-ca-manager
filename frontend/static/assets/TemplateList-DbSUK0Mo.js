import{r as j,j as e,B as b,z as p}from"./index-inlHZ2QJ.js";import{P as U}from"./PageTopBar-Cpbrhq3A.js";import{B as C}from"./Badge-P7rsM6Zs.js";import{M as A}from"./Modal-oFruS72P.js";import{I as f}from"./Input-FGdSMT2U.js";import{s as t}from"./CreateCAModal.module-DdQgTClK.js";import"./api-ClVrI7m4.js";import{e as E}from"./export-BEFxFx9V.js";function _({isOpen:k,onClose:m}){const[s,r]=j.useState({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),[g,i]=j.useState(!1),S=async l=>{if(l.preventDefault(),!s.name){p.error("Template name is required");return}i(!0);try{const a=Object.entries(s.keyUsage).filter(([c,y])=>y).map(([c,y])=>c),h=Object.entries(s.extendedKeyUsage).filter(([c,y])=>y).map(([c,y])=>c),d=await fetch("/api/v2/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.name,description:s.description,type:s.type,validity_days:parseInt(s.validityDays),key_size:parseInt(s.keySize),key_usage:a,extended_key_usage:h})});if(!d.ok){const c=await d.json();throw new Error(c.message||"Failed to create template")}p.success("Template created successfully"),m(),r({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),window.location.reload()}catch(a){p.error(a.message||"Failed to create template")}finally{i(!1)}},u=l=>{r(a=>({...a,[l.target.name]:l.target.value}))},o=l=>{r(a=>({...a,keyUsage:{...a.keyUsage,[l]:!a.keyUsage[l]}}))},x=l=>{r(a=>({...a,extendedKeyUsage:{...a.extendedKeyUsage,[l]:!a.extendedKeyUsage[l]}}))},v=l=>{const a=l.target.value;let h={...s.keyUsage},d={...s.extendedKeyUsage};a==="server"?(h={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},d={serverAuth:!0,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}):a==="client"?(h={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},d={serverAuth:!1,clientAuth:!0,codeSigning:!1,emailProtection:!1,timeStamping:!1}):a==="ca"&&(h={digitalSignature:!0,keyEncipherment:!1,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!0,crlSign:!0},d={serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}),r(c=>({...c,type:a,keyUsage:h,extendedKeyUsage:d}))},T=e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"secondary",onClick:m,disabled:g,children:"Cancel"}),e.jsx(b,{variant:"primary",onClick:S,disabled:g,children:g?"Creating...":"Create Template"})]});return e.jsx(A,{isOpen:k,onClose:m,title:"New Certificate Template",size:"md",footer:T,children:e.jsxs("form",{onSubmit:S,className:t.form,children:[e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Template Information"}),e.jsx(f,{label:"Template Name",name:"name",value:s.name,onChange:u,placeholder:"Web Server Template",required:!0}),e.jsx(f,{label:"Description",name:"description",value:s.description,onChange:u,placeholder:"Template for web server certificates"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Template Type"}),e.jsxs("select",{name:"type",value:s.type,onChange:v,className:t.select,children:[e.jsx("option",{value:"server",children:"Server Authentication"}),e.jsx("option",{value:"client",children:"Client Authentication"}),e.jsx("option",{value:"ca",children:"Certificate Authority"}),e.jsx("option",{value:"code-signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Certificate Settings"}),e.jsxs("div",{className:t.row,children:[e.jsx(f,{label:"Validity Period (Days)",name:"validityDays",type:"number",value:s.validityDays,onChange:u,min:"1",max:"3650"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Key Size"}),e.jsxs("select",{name:"keySize",value:s.keySize,onChange:u,className:t.select,children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.digitalSignature,onChange:()=>o("digitalSignature"),className:t.checkbox}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyEncipherment,onChange:()=>o("keyEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.dataEncipherment,onChange:()=>o("dataEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyAgreement,onChange:()=>o("keyAgreement"),className:t.checkbox}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyCertSign,onChange:()=>o("keyCertSign"),className:t.checkbox}),e.jsx("span",{children:"Certificate Sign"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.crlSign,onChange:()=>o("crlSign"),className:t.checkbox}),e.jsx("span",{children:"CRL Sign"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Extended Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.serverAuth,onChange:()=>x("serverAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Server Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.clientAuth,onChange:()=>x("clientAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Client Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.codeSigning,onChange:()=>x("codeSigning"),className:t.checkbox}),e.jsx("span",{children:"Code Signing"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.emailProtection,onChange:()=>x("emailProtection"),className:t.checkbox}),e.jsx("span",{children:"Email Protection"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.timeStamping,onChange:()=>x("timeStamping"),className:t.checkbox}),e.jsx("span",{children:"Time Stamping"})]})]})]})]})})}const P="_sectionHeader_1humx_2",B="_sectionTitle_1humx_10",K="_filterBtn_1humx_16",L="_tableContainer_1humx_42",D="_templateName_1humx_85",w="_keyUsage_1humx_91",I="_subjectPattern_1humx_97",O="_statusBadge_1humx_107",V="_badgeActive_1humx_118",z="_badgeSystem_1humx_123",M="_actionsCell_1humx_129",F="_actionBtn_1humx_134",n={sectionHeader:P,sectionTitle:B,filterBtn:K,tableContainer:L,templateName:D,keyUsage:w,subjectPattern:I,statusBadge:O,badgeActive:V,badgeSystem:z,actionsCell:M,actionBtn:F},N=[{id:1,name:"Server Certificate",keyUsage:"Digital Signature, Key Encipherment",validity:"1 year",subjectPattern:"CN={hostname}, O=Company",usedBy:"142 certs",status:"ACTIVE"},{id:2,name:"Client Authentication",keyUsage:"Digital Signature, Non Repudiation",validity:"2 years",subjectPattern:"CN={username}, OU=Users",usedBy:"87 certs",status:"ACTIVE"},{id:3,name:"Code Signing",keyUsage:"Digital Signature",validity:"3 years",subjectPattern:"CN={developer}, O=Company",usedBy:"12 certs",status:"ACTIVE"},{id:4,name:"Email Protection",keyUsage:"Digital Signature, Key Encipherment",validity:"1 year",subjectPattern:"CN={email}, OU=Email",usedBy:"234 certs",status:"ACTIVE"},{id:5,name:"Wildcard SSL",keyUsage:"Digital Signature, Key Encipherment",validity:"90 days",subjectPattern:"CN=*.{domain}",usedBy:"45 certs",status:"ACTIVE"},{id:6,name:"VPN Gateway",keyUsage:"Digital Signature, Key Encipherment, TLS Server",validity:"2 years",subjectPattern:"CN={gateway}, OU=VPN",usedBy:"8 certs",status:"ACTIVE"},{id:7,name:"IoT Device",keyUsage:"Digital Signature",validity:"5 years",subjectPattern:"CN={device_id}, OU=IoT",usedBy:"567 certs",status:"ACTIVE"},{id:8,name:"Intermediate CA",keyUsage:"Certificate Sign, CRL Sign",validity:"10 years",subjectPattern:"CN={ca_name}, O=Company",usedBy:"3 certs",status:"SYSTEM"}];function Q(){const[k,m]=j.useState(!1),[s,r]=j.useState(!1),g=()=>{if(N.length===0){p.error("No templates to export");return}E(N,"templates-export",{format:"csv",columns:["id","name","keyUsage","validity","subjectPattern","usedBy","status"]}),p.success("Templates exported successfully")};return e.jsxs("div",{className:n.templateList,children:[e.jsx(U,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsxs(C,{variant:"success",children:[templates.length," Templates"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(b,{icon:"ph ph-download-simple",onClick:g,children:"Export"}),e.jsx(b,{variant:"primary",icon:"ph ph-plus",onClick:()=>r(!0),children:"New Template"})]})}),e.jsxs("div",{className:n.sectionHeader,children:[e.jsx("span",{className:n.sectionTitle,children:"Available Templates"}),e.jsxs("button",{className:n.filterBtn,onClick:()=>m(!k),children:[e.jsx("i",{className:"ph ph-funnel"}),"Filter"]})]}),e.jsx("div",{className:n.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"},children:"TEMPLATE NAME"}),e.jsx("th",{style:{width:"25%"},children:"KEY USAGE"}),e.jsx("th",{style:{width:"10%"},children:"VALIDITY"}),e.jsx("th",{style:{width:"20%"},children:"SUBJECT PATTERN"}),e.jsx("th",{style:{width:"12%"},children:"USED BY"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"8%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:isLoading?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"Loading templates..."})}):templates.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"No templates found"})}):templates.map(i=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:n.templateName,children:i.name}),i.isSystem&&e.jsx(C,{variant:"info",style:{marginLeft:"0.5rem"},children:"System"})]}),e.jsx("td",{children:e.jsx("span",{className:n.keyUsage,children:i.keyUsage})}),e.jsx("td",{children:i.validity}),e.jsx("td",{children:e.jsx("code",{className:n.subjectPattern,children:i.subjectPattern})}),e.jsx("td",{children:i.usedBy}),e.jsx("td",{children:e.jsx("span",{className:`${n.statusBadge} ${i.status==="ACTIVE"?n.badgeActive:n.badgeSystem}`,children:i.status})}),e.jsx("td",{children:e.jsx("div",{className:n.actionsCell,children:!i.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:n.actionBtn,title:"Edit",children:e.jsx("i",{className:"ph ph-pencil"})}),e.jsx("button",{className:n.actionBtn,title:"Delete",onClick:()=>handleDelete(i),children:e.jsx("i",{className:"ph ph-trash"})})]})})})]},i.id))})]})}),e.jsx(_,{isOpen:s,onClose:()=>r(!1)})]})}export{Q as TemplateList,Q as default};
