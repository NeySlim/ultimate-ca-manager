import{a as I,r as c,j as e,B as j,z as g}from"./index-BmhSuKcW.js";import{P as m}from"./PageTopBar-CDIvuvpU.js";import{B as u}from"./Badge-BHKbtQAP.js";import{u as $}from"./useQuery-D1SAqMLR.js";import{u as D}from"./useMutation-1xdByHsX.js";import{a as o}from"./api-ClVrI7m4.js";const A={getAll:async(n={})=>{const r=await o.get("/api/v2/cas",{params:n}),d=(r.data||[]).map(i=>{const h=new Date(i.valid_to)<new Date;return{id:i.id,name:i.common_name||"Unnamed CA",type:i.is_root?"Root":"Intermediate",status:h?"EXPIRED":"ACTIVE",issued:i.valid_from?i.valid_from.split("T")[0]:"N/A",expires:i.valid_to?i.valid_to.split("T")[0]:"N/A",certs:0,children:[],_raw:i}});return{data:d,meta:r.meta||{page:1,per_page:20,total:d.length}}},getById:async n=>(await o.get(`/api/v2/cas/${n}`)).data,create:async n=>(await o.post("/api/v2/cas",n)).data,update:async(n,r)=>(await o.patch(`/api/v2/cas/${n}`,r)).data,delete:async n=>(await o.delete(`/api/v2/cas/${n}`)).data},l={all:["cas"],lists:()=>[...l.all,"list"],list:n=>[...l.lists(),n],details:()=>[...l.all,"detail"],detail:n=>[...l.details(),n]},F=(n={})=>$({queryKey:l.list(n),queryFn:()=>A.getAll(n)}),P=()=>{const n=I();return D({mutationFn:A.delete,onSuccess:()=>{n.invalidateQueries({queryKey:l.lists()})}})},R="_filtersSection_1nm9q_2",L="_filterGroup_1nm9q_13",H="_tableContainer_1nm9q_56",k="_caNameCell_1nm9q_99",G="_caExpandBtn_1nm9q_105",O="_collapsed_1nm9q_123",U="_noChildren_1nm9q_127",Q="_caTreeIndent_1nm9q_132",V="_caIcon_1nm9q_160",K="_root_1nm9q_165",M="_intermediate_1nm9q_169",Y="_orphan_1nm9q_173",X="_statusBadge_1nm9q_178",z="_actionsCell_1nm9q_201",J="_actionBtn_1nm9q_206",W="_orphanedSection_1nm9q_231",Z="_orphanedHeader_1nm9q_239",ee="_orphanedHeaderText_1nm9q_253",se="_orphanedTable_1nm9q_259",t={filtersSection:R,filterGroup:L,tableContainer:H,caNameCell:k,caExpandBtn:G,collapsed:O,noChildren:U,caTreeIndent:Q,caIcon:V,root:K,intermediate:M,orphan:Y,statusBadge:X,actionsCell:z,actionBtn:J,orphanedSection:W,orphanedHeader:Z,orphanedHeaderText:ee,orphanedTable:se};function de(){const[n,r]=c.useState("all"),[d,i]=c.useState("all"),[_,C]=c.useState("name"),[h,S]=c.useState(""),[p,f]=c.useState(new Set),{data:w,isLoading:T,error:v}=F(),E=P(),x=s=>{confirm(`Delete CA "${s.name}"? This cannot be undone.`)&&E.mutate(s.id,{onSuccess:()=>g.success("CA deleted"),onError:()=>g.error("Failed to delete CA")})},b=s=>{const a=new Set(p);a.has(s)?a.delete(s):a.add(s),f(a)};if(T)return e.jsxs("div",{className:t.caList,children:[e.jsx(m,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(u,{variant:"neutral",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading CAs..."})]});if(v)return e.jsxs("div",{className:t.caList,children:[e.jsx(m,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(u,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading CAs: ",v.message]})]});const y=w?.data||[],N=[],B=y.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:t.caList,children:[e.jsx(m,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsxs(u,{variant:"success",children:[B," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:"ph ph-upload-simple",children:"Import"}),e.jsx(j,{icon:"ph ph-download-simple",children:"Export"}),e.jsx(j,{variant:"primary",icon:"ph ph-plus",children:"Create CA"})]})}),e.jsxs("div",{className:t.filtersSection,children:[e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{htmlFor:"type-filter",children:"TYPE"}),e.jsxs("select",{id:"type-filter",value:n,onChange:s=>r(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"root",children:"Root"}),e.jsx("option",{value:"intermediate",children:"Intermediate"})]})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{htmlFor:"status-filter",children:"STATUS"}),e.jsxs("select",{id:"status-filter",value:d,onChange:s=>i(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{htmlFor:"sort-filter",children:"SORT BY"}),e.jsxs("select",{id:"sort-filter",value:_,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued Date"}),e.jsx("option",{value:"expires",children:"Expires Date"})]})]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{className:t.filterGroup,children:e.jsx("input",{type:"text",id:"search-filter",placeholder:"Search CAs...",value:h,onChange:s=>S(s.target.value)})})]}),e.jsx("div",{className:t.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.caNameCell,children:[e.jsx("button",{className:`${t.caExpandBtn} ${s.children?"":t.noChildren} ${p.has(s.id)?"":t.collapsed}`,onClick:()=>s.children&&b(s.id),children:e.jsx("i",{className:"ph ph-caret-down"})}),e.jsx("i",{className:`ph ph-bank ${t.caIcon} ${t.root}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:t.actionBtn,title:"Delete",onClick:a=>{a.stopPropagation(),x(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id),s.children&&p.has(s.id)&&s.children.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.caTreeIndent,children:[e.jsx("i",{className:`ph ph-git-branch ${t.caIcon} ${t.intermediate}`}),e.jsx("span",{children:a.name})]})}),e.jsx("td",{children:e.jsx("span",{children:a.type})}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${a.status.toLowerCase()}`,children:a.status})}),e.jsx("td",{children:a.issued}),e.jsx("td",{children:a.expires}),e.jsx("td",{children:a.certs}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:t.actionBtn,title:"Delete",onClick:q=>{q.stopPropagation(),x(a)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},a.id))]}))})]})}),N.length>0&&e.jsxs("div",{className:t.orphanedSection,children:[e.jsxs("div",{className:t.orphanedHeader,children:[e.jsx("i",{className:"ph ph-warning"}),e.jsx("span",{className:t.orphanedHeaderText,children:"Orphaned Intermediate CAs"})]}),e.jsx("div",{className:t.orphanedTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:t.caNameCell,children:[e.jsx("i",{className:`ph ph-warning ${t.caIcon} ${t.orphan}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${t.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:t.actionsCell,children:[e.jsx("button",{className:t.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:t.actionBtn,title:"Delete",onClick:a=>{a.stopPropagation(),x(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id))})]})})]})]})}export{de as CAList,de as default};
