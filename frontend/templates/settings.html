{% extends "base.html" %}

{% block title %}Settings - UCM{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: column; gap: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 style="font-size: 1.875rem; font-weight: 600; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <svg class="ucm-icon" width="24" height="24"><use href="#icon-settings"/></svg>
            <span>System Settings</span>
        </h1>
    </div>
    
    {% if session.get('role') != 'admin' %}
    <!-- Non-admin message -->
    <div class="card" style="padding: 3rem; text-align: center;">
        <svg class="ucm-icon" width="64" height="64" style="margin: 0 auto 1rem auto; opacity: 0.5;"><use href="#icon-shield"/></svg>
        <h2 style="font-size: 1.5rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Administrator Access Required</h2>
        <p style="color: var(--text-secondary); font-size: 1rem;">
            This page is only accessible to administrators. 
            <br>
            For your account settings, please visit <a href="/my-account" style="color: var(--primary-color); text-decoration: underline;">My Account</a>.
        </p>
    </div>
    {% else %}
    
    <!-- Settings Tabs -->
    <div class="tabs-container" style="display: flex; gap: 0; margin-bottom: 2rem; border-bottom: 2px solid var(--border-color); overflow-x: auto;">
        <button class="tab-button active" onclick="ucm_switchTab('general')" id="btn-tab-general" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 600; color: var(--primary-color); border-bottom: 3px solid var(--primary-color); background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18" style="margin-right: 8px;"><use href="#icon-info-circle"/></svg> General
        </button>
        <button class="tab-button" onclick="ucm_switchTab('https')" id="btn-tab-https" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18"><use href="#icon-lock"/></svg> HTTPS
        </button>
        <button class="tab-button" onclick="ucm_switchTab('authentication')" id="btn-tab-authentication" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18" style="margin-right: 8px;"><use href="#icon-key"/></svg> Authentication
        </button>
        <button class="tab-button" onclick="ucm_switchTab('email')" id="btn-tab-email" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18"><use href="#icon-mail"/></svg> Email
        </button>
        <button class="tab-button" onclick="ucm_switchTab('users')" id="btn-tab-users" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18"><use href="#icon-users"/></svg> Users
        </button>
        <button class="tab-button" onclick="ucm_switchTab('database')" id="btn-tab-database" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18" style="margin-right: 8px;"><use href="#icon-database"/></svg> Database
        </button>
        <button class="tab-button" onclick="ucm_switchTab('advanced')" id="btn-tab-advanced" style="padding: 1rem 2rem; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; background: none; border-top: none; border-left: none; border-right: none; cursor: pointer; min-height: 3.5rem; white-space: nowrap;">
            <svg class="ucm-icon" width="18" height="18" style="margin-right: 8px;"><use href="#icon-settings"/></svg> Advanced
        </button>
    </div>
    
    <!-- Tab: General -->
    <div id="tab-general" class="tab-content active">
        
        <!-- System Information -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-server"/></svg>
                    System Information
                </h2>
            </div>
            <div hx-get="/api/ui/settings/system-info" hx-trigger="intersect once" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading system info...</p>
                </div>
            </div>
        </div>
        
        <!-- Session Configuration -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-clock"/></svg>
                    Session Configuration
                </h2>
            </div>
            <div hx-get="/api/ui/settings/session-config" hx-trigger="intersect once" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading session config...</p>
                </div>
            </div>
        </div>
        
        <!-- UI Preferences -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-palette"/></svg>
                    UI Preferences
                </h2>
            </div>
            <div hx-get="/api/ui/settings/ui-prefs" hx-trigger="intersect once" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading UI preferences...</p>
                </div>
            </div>
        </div>
        
        <!-- Default Certificate Settings -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-award"/></svg>
                    Default Certificate Settings
                </h2>
            </div>
            <div hx-get="/api/ui/settings/cert-defaults" hx-trigger="intersect once" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading certificate defaults...</p>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: General -->
    
    <!-- Tab: HTTPS Certificate -->
    <div id="tab-https" class="tab-content" style="display: none;">
        
        <!-- Password Policy -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-lock"/></svg>
                    Password Policy
                </h2>
            </div>
            <div hx-get="/api/ui/settings/password-policy" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading password policy...</p>
                </div>
            </div>
        </div>
        
        <!-- Session Security -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-shield"/></svg>
                    Session Security
                </h2>
            </div>
            <div hx-get="/api/ui/settings/session-security" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading session security...</p>
                </div>
            </div>
        </div>
        
        <!-- HTTPS Certificate -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-file-text"/></svg>
                    HTTPS Certificate
                </h2>
            </div>
            <div hx-get="/api/ui/settings/https-cert" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading certificate info...</p>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: HTTPS -->
    
    <!-- Tab: Authentication -->
    <div id="tab-authentication" class="tab-content" style="display: none;">
        
        <!-- mTLS Authentication -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-shield-check"/></svg>
                    mTLS Authentication
                </h2>
            </div>
            <div hx-get="/api/ui/settings/mtls" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading mTLS settings...</p>
                </div>
            </div>
        </div>
        
        <!-- WebAuthn Authentication -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-key"/></svg>
                    WebAuthn / FIDO2 Authentication
                </h2>
            </div>
            <div hx-get="/api/ui/settings/webauthn" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading WebAuthn settings...</p>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: Authentication -->
    
    <!-- Tab: Email -->
    <div id="tab-email" class="tab-content" style="display: none;">
        
        <!-- SMTP Configuration -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-mail"/></svg>
                    SMTP Configuration
                </h2>
            </div>
            <div hx-get="/api/ui/settings/email" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading email settings...</p>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: Email -->
    
    <!-- Tab: Users -->
    <div id="tab-users" class="tab-content" style="display: none;">
        
        <!-- User Management -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-users"/></svg>
                    User Management
                </h2>
            </div>
            <div hx-get="/api/ui/settings/users" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading users...</p>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: Users -->
    
    <!-- Tab: Database -->
    <div id="tab-database" class="tab-content" style="display: none;">
        
        <!-- Database Statistics -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-database"/></svg>
                    Database Statistics
                </h2>
            </div>
            <div hx-get="/api/ui/settings/database-stats" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading database stats...</p>
                </div>
            </div>
        </div>
        
        <!-- Backup & Restore -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-download"/></svg>
                    Backup & Restore
                </h2>
            </div>
            <div hx-get="/api/ui/settings/backup" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading backup options...</p>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: Database -->
    
    <!-- Tab: Advanced -->
    <div id="tab-advanced" class="tab-content" style="display: none;">
        
        <!-- ACME Server -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-certificate-authority"/></svg>
                    ACME Server
                </h2>
            </div>
            <div hx-get="/api/ui/settings/acme" hx-trigger="revealed" hx-swap="innerHTML" style="padding: 1.5rem;">
                <div style="text-align: center; padding: 2rem;">
                    <svg class="ucm-icon spinner" width="32" height="32"><use href="#icon-spinner"/></svg>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">Loading ACME settings...</p>
                </div>
            </div>
        </div>
        
        <!-- System Logs -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-file-text"/></svg>
                    System Logs
                </h2>
            </div>
            <div style="padding: 1.5rem;">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                    <button onclick="viewLogs('error')" class="btn-secondary">
                        <svg class="ucm-icon" width="16" height="16"><use href="#icon-warning-triangle"/></svg>
                        View Error Log
                    </button>
                    <button onclick="viewLogs('access')" class="btn-secondary">
                        <svg class="ucm-icon" width="16" height="16"><use href="#icon-file-text"/></svg>
                        View Access Log
                    </button>
                    <button onclick="viewLogs('system')" class="btn-secondary">
                        <svg class="ucm-icon" width="16" height="16"><use href="#icon-server"/></svg>
                        View System Log
                    </button>
                </div>
                <div id="logs-display" style="display: none;">
                    <pre style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; overflow-x: auto; max-height: 500px; font-size: 0.75rem; line-height: 1.5;"></pre>
                </div>
            </div>
        </div>
        
        <!-- System Commands -->
        <div class="card">
            <div class="card-header">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-terminal"/></svg>
                    System Commands
                </h2>
            </div>
            <div style="padding: 1.5rem;">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button onclick="restartService()" class="btn-warning">
                        <svg class="ucm-icon ucm-icon-refresh" width="16" height="16"><use href="#icon-refresh"/></svg>
                        Restart Service
                    </button>
                    <button onclick="reloadService()" class="btn-secondary">
                        <svg class="ucm-icon ucm-icon-refresh" width="16" height="16"><use href="#icon-refresh"/></svg>
                        Reload Service
                    </button>
                    <button onclick="clearCache()" class="btn-secondary">
                        <svg class="ucm-icon" width="16" height="16"><use href="#icon-trash"/></svg>
                        Clear Cache
                    </button>
                </div>
            </div>
        </div>
        
    </div><!-- End Tab: Advanced -->
    
    {% endif %}
</div>

<script>
// ============================================
// UCM TAB MANAGEMENT
// ============================================
function ucm_switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
        tab.classList.remove('active');
    });
    
    // Show selected tab
    const selectedTab = document.getElementById('tab-' + tabName);
    if (selectedTab) {
        selectedTab.style.display = 'block';
        selectedTab.classList.add('active');
        
        // Force HTMX to process all hx-trigger elements in the newly visible tab
        setTimeout(() => {
            htmx.process(selectedTab);
        }, 10);
    }
    
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
        btn.style.fontWeight = '500';
        btn.style.color = 'var(--text-secondary)';
        btn.style.borderBottom = '3px solid transparent';
    });
    
    const selectedBtn = document.getElementById('btn-tab-' + tabName);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
        selectedBtn.style.fontWeight = '600';
        selectedBtn.style.color = 'var(--primary-color)';
        selectedBtn.style.borderBottom = '3px solid var(--primary-color)';
    }
    
    // Trigger HTMX event for lazy loading
    htmx.trigger(document.body, 'tab-' + tabName);
    
    // Save last tab
    localStorage.setItem('ucm-settings-tab', tabName);
    
    // Trigger HTMX load event for lazy-loaded tabs
    htmx.trigger(document.body, 'tab-' + tabName);
}

// Restore last tab on page load
document.addEventListener('DOMContentLoaded', function() {
    const lastTab = localStorage.getItem('ucm-settings-tab');
    if (lastTab && document.getElementById('tab-' + lastTab)) {
        ucm_switchTab(lastTab);
    }
});

// ============================================
// FORM HANDLING
// ============================================
function handleSaveResponse(event) {
    if (event.detail.successful) {
        showToast('Settings saved successfully', 'success');
    } else {
        showToast('Failed to save settings', 'error');
    }
}

// ============================================
// UTILITY FUNCTIONS
// ============================================
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    const bgColors = {
        success: '#10b981',
        error: '#ef4444',
        warning: '#f59e0b',
        info: '#3b82f6'
    };
    
    toast.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        padding: 1rem 1.5rem; border-radius: 0.5rem; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        background: ${bgColors[type] || bgColors.info};
        color: white; font-weight: 500; max-width: 400px;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard', 'success');
    }).catch(() => {
        showToast('Failed to copy', 'error');
    });
}

// ============================================
// SYSTEM LOGS
// ============================================
function viewLogs(logType) {
    const display = document.getElementById('logs-display');
    const pre = display.querySelector('pre');
    
    display.style.display = 'block';
    pre.textContent = 'Loading logs...';
    
    htmx.ajax('GET', `/api/ui/system/logs/${logType}`, {swap: 'none'})
        .then(xhr => {
            const data = JSON.parse(xhr.responseText);
            if (data.success && data.logs) {
                pre.textContent = data.logs;
            } else {
                pre.textContent = 'No logs available';
            }
        })
        .catch(error => {
            pre.textContent = 'Error loading logs: ' + error.message;
        });
}

// ============================================
// SYSTEM COMMANDS
// ============================================
function restartService() {
    if (!confirm('Are you sure you want to restart the UCM service?\n\nThis will temporarily interrupt service.')) {
        return;
    }
    
    showToast('Restarting service...', 'info');
    
    htmx.ajax('POST', '/api/ui/system/restart', {swap: 'none'})
        .then(xhr => {
            showToast('Service restarted successfully', 'success');
            setTimeout(() => location.reload(), 2000);
        })
        .catch(error => {
            showToast('Failed to restart service', 'error');
        });
}

function reloadService() {
    showToast('Reloading service...', 'info');
    
    htmx.ajax('POST', '/api/ui/system/reload', {swap: 'none'})
        .then(xhr => {
            showToast('Service reloaded successfully', 'success');
        })
        .catch(error => {
            showToast('Failed to reload service', 'error');
        });
}

function clearCache() {
    if (!confirm('Clear all cached data?')) {
        return;
    }
    
    showToast('Clearing cache...', 'info');
    
    htmx.ajax('POST', '/api/ui/system/clear-cache', {swap: 'none'})
        .then(xhr => {
            showToast('Cache cleared successfully', 'success');
        })
        .catch(error => {
            showToast('Failed to clear cache', 'error');
        });
}

// ============================================
// MODAL MANAGEMENT
// ============================================
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Close modal on overlay click
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal-overlay')) {
        event.target.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
});

// Close modal on Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.style.display = 'none';
        });
        document.body.style.overflow = 'auto';
    }
});

</script>
{% endblock %}
