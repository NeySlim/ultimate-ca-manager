{% extends "base.html" %}

{% block title %}OCSP Status - UCM{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: column; gap: 1.5rem;">
    <div>
        <h1 style="font-size: 1.875rem; font-weight: bold; color: var(--text-primary); margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
            <svg class="ucm-icon" width="24" height="24"><use href="#icon-ocsp"/></svg>
            <span>OCSP Status</span>
        </h1>
        <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">
            Online Certificate Status Protocol - Real-time certificate validation
        </p>
    </div>

    <!-- OCSP Overview -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <div class="card" style="padding: 0;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); margin: 0 0 0.5rem 0;">OCSP Enabled CAs</p>
                    <p style="font-size: 1.5rem; font-weight: bold; color: var(--text-primary); margin: 0;" 
                       hx-get="/api/ui/ocsp/stats" 
                       hx-trigger="load" 
                       hx-swap="innerHTML"
                       hx-select=".ocsp-enabled-count">
                        <svg class="ucm-icon icon-spin" width="20" height="20"><use href="#icon-spinner"/></svg>
                    </p>
                </div>
                <div style="padding: 0.75rem; background: var(--primary-bg); border-radius: 50%;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-check-circle"/></svg>
                </div>
            </div>
        </div>

        <div class="card" style="padding: 0;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); margin: 0 0 0.5rem 0;">Cached Responses</p>
                    <p style="font-size: 1.5rem; font-weight: bold; color: var(--text-primary); margin: 0;"
                       hx-get="/api/ui/ocsp/stats"
                       hx-trigger="load"
                       hx-swap="innerHTML"
                       hx-select=".cached-responses-count">
                        <svg class="ucm-icon icon-spin" width="20" height="20"><use href="#icon-spinner"/></svg>
                    </p>
                </div>
                <div style="padding: 0.75rem; background: var(--success-bg); border-radius: 50%;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--success-color);"><use href="#icon-database"/></svg>
                </div>
            </div>
        </div>

        <div class="card" style="padding: 0;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); margin: 0 0 0.5rem 0;">Responder Endpoint</p>
                    <p style="font-size: 0.875rem; font-family: monospace; color: var(--text-primary); margin: 0;">/ocsp</p>
                </div>
                <div style="padding: 0.75rem; background: var(--primary-bg); border-radius: 50%;">
                    <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-server"/></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- OCSP Information -->
    <div class="info-box">
        <div class="info-box-title">
            <svg class="ucm-icon" width="20" height="20" style="color: var(--info-color);"><use href="#icon-info"/></svg>
            <span>What is OCSP?</span>
        </div>
        <div class="info-box-content">
            <p>
                <strong>OCSP (Online Certificate Status Protocol)</strong> provides real-time certificate validation status. 
                When a client connects to a server, it can query the OCSP responder to check if the certificate is valid, 
                revoked, or unknown.
            </p>
            <p>
                <svg class="ucm-icon" width="16" height="16" style="vertical-align: text-bottom; margin-right: 0.375rem; color: var(--success-color);"><use href="#icon-check-circle"/></svg>
                <strong>Advantages:</strong> Real-time status, lightweight responses, better performance than downloading full CRLs
            </p>
        </div>
    </div>
    
    <div class="info-box warning">
        <div class="info-box-title">
            <svg class="ucm-icon" width="20" height="20" style="color: var(--warning-color);"><use href="#icon-alert-triangle"/></svg>
            <span>Privacy Note</span>
        </div>
        <div class="info-box-content">
            <p>
                OCSP requests reveal which certificates are being validated to the responder. 
                Use CRL for better privacy or enable OCSP Stapling.
            </p>
        </div>
    </div>

    <!-- CA OCSP Configuration -->
    <div class="card" style="padding: 0;">
        <div style="padding: 1.5rem 1.5rem 0.75rem 1.5rem; border-bottom: 1px solid var(--border-color);">
            <h2 style="font-size: 1rem; font-weight: 600; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                <svg class="ucm-icon" width="18" height="18"><use href="#icon-settings"/></svg>
                <span>Certificate Authorities OCSP Configuration</span>
            </h2>
        </div>
        <div hx-get="/api/ui/ocsp/status" 
             hx-trigger="load" 
             hx-target="#ocsp-status-list"
             hx-swap="innerHTML">
            <div id="ocsp-status-list">
                <div style="display: flex; justify-content: center; align-items: center; padding: 2rem;">
                    <svg class="ucm-icon icon-spin" width="20" height="20"><use href="#icon-spinner"/></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Testing Section -->
    <div class="card" style="padding: 0;">
        <h2 style="font-size: 1rem; font-weight: 600; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <svg class="ucm-icon" width="18" height="18"><use href="#icon-flask"/></svg>
            <span>Testing OCSP Responder</span>
        </h2>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div>
                <p style="font-size: 0.875rem; font-weight: 500; margin: 0 0 0.5rem 0; color: var(--text-secondary);">Test with OpenSSL:</p>
                <code style="display: block; background: var(--code-bg, #1e1e1e); color: var(--code-text, #4ec9b0); padding: 1rem; border-radius: 0.5rem; font-size: 0.875rem; overflow-x: auto;">openssl ocsp -issuer ca.crt -cert certificate.crt \
  -url https://your-domain:8443/ocsp \
  -text</code>
            </div>
            <div>
                <p style="font-size: 0.875rem; font-weight: 500; margin: 0 0 0.5rem 0; color: var(--text-secondary);">Expected Response:</p>
                <code style="display: block; background: var(--code-bg, #1e1e1e); color: var(--code-text, #4ec9b0); padding: 1rem; border-radius: 0.5rem; font-size: 0.875rem; overflow-x: auto;">Response verify OK
certificate.crt: good
    This Update: Jan  5 14:50:00 2026 GMT
    Next Update: Jan  6 14:50:00 2026 GMT</code>
            </div>
        </div>
    </div>
</div>

{% endblock %}
