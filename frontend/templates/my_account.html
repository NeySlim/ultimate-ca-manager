{% extends "base.html" %}

{% block title %}My Account - UCM{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: column; gap: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 style="font-size: 1.875rem; font-weight: 600; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <svg class="ucm-icon" width="24" height="24"><use href="#icon-user"/></svg>
            <span>My Account</span>
        </h1>
    </div>
    
    <!-- User Profile -->
    <div class="card" style="padding: 0;">
        <div class="card-header">
            <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-user"/></svg>
                Profile Information
            </h2>
        </div>
        <div style="padding: 1.5rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">Username</label>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <svg class="ucm-icon" width="24" height="24" style="color: var(--primary-color);"><use href="#icon-user"/></svg>
                        <span style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary);">{{ session.get('username', 'N/A') }}</span>
                    </div>
                </div>
                <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">Role</label>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        {% if session.get('role') == 'admin' %}
                        <span class="badge-outline badge-primary">
                            <svg class="ucm-icon" width="12" height="12"><use href="#icon-shield-check"/></svg>
                            Administrator
                        </span>
                        {% else %}
                        <span class="badge-outline badge-info">
                            <svg class="ucm-icon" width="12" height="12"><use href="#icon-eye"/></svg>
                            {{ session.get('role', 'viewer').title() }}
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Password Change -->
    <div class="card" style="padding: 0;">
        <div class="card-header">
            <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-key"/></svg>
                Change Password
            </h2>
        </div>
        <div style="padding: 1.5rem;">
            <form id="change-password-form" style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <label class="form-label">Current Password</label>
                    <input type="password" id="current-password" class="form-input" placeholder="Enter current password" required>
                </div>
                <div>
                    <label class="form-label">New Password</label>
                    <input type="password" id="new-password" class="form-input" placeholder="Enter new password" required minlength="8">
                </div>
                <div>
                    <label class="form-label">Confirm New Password</label>
                    <input type="password" id="confirm-password" class="form-input" placeholder="Confirm new password" required>
                </div>
                <div style="padding-top: 0.5rem;">
                    <button type="submit" class="btn-primary">
                        <svg class="ucm-icon" width="16" height="16" style="margin-right: 0.5rem;"><use href="#icon-check"/></svg>
                        Update Password
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Theme Preferences -->
    <div class="card" style="padding: 0;">
        <div class="card-header">
            <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-palette"/></svg>
                Theme Preferences
            </h2>
        </div>
        <div style="padding: 1.5rem;">
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                Current theme: <span id="current-theme-name" style="font-weight: 600; color: var(--text-primary);"></span>
            </p>
            <div style="display: grid; grid-template-columns: repeat(4, minmax(200px, 1fr)); gap: 1rem; max-width: 100%;">
                <!-- First row: Light themes -->
                <!-- Sentinel Light -->
                <button data-action="set-theme" data-theme="sentinel-light" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s; min-width: 0;" onmouseover="this.style.borderColor='#3b82f6'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(59,130,246,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #f8fafc;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #3b82f6;"><use href="#icon-sun"/></svg>
                                <span style="font-weight: 600; color: #1e293b; font-size: 0.75rem;">Sentinel Light</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #2563eb);"></div>
                        </div>
                        <div style="background: #ffffff; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #e2e8f0;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #3b82f6; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #e2e8f0; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #cbd5e1; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #e2e8f0; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Sentinel Dark -->
                <button data-action="set-theme" data-theme="sentinel-dark" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#3b82f6'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(59,130,246,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #0f172a;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #60a5fa;"><use href="#icon-moon"/></svg>
                                <span style="font-weight: 600; color: #f1f5f9; font-size: 0.75rem;">Sentinel Dark</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #2563eb);"></div>
                        </div>
                        <div style="background: #1e293b; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #334155;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #3b82f6; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #334155; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #475569; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #334155; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Amber Light -->
                <button data-action="set-theme" data-theme="amber-light" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#f97316'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(249,115,22,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #fffbeb;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #f97316;"><use href="#icon-sun"/></svg>
                                <span style="font-weight: 600; color: #78350f; font-size: 0.75rem;">Amber Light</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #f97316, #ea580c);"></div>
                        </div>
                        <div style="background: #ffffff; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #fed7aa;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #f97316; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #fed7aa; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #fde68a; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #fed7aa; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Amber Dark -->
                <button data-action="set-theme" data-theme="amber-dark" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#f97316'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(249,115,22,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #1c1917;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #fb923c;"><use href="#icon-moon"/></svg>
                                <span style="font-weight: 600; color: #fef3c7; font-size: 0.75rem;">Amber Dark</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #f97316, #ea580c);"></div>
                        </div>
                        <div style="background: #292524; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #44403c;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #f97316; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #44403c; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #57534e; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #44403c; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Blossom Light -->
                <button data-action="set-theme" data-theme="blossom-light" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#ec4899'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(236,72,153,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #fdf2f8;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #ec4899;"><use href="#icon-sun"/></svg>
                                <span style="font-weight: 600; color: #831843; font-size: 0.75rem;">Blossom Light</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #ec4899, #db2777);"></div>
                        </div>
                        <div style="background: #ffffff; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #fbcfe8;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #ec4899; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #fbcfe8; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #f9a8d4; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #fbcfe8; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Blossom Dark -->
                <button data-action="set-theme" data-theme="blossom-dark" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#ec4899'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(236,72,153,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #1e1b20;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #f472b6;"><use href="#icon-moon"/></svg>
                                <span style="font-weight: 600; color: #fce7f3; font-size: 0.75rem;">Blossom Dark</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #ec4899, #db2777);"></div>
                        </div>
                        <div style="background: #2d1b28; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #4a2640;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #ec4899; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #4a2640; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #5e3450; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #4a2640; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Nebula Light -->
                <button data-action="set-theme" data-theme="nebula-light" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#8b5cf6'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(139,92,246,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #faf5ff;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #8b5cf6;"><use href="#icon-sun"/></svg>
                                <span style="font-weight: 600; color: #581c87; font-size: 0.75rem;">Nebula Light</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></div>
                        </div>
                        <div style="background: #ffffff; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #e9d5ff;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #8b5cf6; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #e9d5ff; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #d8b4fe; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #e9d5ff; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>

                <!-- Nebula Dark -->
                <button data-action="set-theme" data-theme="nebula-dark" style="all: unset; cursor: pointer; position: relative; border-radius: 0.5rem; overflow: hidden; border: 2px solid var(--border-color); transition: all 0.2s;" onmouseover="this.style.borderColor='#8b5cf6'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(139,92,246,0.15)'" onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="padding: 0.75rem; background: #1e1b2e;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem;">
                                <svg width="12" height="12" style="color: #a78bfa;"><use href="#icon-moon"/></svg>
                                <span style="font-weight: 600; color: #e9d5ff; font-size: 0.75rem;">Nebula Dark</span>
                            </div>
                            <div style="width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></div>
                        </div>
                        <div style="background: #2e1f47; border-radius: 0.375rem; padding: 0.5rem; border: 1px solid #4c3565;">
                            <div style="display: flex; gap: 0.375rem; margin-bottom: 0.375rem;">
                                <div style="flex: 1; height: 1rem; background: #8b5cf6; border-radius: 0.25rem;"></div>
                                <div style="flex: 1; height: 1rem; background: #4c3565; border-radius: 0.25rem;"></div>
                            </div>
                            <div style="height: 0.5rem; background: #5e4578; border-radius: 0.25rem; margin-bottom: 0.25rem;"></div>
                            <div style="height: 0.5rem; background: #4c3565; border-radius: 0.25rem; width: 60%;"></div>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Client Certificates -->
    <div class="card" style="padding: 0;">
        <div class="card-header">
            <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-key"/></svg>
                Client Certificates
            </h2>
        </div>
        <div style="padding: 1.5rem;">
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                Manage your client certificates for mTLS authentication and secure communications.
            </p>
            <a href="/my-account/mtls" class="btn-secondary">
                <svg class="ucm-icon" width="16" height="16" style="margin-right: 0.5rem;"><use href="#icon-key"/></svg>
                Manage My Certificates
            </a>
        </div>
    </div>

    <!-- Session Information -->
    <div class="card" style="padding: 0;">
        <div class="card-header">
            <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                <svg class="ucm-icon" width="20" height="20" style="color: var(--primary-color);"><use href="#icon-clock"/></svg>
                Session Information
            </h2>
        </div>
        <div style="padding: 1.5rem;">
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 500; color: var(--text-secondary);">Session Status</span>
                    <span class="badge-outline badge-success">
                        <svg class="ucm-icon" width="12" height="12"><use href="#icon-check"/></svg>
                        Active
                    </span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 500; color: var(--text-secondary);">Login Method</span>
                    <span style="font-weight: 600; color: var(--text-primary);">Password</span>
                </div>
                <div style="padding-top: 0.5rem; border-top: 1px solid var(--border-color);">
                    <a href="/logout" class="btn-danger">
                        <svg class="ucm-icon" width="16" height="16" style="margin-right: 0.5rem;"><use href="#icon-logout"/></svg>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Display current theme
document.addEventListener('DOMContentLoaded', function() {
    const theme = localStorage.getItem('ucm-theme') || 'sentinel-light';
    const [base, variant] = theme.split('-');
    const themeName = base.charAt(0).toUpperCase() + base.slice(1) + ' ' + 
                     variant.charAt(0).toUpperCase() + variant.slice(1);
    document.getElementById('current-theme-name').textContent = themeName;
});

// Handle password change form
document.getElementById('change-password-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    
    if (newPassword !== confirmPassword) {
        ucmAlert('New passwords do not match!', 'Error');
        return;
    }
    
    if (newPassword.length < 8) {
        ucmAlert('Password must be at least 8 characters long!', 'Error');
        return;
    }
    
    // TODO: Implement password change API call
    fetch('/api/auth/change-password', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            current_password: currentPassword,
            new_password: newPassword
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            ucmAlert('Password changed successfully!', 'Success').then(() => {
                document.getElementById('change-password-form').reset();
            });
        } else {
            ucmAlert('Error: ' + (data.message || 'Failed to change password'), 'Error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        ucmAlert('An error occurred while changing password', 'Error');
    });
});

</script>
{% endblock %}
