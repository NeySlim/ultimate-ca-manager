{% extends "base.html" %}

{% block title %}Certificate Templates - UCM{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: column; gap: 1.5rem;">
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 style="font-size: 1.875rem; font-weight: 600; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <svg class="ucm-icon" width="28" height="28"><use href="#icon-file"/></svg>
            Certificate Templates
        </h1>
        {% if session.get('role') == 'admin' %}
        <button onclick="openCreateModal()" class="btn-primary">
            <svg class="ucm-icon" width="16" height="16"><use href="#icon-plus"/></svg>
            Create Template
        </button>
        {% endif %}
    </div>

    <!-- Stats Cards -->
    <div id="templates-stats" 
         style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;"
         hx-get="/api/ui/templates/stats" 
         hx-trigger="load, refreshTemplates from:body"
         hx-swap="innerHTML">
        <div class="stats-card skeleton"></div>
    </div>

    <!-- Templates List -->
    <div class="card" style="padding: 1.5rem;">
        <div id="templates-list"
             hx-get="/api/ui/templates/list"
             hx-trigger="load, refreshTemplates from:body"
             hx-swap="innerHTML">
            <div style="text-align: center; padding: 3rem;">
                <p style="color: var(--text-secondary);">Loading...</p>
            </div>
        </div>
    </div>
</div>

<script>
function openCreateModal() {
    alert('Create modal - Work in progress');
}

function viewTemplateDetail(id) {
    // Simple alert for now - could be enhanced with a modal
    fetch('/api/v1/templates/' + id)
        .then(r => r.json())
        .then(t => {
            const details = `Template: ${t.name}\n\nType: ${t.template_type}\nKey: ${t.key_type}\nValidity: ${t.validity_days} days\nDigest: ${t.digest}\n\nDN Template:\n${JSON.stringify(t.dn_template, null, 2)}\n\nExtensions:\n${JSON.stringify(t.extensions_template, null, 2)}`;
            alert(details);
        })
        .catch(e => alert('Error: ' + e.message));
}

function openEditModal(id) {
    alert('Edit modal - Work in progress (template ID: ' + id + ')');
}

window.showToast = window.showToast || function(msg, type) { alert(msg); };
</script>

<style>
.stats-card {
    padding: 1.5rem;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
}
.skeleton {
    height: 60px;
    background: var(--bg-secondary);
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
</style>
{% endblock %}
