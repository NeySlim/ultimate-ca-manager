import{j as e}from"./radix-B6Y-MRu0.js";import{a as i}from"./vendor-DEQSVNfj.js";import{u as ye,c as he,m as fe,h as je,g as S,B as d,L as ee,I as j}from"./index-vswyqp58.js";import{n as ge}from"./Globe.es-CtUoIY1T.js";import{s as q,C as be,b as U,c as I,d as m}from"./DetailCard-BKBzFg8i.js";import{s as G}from"./Download.es-Bp_lE9WD.js";import{c as Q}from"./FileArrowUp.es-C-xJex7r.js";import{a as X}from"./PencilSimple.es-CJefJBPq.js";import{n as L}from"./Plus.es-DN9hvW10.js";import{n as Y}from"./Trash.es-DhgoD9TD.js";import{M as Z}from"./Modal-7_eTIvz3.js";import{B as w}from"./Badge-CZ5NzBfK.js";import{S as ve}from"./Select-PwXyFoxR.js";import{T as Ce}from"./Textarea-DuI5mbE0.js";import{H as R}from"./HelpCard-BINCqYIf.js";import{R as Te}from"./ResponsiveDataTable-kYvH3TtM.js";import{R as Ne}from"./ResponsiveLayout-BgG2EW8C.js";import{t as g}from"./templates.service-CpYEtCuT.js";import{u as Se}from"./usePermission-B5db8pNS.js";import"./CaretDown.es-DuThAI6u.js";import"./Fingerprint.es-a52JDt2Q.js";import"./CaretUp.es-CYK8cpGg.js";import"./CaretRight.es-B3hFfvz_.js";import"./ArrowLeft.es-CZcTzWfI.js";import"./UnifiedPageHeader-Cbwye_R6.js";function Ye(){const{isMobile:c}=ye(),{showSuccess:h,showError:u,showConfirm:r}=he(),{canWrite:o,canDelete:b}=Se(),v=i.useRef(null),[p,C]=i.useState([]),[l,n]=i.useState(!0),[a,T]=i.useState(null),[te,x]=i.useState(!1),[ae,O]=i.useState(!1),[_,y]=i.useState(null),[se,P]=i.useState(1),[le,ie]=i.useState(25),[z,re]=i.useState(""),[D,F]=i.useState(null),[E,M]=i.useState(""),[$,J]=i.useState(!1);i.useEffect(()=>{N()},[]);const N=async()=>{try{n(!0);const t=await g.getAll();C(t.data||[])}catch{u("Failed to load templates")}finally{n(!1)}},k=i.useCallback(t=>{if(t.type)return t.type;const s=(t.name||"").toLowerCase();return s.includes("ca")||s.includes("authority")||t.is_ca||t.basic_constraints?.ca?"ca":"certificate"},[]),ne=async t=>{try{const s=await g.create(t);h("Template created"),x(!1),y(null),N(),T(s)}catch(s){u(s.message||"Failed to create template")}},ce=async t=>{try{await g.update(_.id,t),h("Template updated"),x(!1),y(null),N(),a?.id===_.id&&T({...a,...t})}catch(s){u(s.message||"Failed to update template")}},B=async t=>{if(await r(`Delete template "${t.name}"?`,{title:"Delete Template",confirmText:"Delete",variant:"danger"}))try{await g.delete(t.id),h("Template deleted"),a?.id===t.id&&T(null),N()}catch(f){u(f.message||"Failed to delete template")}},K=async t=>{try{const s=await g.duplicate(t.id);h("Template duplicated"),N(),T(s)}catch(s){u(s.message||"Failed to duplicate template")}},V=async t=>{try{const s=await g.export(t.id),f=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),W=URL.createObjectURL(f),A=document.createElement("a");A.href=W,A.download=`${t.name||"template"}.json`,A.click(),URL.revokeObjectURL(W),h("Template exported")}catch(s){u(s.message||"Failed to export template")}},oe=async()=>{if(!(!D&&!E.trim())){J(!0);try{let t;if(D){const s=await D.text();t=JSON.parse(s)}else t=JSON.parse(E);await g.create(t),h("Template imported"),O(!1),F(null),M(""),N()}catch(t){u(t.message||"Failed to import template")}finally{J(!1)}}},H=i.useMemo(()=>{let t=p.map(s=>({...s,type:k(s)}));return z&&(t=t.filter(s=>s.type===z)),t},[p,z,k]),de=i.useMemo(()=>{const t=p.filter(f=>k(f)==="certificate").length,s=p.filter(f=>k(f)==="ca").length;return[{icon:fe,label:"Certificate",value:t,variant:"primary"},{icon:je,label:"CA",value:s,variant:"violet"},{icon:S,label:"Total",value:p.length,variant:"default"}]},[p,k]),me=i.useMemo(()=>[{key:"name",header:"Template",priority:1,sortable:!0,render:(t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{size:16,className:"text-accent-primary shrink-0"}),e.jsx("span",{className:"font-medium truncate",children:t||"Unnamed"})]})},{key:"type",header:"Type",priority:2,sortable:!0,render:t=>e.jsx(w,{variant:t==="ca"?"violet":"secondary",size:"sm",children:t==="ca"?"CA":"Certificate"})},{key:"validity_days",header:"Validity",priority:3,hideOnMobile:!0,sortable:!0,render:t=>e.jsxs("span",{className:"text-sm text-text-secondary",children:[t||365," days"]})},{key:"usage_count",header:"Used",hideOnMobile:!0,sortable:!0,render:t=>e.jsxs(w,{variant:"outline",size:"sm",children:[t||0," certs"]})},{key:"description",header:"Description",hideOnMobile:!0,render:t=>e.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[200px]",children:t||"—"})}],[]),pe=i.useCallback(t=>[{label:"Edit",icon:X,onClick:()=>{y(t),x(!0)}},{label:"Duplicate",icon:q,onClick:()=>K(t)},{label:"Export",icon:G,onClick:()=>V(t)},...b("templates")?[{label:"Delete",icon:Y,variant:"danger",onClick:()=>B(t)}]:[]],[b]),ue=e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{title:"About Templates",variant:"info",children:"Certificate templates define default values for certificate issuance. Use them to standardize certificate properties across your organization."}),e.jsx(R,{title:"Template Types",variant:"tip",children:e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"secondary",size:"sm",children:"Certificate"}),e.jsx("span",{className:"text-xs",children:"End-entity certs (servers, users)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"violet",size:"sm",children:"CA"}),e.jsx("span",{className:"text-xs",children:"Intermediate CAs"})]})]})}),e.jsx(R,{title:"Key Usage",variant:"warning",children:"Ensure Key Usage and Extended Key Usage match your certificate's intended purpose."})]}),xe=a&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsx(be,{icon:S,iconClass:a.type==="ca"?"bg-violet-500/20":"bg-accent-primary/20",title:a.name,subtitle:`${a.usage_count||0} certificates issued`,badge:e.jsx(w,{variant:a.type==="ca"?"violet":"secondary",size:"sm",children:a.type==="ca"?"CA":"Certificate"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o("templates")&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>{y(a),x(!0)},children:[e.jsx(X,{size:14})," Edit"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>K(a),children:[e.jsx(q,{size:14})," Duplicate"]})]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>V(a),children:[e.jsx(G,{size:14})," Export"]}),b("templates")&&e.jsxs(d,{size:"sm",variant:"danger",onClick:()=>B(a),children:[e.jsx(Y,{size:14})," Delete"]})]}),e.jsx(U,{title:"Basic Information",children:e.jsxs(I,{columns:1,children:[e.jsx(m,{label:"Name",value:a.name}),e.jsx(m,{label:"Type",value:a.type==="ca"?"Certificate Authority":"Certificate"}),e.jsx(m,{label:"Description",value:a.description||"—"})]})}),e.jsx(U,{title:"Validity Period",icon:ge,children:e.jsxs(I,{columns:2,children:[e.jsx(m,{label:"Default",value:`${a.validity_days||365} days`}),e.jsx(m,{label:"Maximum",value:`${a.max_validity_days||3650} days`})]})}),e.jsx(U,{title:"Subject Template",collapsible:!0,children:e.jsxs(I,{columns:2,children:[e.jsx(m,{label:"Country (C)",value:a.subject?.C||"—"}),e.jsx(m,{label:"State (ST)",value:a.subject?.ST||"—"}),e.jsx(m,{label:"Organization (O)",value:a.subject?.O||"—"}),e.jsx(m,{label:"Common Name (CN)",value:a.subject?.CN||"—"})]})}),(a.key_usage?.length>0||a.extended_key_usage?.length>0)&&e.jsx(U,{title:"Key Usage",collapsible:!0,defaultOpen:!1,children:e.jsxs(I,{columns:1,children:[a.key_usage?.length>0&&e.jsx(m,{label:"Key Usage",value:a.key_usage.join(", ")}),a.extended_key_usage?.length>0&&e.jsx(m,{label:"Extended Key Usage",value:a.extended_key_usage.join(", ")})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{title:"Templates",subtitle:`${p.length} template${p.length!==1?"s":""}`,icon:S,stats:de,helpContent:ue,helpTitle:"Templates Help",splitView:!0,splitEmptyContent:e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-bg-tertiary flex items-center justify-center mb-3",children:e.jsx(S,{size:24,className:"text-text-tertiary"})}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Select a template to view details"})]}),slideOverOpen:!!a,slideOverTitle:a?.name||"Template Details",slideOverContent:xe,slideOverWidth:"lg",onSlideOverClose:()=>T(null),children:e.jsx(Te,{data:H,columns:me,loading:l,onRowClick:T,selectedId:a?.id,rowActions:pe,searchable:!0,searchPlaceholder:"Search templates...",searchKeys:["name","description","type"],toolbarFilters:[{key:"type",value:z,onChange:re,placeholder:"All Types",options:[{value:"certificate",label:"Certificate"},{value:"ca",label:"CA"}]}],toolbarActions:o("templates")&&(c?e.jsx(d,{size:"lg",onClick:()=>{y(null),x(!0)},className:"w-11 h-11 p-0",children:e.jsx(L,{size:22,weight:"bold"})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",onClick:()=>{y(null),x(!0)},children:[e.jsx(L,{size:14,weight:"bold"}),"New"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>O(!0),children:[e.jsx(Q,{size:14}),"Import"]})]})),sortable:!0,defaultSort:{key:"name",direction:"asc"},pagination:{page:se,total:H.length,perPage:le,onChange:P,onPerPageChange:t=>{ie(t),P(1)}},emptyIcon:S,emptyTitle:"No templates",emptyDescription:"Create your first template to get started",emptyAction:o("templates")&&e.jsxs(d,{onClick:()=>{y(null),x(!0)},children:[e.jsx(L,{size:16})," New Template"]})})}),e.jsx(Z,{open:te,onOpenChange:t=>{x(t),t||y(null)},title:_?"Edit Template":"Create Template",size:"lg",children:e.jsx(_e,{template:_,onSubmit:_?ce:ne,onCancel:()=>{x(!1),y(null)}})}),e.jsx(Z,{open:ae,onOpenChange:O,title:"Import Template",size:"md",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Import a certificate template from a JSON file or paste JSON content"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Template File (JSON)"}),e.jsx("input",{ref:v,type:"file",accept:".json",onChange:t=>{F(t.target.files[0]),M("")},className:"w-full text-sm text-text-secondary file:mr-4 file:py-1.5 file:px-3 file:rounded-sm file:border-0 file:text-sm file:bg-accent-primary file:text-white hover:file:bg-accent-primary/80"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 border-t border-border"}),e.jsx("span",{className:"text-xs text-text-secondary",children:"OR paste JSON content"}),e.jsx("div",{className:"flex-1 border-t border-border"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Paste JSON Content"}),e.jsx("textarea",{value:E,onChange:t=>{M(t.target.value),F(null),v.current&&(v.current.value="")},placeholder:'{"name": "My Template", "validity_days": 365, ...}',rows:6,className:"w-full px-2 py-1.5 bg-bg-secondary border border-border rounded-sm text-sm text-text-primary font-mono placeholder-text-secondary focus:outline-none focus:ring-1 focus:ring-accent-primary resize-y"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(d,{variant:"secondary",onClick:()=>O(!1),children:"Cancel"}),e.jsxs(d,{onClick:oe,disabled:$||!D&&!E.trim(),children:[$?e.jsx(ee,{size:"sm"}):e.jsx(Q,{size:16}),"Import Template"]})]})]})})]})}function _e({template:c,onSubmit:h,onCancel:u}){const[r,o]=i.useState({name:"",description:"",type:"certificate",validity_days:365,max_validity_days:3650,subject:{C:"",ST:"",L:"",O:"",OU:"",CN:""},key_usage:[],extended_key_usage:[]}),[b,v]=i.useState(!1);i.useEffect(()=>{o(c?{name:c.name||"",description:c.description||"",type:c.type||"certificate",validity_days:c.validity_days||365,max_validity_days:c.max_validity_days||3650,subject:c.subject||{C:"",ST:"",L:"",O:"",OU:"",CN:""},key_usage:c.key_usage||[],extended_key_usage:c.extended_key_usage||[]}:{name:"",description:"",type:"certificate",validity_days:365,max_validity_days:3650,subject:{C:"",ST:"",L:"",O:"",OU:"",CN:""},key_usage:[],extended_key_usage:[]})},[c]);const p=async l=>{if(l.preventDefault(),!!r.name.trim()){v(!0);try{await h(r)}finally{v(!1)}}},C=(l,n)=>{o(a=>({...a,subject:{...a.subject,[l]:n}}))};return e.jsxs("form",{onSubmit:p,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{label:"Template Name",value:r.name,onChange:l=>o(n=>({...n,name:l.target.value})),placeholder:"e.g., Web Server Certificate",required:!0}),e.jsx(ve,{label:"Type",value:r.type,onChange:l=>o(n=>({...n,type:l})),options:[{value:"certificate",label:"Certificate"},{value:"ca",label:"Certificate Authority"}]})]}),e.jsx(Ce,{label:"Description",value:r.description,onChange:l=>o(n=>({...n,description:l.target.value})),placeholder:"Brief description of this template",rows:2}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{label:"Default Validity (days)",type:"number",value:r.validity_days,onChange:l=>o(n=>({...n,validity_days:parseInt(l.target.value)||365}))}),e.jsx(j,{label:"Maximum Validity (days)",type:"number",value:r.max_validity_days,onChange:l=>o(n=>({...n,max_validity_days:parseInt(l.target.value)||3650}))})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-3",children:"Subject Template"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{label:"Country (C)",value:r.subject.C,onChange:l=>C("C",l.target.value),placeholder:"US"}),e.jsx(j,{label:"State (ST)",value:r.subject.ST,onChange:l=>C("ST",l.target.value),placeholder:"California"}),e.jsx(j,{label:"Organization (O)",value:r.subject.O,onChange:l=>C("O",l.target.value),placeholder:"Example Corp"}),e.jsx(j,{label:"Common Name (CN)",value:r.subject.CN,onChange:l=>C("CN",l.target.value),placeholder:"*.example.com"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:b||!r.name.trim(),children:b?e.jsx(ee,{size:"sm"}):c?"Update":"Create"})]})]})}export{Ye as default};
