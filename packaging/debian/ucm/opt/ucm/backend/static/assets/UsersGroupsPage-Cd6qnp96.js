import{j as e}from"./radix-B6Y-MRu0.js";import{u as Te,a as t}from"./vendor-DEQSVNfj.js";import{u as Le,c as Ie,i as Y,j as J,s as ae,n as N,d as qe,f as T,k as te,o as re,B as d,h as Be,I as k,L as oe}from"./index-vswyqp58.js";import{n as Ve}from"./Globe.es-CtUoIY1T.js";import{a as L}from"./PencilSimple.es-CJefJBPq.js";import{n as K}from"./Plus.es-DN9hvW10.js";import{n as I}from"./Trash.es-DhgoD9TD.js";import{n as S}from"./Users.es-CVu0XWaq.js";import{M as le}from"./Modal-7_eTIvz3.js";import{B as D}from"./Badge-CZ5NzBfK.js";import{S as He}from"./Select-PwXyFoxR.js";import{H as ne}from"./HelpCard-BINCqYIf.js";import{C as ie,b as P,c as q,d as p}from"./DetailCard-BKBzFg8i.js";import{R as We}from"./ResponsiveDataTable-kYvH3TtM.js";import{R as Ye}from"./ResponsiveLayout-BgG2EW8C.js";import{u as U,g as B,r as Je}from"./groupsService-DOlTM9fo.js";import{u as Ke}from"./usePermission-B5db8pNS.js";import"./CaretDown.es-DuThAI6u.js";import"./Fingerprint.es-a52JDt2Q.js";import"./CaretUp.es-CYK8cpGg.js";import"./CaretRight.es-B3hFfvz_.js";import"./ArrowLeft.es-CZcTzWfI.js";import"./UnifiedPageHeader-Cbwye_R6.js";function ws(){const{isMobile:i}=Le(),[z,G]=Te(),{showSuccess:o,showError:n,showConfirm:f}=Ie(),{canWrite:h,canDelete:x}=Ke(),[a,c]=t.useState(z.get("tab")||"users"),[v,ce]=t.useState([]),[R,de]=t.useState([]),[Ze,ue]=t.useState([]),[me,Q]=t.useState(!0),[l,b]=t.useState(null),[u,A]=t.useState(null),[pe,j]=t.useState(!1),[he,y]=t.useState(!1),[F,C]=t.useState(null),[E,w]=t.useState(null),[xe,V]=t.useState(1),[fe,ve]=t.useState(25),[$,ge]=t.useState(""),[_,be]=t.useState(""),je=s=>{c(s),G({tab:s}),b(null),A(null),V(1)};t.useEffect(()=>{g()},[]);const g=async()=>{try{Q(!0);const[s,r,m]=await Promise.all([U.getAll(),B.getAll(),Je.getAll().catch(()=>({data:[]}))]);ce(s.data||[]),de(r.data||[]),ue(m.data||[])}catch{n("Failed to load data")}finally{Q(!1)}},ye=async s=>{try{await U.create(s),o("User created"),j(!1),C(null),g()}catch(r){n(r.message||"Failed to create user")}},Ce=async s=>{try{await U.update(F.id,s),o("User updated"),j(!1),C(null),g(),l?.id===F.id&&b({...l,...s})}catch(r){n(r.message||"Failed to update user")}},X=async s=>{if(await f(`Delete user "${s.username}"?`,{title:"Delete User",confirmText:"Delete",variant:"danger"}))try{await U.delete(s.id),o("User deleted"),l?.id===s.id&&b(null),g()}catch(m){n(m.message||"Failed to delete user")}},Z=async s=>{try{await U.update(s.id,{active:!s.active}),o(`User ${s.active?"disabled":"enabled"}`),g(),l?.id===s.id&&b({...l,active:!s.active})}catch(r){n(r.message||"Failed to update user")}},ee=async s=>{if(await f(`Reset password for "${s.username}"?`,{title:"Reset Password",confirmText:"Reset"}))try{const m=await U.resetPassword(s.id);o(`New password: ${m.password||"Check email"}`)}catch(m){n(m.message||"Failed to reset password")}},we=async s=>{try{await B.create(s),o("Group created"),y(!1),w(null),g()}catch(r){n(r.message||"Failed to create group")}},Ne=async s=>{try{await B.update(E.id,s),o("Group updated"),y(!1),w(null),g()}catch(r){n(r.message||"Failed to update group")}},se=async s=>{if(await f(`Delete group "${s.name}"?`,{title:"Delete Group",confirmText:"Delete",variant:"danger"}))try{await B.delete(s.id),o("Group deleted"),u?.id===s.id&&A(null),g()}catch(m){n(m.message||"Failed to delete group")}},Se=t.useMemo(()=>{let s=[...v];return $&&(s=s.filter(r=>r.role===$)),_==="active"&&(s=s.filter(r=>r.active)),_==="disabled"&&(s=s.filter(r=>!r.active)),s},[v,$,_]),De=t.useMemo(()=>R,[R]),Ue=t.useMemo(()=>{if(a==="users"){const s=v.filter(M=>M.active).length,r=v.filter(M=>!M.active).length,m=v.filter(M=>M.role==="admin").length;return[{icon:Y,label:"Active",value:s,variant:"success"},{icon:J,label:"Disabled",value:r,variant:"secondary"},{icon:ae,label:"Admins",value:m,variant:"primary"},{icon:N,label:"Total",value:v.length,variant:"default"}]}else return[{icon:S,label:"Groups",value:R.length,variant:"primary"},{icon:N,label:"Users",value:v.length,variant:"secondary"}]},[a,v,R]),ke=t.useMemo(()=>[{key:"username",header:"User",priority:1,sortable:!0,render:(s,r)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:qe("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",r.active?"bg-accent-primary/10 text-accent-primary":"bg-text-muted/10 text-text-muted"),children:s?.charAt(0)?.toUpperCase()||"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-text-primary truncate",children:s||"—"}),e.jsx("div",{className:"text-xs text-text-secondary truncate",children:r.email||"—"})]})]})},{key:"role",header:"Role",priority:2,sortable:!0,render:(s,r)=>e.jsxs(D,{variant:s==="admin"?"primary":s==="operator"?"secondary":"outline",size:"sm",children:[s==="admin"&&e.jsx(ae,{weight:"fill",className:"h-3 w-3 mr-1"}),s||"viewer"]})},{key:"active",header:"Status",priority:3,sortable:!0,render:s=>e.jsx(D,{variant:s?"success":"secondary",size:"sm",children:s?"Active":"Disabled"})},{key:"last_login",header:"Last Login",hideOnMobile:!0,sortable:!0,render:s=>e.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:s?T(s):"Never"})}],[]),ze=t.useMemo(()=>[{key:"name",header:"Group",priority:1,sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{size:16,className:"text-accent-primary shrink-0"}),e.jsx("span",{className:"font-medium",children:s})]})},{key:"description",header:"Description",priority:2,hideOnMobile:!0,render:s=>e.jsx("span",{className:"text-text-secondary truncate",children:s||"—"})},{key:"member_count",header:"Members",priority:3,sortable:!0,render:(s,r)=>e.jsxs(D,{variant:"outline",size:"sm",children:[r.members?.length||s||0," members"]})}],[]),Ge=t.useCallback(s=>[{label:"Edit",icon:L,onClick:()=>{C(s),j(!0)}},{label:s.active?"Disable":"Enable",icon:s.active?J:Y,onClick:()=>Z(s)},{label:"Reset Password",icon:te,onClick:()=>ee(s)},...x("users")?[{label:"Delete",icon:I,variant:"danger",onClick:()=>X(s)}]:[]],[x]),Re=t.useCallback(s=>[{label:"Edit",icon:L,onClick:()=>{w(s),y(!0)}},...x("users")?[{label:"Delete",icon:I,variant:"danger",onClick:()=>se(s)}]:[]],[x]),Ae=e.jsxs("div",{className:"space-y-3",children:[e.jsx(ne,{title:"User Management",variant:"info",children:"Create and manage user accounts. Assign roles to control access levels."}),e.jsx(ne,{title:"Roles",variant:"tip",children:e.jsxs("div",{className:"space-y-1 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"primary",size:"sm",children:"Admin"}),e.jsx("span",{className:"text-xs",children:"Full access"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"secondary",size:"sm",children:"Operator"}),e.jsx("span",{className:"text-xs",children:"Manage certificates"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",children:"Viewer"}),e.jsx("span",{className:"text-xs",children:"Read-only access"})]})]})})]}),Fe=l&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsx(ie,{icon:re,iconClass:l.active?"bg-accent-primary/20":"bg-text-muted/20",title:l.username,subtitle:l.email,badge:e.jsx(D,{variant:l.active?"success":"secondary",size:"sm",children:l.active?"Active":"Disabled"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h("users")&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>{C(l),j(!0)},children:[e.jsx(L,{size:14})," Edit"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>Z(l),children:[l.active?e.jsx(J,{size:14}):e.jsx(Y,{size:14}),l.active?"Disable":"Enable"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>ee(l),children:[e.jsx(te,{size:14})," Reset Password"]})]}),x("users")&&e.jsxs(d,{size:"sm",variant:"danger",onClick:()=>X(l),children:[e.jsx(I,{size:14})," Delete"]})]}),e.jsx(P,{title:"User Information",icon:re,children:e.jsxs(q,{columns:1,children:[e.jsx(p,{label:"Full Name",value:l.full_name||"—"}),e.jsx(p,{label:"Email",value:l.email}),e.jsx(p,{label:"Role",value:l.role})]})}),e.jsx(P,{title:"Activity",icon:Ve,children:e.jsxs(q,{columns:1,children:[e.jsx(p,{label:"Created",value:T(l.created_at)}),e.jsx(p,{label:"Last Login",value:l.last_login?T(l.last_login):"Never"}),e.jsx(p,{label:"Login Count",value:l.login_count||0})]})}),e.jsx(P,{title:"Security",icon:Be,children:e.jsxs(q,{columns:1,children:[e.jsx(p,{label:"MFA Enabled",value:l.mfa_enabled?"Yes":"No"}),e.jsx(p,{label:"TOTP Configured",value:l.totp_confirmed?"Yes":"No"})]})})]}),Me=u&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsx(ie,{icon:S,iconClass:"bg-accent-primary/20",title:u.name,subtitle:`${u.members?.length||0} members`}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h("users")&&e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>{w(u),y(!0)},children:[e.jsx(L,{size:14})," Edit"]}),x("users")&&e.jsxs(d,{size:"sm",variant:"danger",onClick:()=>se(u),children:[e.jsx(I,{size:14})," Delete"]})]}),e.jsx(P,{title:"Group Information",children:e.jsxs(q,{columns:1,children:[e.jsx(p,{label:"Name",value:u.name}),e.jsx(p,{label:"Description",value:u.description||"—"}),e.jsx(p,{label:"Created",value:T(u.created_at)})]})}),u.members?.length>0&&e.jsx(P,{title:"Members",children:e.jsx("div",{className:"space-y-2",children:u.members.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{size:14,className:"text-text-secondary"}),e.jsx("span",{children:s.username||s})]},s.id||s.username))})})]}),H=a==="users"?Se:De,Pe=a==="users"?ke:ze,Ee=a==="users"?Ge:Re,O=a==="users"?l:u,$e=a==="users"?Fe:Me,_e=s=>{a==="users"?(b(s),A(null)):(A(s),b(null))},W=()=>{a==="users"?(C(null),j(!0)):(w(null),y(!0))},Oe=[{id:"users",label:"Users",icon:N,count:v.length},{id:"groups",label:"Groups",icon:S,count:R.length}];return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{title:a==="users"?"Users":"Groups",subtitle:`${H.length} ${a}`,icon:a==="users"?N:S,stats:Ue,tabs:Oe,activeTab:a,onTabChange:je,helpContent:Ae,helpTitle:"User Management",splitView:!0,splitEmptyContent:e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-bg-tertiary flex items-center justify-center mb-3",children:a==="users"?e.jsx(N,{size:24,className:"text-text-tertiary"}):e.jsx(S,{size:24,className:"text-text-tertiary"})}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Select ",a==="users"?"a user":"a group"," to view details"]})]}),slideOverOpen:!!O,slideOverTitle:O?.username||O?.name||"Details",slideOverContent:$e,slideOverWidth:"lg",onSlideOverClose:()=>{b(null),A(null)},children:e.jsx("div",{className:"flex flex-col h-full min-h-0",children:e.jsx(We,{data:H,columns:Pe,loading:me,onRowClick:_e,selectedId:O?.id,rowActions:Ee,searchable:!0,searchPlaceholder:`Search ${a}...`,searchKeys:a==="users"?["username","email","full_name","role"]:["name","description"],toolbarFilters:a==="users"?[{key:"role",value:$,onChange:ge,placeholder:"All Roles",options:[{value:"admin",label:"Admin"},{value:"operator",label:"Operator"},{value:"viewer",label:"Viewer"}]},{key:"status",value:_,onChange:be,placeholder:"All Status",options:[{value:"active",label:"Active"},{value:"disabled",label:"Disabled"}]}]:[],toolbarActions:h("users")&&(i?e.jsx(d,{size:"lg",onClick:W,className:"w-11 h-11 p-0",children:e.jsx(K,{size:22,weight:"bold"})}):e.jsxs(d,{size:"sm",onClick:W,children:[e.jsx(K,{size:14,weight:"bold"}),"New ",a==="users"?"User":"Group"]})),sortable:!0,defaultSort:{key:a==="users"?"username":"name",direction:"asc"},pagination:{page:xe,total:H.length,perPage:fe,onChange:V,onPerPageChange:s=>{ve(s),V(1)}},emptyIcon:a==="users"?N:S,emptyTitle:`No ${a}`,emptyDescription:`Create your first ${a==="users"?"user":"group"} to get started`,emptyAction:h("users")&&e.jsxs(d,{onClick:W,children:[e.jsx(K,{size:16})," New ",a==="users"?"User":"Group"]})})})}),e.jsx(le,{open:pe,onOpenChange:s=>{j(s),s||C(null)},title:F?"Edit User":"Create User",size:"md",children:e.jsx(Qe,{user:F,onSubmit:F?Ce:ye,onCancel:()=>{j(!1),C(null)}})}),e.jsx(le,{open:he,onOpenChange:s=>{y(s),s||w(null)},title:E?"Edit Group":"Create Group",size:"md",children:e.jsx(Xe,{group:E,onSubmit:E?Ne:we,onCancel:()=>{y(!1),w(null)}})})]})}function Qe({user:i,onSubmit:z,onCancel:G}){const[o,n]=t.useState({username:"",email:"",password:"",full_name:"",role:"viewer"}),[f,h]=t.useState(!1);t.useEffect(()=>{n(i?{username:i.username||"",email:i.email||"",password:"",full_name:i.full_name||"",role:i.role||"viewer"}:{username:"",email:"",password:"",full_name:"",role:"viewer"})},[i]);const x=async a=>{a.preventDefault(),h(!0);try{const c={...o};i&&!c.password&&delete c.password,await z(c)}finally{h(!1)}};return e.jsxs("form",{onSubmit:x,className:"p-4 space-y-4",children:[e.jsx(k,{label:"Username",value:o.username,onChange:a=>n(c=>({...c,username:a.target.value})),required:!0,disabled:!!i,placeholder:"johndoe"}),e.jsx(k,{label:"Email",type:"email",value:o.email,onChange:a=>n(c=>({...c,email:a.target.value})),required:!0,placeholder:"john@example.com"}),e.jsx(k,{label:"Full Name",value:o.full_name,onChange:a=>n(c=>({...c,full_name:a.target.value})),placeholder:"John Doe"}),e.jsx(k,{label:i?"New Password (leave blank to keep)":"Password",type:"password",value:o.password,onChange:a=>n(c=>({...c,password:a.target.value})),required:!i,placeholder:"••••••••"}),e.jsx(He,{label:"Role",value:o.role,onChange:a=>n(c=>({...c,role:a})),options:[{value:"admin",label:"Administrator"},{value:"operator",label:"Operator"},{value:"viewer",label:"Viewer"}]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:G,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:f,children:f?e.jsx(oe,{size:"sm"}):i?"Update":"Create"})]})]})}function Xe({group:i,onSubmit:z,onCancel:G}){const[o,n]=t.useState({name:"",description:""}),[f,h]=t.useState(!1);t.useEffect(()=>{n(i?{name:i.name||"",description:i.description||""}:{name:"",description:""})},[i]);const x=async a=>{a.preventDefault(),h(!0);try{await z(o)}finally{h(!1)}};return e.jsxs("form",{onSubmit:x,className:"p-4 space-y-4",children:[e.jsx(k,{label:"Group Name",value:o.name,onChange:a=>n(c=>({...c,name:a.target.value})),required:!0,placeholder:"developers"}),e.jsx(k,{label:"Description",value:o.description,onChange:a=>n(c=>({...c,description:a.target.value})),placeholder:"Development team"}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:G,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:f,children:f?e.jsx(oe,{size:"sm"}):i?"Update":"Create"})]})]})}export{ws as default};
