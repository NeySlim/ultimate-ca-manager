import{j as e}from"./radix-B6Y-MRu0.js";import{a as o}from"./vendor-DEQSVNfj.js";import{c as W,h as b,m as u,i as k,f,B as l,v as J,I as C}from"./index-vswyqp58.js";import{n as Q}from"./Globe.es-CtUoIY1T.js";import{s as I}from"./Download.es-Bp_lE9WD.js";import{n as D}from"./Plus.es-DN9hvW10.js";import{n as F}from"./Trash.es-DhgoD9TD.js";import{M as X}from"./Modal-7_eTIvz3.js";import{B as z}from"./Badge-CZ5NzBfK.js";import{T as Y}from"./Textarea-DuI5mbE0.js";import{H as g}from"./HelpCard-BINCqYIf.js";import{C as Z,a as ee,b as O,d as m}from"./DetailCard-BKBzFg8i.js";import{R as te}from"./ResponsiveDataTable-kYvH3TtM.js";import{R as ae}from"./ResponsiveLayout-BgG2EW8C.js";import{t as x}from"./truststore.service-DLtx8kP5.js";import{u as se}from"./usePermission-B5db8pNS.js";import{u as re}from"./useCommon-lRatzZ8x.js";import"./CaretDown.es-DuThAI6u.js";import"./Fingerprint.es-a52JDt2Q.js";import"./CaretUp.es-CYK8cpGg.js";import"./CaretRight.es-B3hFfvz_.js";import"./ArrowLeft.es-CZcTzWfI.js";import"./UnifiedPageHeader-Cbwye_R6.js";function Re(){const{showSuccess:y,showError:p,showConfirm:B}=W(),{canWrite:_,canDelete:N}=se(),{modals:P,open:A,close:h}=re(["add"]),[M,S]=o.useState(!0),[n,L]=o.useState([]),[a,d]=o.useState(null),[i,c]=o.useState({name:"",description:"",certificate_pem:"",purpose:"custom",notes:""}),[w,R]=o.useState(!1);o.useEffect(()=>{v()},[]);const v=async()=>{S(!0);try{const s=(await x.getAll()).data||[];L(s)}catch(t){p(t.message||"Failed to load trust store")}finally{S(!1)}},$=async t=>{try{const s=await x.getById(t.id);d(s.data||t)}catch{d(t)}},H=async()=>{if(!i.name||!i.certificate_pem){p("Name and certificate are required");return}R(!0);try{const t=await x.add(i);y("Certificate added to trust store"),h("add"),c({name:"",description:"",certificate_pem:"",purpose:"custom",notes:""}),v(),t.data&&d(t.data)}catch(t){p(t.message||"Failed to add certificate")}finally{R(!1)}},T=async t=>{if(await B("Remove this certificate from the trust store?",{title:"Remove Certificate",confirmText:"Remove",variant:"danger"}))try{await x.delete(t.id),y("Certificate removed from trust store"),v(),a?.id===t.id&&d(null)}catch(r){p(r.message||"Failed to remove certificate")}},E=t=>{if(!t?.certificate_pem)return;const s=new Blob([t.certificate_pem],{type:"application/x-pem-file"}),r=URL.createObjectURL(s),j=document.createElement("a");j.href=r,j.download=`${t.name.replace(/\s+/g,"_")}.pem`,j.click(),URL.revokeObjectURL(r)},U=o.useMemo(()=>{const t=n.filter(r=>r.purpose==="root_ca").length,s=n.filter(r=>r.purpose==="intermediate_ca").length;return[{icon:b,label:"Root CAs",value:t,variant:"success"},{icon:u,label:"Intermediate",value:s,variant:"primary"},{icon:k,label:"Total",value:n.length,variant:"default"}]},[n]),q=[{key:"name",header:"Certificate",sortable:!0,render:(t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{size:16,className:"text-accent-primary shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t}),s.subject_cn&&s.subject_cn!==t&&e.jsx("div",{className:"text-xs text-text-secondary truncate",children:s.subject_cn})]})]})},{key:"purpose",header:"Purpose",render:t=>{const s={root_ca:"success",intermediate_ca:"primary",client_auth:"purple",code_signing:"warning",system:"secondary",custom:"default"};return e.jsx(z,{variant:s[t]||"default",size:"sm",children:t?.replace("_"," ")})}},{key:"not_after",header:"Expires",render:t=>{if(!t)return e.jsx("span",{className:"text-text-tertiary",children:"—"});const r=new Date(t)<new Date;return e.jsx("span",{className:r?"text-status-danger":"",children:f(t)})}}],V=t=>[{label:"Export",icon:I,onClick:()=>E(t)},...N("truststore")?[{label:"Delete",icon:F,variant:"danger",onClick:()=>T(t)}]:[]],G=a&&e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsx(Z,{icon:u,iconClass:"status-primary-bg",title:a.name,subtitle:a.subject_cn||a.description,badge:e.jsx(z,{variant:a.purpose==="root_ca"?"success":"primary",size:"sm",children:a.purpose?.replace("_"," ")})}),e.jsx(ee,{stats:[{icon:Q,value:a.not_after?f(a.not_after):"No expiry"},{icon:k,value:a.issuer_cn||"Self-signed"}]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"secondary",className:"flex-1",onClick:()=>E(a),children:[e.jsx(I,{size:14}),"Export"]}),N("truststore")&&e.jsx(l,{size:"sm",variant:"danger",onClick:()=>T(a),children:e.jsx(F,{size:14})})]}),e.jsxs(O,{title:"Certificate Info",icon:u,children:[e.jsx(m,{label:"Subject",value:a.subject||a.subject_cn}),e.jsx(m,{label:"Issuer",value:a.issuer||a.issuer_cn}),e.jsx(m,{label:"Valid From",value:a.not_before?f(a.not_before):"—"}),e.jsx(m,{label:"Valid To",value:a.not_after?f(a.not_after):"—"}),a.fingerprint_sha256&&e.jsx(m,{label:"SHA-256",value:a.fingerprint_sha256,mono:!0,copyable:!0})]}),a.notes&&e.jsx(O,{title:"Notes",icon:J,children:e.jsx("p",{className:"text-sm text-text-secondary",children:a.notes})})]}),K=e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{variant:"info",title:"About Trust Store",children:"The Trust Store contains certificates that are explicitly trusted for validating certificate chains. Add Root and Intermediate CAs here for chain verification."}),e.jsx(g,{variant:"tip",title:"Best Practices",children:"Only add certificates from trusted sources. Regularly review and remove expired or unnecessary certificates to maintain security."}),e.jsx(g,{variant:"warning",title:"Security Note",children:"Certificates in the Trust Store can validate any certificate chain. Be careful when adding third-party certificates."})]});return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Trust Store",subtitle:`${n.length} certificate${n.length!==1?"s":""}`,icon:b,stats:U,helpContent:K,helpTitle:"Trust Store Help",splitView:!0,splitEmptyContent:e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-bg-tertiary flex items-center justify-center mb-3",children:e.jsx(u,{size:24,className:"text-text-tertiary"})}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Select a certificate to view details"})]}),slideOverOpen:!!a,slideOverTitle:a?.name||"Certificate Details",slideOverContent:G,onSlideOverClose:()=>d(null),children:e.jsx(te,{data:n,columns:q,loading:M,onRowClick:$,selectedId:a?.id,rowActions:V,searchable:!0,searchPlaceholder:"Search certificates...",searchKeys:["name","subject_cn","issuer_cn","purpose"],toolbarFilters:[{key:"purpose",placeholder:"All Purposes",options:[{value:"root_ca",label:"Root CA"},{value:"intermediate_ca",label:"Intermediate"},{value:"client_auth",label:"Client Auth"},{value:"code_signing",label:"Code Signing"},{value:"custom",label:"Custom"}]}],toolbarActions:_("truststore")&&e.jsxs(l,{onClick:()=>A("add"),children:[e.jsx(D,{size:16})," Add"]}),sortable:!0,defaultSort:{key:"name",direction:"asc"},emptyIcon:b,emptyTitle:"No trusted certificates",emptyDescription:"Add certificates to validate certificate chains",emptyAction:_("truststore")&&e.jsxs(l,{onClick:()=>A("add"),children:[e.jsx(D,{size:16})," Add Certificate"]})})}),e.jsx(X,{open:P.add,onClose:()=>h("add"),title:"Add Trusted Certificate",children:e.jsxs("form",{className:"p-4 space-y-4",onSubmit:t=>{t.preventDefault(),H()},children:[e.jsx(C,{label:"Name",placeholder:"e.g., DigiCert Global Root CA",value:i.name,onChange:t=>c(s=>({...s,name:t.target.value})),required:!0}),e.jsx(C,{label:"Description",placeholder:"Optional description",value:i.description,onChange:t=>c(s=>({...s,description:t.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1",children:"Purpose"}),e.jsxs("select",{value:i.purpose,onChange:t=>c(s=>({...s,purpose:t.target.value})),className:"w-full px-3 py-2 text-sm bg-bg-secondary border border-border rounded-md text-text-primary",children:[e.jsx("option",{value:"root_ca",children:"Root CA"}),e.jsx("option",{value:"intermediate_ca",children:"Intermediate CA"}),e.jsx("option",{value:"client_auth",children:"Client Authentication"}),e.jsx("option",{value:"code_signing",children:"Code Signing"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsx(Y,{label:"Certificate (PEM)",placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,value:i.certificate_pem,onChange:t=>c(s=>({...s,certificate_pem:t.target.value})),rows:8,className:"font-mono text-xs",required:!0}),e.jsx(C,{label:"Notes",placeholder:"Optional notes",value:i.notes,onChange:t=>c(s=>({...s,notes:t.target.value}))}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(l,{type:"button",variant:"secondary",onClick:()=>h("add"),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:w,children:w?"Adding...":"Add Certificate"})]})]})})]})}export{Re as default};
