import{j as e}from"./radix-B6Y-MRu0.js";import{a as t}from"./vendor-DEQSVNfj.js";import{m as z}from"./ArrowsClockwise.es-DS70dwCP.js";import{C as Ae,a as He,b as U,c as ke,d as f,e as te}from"./DetailCard-BKBzFg8i.js";import{G as ze,c as Ee,n as ae,J as N,m as re,j as S,i as k,K as Le,C as $e,L as De,I as T,B as c,v as Me}from"./index-vswyqp58.js";import{b as le}from"./Globe.es-CtUoIY1T.js";import{l as ne,s as ie}from"./Export.es-ZKf2NYml.js";import{c as ce}from"./SignIn.es-DK32xfj-.js";import{n as E}from"./Trash.es-DhgoD9TD.js";import{n as Oe}from"./Users.es-CVu0XWaq.js";import{M as Ze}from"./Modal-7_eTIvz3.js";import{B as y}from"./Badge-CZ5NzBfK.js";import{H}from"./HelpCard-BINCqYIf.js";import{R as Re}from"./ResponsiveDataTable-kYvH3TtM.js";import{R as Ue}from"./ResponsiveLayout-BgG2EW8C.js";import{a as j}from"./audit.service-C2V-F5Hn.js";import"./CaretDown.es-DuThAI6u.js";import"./Fingerprint.es-a52JDt2Q.js";import"./CaretUp.es-CYK8cpGg.js";import"./CaretRight.es-B3hFfvz_.js";import"./ArrowLeft.es-CZcTzWfI.js";import"./UnifiedPageHeader-Cbwye_R6.js";const Te=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M204,136a12,12,0,0,1-12,12H64a12,12,0,0,1,0-24H192A12,12,0,0,1,204,136Zm28-60H24a12,12,0,0,0,0,24H232a12,12,0,0,0,0-24Zm-80,96H104a12,12,0,0,0,0,24h48a12,12,0,0,0,0-24Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M232,56V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56Z",opacity:"0.2"}),t.createElement("path",{d:"M200,136a8,8,0,0,1-8,8H64a8,8,0,0,1,0-16H192A8,8,0,0,1,200,136Zm32-56H24a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16Zm-80,96H104a8,8,0,0,0,0,16h48a8,8,0,0,0,0-16Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM144,176H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm32-40H80a8,8,0,0,1,0-16h96a8,8,0,0,1,0,16Zm32-40H48a8,8,0,0,1,0-16H208a8,8,0,0,1,0,16Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M198,136a6,6,0,0,1-6,6H64a6,6,0,0,1,0-12H192A6,6,0,0,1,198,136Zm34-54H24a6,6,0,0,0,0,12H232a6,6,0,0,0,0-12Zm-80,96H104a6,6,0,0,0,0,12h48a6,6,0,0,0,0-12Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M200,136a8,8,0,0,1-8,8H64a8,8,0,0,1,0-16H192A8,8,0,0,1,200,136Zm32-56H24a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16Zm-80,96H104a8,8,0,0,0,0,16h48a8,8,0,0,0,0-16Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M196,136a4,4,0,0,1-4,4H64a4,4,0,0,1,0-8H192A4,4,0,0,1,196,136Zm36-52H24a4,4,0,0,0,0,8H232a4,4,0,0,0,0-8Zm-80,96H104a4,4,0,0,0,0,8h48a4,4,0,0,0,0-8Z"}))]]),de=t.forwardRef((l,w)=>t.createElement(ze,{ref:w,...l,weights:Te}));de.displayName="FunnelSimpleIcon";const Ie=de,v={login_success:ce,login_failure:ce,logout:Le,create:k,update:z,delete:E,issue:re,revoke:S,renew:z,sign:re,import:ne,export:ne,audit_cleanup:E,default:N},Pe={auth:"blue",certificates:"emerald",cas:"purple",csrs:"orange",users:"cyan",settings:"gray",system:"red",audit:"yellow",default:"gray"},oe=l=>l.includes("login")||l.includes("logout")?"auth":l.includes("cert")||l.includes("issue")||l.includes("revoke")?"certificates":l.includes("ca_")?"cas":l.includes("csr")?"csrs":l.includes("user")?"users":l.includes("setting")?"settings":l.includes("audit")?"audit":"system";function ps(){const{showError:l,showSuccess:w}=Ee(),[L,I]=t.useState([]),[i,me]=t.useState(null),[$,ue]=t.useState({actions:[],categories:{}}),[xe,P]=t.useState(!0),[a,V]=t.useState(null),[D,n]=t.useState(1),[C,pe]=t.useState(50),[B,J]=t.useState(0),[_,q]=t.useState(""),[x,M]=t.useState(""),[d,b]=t.useState(""),[m,F]=t.useState(""),[p,K]=t.useState(""),[h,G]=t.useState(""),[he,A]=t.useState(!1),[Q,ge]=t.useState(90),[fe,W]=t.useState(!1),[Ve,Be]=t.useState(!1),[ye,g]=t.useState(!1);t.useEffect(()=>{X()},[]),t.useEffect(()=>{Y()},[D,C,x,d,m,p,h,_]);const X=async()=>{try{P(!0);const[s,r,u]=await Promise.all([j.getLogs({page:1,per_page:C}),j.getStats(30),j.getActions()]);I(s.data||[]),J(s.meta?.total||0),me(r.data||null),ue(u.data||{actions:[],categories:{}})}catch(s){console.error("Failed to load audit data:",s),l("Failed to load audit logs")}finally{P(!1)}},Y=async()=>{try{const s={page:D,per_page:C,search:_||void 0,username:x||void 0,action:d||void 0,success:m!==""?m:void 0,date_from:p||void 0,date_to:h||void 0},r=await j.getLogs(s);I(r.data||[]),J(r.meta?.total||0)}catch(s){console.error("Failed to load logs:",s)}},ee=async s=>{try{const r=await j.exportLogs({format:s,date_from:p||void 0,date_to:h||void 0,limit:1e4}),u=new Blob([typeof r=="string"?r:JSON.stringify(r,null,2)],{type:s==="csv"?"text/csv":"application/json"}),o=URL.createObjectURL(u),R=document.createElement("a");R.href=o,R.download=`audit_logs_${new Date().toISOString().slice(0,10)}.${s}`,R.click(),URL.revokeObjectURL(o),w(`Exported audit logs as ${s.toUpperCase()}`)}catch{l("Failed to export logs")}},je=async()=>{try{W(!0);const s=await j.cleanupLogs(Q);w(s.message||`Cleaned up ${s.data?.deleted||0} old logs`),A(!1),X()}catch{l("Failed to cleanup logs")}finally{W(!1)}},ve=t.useCallback(()=>{q(""),M(""),b(""),F(""),K(""),G(""),n(1)},[]),O=s=>{const r=new Date(s),o=(new Date-r)/1e3;return o<60?"Just now":o<3600?`${Math.floor(o/60)}m ago`:o<86400?`${Math.floor(o/3600)}h ago`:r.toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},Z=t.useMemo(()=>{const s=new Set(L.map(r=>r.username).filter(Boolean));return Array.from(s).sort()},[L]),be=t.useMemo(()=>[{key:"timestamp",label:"Time",sortable:!0,width:"100px",render:s=>e.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:O(s)})},{key:"username",label:"User",width:"120px",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:12,className:"text-text-secondary"}),e.jsx("span",{className:"text-sm font-medium",children:s||"system"})]})},{key:"action",label:"Action",render:s=>{const r=oe(s),u=Pe[r]||"gray",o=v[s]||v.default;return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(o,{size:14,className:"text-text-secondary"}),e.jsx(y,{variant:u,size:"sm",children:s.replace(/_/g," ")})]})}},{key:"resource_type",label:"Resource",render:(s,r)=>e.jsxs("span",{className:"text-sm text-text-secondary truncate",children:[s,r.resource_name?`: ${r.resource_name}`:r.resource_id?` #${r.resource_id}`:""]})},{key:"success",label:"Status",width:"80px",render:s=>s?e.jsxs(y,{variant:"emerald",size:"sm",children:[e.jsx(k,{size:12,weight:"fill"}),"OK"]}):e.jsxs(y,{variant:"red",size:"sm",children:[e.jsx(S,{size:12,weight:"fill"}),"Fail"]})},{key:"ip_address",label:"IP",width:"120px",render:s=>e.jsx("span",{className:"text-xs text-text-secondary font-mono",children:s||"-"})}],[]),Ne=t.useCallback((s,r)=>{const u=v[s.action]||v.default;return oe(s.action),e.jsx("div",{className:`p-4 ${r?"mobile-row-selected":""}`,children:e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-bg-tertiary flex items-center justify-center",children:e.jsx(u,{size:20,className:"text-text-secondary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-text-primary truncate",children:s.action?.replace(/_/g," ")}),e.jsx(y,{variant:s.success?"emerald":"red",size:"sm",children:s.success?"OK":"Fail"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary mt-0.5",children:[e.jsx("span",{children:s.username||"system"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:O(s.timestamp)})]}),(s.resource_type||s.resource_name)&&e.jsxs("div",{className:"text-xs text-text-secondary mt-1 truncate",children:[s.resource_type,s.resource_name?`: ${s.resource_name}`:""]})]})]})})})},[]),Se=t.useMemo(()=>i?[{icon:le,label:"Total",value:i.total_logs||0,variant:"default"},{icon:k,label:"Success",value:i.success_count||0,variant:"success"},{icon:S,label:"Failed",value:i.failure_count||0,variant:"danger"},{icon:Oe,label:"Users",value:i.unique_users||0,variant:"info"}]:[],[i]);t.useMemo(()=>[{key:"action",label:"Action",type:"select",value:d,onChange:s=>{b(s),n(1)},placeholder:"All Actions",options:($.actions||[]).map(s=>({value:s,label:s.replace(/_/g," ")}))},{key:"status",label:"Status",type:"select",value:m,onChange:s=>{F(s),n(1)},placeholder:"All Status",options:[{value:"true",label:"Success"},{value:"false",label:"Failed"}]},{key:"username",label:"User",type:"select",value:x,onChange:s=>{M(s),n(1)},placeholder:"All Users",options:Z.map(s=>({value:s,label:s}))}],[d,m,x,$.actions,Z]);const se=t.useMemo(()=>{let s=0;return d&&s++,m&&s++,x&&s++,p&&s++,h&&s++,s},[d,m,x,p,h]),we=e.jsxs("div",{className:"p-4 space-y-4",children:[i&&e.jsxs($e,{className:"p-4 space-y-3 bg-gradient-to-br from-accent-primary/5 to-transparent",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[e.jsx(le,{size:16,className:"text-accent-primary"}),"Last 30 Days Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-bg-tertiary rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-text-primary",children:i.total_logs||0}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Total Events"})]}),e.jsxs("div",{className:"text-center p-3 bg-bg-tertiary rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold status-success-text",children:i.success_count||0}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Successful"})]}),e.jsxs("div",{className:"text-center p-3 bg-bg-tertiary rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold status-danger-text",children:i.failure_count||0}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Failed"})]}),e.jsxs("div",{className:"text-center p-3 bg-bg-tertiary rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-text-primary",children:i.unique_users||0}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Active Users"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{variant:"info",title:"About Audit Logs",children:"All user actions are logged for security and compliance purposes. Logs include timestamps, users, actions, resources, and IP addresses."}),e.jsx(H,{variant:"tip",title:"Filtering & Search",children:"Use filters to narrow down logs by date range, user, action type, or status. The search box supports full-text search across all log fields."}),e.jsx(H,{variant:"warning",title:"Data Retention",children:"Old logs can be cleaned up to save storage space. The minimum retention period is 30 days for compliance requirements."}),e.jsx(H,{variant:"info",title:"Export Options",children:"Export logs in JSON or CSV format for external analysis, compliance reporting, or integration with SIEM systems."})]})]}),Ce=e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[e.jsx(te,{size:16}),"Date Range Filter"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1",children:"From Date"}),e.jsx(T,{type:"date",value:p,onChange:s=>{K(s.target.value),n(1)},className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1",children:"To Date"}),e.jsx(T,{type:"date",value:h,onChange:s=>{G(s.target.value),n(1)},className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-text-secondary",children:"Quick Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{variant:d==="login_failure"?"primary":"ghost",size:"sm",className:"w-full justify-start",onClick:()=>{b("login_failure"),g(!1),n(1)},children:[e.jsx(S,{size:14}),"Failed Logins"]}),e.jsxs(c,{variant:m==="false"&&!d?"primary":"ghost",size:"sm",className:"w-full justify-start",onClick:()=>{F("false"),b(""),g(!1),n(1)},children:[e.jsx(Me,{size:14}),"All Failures"]})]})]}),se>0&&e.jsxs(c,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{ve(),g(!1)},children:[e.jsx(z,{size:14}),"Clear All Filters"]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-text-secondary",children:"Export Logs"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>ee("json"),className:"flex-1",children:[e.jsx(ie,{size:14}),"JSON"]}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>ee("csv"),className:"flex-1",children:[e.jsx(ie,{size:14}),"CSV"]})]})]})]}),_e=a&&e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsx(Ae,{icon:v[a.action]||v.default,iconClass:a.success?"bg-status-success/20":"bg-status-error/20",title:a.action?.replace(/_/g," ")||"Event",subtitle:`${a.resource_type||"System"}${a.resource_name?`: ${a.resource_name}`:a.resource_id?` #${a.resource_id}`:""}`,badge:e.jsx(y,{variant:a.success?"emerald":"red",size:"sm",children:a.success?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:12,weight:"fill"})," Success"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:12,weight:"fill"})," Failed"]})})}),e.jsx(He,{stats:[{icon:ae,value:a.username||"system"},{icon:N,value:O(a.timestamp)}]}),e.jsx(U,{title:"Event Details",children:e.jsxs(ke,{children:[e.jsx(f,{label:"Timestamp",value:new Date(a.timestamp).toLocaleString()}),e.jsx(f,{label:"User",value:a.username||"system"}),e.jsx(f,{label:"Action",value:a.action?.replace(/_/g," ")}),e.jsx(f,{label:"Resource",value:`${a.resource_type||"-"}${a.resource_name?`: ${a.resource_name}`:a.resource_id?` #${a.resource_id}`:""}`}),e.jsx(f,{label:"IP Address",value:a.ip_address,mono:!0,copyable:!0}),e.jsx(f,{label:"Status",value:a.success?"Success":"Failed"})]})}),a.details&&e.jsx(U,{title:"Details",collapsible:!0,children:e.jsx("pre",{className:"text-[10px] font-mono text-text-secondary bg-bg-tertiary/50 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto whitespace-pre-wrap",children:a.details})}),a.user_agent&&e.jsx(U,{title:"Client Information",collapsible:!0,defaultOpen:!1,children:e.jsx("pre",{className:"text-[10px] font-mono text-text-secondary bg-bg-tertiary/50 p-2 rounded overflow-x-auto whitespace-pre-wrap",children:a.user_agent})})]}),Fe=e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>g(!0),className:"hidden md:inline-flex",children:[e.jsx(te,{size:14}),"Date",(p||h)&&e.jsx(y,{variant:"primary",size:"sm",className:"ml-1",children:"1"})]}),e.jsx(c,{variant:"secondary",size:"sm",onClick:Y,className:"hidden md:inline-flex",children:e.jsx(z,{size:14})}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>A(!0),children:[e.jsx(E,{size:14,className:"text-status-error"}),e.jsx("span",{className:"hidden md:inline",children:"Cleanup"})]}),e.jsx(c,{variant:"secondary",size:"lg",onClick:()=>g(!0),className:"md:hidden h-11 w-11 p-0",children:e.jsx(Ie,{size:22})})]});return xe?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(De,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{title:"Audit Logs",icon:N,subtitle:`${B} log entries`,stats:Se,helpContent:we,splitView:!0,splitEmptyContent:e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-bg-tertiary flex items-center justify-center mb-3",children:e.jsx(N,{size:24,className:"text-text-tertiary"})}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Select a log entry to view details"})]}),slideOverOpen:!!a||ye,onSlideOverClose:()=>{V(null),g(!1)},slideOverTitle:a?"Log Details":"Filters & Export",slideOverContent:a?_e:Ce,slideOverWidth:a?"md":"sm",children:e.jsx(Re,{data:L,columns:be,keyField:"id",searchable:!0,externalSearch:_,onSearchChange:q,searchPlaceholder:"Search logs...",toolbarFilters:[{key:"action",value:d,onChange:s=>{b(s),n(1)},placeholder:"All Actions",options:($.actions||[]).map(s=>({value:s,label:s.replace(/_/g," ")}))},{key:"status",value:m,onChange:s=>{F(s),n(1)},placeholder:"All Status",options:[{value:"true",label:"Success"},{value:"false",label:"Failed"}]},{key:"username",value:x,onChange:s=>{M(s),n(1)},placeholder:"All Users",options:Z.map(s=>({value:s,label:s}))}],toolbarActions:Fe,selectedId:a?.id,onRowClick:V,renderMobileCard:Ne,pagination:{page:D,perPage:C,total:B,onPageChange:n,onPerPageChange:s=>{pe(s),n(1)}},emptyState:{icon:N,title:"No audit logs found",description:_||se>0?"Try adjusting your filters":"Activity will appear here"}})}),e.jsx(Ze,{open:he,onOpenChange:A,title:"Cleanup Old Logs",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Delete audit logs older than the specified number of days. This action cannot be undone."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Retention Days"}),e.jsx(T,{type:"number",min:30,max:365,value:Q,onChange:s=>ge(Math.max(30,parseInt(s.target.value)||90))}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Minimum: 30 days"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{size:"sm",variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsxs(c,{variant:"danger",onClick:je,loading:fe,children:[e.jsx(E,{size:14}),"Delete Old Logs"]})]})]})})]})}export{ps as default};
