import{c as B,a as x,k as y,A as V,x as T,C as W,i as G,j as H,B as _,I as o}from"./index-vswyqp58.js";import{j as e,R as Y,L as q,T as w,C as D}from"./radix-B6Y-MRu0.js";import{a as d}from"./vendor-DEQSVNfj.js";import{m as J}from"./ArrowsClockwise.es-DS70dwCP.js";import{a as A,b as O}from"./Globe.es-CtUoIY1T.js";import{c as K}from"./Lightning.es-C-Sz8AXK.js";import{a as Q}from"./PencilSimple.es-CJefJBPq.js";import{n as X}from"./Plus.es-DN9hvW10.js";import{n as Z}from"./TestTube.es-BJzbVb1c.js";import{n as ee}from"./Trash.es-DhgoD9TD.js";import{M as ae}from"./Modal-7_eTIvz3.js";import{B as E}from"./Badge-CZ5NzBfK.js";import{E as te}from"./EmptyState-B4dAc_K5.js";import{S as L}from"./Select-PwXyFoxR.js";import{T as se}from"./Textarea-DuI5mbE0.js";import{H as le}from"./HelpCard-BINCqYIf.js";import{D as re,f as ne,g as oe,h as N,i}from"./DetailCard-BKBzFg8i.js";const ie=[{value:"ldap",label:"LDAP / Active Directory",icon:O},{value:"oauth2",label:"OAuth2 / OIDC",icon:A},{value:"saml",label:"SAML 2.0",icon:T}],z={ldap:O,oauth2:A,saml:T};function ce(){const[a,g]=d.useState([]),[n,s]=d.useState(null),[b,m]=d.useState(!0),[v,r]=d.useState(!1),[f,t]=d.useState("create"),[u,S]=d.useState(!1),[p,I]=d.useState(""),{showSuccess:j,showError:h}=B();d.useEffect(()=>{C()},[]);const C=async()=>{try{const l=await x.get("/sso/providers");g(l.data||[])}catch{h("Failed to load SSO providers")}finally{m(!1)}},P=()=>{s(null),t("create"),r(!0)},U=l=>{s(l),t("edit"),r(!0)},$=async l=>{if(confirm(`Delete SSO provider "${l.name}"?`))try{await x.delete(`/sso/providers/${l.id}`),j("Provider deleted"),C(),s(null)}catch{h("Failed to delete provider")}},R=async l=>{try{await x.post(`/sso/providers/${l.id}/toggle`),j(`Provider ${l.enabled?"disabled":"enabled"}`),C()}catch{h("Failed to toggle provider")}},M=async l=>{S(!0);try{const c=await x.post(`/sso/providers/${l.id}/test`);c.data?.status==="success"?j(c.data.message||"Connection successful"):h(c.message||"Test failed")}catch(c){h(c.message||"Connection test failed")}finally{S(!1)}},F=async l=>{try{f==="create"?(await x.post("/sso/providers",l),j("Provider created")):(await x.put(`/sso/providers/${n.id}`,l),j("Provider updated")),r(!1),C()}catch(c){h(c.message||"Failed to save provider")}},k=a.filter(l=>l.name?.toLowerCase().includes(p.toLowerCase())||l.display_name?.toLowerCase().includes(p.toLowerCase()));return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-6 h-6 border-2 border-accent-primary/30 border-t-accent-primary rounded-full animate-spin"})}):e.jsxs(re,{children:[e.jsx(ne,{icon:y,title:"Single Sign-On",subtitle:"Configure LDAP, OAuth2, or SAML providers for centralized authentication",badge:e.jsx(E,{variant:"info",children:"Pro"}),actions:[{label:"Add Provider",icon:X,onClick:P}]}),e.jsx(le,{variant:"info",title:"SSO Providers",className:"mb-4",children:"Connect UCM to your identity provider for seamless authentication. Users can login with their corporate credentials."}),a.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(V,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-tertiary"}),e.jsx("input",{type:"text",placeholder:"Search providers...",value:p,onChange:l=>I(l.target.value),className:"w-full pl-9 pr-3 py-2 text-sm bg-bg-tertiary border border-border rounded-lg text-text-primary placeholder:text-text-tertiary focus:outline-none focus:ring-1 focus:ring-accent-primary"})]})}),k.length===0?e.jsx(te,{icon:y,title:p?"No matches":"No SSO providers",description:p?"Try a different search":"Add LDAP, OAuth2, or SAML providers",action:p?void 0:{label:"Add Provider",onClick:P}}):e.jsx("div",{className:"grid gap-3 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:k.map(l=>{const c=z[l.provider_type]||y;return e.jsx(W,{className:`cursor-pointer transition-all ${n?.id===l.id?"ring-2 ring-accent-primary bg-accent-primary/5":"hover:bg-bg-tertiary"}`,onClick:()=>s(l),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${n?.id===l.id?"bg-accent-primary/20":"bg-bg-tertiary"}`,children:e.jsx(c,{size:20,className:n?.id===l.id?"text-accent-primary":"text-text-tertiary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-text-primary truncate",children:l.display_name||l.name}),l.enabled?e.jsx(G,{size:16,className:"status-success-text shrink-0",weight:"fill"}):e.jsx(H,{size:16,className:"text-text-tertiary shrink-0"})]}),e.jsx("p",{className:"text-xs text-text-tertiary mt-0.5",children:l.provider_type?.toUpperCase()||"Unknown"})]})]})},l.id)})}),n&&e.jsx(oe,{title:"Provider Details",className:"mt-6",children:e.jsx(de,{provider:n,onEdit:()=>U(n),onDelete:()=>$(n),onToggle:()=>R(n),onTest:()=>M(n),testing:u})}),v&&e.jsx(ue,{provider:f==="edit"?n:null,onSave:F,onClose:()=>r(!1)})]})}function de({provider:a,onEdit:g,onDelete:n,onToggle:s,onTest:b,testing:m}){const v=z[a.provider_type]||y;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent-primary/10 flex items-center justify-center",children:e.jsx(v,{size:20,className:"text-accent-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-primary",children:a.display_name||a.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:a.provider_type?.toUpperCase()})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{size:"sm",variant:"secondary",onClick:b,disabled:m,children:[m?e.jsx(J,{size:14,className:"animate-spin"}):e.jsx(Z,{size:14}),"Test"]}),e.jsxs(_,{size:"sm",variant:"secondary",onClick:s,children:[e.jsx(K,{size:14}),a.enabled?"Disable":"Enable"]}),e.jsx(_,{size:"sm",variant:"secondary",onClick:g,children:e.jsx(Q,{size:14})}),e.jsx(_,{size:"sm",variant:"danger",onClick:n,children:e.jsx(ee,{size:14})})]})]}),e.jsxs(N,{columns:2,children:[e.jsx(i,{label:"Status",value:e.jsx(E,{variant:a.enabled?"success":"secondary",children:a.enabled?"Enabled":"Disabled"})}),e.jsx(i,{label:"Default Role",value:a.default_role||"viewer"}),e.jsx(i,{label:"Auto-create Users",value:a.auto_create_users?"Yes":"No"}),e.jsx(i,{label:"Auto-update Users",value:a.auto_update_users?"Yes":"No"})]}),a.provider_type==="ldap"&&e.jsxs(N,{columns:2,children:[e.jsx(i,{label:"Server",value:`${a.ldap_server}:${a.ldap_port}`,mono:!0}),e.jsx(i,{label:"SSL/TLS",value:a.ldap_use_ssl?"Enabled":"Disabled"}),e.jsx(i,{label:"Base DN",value:a.ldap_base_dn,mono:!0,fullWidth:!0})]}),a.provider_type==="oauth2"&&e.jsxs(N,{columns:2,children:[e.jsx(i,{label:"Client ID",value:a.oauth2_client_id,mono:!0}),e.jsx(i,{label:"Scopes",value:a.oauth2_scopes?.join(", ")}),e.jsx(i,{label:"Auth URL",value:a.oauth2_auth_url,mono:!0,fullWidth:!0})]}),a.provider_type==="saml"&&e.jsxs(N,{columns:2,children:[e.jsx(i,{label:"Entity ID",value:a.saml_entity_id,mono:!0,fullWidth:!0}),e.jsx(i,{label:"SSO URL",value:a.saml_sso_url,mono:!0,fullWidth:!0})]})]})}function ue({provider:a,onSave:g,onClose:n}){const[s,b]=d.useState({name:a?.name||"",display_name:a?.display_name||"",provider_type:a?.provider_type||"ldap",enabled:a?.enabled??!1,default_role:a?.default_role||"viewer",auto_create_users:a?.auto_create_users??!0,auto_update_users:a?.auto_update_users??!0,ldap_server:a?.ldap_server||"",ldap_port:a?.ldap_port||389,ldap_use_ssl:a?.ldap_use_ssl??!1,ldap_bind_dn:a?.ldap_bind_dn||"",ldap_bind_password:"",ldap_base_dn:a?.ldap_base_dn||"",ldap_user_filter:a?.ldap_user_filter||"(uid={username})",oauth2_client_id:a?.oauth2_client_id||"",oauth2_client_secret:"",oauth2_auth_url:a?.oauth2_auth_url||"",oauth2_token_url:a?.oauth2_token_url||"",oauth2_userinfo_url:a?.oauth2_userinfo_url||"",oauth2_scopes:a?.oauth2_scopes?.join(" ")||"openid profile email",saml_entity_id:a?.saml_entity_id||"",saml_sso_url:a?.saml_sso_url||"",saml_slo_url:a?.saml_slo_url||"",saml_certificate:a?.saml_certificate||""}),[m,v]=d.useState("general"),r=(t,u)=>{b(S=>({...S,[t]:u}))},f=t=>{t.preventDefault();const u={...s};u.provider_type==="oauth2"&&(u.oauth2_scopes=u.oauth2_scopes.split(/\s+/).filter(Boolean)),g(u)};return e.jsx(ae,{open:!0,onClose:n,title:a?"Edit SSO Provider":"New SSO Provider",size:"lg",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs(Y,{value:m,onValueChange:v,children:[e.jsxs(q,{className:"flex gap-1 border-b border-border mb-4",children:[e.jsx(w,{value:"general",className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary data-[state=active]:text-accent-primary data-[state=active]:border-b-2 data-[state=active]:border-accent-primary",children:"General"}),e.jsx(w,{value:"connection",className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary data-[state=active]:text-accent-primary data-[state=active]:border-b-2 data-[state=active]:border-accent-primary",children:"Connection"}),e.jsx(w,{value:"provisioning",className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary data-[state=active]:text-accent-primary data-[state=active]:border-b-2 data-[state=active]:border-accent-primary",children:"Provisioning"})]}),e.jsxs(D,{value:"general",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Provider Name",value:s.name,onChange:t=>r("name",t.target.value),required:!0,placeholder:"e.g., corporate-ldap"}),e.jsx(o,{label:"Display Name",value:s.display_name,onChange:t=>r("display_name",t.target.value),placeholder:"e.g., Corporate Directory"})]}),!a&&e.jsx(L,{label:"Provider Type",value:s.provider_type,onChange:t=>r("provider_type",t),options:ie}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:t=>r("enabled",t.target.checked),className:"rounded"}),"Enable provider"]})]}),e.jsxs(D,{value:"connection",className:"space-y-4 mt-4",children:[s.provider_type==="ldap"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{label:"LDAP Server",value:s.ldap_server,onChange:t=>r("ldap_server",t.target.value),placeholder:"ldap.example.com",className:"col-span-2"}),e.jsx(o,{label:"Port",type:"number",value:s.ldap_port,onChange:t=>r("ldap_port",parseInt(t.target.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.ldap_use_ssl,onChange:t=>r("ldap_use_ssl",t.target.checked),className:"rounded"}),"Use SSL/TLS"]}),e.jsx(o,{label:"Bind DN",value:s.ldap_bind_dn,onChange:t=>r("ldap_bind_dn",t.target.value),placeholder:"cn=admin,dc=example,dc=com"}),e.jsx(o,{label:"Bind Password",type:"password",value:s.ldap_bind_password,onChange:t=>r("ldap_bind_password",t.target.value),placeholder:a?"••••••• (leave empty to keep)":""}),e.jsx(o,{label:"Base DN",value:s.ldap_base_dn,onChange:t=>r("ldap_base_dn",t.target.value),placeholder:"dc=example,dc=com"}),e.jsx(o,{label:"User Filter",value:s.ldap_user_filter,onChange:t=>r("ldap_user_filter",t.target.value),placeholder:"(uid={username})"})]}),s.provider_type==="oauth2"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Client ID",value:s.oauth2_client_id,onChange:t=>r("oauth2_client_id",t.target.value)}),e.jsx(o,{label:"Client Secret",type:"password",value:s.oauth2_client_secret,onChange:t=>r("oauth2_client_secret",t.target.value),placeholder:a?"••••••• (leave empty to keep)":""}),e.jsx(o,{label:"Authorization URL",value:s.oauth2_auth_url,onChange:t=>r("oauth2_auth_url",t.target.value),placeholder:"https://provider.com/oauth/authorize"}),e.jsx(o,{label:"Token URL",value:s.oauth2_token_url,onChange:t=>r("oauth2_token_url",t.target.value),placeholder:"https://provider.com/oauth/token"}),e.jsx(o,{label:"Scopes",value:s.oauth2_scopes,onChange:t=>r("oauth2_scopes",t.target.value),placeholder:"openid profile email"})]}),s.provider_type==="saml"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Entity ID",value:s.saml_entity_id,onChange:t=>r("saml_entity_id",t.target.value),placeholder:"https://idp.example.com/saml/metadata"}),e.jsx(o,{label:"SSO URL",value:s.saml_sso_url,onChange:t=>r("saml_sso_url",t.target.value),placeholder:"https://idp.example.com/saml/sso"}),e.jsx(o,{label:"SLO URL (optional)",value:s.saml_slo_url,onChange:t=>r("saml_slo_url",t.target.value),placeholder:"https://idp.example.com/saml/slo"}),e.jsx(se,{label:"IdP Certificate (PEM)",value:s.saml_certificate,onChange:t=>r("saml_certificate",t.target.value),rows:6,placeholder:"-----BEGIN CERTIFICATE-----...",className:"font-mono text-xs"})]})]}),e.jsxs(D,{value:"provisioning",className:"space-y-4 mt-4",children:[e.jsx(L,{label:"Default Role",value:s.default_role,onChange:t=>r("default_role",t),options:[{value:"admin",label:"Admin"},{value:"operator",label:"Operator"},{value:"viewer",label:"Viewer"}]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.auto_create_users,onChange:t=>r("auto_create_users",t.target.checked),className:"rounded"}),"Auto-create users on first login"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.auto_update_users,onChange:t=>r("auto_update_users",t.target.checked),className:"rounded"}),"Update user info on each login"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-border",children:[e.jsx(_,{type:"button",variant:"secondary",onClick:n,children:"Cancel"}),e.jsxs(_,{type:"submit",children:[a?"Update":"Create"," Provider"]})]})]})})}const me=[{id:"sso",label:"SSO",icon:y,description:"Single Sign-On providers",pro:!0,component:ce}],Le=Object.freeze(Object.defineProperty({__proto__:null,proSettingsCategories:me},Symbol.toStringTag,{value:"Module"}));export{ce as S,me as p,Le as s};
