import{r as v,j as e,B as T,z as m,b as C,d as L}from"./index-gWc9Wuxx.js";import{P as w}from"./PageTopBar-DQU6wF4a.js";import{B as _}from"./Badge-C7kSHm3C.js";import{a as R,E as I}from"./ErrorState-DvQycW5G.js";import{E as q}from"./EmptyState-BVXbz1Ol.js";import{M as k}from"./Modal-sdelTJ_G.js";import{I as B}from"./Input-c2F2jU2v.js";import{s as t}from"./SharedModalForm.module-1nz5DqPv.js";import{u as z}from"./useQuery-Cqzu-coP.js";import{u as F}from"./useMutation-BAq7cHoY.js";import{e as M}from"./export-BEFxFx9V.js";function O({isOpen:n,onClose:c}){const[s,r]=v.useState({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),[d,g]=v.useState(!1),x=async p=>{if(p.preventDefault(),!s.name){m.error("Template name is required");return}g(!0);try{const l=Object.entries(s.keyUsage).filter(([h,a])=>a).map(([h,a])=>h),f=Object.entries(s.extendedKeyUsage).filter(([h,a])=>a).map(([h,a])=>h),y=await fetch("/api/v2/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.name,description:s.description,type:s.type,validity_days:parseInt(s.validityDays),key_size:parseInt(s.keySize),key_usage:l,extended_key_usage:f})});if(!y.ok){const h=await y.json();throw new Error(h.message||"Failed to create template")}m.success("Template created successfully"),c(),r({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),window.location.reload()}catch(l){m.error(l.message||"Failed to create template")}finally{g(!1)}},j=p=>{r(l=>({...l,[p.target.name]:p.target.value}))},i=p=>{r(l=>({...l,keyUsage:{...l.keyUsage,[p]:!l.keyUsage[p]}}))},b=p=>{r(l=>({...l,extendedKeyUsage:{...l.extendedKeyUsage,[p]:!l.extendedKeyUsage[p]}}))},N=p=>{const l=p.target.value;let f={...s.keyUsage},y={...s.extendedKeyUsage};l==="server"?(f={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},y={serverAuth:!0,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}):l==="client"?(f={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},y={serverAuth:!1,clientAuth:!0,codeSigning:!1,emailProtection:!1,timeStamping:!1}):l==="ca"&&(f={digitalSignature:!0,keyEncipherment:!1,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!0,crlSign:!0},y={serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}),r(h=>({...h,type:l,keyUsage:f,extendedKeyUsage:y}))},U=e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"secondary",onClick:c,disabled:d,children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:x,disabled:d,children:d?"Creating...":"Create Template"})]});return e.jsx(k,{isOpen:n,onClose:c,title:"New Certificate Template",size:"md",footer:U,children:e.jsxs("form",{onSubmit:x,className:t.form,children:[e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Template Information"}),e.jsx(B,{label:"Template Name",name:"name",value:s.name,onChange:j,placeholder:"Web Server Template",required:!0}),e.jsx(B,{label:"Description",name:"description",value:s.description,onChange:j,placeholder:"Template for web server certificates"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Template Type"}),e.jsxs("select",{name:"type",value:s.type,onChange:N,className:t.select,children:[e.jsx("option",{value:"server",children:"Server Authentication"}),e.jsx("option",{value:"client",children:"Client Authentication"}),e.jsx("option",{value:"ca",children:"Certificate Authority"}),e.jsx("option",{value:"code-signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Certificate Settings"}),e.jsxs("div",{className:t.row,children:[e.jsx(B,{label:"Validity Period (Days)",name:"validityDays",type:"number",value:s.validityDays,onChange:j,min:"1",max:"3650"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Key Size"}),e.jsxs("select",{name:"keySize",value:s.keySize,onChange:j,className:t.select,children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.digitalSignature,onChange:()=>i("digitalSignature"),className:t.checkbox}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyEncipherment,onChange:()=>i("keyEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.dataEncipherment,onChange:()=>i("dataEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyAgreement,onChange:()=>i("keyAgreement"),className:t.checkbox}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyCertSign,onChange:()=>i("keyCertSign"),className:t.checkbox}),e.jsx("span",{children:"Certificate Sign"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.crlSign,onChange:()=>i("crlSign"),className:t.checkbox}),e.jsx("span",{children:"CRL Sign"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Extended Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.serverAuth,onChange:()=>b("serverAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Server Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.clientAuth,onChange:()=>b("clientAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Client Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.codeSigning,onChange:()=>b("codeSigning"),className:t.checkbox}),e.jsx("span",{children:"Code Signing"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.emailProtection,onChange:()=>b("emailProtection"),className:t.checkbox}),e.jsx("span",{children:"Email Protection"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.timeStamping,onChange:()=>b("timeStamping"),className:t.checkbox}),e.jsx("span",{children:"Time Stamping"})]})]})]})]})})}const E={getTemplates:async(n={})=>(await C.get("/api/v2/templates",{params:n})).data,getTemplateDetails:async n=>(await C.get(`/api/v2/templates/${n}`)).data,createTemplate:async n=>(await C.post("/api/v2/templates",n)).data,updateTemplate:async({id:n,...c})=>(await C.put(`/api/v2/templates/${n}`,c)).data,deleteTemplate:async n=>(await C.delete(`/api/v2/templates/${n}`)).data},S={all:["templates"],lists:()=>[...S.all,"list"],list:n=>[...S.lists(),n]},$=(n={})=>z({queryKey:S.list(n),queryFn:()=>E.getTemplates(n)}),W=()=>{const n=L();return F({mutationFn:E.updateTemplate,onSuccess:()=>{n.invalidateQueries({queryKey:S.all}),m.success("Template updated successfully")},onError:c=>{m.error(c.response?.data?.message||"Failed to update template")}})},H=()=>{const n=L();return F({mutationFn:E.deleteTemplate,onSuccess:()=>{n.invalidateQueries({queryKey:S.all}),m.success("Template deleted successfully")},onError:c=>{m.error(c.response?.data?.message||"Failed to delete template")}})},V=n=>z({queryKey:[...S.all,"detail",n],queryFn:()=>E.getTemplateDetails(n),enabled:!!n});function Q({isOpen:n,onClose:c,templateId:s}){const[r,d]=v.useState({name:"",description:"",validityDays:397,keyType:"RSA-2048",digest:"sha256",isActive:!0}),{data:g}=V(s),x=W();v.useEffect(()=>{if(g?.data){const i=g.data;d({name:i.name||"",description:i.description||"",validityDays:i.validity_days||397,keyType:i.key_type||"RSA-2048",digest:i.digest||"sha256",isActive:i.is_active!==!1})}},[g]);const j=async i=>{if(i.preventDefault(),!r.name){m.error("Template name is required");return}x.mutate({id:s,name:r.name,description:r.description,validity_days:parseInt(r.validityDays),key_type:r.keyType,digest:r.digest,is_active:r.isActive},{onSuccess:()=>{c()}})};return s?e.jsxs(k,{isOpen:n,onClose:c,size:"medium",children:[e.jsxs(k.Header,{children:[e.jsx("i",{className:"ph ph-pencil-simple",style:{marginRight:"8px"}}),"Edit Template"]}),e.jsxs("form",{onSubmit:j,children:[e.jsx(k.Body,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:["Template Name ",e.jsx("span",{style:{color:"var(--status-danger)"},children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:i=>d({...r,name:i.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Description"}),e.jsx("textarea",{value:r.description,onChange:i=>d({...r,description:i.target.value}),rows:3,style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Validity (Days)"}),e.jsx("input",{type:"number",value:r.validityDays,onChange:i=>d({...r,validityDays:i.target.value}),min:"1",max:"3650",style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Key Type"}),e.jsxs("select",{value:r.keyType,onChange:i=>d({...r,keyType:i.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[e.jsx("option",{value:"RSA-2048",children:"RSA 2048"}),e.jsx("option",{value:"RSA-4096",children:"RSA 4096"}),e.jsx("option",{value:"ECDSA-P256",children:"ECDSA P-256"}),e.jsx("option",{value:"ECDSA-P384",children:"ECDSA P-384"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Signature Algorithm"}),e.jsxs("select",{value:r.digest,onChange:i=>d({...r,digest:i.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[e.jsx("option",{value:"sha256",children:"SHA-256"}),e.jsx("option",{value:"sha384",children:"SHA-384"}),e.jsx("option",{value:"sha512",children:"SHA-512"})]})]}),e.jsx("div",{children:e.jsxs("label",{style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.isActive,onChange:i=>d({...r,isActive:i.target.checked}),style:{marginRight:"8px"}}),"Active Template"]})})]})}),e.jsxs(k.Footer,{children:[e.jsx(k.CloseButton,{onClick:c,disabled:x.isPending,children:"Cancel"}),e.jsx(T,{type:"submit",variant:"primary",icon:"ph ph-check",disabled:x.isPending,children:x.isPending?"Saving...":"Save Changes"})]})]})]}):null}const G="_sectionHeader_1humx_2",Y="_sectionTitle_1humx_10",J="_filterBtn_1humx_16",X="_tableContainer_1humx_42",Z="_templateName_1humx_85",ee="_keyUsage_1humx_91",te="_subjectPattern_1humx_97",ae="_statusBadge_1humx_107",se="_badgeActive_1humx_118",ie="_badgeSystem_1humx_123",ne="_actionsCell_1humx_129",re="_actionBtn_1humx_134",o={sectionHeader:G,sectionTitle:Y,filterBtn:J,tableContainer:X,templateName:Z,keyUsage:ee,subjectPattern:te,statusBadge:ae,badgeActive:se,badgeSystem:ie,actionsCell:ne,actionBtn:re};function je(){const[n,c]=v.useState(!1),[s,r]=v.useState(!1),[d,g]=v.useState(null),[x,j]=v.useState(!1),{data:i,isLoading:b,error:N}=$(),U=H(),l=(Array.isArray(i)?i:i?.data||[]).map(a=>{try{const u=a.dn_template;let D="N/A";if(typeof u=="string")D=u;else if(u&&typeof u=="object"){const P=Object.entries(u).filter(([K,A])=>A&&A.trim()).map(([K,A])=>`${K}=${A}`);D=P.length>0?P.join(", "):"N/A"}return{id:a.id,name:a.name||"Unnamed",keyUsage:a.extensions_template?.key_usage?.join(", ")||"N/A",validity:a.validity_days?`${a.validity_days} days`:"N/A",subjectPattern:D,usedBy:"0 certs",status:"ACTIVE",isSystem:a.is_system||!1}}catch(u){return console.error("Error mapping template:",a,u),null}}).filter(Boolean),f=()=>{if(l.length===0){m.error("No templates to export");return}M(l,"templates-export",{format:"csv",columns:["id","name","keyUsage","validity","subjectPattern","usedBy","status"]}),m.success("Templates exported successfully")},y=a=>{if(a.isSystem){m.error("Cannot delete system template");return}confirm(`Delete template "${a.name}"?`)&&U.mutate(a.id)},h=a=>{if(a.isSystem){m.error("Cannot edit system template");return}g(a.id),r(!0)};return b?e.jsxs("div",{className:o.templateList,children:[e.jsx(w,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsx(_,{variant:"neutral",children:"Loading..."})}),Array.from({length:5}).map((a,u)=>e.jsx(R,{width:"100%",height:70,style:{marginBottom:"10px"}},u))]}):N?e.jsxs("div",{className:o.templateList,children:[e.jsx(w,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsx(_,{variant:"danger",children:"Error"})}),e.jsx(I,{error:N,shake:!0})]}):e.jsxs("div",{className:o.templateList,children:[e.jsx(w,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsxs(_,{variant:"success",children:[l.length," Templates"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:"ph ph-download-simple",onClick:f,children:"Export"}),e.jsx(T,{variant:"primary",icon:"ph ph-plus",onClick:()=>c(!0),children:"New Template"})]})}),e.jsxs("div",{className:o.sectionHeader,children:[e.jsx("span",{className:o.sectionTitle,children:"Available Templates"}),e.jsxs("button",{className:o.filterBtn,onClick:()=>j(!x),children:[e.jsx("i",{className:"ph ph-funnel"}),"Filter"]})]}),e.jsx("div",{className:o.tableContainer,children:l.length===0?e.jsx(q,{icon:"ph ph-file-text",title:"No Certificate Templates",message:"Create reusable templates to standardize certificate issuance",action:{label:"New Template",onClick:()=>c(!0)}}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"},children:"TEMPLATE NAME"}),e.jsx("th",{style:{width:"25%"},children:"KEY USAGE"}),e.jsx("th",{style:{width:"10%"},children:"VALIDITY"}),e.jsx("th",{style:{width:"20%"},children:"SUBJECT PATTERN"}),e.jsx("th",{style:{width:"12%"},children:"USED BY"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"8%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"Loading templates..."})}):l.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:o.templateName,children:a.name}),a.isSystem&&e.jsx(_,{variant:"info",style:{marginLeft:"0.5rem"},children:"System"})]}),e.jsx("td",{children:e.jsx("span",{className:o.keyUsage,children:a.keyUsage})}),e.jsx("td",{children:a.validity}),e.jsx("td",{children:e.jsx("code",{className:o.subjectPattern,children:a.subjectPattern})}),e.jsx("td",{children:a.usedBy}),e.jsx("td",{children:e.jsx("span",{className:`${o.statusBadge} ${a.status==="ACTIVE"?o.badgeActive:o.badgeSystem}`,children:a.status})}),e.jsx("td",{children:e.jsx("div",{className:o.actionsCell,children:!a.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:o.actionBtn,title:"Edit",onClick:()=>h(a),children:e.jsx("i",{className:"ph ph-pencil"})}),e.jsx("button",{className:o.actionBtn,title:"Delete",onClick:()=>y(a),children:e.jsx("i",{className:"ph ph-trash"})})]})})})]},a.id))})]})}),e.jsx(O,{isOpen:n,onClose:()=>c(!1)}),e.jsx(Q,{isOpen:s,onClose:()=>r(!1),templateId:d})]})}export{je as TemplateList,je as default};
