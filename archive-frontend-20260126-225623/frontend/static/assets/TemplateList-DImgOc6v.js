import{r as b,j as e,B as S,z as f}from"./index-qRzKqHpr.js";import{P as E}from"./PageTopBar-B-3ftnRb.js";import{B as T}from"./Badge-yiObn7Iz.js";import{a as B,E as P}from"./ErrorState-3kve913z.js";import{E as L}from"./EmptyState-Db0MrSQ7.js";import{M as v}from"./Modal-C-kFYSLF.js";import{I as U}from"./Input-Dcef6QFO.js";import{s as t}from"./SharedModalForm.module-1nz5DqPv.js";import{a as z,b as K,u as R,c as I}from"./useTemplates-BuR5Upua.js";import{e as F}from"./export-BEFxFx9V.js";import"./X.es-BJJE6H0d.js";import"./with-selector-lNK7IjxG.js";import"./index-Gg_cCWSY.js";import"./useQuery-BTYUFOaa.js";import"./useMutation-DcMyPSfU.js";function M({isOpen:k,onClose:o}){const[s,n]=b.useState({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),[c,y]=b.useState(!1),m=async d=>{if(d.preventDefault(),!s.name){f.error("Template name is required");return}y(!0);try{const r=Object.entries(s.keyUsage).filter(([h,a])=>a).map(([h,a])=>h),j=Object.entries(s.extendedKeyUsage).filter(([h,a])=>a).map(([h,a])=>h),p=await fetch("/api/v2/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.name,description:s.description,type:s.type,validity_days:parseInt(s.validityDays),key_size:parseInt(s.keySize),key_usage:r,extended_key_usage:j})});if(!p.ok){const h=await p.json();throw new Error(h.message||"Failed to create template")}f.success("Template created successfully"),o(),n({name:"",description:"",type:"server",validityDays:"365",keySize:"2048",keyUsage:{digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},extendedKeyUsage:{serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}}),window.location.reload()}catch(r){f.error(r.message||"Failed to create template")}finally{y(!1)}},g=d=>{n(r=>({...r,[d.target.name]:d.target.value}))},i=d=>{n(r=>({...r,keyUsage:{...r.keyUsage,[d]:!r.keyUsage[d]}}))},u=d=>{n(r=>({...r,extendedKeyUsage:{...r.extendedKeyUsage,[d]:!r.extendedKeyUsage[d]}}))},C=d=>{const r=d.target.value;let j={...s.keyUsage},p={...s.extendedKeyUsage};r==="server"?(j={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},p={serverAuth:!0,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}):r==="client"?(j={digitalSignature:!0,keyEncipherment:!0,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!1,crlSign:!1},p={serverAuth:!1,clientAuth:!0,codeSigning:!1,emailProtection:!1,timeStamping:!1}):r==="ca"&&(j={digitalSignature:!0,keyEncipherment:!1,dataEncipherment:!1,keyAgreement:!1,keyCertSign:!0,crlSign:!0},p={serverAuth:!1,clientAuth:!1,codeSigning:!1,emailProtection:!1,timeStamping:!1}),n(h=>({...h,type:r,keyUsage:j,extendedKeyUsage:p}))},A=e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"secondary",onClick:o,disabled:c,children:"Cancel"}),e.jsx(S,{variant:"primary",onClick:m,disabled:c,children:c?"Creating...":"Create Template"})]});return e.jsx(v,{isOpen:k,onClose:o,title:"New Certificate Template",size:"md",footer:A,children:e.jsxs("form",{onSubmit:m,className:t.form,children:[e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Template Information"}),e.jsx(U,{label:"Template Name",name:"name",value:s.name,onChange:g,placeholder:"Web Server Template",required:!0}),e.jsx(U,{label:"Description",name:"description",value:s.description,onChange:g,placeholder:"Template for web server certificates"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Template Type"}),e.jsxs("select",{name:"type",value:s.type,onChange:C,className:t.select,children:[e.jsx("option",{value:"server",children:"Server Authentication"}),e.jsx("option",{value:"client",children:"Client Authentication"}),e.jsx("option",{value:"ca",children:"Certificate Authority"}),e.jsx("option",{value:"code-signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Certificate Settings"}),e.jsxs("div",{className:t.row,children:[e.jsx(U,{label:"Validity Period (Days)",name:"validityDays",type:"number",value:s.validityDays,onChange:g,min:"1",max:"3650"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Key Size"}),e.jsxs("select",{name:"keySize",value:s.keySize,onChange:g,className:t.select,children:[e.jsx("option",{value:"2048",children:"2048 bits"}),e.jsx("option",{value:"3072",children:"3072 bits"}),e.jsx("option",{value:"4096",children:"4096 bits"})]})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.digitalSignature,onChange:()=>i("digitalSignature"),className:t.checkbox}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyEncipherment,onChange:()=>i("keyEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.dataEncipherment,onChange:()=>i("dataEncipherment"),className:t.checkbox}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyAgreement,onChange:()=>i("keyAgreement"),className:t.checkbox}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.keyCertSign,onChange:()=>i("keyCertSign"),className:t.checkbox}),e.jsx("span",{children:"Certificate Sign"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.keyUsage.crlSign,onChange:()=>i("crlSign"),className:t.checkbox}),e.jsx("span",{children:"CRL Sign"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Extended Key Usage"}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.serverAuth,onChange:()=>u("serverAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Server Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.clientAuth,onChange:()=>u("clientAuth"),className:t.checkbox}),e.jsx("span",{children:"TLS Web Client Authentication"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.codeSigning,onChange:()=>u("codeSigning"),className:t.checkbox}),e.jsx("span",{children:"Code Signing"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.emailProtection,onChange:()=>u("emailProtection"),className:t.checkbox}),e.jsx("span",{children:"Email Protection"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:s.extendedKeyUsage.timeStamping,onChange:()=>u("timeStamping"),className:t.checkbox}),e.jsx("span",{children:"Time Stamping"})]})]})]})]})})}function O({isOpen:k,onClose:o,templateId:s}){const[n,c]=b.useState({name:"",description:"",validityDays:397,keyType:"RSA-2048",digest:"sha256",isActive:!0}),{data:y}=z(s),m=K();b.useEffect(()=>{if(y?.data){const i=y.data;c({name:i.name||"",description:i.description||"",validityDays:i.validity_days||397,keyType:i.key_type||"RSA-2048",digest:i.digest||"sha256",isActive:i.is_active!==!1})}},[y]);const g=async i=>{if(i.preventDefault(),!n.name){f.error("Template name is required");return}m.mutate({id:s,name:n.name,description:n.description,validity_days:parseInt(n.validityDays),key_type:n.keyType,digest:n.digest,is_active:n.isActive},{onSuccess:()=>{o()}})};return s?e.jsxs(v,{isOpen:k,onClose:o,size:"medium",children:[e.jsxs(v.Header,{children:[e.jsx("i",{className:"ph ph-pencil-simple",style:{marginRight:"8px"}}),"Edit Template"]}),e.jsxs("form",{onSubmit:g,children:[e.jsx(v.Body,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:["Template Name ",e.jsx("span",{style:{color:"var(--status-danger)"},children:"*"})]}),e.jsx("input",{type:"text",value:n.name,onChange:i=>c({...n,name:i.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Description"}),e.jsx("textarea",{value:n.description,onChange:i=>c({...n,description:i.target.value}),rows:3,style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Validity (Days)"}),e.jsx("input",{type:"number",value:n.validityDays,onChange:i=>c({...n,validityDays:i.target.value}),min:"1",max:"3650",style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Key Type"}),e.jsxs("select",{value:n.keyType,onChange:i=>c({...n,keyType:i.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[e.jsx("option",{value:"RSA-2048",children:"RSA 2048"}),e.jsx("option",{value:"RSA-4096",children:"RSA 4096"}),e.jsx("option",{value:"ECDSA-P256",children:"ECDSA P-256"}),e.jsx("option",{value:"ECDSA-P384",children:"ECDSA P-384"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Signature Algorithm"}),e.jsxs("select",{value:n.digest,onChange:i=>c({...n,digest:i.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[e.jsx("option",{value:"sha256",children:"SHA-256"}),e.jsx("option",{value:"sha384",children:"SHA-384"}),e.jsx("option",{value:"sha512",children:"SHA-512"})]})]}),e.jsx("div",{children:e.jsxs("label",{style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.isActive,onChange:i=>c({...n,isActive:i.target.checked}),style:{marginRight:"8px"}}),"Active Template"]})})]})}),e.jsxs(v.Footer,{children:[e.jsx(v.CloseButton,{onClick:o,disabled:m.isPending,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"primary",icon:"ph ph-check",disabled:m.isPending,children:m.isPending?"Saving...":"Save Changes"})]})]})]}):null}const W="_sectionHeader_1humx_2",H="_sectionTitle_1humx_10",$="_filterBtn_1humx_16",V="_tableContainer_1humx_42",q="_templateName_1humx_85",G="_keyUsage_1humx_91",Y="_subjectPattern_1humx_97",J="_statusBadge_1humx_107",Q="_badgeActive_1humx_118",X="_badgeSystem_1humx_123",Z="_actionsCell_1humx_129",ee="_actionBtn_1humx_134",l={sectionHeader:W,sectionTitle:H,filterBtn:$,tableContainer:V,templateName:q,keyUsage:G,subjectPattern:Y,statusBadge:J,badgeActive:Q,badgeSystem:X,actionsCell:Z,actionBtn:ee};function ge(){const[k,o]=b.useState(!1),[s,n]=b.useState(!1),[c,y]=b.useState(null),[m,g]=b.useState(!1),{data:i,isLoading:u,error:C}=R(),A=I(),r=(Array.isArray(i)?i:i?.data||[]).map(a=>{try{const x=a.dn_template;let _="N/A";if(typeof x=="string")_=x;else if(x&&typeof x=="object"){const D=Object.entries(x).filter(([w,N])=>N&&N.trim()).map(([w,N])=>`${w}=${N}`);_=D.length>0?D.join(", "):"N/A"}return{id:a.id,name:a.name||"Unnamed",keyUsage:a.extensions_template?.key_usage?.join(", ")||"N/A",validity:a.validity_days?`${a.validity_days} days`:"N/A",subjectPattern:_,usedBy:"0 certs",status:"ACTIVE",isSystem:a.is_system||!1}}catch(x){return console.error("Error mapping template:",a,x),null}}).filter(Boolean),j=()=>{if(r.length===0){f.error("No templates to export");return}F(r,"templates-export",{format:"csv",columns:["id","name","keyUsage","validity","subjectPattern","usedBy","status"]}),f.success("Templates exported successfully")},p=a=>{if(a.isSystem){f.error("Cannot delete system template");return}confirm(`Delete template "${a.name}"?`)&&A.mutate(a.id)},h=a=>{if(a.isSystem){f.error("Cannot edit system template");return}y(a.id),n(!0)};return u?e.jsxs("div",{className:l.templateList,children:[e.jsx(E,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsx(T,{variant:"neutral",children:"Loading..."})}),Array.from({length:5}).map((a,x)=>e.jsx(B,{width:"100%",height:70,style:{marginBottom:"10px"}},x))]}):C?e.jsxs("div",{className:l.templateList,children:[e.jsx(E,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsx(T,{variant:"danger",children:"Error"})}),e.jsx(P,{error:C,shake:!0})]}):e.jsxs("div",{className:l.templateList,children:[e.jsx(E,{icon:"ph ph-file-text",title:"Certificate Templates",badge:e.jsxs(T,{variant:"success",children:[r.length," Templates"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:"ph ph-download-simple",onClick:j,children:"Export"}),e.jsx(S,{variant:"primary",icon:"ph ph-plus",onClick:()=>o(!0),children:"New Template"})]})}),e.jsxs("div",{className:l.sectionHeader,children:[e.jsx("span",{className:l.sectionTitle,children:"Available Templates"}),e.jsxs("button",{className:l.filterBtn,onClick:()=>g(!m),children:[e.jsx("i",{className:"ph ph-funnel"}),"Filter"]})]}),e.jsx("div",{className:l.tableContainer,children:r.length===0?e.jsx(L,{icon:"ph ph-file-text",title:"No Certificate Templates",message:"Create reusable templates to standardize certificate issuance",action:{label:"New Template",onClick:()=>o(!0)}}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"15%"},children:"TEMPLATE NAME"}),e.jsx("th",{style:{width:"25%"},children:"KEY USAGE"}),e.jsx("th",{style:{width:"10%"},children:"VALIDITY"}),e.jsx("th",{style:{width:"20%"},children:"SUBJECT PATTERN"}),e.jsx("th",{style:{width:"12%"},children:"USED BY"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"8%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",style:{textAlign:"center",padding:"2rem"},children:"Loading templates..."})}):r.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:l.templateName,children:a.name}),a.isSystem&&e.jsx(T,{variant:"info",style:{marginLeft:"0.5rem"},children:"System"})]}),e.jsx("td",{children:e.jsx("span",{className:l.keyUsage,children:a.keyUsage})}),e.jsx("td",{children:a.validity}),e.jsx("td",{children:e.jsx("code",{className:l.subjectPattern,children:a.subjectPattern})}),e.jsx("td",{children:a.usedBy}),e.jsx("td",{children:e.jsx("span",{className:`${l.statusBadge} ${a.status==="ACTIVE"?l.badgeActive:l.badgeSystem}`,children:a.status})}),e.jsx("td",{children:e.jsx("div",{className:l.actionsCell,children:!a.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:l.actionBtn,title:"Edit",onClick:()=>h(a),children:e.jsx("i",{className:"ph ph-pencil"})}),e.jsx("button",{className:l.actionBtn,title:"Delete",onClick:()=>p(a),children:e.jsx("i",{className:"ph ph-trash"})})]})})})]},a.id))})]})}),e.jsx(M,{isOpen:k,onClose:()=>o(!1)}),e.jsx(O,{isOpen:s,onClose:()=>n(!1),templateId:c})]})}export{ge as TemplateList,ge as default};
