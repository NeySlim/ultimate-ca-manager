import{r as h,j as e,B as x,z as g}from"./index-qRzKqHpr.js";import{D as Z}from"./DataTable-BxWBQjUk.js";import{B as S}from"./Badge-yiObn7Iz.js";import{a as ee,E as se}from"./ErrorState-3kve913z.js";import{E as ae}from"./EmptyState-Db0MrSQ7.js";import{P as M}from"./PageTopBar-B-3ftnRb.js";import{P as F,a as C}from"./PillFilter-Dy7B1Q1S.js";import{e as re}from"./export-BEFxFx9V.js";import{M as w}from"./Modal-C-kFYSLF.js";import{I as A}from"./Input-Dcef6QFO.js";import{S as te}from"./SuccessAnimation-bjU8SnKp.js";import{s as t}from"./SharedModalForm.module-1nz5DqPv.js";import{a as ie,u as le,b as ne,c as oe,d as ce,e as de}from"./useUsers-B1bhUKVA.js";import"./X.es-BJJE6H0d.js";import"./with-selector-lNK7IjxG.js";import"./index-Gg_cCWSY.js";import"./useQuery-BTYUFOaa.js";import"./useMutation-DcMyPSfU.js";function me({isOpen:d,onClose:u}){const[i,l]=h.useState(!1),[r,m]=h.useState({username:"",password:"",confirmPassword:"",email:"",fullName:"",role:"operator",permissions:{manageCAs:!1,issueCertificates:!0,revokeCertificates:!1,manageUsers:!1,viewLogs:!0,manageSettings:!1}}),[y,c]=h.useState(!1),U=async p=>{if(p.preventDefault(),!r.username||!r.password){g.error("Username and password are required");return}if(r.password!==r.confirmPassword){g.error("Passwords do not match");return}if(r.password.length<8){g.error("Password must be at least 8 characters");return}c(!0);try{const o=await fetch("/api/v2/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r.username,password:r.password,email:r.email,full_name:r.fullName,role:r.role,permissions:r.permissions})});if(!o.ok){const b=await o.json();throw new Error(b.message||"Failed to create user")}l(!0),g.success("User created successfully"),setTimeout(()=>{u(),l(!1),m({username:"",password:"",confirmPassword:"",email:"",fullName:"",role:"operator",permissions:{manageCAs:!1,issueCertificates:!0,revokeCertificates:!1,manageUsers:!1,viewLogs:!0,manageSettings:!1}}),window.location.reload()},2e3)}catch(o){g.error(o.message||"Failed to create user")}finally{c(!1)}},f=p=>{m(o=>({...o,[p.target.name]:p.target.value}))},v=p=>{m(o=>({...o,permissions:{...o.permissions,[p]:!o.permissions[p]}}))},N=p=>{const o=p.target.value;let b={...r.permissions};o==="admin"?b={manageCAs:!0,issueCertificates:!0,revokeCertificates:!0,manageUsers:!0,viewLogs:!0,manageSettings:!0}:o==="operator"?b={manageCAs:!1,issueCertificates:!0,revokeCertificates:!1,manageUsers:!1,viewLogs:!0,manageSettings:!1}:o==="viewer"&&(b={manageCAs:!1,issueCertificates:!1,revokeCertificates:!1,manageUsers:!1,viewLogs:!0,manageSettings:!1}),m(z=>({...z,role:o,permissions:b}))},_=e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"secondary",onClick:u,disabled:y,children:"Cancel"}),e.jsx(x,{variant:"primary",onClick:U,disabled:y,children:y?"Creating...":"Create User"})]});return e.jsxs(w,{isOpen:d,onClose:u,title:"Create User",size:"md",footer:_,children:[e.jsxs("form",{onSubmit:U,className:t.form,children:[e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Account Information"}),e.jsx(A,{label:"Username",name:"username",value:r.username,onChange:f,placeholder:"john.doe",required:!0}),e.jsx(A,{label:"Full Name",name:"fullName",value:r.fullName,onChange:f,placeholder:"John Doe"}),e.jsx(A,{label:"Email Address",name:"email",type:"email",value:r.email,onChange:f,placeholder:"john.doe@example.com"})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Security"}),e.jsx(A,{label:"Password",name:"password",type:"password",value:r.password,onChange:f,placeholder:"••••••••",required:!0,helpText:"Minimum 8 characters"}),e.jsx(A,{label:"Confirm Password",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:f,placeholder:"••••••••",required:!0})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Role & Permissions"}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Role"}),e.jsxs("select",{name:"role",value:r.role,onChange:N,className:t.select,children:[e.jsx("option",{value:"admin",children:"Administrator"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"viewer",children:"Viewer"})]}),e.jsxs("p",{className:t.helpText,children:[r.role==="admin"&&"Full access to all features",r.role==="operator"&&"Can issue and manage certificates",r.role==="viewer"&&"Read-only access"]})]}),e.jsxs("div",{className:t.permissionsGrid,children:[e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:r.permissions.manageCAs,onChange:()=>v("manageCAs"),className:t.checkbox}),e.jsx("span",{children:"Manage CAs"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:r.permissions.issueCertificates,onChange:()=>v("issueCertificates"),className:t.checkbox}),e.jsx("span",{children:"Issue Certificates"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:r.permissions.revokeCertificates,onChange:()=>v("revokeCertificates"),className:t.checkbox}),e.jsx("span",{children:"Revoke Certificates"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:r.permissions.manageUsers,onChange:()=>v("manageUsers"),className:t.checkbox}),e.jsx("span",{children:"Manage Users"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:r.permissions.viewLogs,onChange:()=>v("viewLogs"),className:t.checkbox}),e.jsx("span",{children:"View Logs"})]}),e.jsxs("label",{className:t.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:r.permissions.manageSettings,onChange:()=>v("manageSettings"),className:t.checkbox}),e.jsx("span",{children:"Manage Settings"})]})]})]})]}),i&&e.jsx(te,{message:"User Created!",onComplete:()=>l(!1)})]})}function pe({isOpen:d,onClose:u,user:i}){const[l,r]=h.useState({email:"",fullName:"",role:"operator",active:!0}),m=ie();if(h.useEffect(()=>{i&&r({email:i.email||"",fullName:i.name||"",role:i.role?.toLowerCase()||"operator",active:i.status==="Active"})},[i]),!i)return null;const y=async c=>{if(c.preventDefault(),!l.email){g.error("Email is required");return}m.mutate({id:i.id,email:l.email,full_name:l.fullName,role:l.role,active:l.active},{onSuccess:()=>{u()}})};return e.jsxs(w,{isOpen:d,onClose:u,size:"medium",children:[e.jsxs(w.Header,{children:[e.jsx("i",{className:"ph ph-pencil-simple",style:{marginRight:"8px"}}),"Edit User: ",i.name]}),e.jsxs("form",{onSubmit:y,children:[e.jsx(w.Body,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Username"}),e.jsx("input",{type:"text",value:i.name,readOnly:!0,disabled:!0,style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-tertiary)",color:"var(--text-tertiary)",cursor:"not-allowed"}})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:["Email ",e.jsx("span",{style:{color:"var(--status-danger)"},children:"*"})]}),e.jsx("input",{type:"email",value:l.email,onChange:c=>r({...l,email:c.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Full Name"}),e.jsx("input",{type:"text",value:l.fullName,onChange:c=>r({...l,fullName:c.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Role"}),e.jsxs("select",{value:l.role,onChange:c=>r({...l,role:c.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]}),e.jsx("div",{children:e.jsxs("label",{style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:c=>r({...l,active:c.target.checked}),style:{marginRight:"8px"}}),"Active User"]})})]})}),e.jsxs(w.Footer,{children:[e.jsx(w.CloseButton,{onClick:u,disabled:m.isPending,children:"Cancel"}),e.jsx(x,{type:"submit",variant:"primary",icon:"ph ph-check",disabled:m.isPending,children:m.isPending?"Saving...":"Save Changes"})]})]})]})}const ue="_userList_96igz_3",he="_filtersSection_96igz_9",xe="_filterGroup_96igz_21",ge="_badge_96igz_35",fe="_tableContainer_96igz_40",ve="_userInfoCell_96igz_46",be="_userAvatar_96igz_52",je="_userDetails_96igz_66",ye="_userName_96igz_72",Ce="_userEmail_96igz_78",ke="_actionsCell_96igz_83",n={userList:ue,filtersSection:he,filterGroup:xe,badge:ge,tableContainer:fe,userInfoCell:ve,userAvatar:be,userDetails:je,userName:ye,userEmail:Ce,actionsCell:ke};function Ge(){const[d,u]=h.useState("All"),[i,l]=h.useState("All"),[r,m]=h.useState(!1),[y,c]=h.useState(null),[U,f]=h.useState(!1),v=h.useMemo(()=>{const s={};return d!=="All"&&(s.role=d.toLowerCase()),i!=="All"&&(s.active=i==="Active"),s},[d,i]),{data:N,isLoading:_,error:p}=le(v),o=ne(),b=oe(),z=ce(),$=de(),B=s=>{if(!s)return"??";const a=s.split(" ");return a.length>1?`${a[0][0]}${a[1][0]}`:s.substring(0,2)},T=s=>{if(!s)return"Never";const a=new Date(s),P=new Date-a,I=Math.floor(P/6e4),D=Math.floor(P/36e5),k=Math.floor(P/864e5);return I<60?`${I} min ago`:D<24?`${D} hour${D>1?"s":""} ago`:k<7?`${k} day${k>1?"s":""} ago`:k<30?`${Math.floor(k/7)} week${Math.floor(k/7)>1?"s":""} ago`:a.toLocaleDateString("en-US",{month:"short",year:"numeric"})},j=(Array.isArray(N)?N:N?.data||[]).map(s=>({id:s.id,name:s.username,initials:B(s.username),email:s.email,role:s.role?s.role.charAt(0).toUpperCase()+s.role.slice(1):"Unknown",status:s.active?"Active":"Disabled",lastLogin:T(s.last_login),created:T(s.created_at)})),L=j,O=j.filter(s=>s.role==="Admin").length,G=j.filter(s=>s.role==="Operator").length,V=j.filter(s=>s.role==="Viewer").length,R=j.filter(s=>s.status==="Active").length,W=j.filter(s=>s.status==="Disabled").length,q=()=>{if(L.length===0){g.error("No data to export");return}re(L,"users-export",{format:"csv",columns:["id","name","email","role","status","lastLogin","created"]}),g.success("Users exported successfully")},H=s=>{confirm(`Delete user "${s.name}"?`)&&o.mutate(s.id)},J=s=>{const a=s.target.files[0];a&&(b.mutate(a),s.target.value="")},K=s=>{c(s),f(!0)},Q=s=>{const a=prompt(`Enter new password for ${s.name}:`);a&&a.length>=8?z.mutate({userId:s.id,newPassword:a}):a&&g.error("Password must be at least 8 characters")},X=s=>{const a=s.status==="Active"?"deactivate":"activate";confirm(`Are you sure you want to ${a} user "${s.name}"?`)&&$.mutate(s.id)};if(_)return e.jsxs("div",{className:n.userList,children:[e.jsx(M,{icon:"ph ph-users",title:"Users",badge:e.jsx(S,{variant:"neutral",children:"Loading..."})}),Array.from({length:6}).map((s,a)=>e.jsx(ee,{width:"100%",height:60,style:{marginBottom:"8px"}},a))]});if(p)return e.jsxs("div",{className:n.userList,children:[e.jsx(M,{icon:"ph ph-users",title:"Users",badge:e.jsx(S,{variant:"danger",children:"Error"})}),e.jsx(se,{error:p,shake:!0}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading users: ",p.message]})]});const Y=[{key:"name",label:"User",render:s=>e.jsxs("div",{className:n.userInfoCell,children:[e.jsx("div",{className:n.userAvatar,children:s.initials}),e.jsxs("div",{className:n.userDetails,children:[e.jsx("div",{className:n.userName,children:s.name}),e.jsx("div",{className:n.userEmail,children:s.email})]})]})},{key:"role",label:"Role",render:s=>{const a=s.role==="Admin"?"error":s.role==="Operator"?"warning":"info";return e.jsx(S,{variant:a,children:s.role})}},{key:"status",label:"Status",render:s=>e.jsx(S,{variant:s.status==="Active"?"success":"error",children:s.status})},{key:"lastLogin",label:"Last Login"},{key:"created",label:"Created"},{key:"actions",label:"Actions",render:s=>e.jsxs("div",{className:n.actionsCell,children:[e.jsx(x,{variant:"default",size:"sm",icon:"ph ph-pencil-simple",onClick:a=>{a.stopPropagation(),K(s)}}),e.jsx(x,{variant:"default",size:"sm",icon:"ph ph-trash",onClick:a=>{a.stopPropagation(),H(s)}}),e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsx(x,{variant:"default",size:"sm",icon:"ph ph-dots-three-outline-vertical",onClick:a=>{a.stopPropagation();const E=a.currentTarget.nextSibling;E.style.display=E.style.display==="block"?"none":"block"}}),e.jsxs("div",{style:{display:"none",position:"absolute",right:0,top:"100%",marginTop:"4px",background:"var(--bg-secondary)",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:1e3,minWidth:"160px"},children:[e.jsxs("button",{onClick:a=>{a.stopPropagation(),Q(s),a.currentTarget.parentElement.style.display="none"},style:{width:"100%",padding:"8px 12px",fontSize:"13px",color:"var(--text-primary)",background:"transparent",border:"none",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:a=>a.currentTarget.style.background="var(--bg-hover)",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:[e.jsx("i",{className:"ph ph-key"}),"Reset Password"]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),X(s),a.currentTarget.parentElement.style.display="none"},style:{width:"100%",padding:"8px 12px",fontSize:"13px",color:"var(--text-primary)",background:"transparent",border:"none",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:a=>a.currentTarget.style.background="var(--bg-hover)",onMouseLeave:a=>a.currentTarget.style.background="transparent",children:[e.jsx("i",{className:s.status==="Active"?"ph ph-prohibit":"ph ph-check-circle"}),s.status==="Active"?"Deactivate":"Activate"]})]})]})]})}];return e.jsxs("div",{className:n.userList,children:[e.jsx(M,{icon:"ph ph-users",title:"Users",badge:e.jsxs(S,{variant:"info",children:[R," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"import-users",accept:".csv",style:{display:"none"},onChange:J}),e.jsx(x,{variant:"default",icon:"ph ph-upload-simple",onClick:()=>document.getElementById("import-users").click(),children:"Import"}),e.jsx(x,{variant:"default",icon:"ph ph-download-simple",onClick:q,children:"Export"}),e.jsx(x,{variant:"primary",icon:"ph ph-plus",onClick:()=>m(!0),children:"Create User"})]})}),e.jsxs("div",{className:n.filtersSection,children:[e.jsxs("div",{className:n.filterGroup,children:[e.jsx("label",{children:"Role"}),e.jsxs(F,{children:[e.jsxs(C,{active:d==="All",onClick:()=>u("All"),children:["All ",e.jsxs("span",{className:n.badge,children:["(",j.length,")"]})]}),e.jsxs(C,{active:d==="Admin",onClick:()=>u("Admin"),children:["Admin ",e.jsxs("span",{className:n.badge,children:["(",O,")"]})]}),e.jsxs(C,{active:d==="Operator",onClick:()=>u("Operator"),children:["Operator ",e.jsxs("span",{className:n.badge,children:["(",G,")"]})]}),e.jsxs(C,{active:d==="Viewer",onClick:()=>u("Viewer"),children:["Viewer ",e.jsxs("span",{className:n.badge,children:["(",V,")"]})]})]})]}),e.jsxs("div",{className:n.filterGroup,children:[e.jsx("label",{children:"Status"}),e.jsxs(F,{children:[e.jsxs(C,{active:i==="All",onClick:()=>l("All"),children:["All ",e.jsxs("span",{className:n.badge,children:["(",j.length,")"]})]}),e.jsxs(C,{active:i==="Active",onClick:()=>l("Active"),children:["Active ",e.jsxs("span",{className:n.badge,children:["(",R,")"]})]}),e.jsxs(C,{active:i==="Disabled",onClick:()=>l("Disabled"),children:["Disabled ",e.jsxs("span",{className:n.badge,children:["(",W,")"]})]})]})]})]}),e.jsx("div",{className:n.tableContainer,children:L.length===0?e.jsx(ae,{icon:"ph ph-users",title:"No users found",message:d!=="All"||i!=="All"?"Try adjusting your filters to see more results":"Get started by creating your first user account",action:d==="All"&&i==="All"?{label:"Create User",onClick:()=>m(!0)}:void 0}):e.jsx(Z,{columns:Y,data:L,loading:_,onRowClick:s=>console.log("User clicked:",s),pageSize:10})}),e.jsx(me,{isOpen:r,onClose:()=>m(!1)}),e.jsx(pe,{isOpen:U,onClose:()=>f(!1),user:y})]})}export{Ge as UserList,Ge as default};
