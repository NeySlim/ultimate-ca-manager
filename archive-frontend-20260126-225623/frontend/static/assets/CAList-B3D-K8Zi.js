import{r as d,j as e,B as w,z as h,b as M}from"./index-Dj_QqA_h.js";import{P as G}from"./PageTopBar-CT0oX-Xo.js";import{B as D}from"./Badge-BzE7p1LT.js";import{a as $,E as U}from"./ErrorState-6-4sQVqy.js";import{E as L}from"./EmptyState-C-PzjsAR.js";import{u as O,a as H,b as K}from"./useCAs-AhB9AaVz.js";import{M as F}from"./Modal-BI7uGW8l.js";import{I as g}from"./Input-BSV9t-AI.js";import{s as n,F as V}from"./ImportCAModal.module-DCeTCmSm.js";import{e as Y}from"./export-BEFxFx9V.js";import"./useQuery-CGV9S-OY.js";import"./useMutation-Dopo3tb_.js";const q="_form_p6l90_1",Q="_section_p6l90_7",X="_sectionTitle_p6l90_13",J="_fieldGroup_p6l90_22",W="_fieldRow_p6l90_29",Z="_label_p6l90_35",ee="_radioGroup_p6l90_43",se="_radio_p6l90_43",ae="_select_p6l90_67",t={form:q,section:Q,sectionTitle:X,fieldGroup:J,fieldRow:W,label:Z,radioGroup:ee,radio:se,select:ae};function te({isOpen:S,onClose:f}){const[i,j]=d.useState({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0}),u=O(),p=l=>{if(l.preventDefault(),!i.commonName){h.error("Common Name is required");return}u.mutate({common_name:i.commonName,organization:i.organization,organizational_unit:i.organizationalUnit,country:i.country,state:i.state,locality:i.locality,validity_days:parseInt(i.validityDays),key_size:parseInt(i.keySize),is_root:i.isRoot},{onSuccess:()=>{h.success("CA created successfully"),f(),j({commonName:"",organization:"",organizationalUnit:"",country:"",state:"",locality:"",validityDays:"3650",keySize:"2048",isRoot:!0})},onError:x=>{h.error(`Failed to create CA: ${x.message}`)}})},c=(l,x)=>{j(b=>({...b,[l]:x}))};return e.jsx(F,{isOpen:S,onClose:f,title:"Create Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"default",onClick:f,children:"Cancel"}),e.jsx(w,{variant:"primary",onClick:p,disabled:u.isPending,children:u.isPending?"Creating...":"Create CA"})]}),children:e.jsxs("form",{className:t.form,onSubmit:p,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"CA Type"}),e.jsxs("div",{className:t.radioGroup,children:[e.jsxs("label",{className:t.radio,children:[e.jsx("input",{type:"radio",checked:i.isRoot,onChange:()=>c("isRoot",!0)}),e.jsx("span",{children:"Root CA"})]}),e.jsxs("label",{className:t.radio,children:[e.jsx("input",{type:"radio",checked:!i.isRoot,onChange:()=>c("isRoot",!1)}),e.jsx("span",{children:"Intermediate CA"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Common Name (CN) *"}),e.jsx(g,{value:i.commonName,onChange:l=>c("commonName",l.target.value),placeholder:"My Root CA",required:!0})]}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Organization (O)"}),e.jsx(g,{value:i.organization,onChange:l=>c("organization",l.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Organizational Unit (OU)"}),e.jsx(g,{value:i.organizationalUnit,onChange:l=>c("organizationalUnit",l.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Country (C)"}),e.jsx(g,{value:i.country,onChange:l=>c("country",l.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"State/Province (ST)"}),e.jsx(g,{value:i.state,onChange:l=>c("state",l.target.value),placeholder:"California"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"City/Locality (L)"}),e.jsx(g,{value:i.locality,onChange:l=>c("locality",l.target.value),placeholder:"San Francisco"})]})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{className:t.sectionTitle,children:"Settings"}),e.jsxs("div",{className:t.fieldRow,children:[e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Validity (days)"}),e.jsx(g,{type:"number",value:i.validityDays,onChange:l=>c("validityDays",l.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:t.fieldGroup,children:[e.jsx("label",{className:t.label,children:"Key Size (bits)"}),e.jsxs("select",{className:t.select,value:i.keySize,onChange:l=>c("keySize",l.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]})]})})}function le({isOpen:S,onClose:f,onSuccess:i}){const[j,u]=d.useState(null),[p,c]=d.useState("PEM"),[l,x]=d.useState(""),[b,E]=d.useState(null),[m,I]=d.useState(!1),[v,N]=d.useState(null),z=(o,C)=>{if(u(o),E(C),N(null),o&&p==="PEM"){const B=new FileReader;B.onload=_=>{const y=_.target.result;if(y.includes("BEGIN CERTIFICATE")){const k=y.split(`
`),s=k.findIndex(T=>T.includes("BEGIN CERTIFICATE")),r=k.findIndex(T=>T.includes("END CERTIFICATE"));s>=0&&r>s&&N({type:"PEM Certificate",lines:r-s+1,size:o.size})}},B.readAsText(o)}},P=async()=>{if(!j){h.error("Please select a file to upload");return}if(p==="PKCS12"&&!l){h.error("Password is required for PKCS12 format");return}I(!0);const o=new FormData;o.append("file",j),o.append("format",p),l&&o.append("password",l);try{const C=await M.post("/api/v2/certificates/import",o,{headers:{"Content-Type":"multipart/form-data"}});h.success("CA imported successfully"),u(null),c("PEM"),x(""),N(null),E(null),i&&i(C),f()}catch(C){h.error(`Import failed: ${C.message||"Unknown error"}`)}finally{I(!1)}},R=()=>{m||(u(null),c("PEM"),x(""),N(null),E(null),f())},A={PEM:".pem,.crt,.cer",DER:".der,.cer",PKCS12:".p12,.pfx"};return e.jsx(F,{isOpen:S,onClose:R,title:"Import Certificate Authority",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"default",onClick:R,disabled:m,children:"Cancel"}),e.jsx(w,{variant:"primary",onClick:P,disabled:!j||m||!!b,children:m?"Importing...":"Import CA"})]}),children:e.jsxs("div",{className:n.form,children:[e.jsxs("div",{className:n.fieldGroup,children:[e.jsx("label",{className:n.label,children:"Certificate Format"}),e.jsx("div",{className:n.formatSelector,children:["PEM","DER","PKCS12"].map(o=>e.jsxs("label",{className:n.formatOption,children:[e.jsx("input",{type:"radio",name:"format",value:o,checked:p===o,onChange:C=>{c(C.target.value),u(null),N(null)},disabled:m}),e.jsx("span",{className:n.formatLabel,children:o}),e.jsxs("span",{className:n.formatHint,children:[o==="PEM"&&"Base64 encoded, most common",o==="DER"&&"Binary format",o==="PKCS12"&&"Password protected bundle"]})]},o))})]}),e.jsxs("div",{className:n.fieldGroup,children:[e.jsx("label",{className:n.label,children:"Certificate File"}),e.jsx(V,{value:j,onChange:z,accept:A[p],maxSize:5*1024*1024,disabled:m,error:b})]}),p==="PKCS12"&&e.jsxs("div",{className:n.fieldGroup,children:[e.jsx("label",{className:n.label,children:"Password"}),e.jsx(g,{type:"password",value:l,onChange:o=>x(o.target.value),placeholder:"Enter PKCS12 password",disabled:m})]}),v&&e.jsxs("div",{className:n.preview,children:[e.jsx("h4",{className:n.previewTitle,children:"Certificate Preview"}),e.jsxs("div",{className:n.previewContent,children:[e.jsxs("div",{className:n.previewRow,children:[e.jsx("span",{className:n.previewLabel,children:"Type:"}),e.jsx("span",{className:n.previewValue,children:v.type})]}),e.jsxs("div",{className:n.previewRow,children:[e.jsx("span",{className:n.previewLabel,children:"Size:"}),e.jsxs("span",{className:n.previewValue,children:[v.size," bytes"]})]}),v.lines&&e.jsxs("div",{className:n.previewRow,children:[e.jsx("span",{className:n.previewLabel,children:"Lines:"}),e.jsx("span",{className:n.previewValue,children:v.lines})]})]})]}),e.jsx("div",{className:n.helpText,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The CA certificate will be validated and imported into the system. Make sure the file format matches the selected type."]})})]})})}const ie="_filtersSection_10a3w_2",ne="_filterGroup_10a3w_13",re="_tableContainer_10a3w_56",oe="_caNameCell_10a3w_99",ce="_caExpandBtn_10a3w_105",de="_collapsed_10a3w_124",he="_caExpandSpacer_10a3w_128",pe="_caTreeIndent_10a3w_135",xe="_caIcon_10a3w_163",me="_root_10a3w_168",ue="_intermediate_10a3w_172",je="_orphan_10a3w_176",Ce="_statusBadge_10a3w_181",fe="_actionsCell_10a3w_204",ve="_actionBtn_10a3w_209",Ne="_orphanedSection_10a3w_234",ye="_orphanedHeader_10a3w_242",ge="_orphanedHeaderText_10a3w_256",_e="_orphanedTable_10a3w_262",a={filtersSection:ie,filterGroup:ne,tableContainer:re,caNameCell:oe,caExpandBtn:ce,collapsed:de,caExpandSpacer:he,caTreeIndent:pe,caIcon:xe,root:me,intermediate:ue,orphan:je,statusBadge:Ce,actionsCell:fe,actionBtn:ve,orphanedSection:Ne,orphanedHeader:ye,orphanedHeaderText:ge,orphanedTable:_e};function Ge(){const[S,f]=d.useState("all"),[i,j]=d.useState("all"),[u,p]=d.useState("name"),[c,l]=d.useState(""),[x,b]=d.useState(new Set),[E,m]=d.useState(!1),[I,v]=d.useState(!1),{data:N,isLoading:z,error:P}=H(),R=K(),A=s=>{confirm(`Delete CA "${s.name}"? This cannot be undone.`)&&R.mutate(s.id,{onSuccess:()=>h.success("CA deleted"),onError:()=>h.error("Failed to delete CA")})},o=s=>{const r=new Set(x);r.has(s)?r.delete(s):r.add(s),b(r)},C=()=>{const s=[..._,...y];if(s.length===0){h.error("No data to export");return}Y(s,"cas-export",{format:"csv",columns:["id","name","type","status","issued","expires","certs"]}),h.success("CAs exported successfully")},B=()=>{h.success("CA imported successfully")};if(z)return e.jsxs("div",{className:a.caList,children:[e.jsx(G,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(D,{variant:"neutral",children:"Loading..."})}),Array.from({length:5}).map((s,r)=>e.jsx($,{width:"100%",height:80,style:{marginBottom:"12px"}},r))]});if(P)return e.jsxs("div",{className:a.caList,children:[e.jsx(G,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsx(D,{variant:"danger",children:"Error"})}),e.jsx(U,{error:P,shake:!0})]});const _=N?.roots||[],y=N?.orphans||[],k=[..._,...y].filter(s=>s.status==="Active").length;return e.jsxs("div",{className:a.caList,children:[e.jsx(G,{icon:"ph ph-bank",title:"Certificate Authorities",badge:e.jsxs(D,{variant:"success",children:[k," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(w,{icon:"ph ph-upload-simple",onClick:()=>v(!0),children:"Import"}),e.jsx(w,{icon:"ph ph-download-simple",onClick:C,children:"Export"}),e.jsx(w,{variant:"primary",icon:"ph ph-plus",onClick:()=>m(!0),children:"Create CA"})]})}),e.jsxs("div",{className:a.filtersSection,children:[e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"type-filter",children:"TYPE"}),e.jsxs("select",{id:"type-filter",value:S,onChange:s=>f(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"root",children:"Root"}),e.jsx("option",{value:"intermediate",children:"Intermediate"})]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"status-filter",children:"STATUS"}),e.jsxs("select",{id:"status-filter",value:i,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{htmlFor:"sort-filter",children:"SORT BY"}),e.jsxs("select",{id:"sort-filter",value:u,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued Date"}),e.jsx("option",{value:"expires",children:"Expires Date"})]})]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{className:a.filterGroup,children:e.jsx("input",{type:"text",id:"search-filter",placeholder:"Search CAs...",value:c,onChange:s=>l(s.target.value)})})]}),e.jsx("div",{className:a.tableContainer,children:_.length===0&&y.length===0?e.jsx(L,{icon:"ph ph-bank",title:"No Certificate Authorities",message:"Create your first Root CA to start issuing certificates",action:{label:"Create CA",onClick:()=>m(!0)}}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:_.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caNameCell,children:[s.children&&s.children.length>0?e.jsx("button",{className:`${a.caExpandBtn} ${x.has(s.id)?"":a.collapsed}`,onClick:()=>o(s.id),children:e.jsx("i",{className:"ph ph-caret-down"})}):e.jsx("span",{className:a.caExpandSpacer}),e.jsx("i",{className:`ph ph-bank ${a.caIcon} ${a.root}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:r=>{r.stopPropagation(),A(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id),s.children&&x.has(s.id)&&s.children.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caTreeIndent,children:[e.jsx("i",{className:`ph ph-git-branch ${a.caIcon} ${a.intermediate}`}),e.jsx("span",{children:r.name})]})}),e.jsx("td",{children:e.jsx("span",{children:r.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${r.status.toLowerCase()}`,children:r.status})}),e.jsx("td",{children:r.issued}),e.jsx("td",{children:r.expires}),e.jsx("td",{children:r.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:T=>{T.stopPropagation(),A(r)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},r.id))]}))})]})}),y.length>0&&_.length>0&&e.jsxs("div",{className:a.orphanedSection,children:[e.jsxs("div",{className:a.orphanedHeader,children:[e.jsx("i",{className:"ph ph-warning"}),e.jsx("span",{className:a.orphanedHeaderText,children:"Orphaned Intermediate CAs"})]}),e.jsx("div",{className:a.orphanedTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"35%"},children:"NAME"}),e.jsx("th",{style:{width:"15%"},children:"TYPE"}),e.jsx("th",{style:{width:"12%"},children:"STATUS"}),e.jsx("th",{style:{width:"12%"},children:"ISSUED"}),e.jsx("th",{style:{width:"12%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"8%"},children:"CERTS"}),e.jsx("th",{style:{width:"6%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:a.caNameCell,children:[e.jsx("i",{className:`ph ph-warning ${a.caIcon} ${a.orphan}`}),e.jsx("span",{children:s.name})]})}),e.jsx("td",{children:e.jsx("span",{children:s.type})}),e.jsx("td",{children:e.jsx("span",{className:`${a.statusBadge} ${s.status.toLowerCase()}`,children:s.status})}),e.jsx("td",{children:s.issued}),e.jsx("td",{children:s.expires}),e.jsx("td",{children:s.certs}),e.jsx("td",{children:e.jsxs("div",{className:a.actionsCell,children:[e.jsx("button",{className:a.actionBtn,title:"View",children:e.jsx("i",{className:"ph ph-eye"})}),e.jsx("button",{className:a.actionBtn,title:"Delete",onClick:r=>{r.stopPropagation(),A(s)},children:e.jsx("i",{className:"ph ph-trash"})})]})})]},s.id))})]})})]}),e.jsx(te,{isOpen:E,onClose:()=>m(!1)}),e.jsx(le,{isOpen:I,onClose:()=>v(!1),onSuccess:B})]})}export{Ge as CAList,Ge as default};
