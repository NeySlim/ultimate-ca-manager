import{b as E,r as d,j as e,B as l,C as r}from"./index-BFyg8tas.js";import{P as G}from"./PageTopBar-BfXcxdOD.js";import{S as O,T as N}from"./SectionTabs-CzMvshne.js";import{I as o}from"./Input-Cqaq8s2W.js";import{B as I}from"./Badge-l_m74PsE.js";import{D as L}from"./DataTable-C337Hppv.js";import{M as R}from"./Modal-YGRVblBg.js";import{u as T}from"./useMutation-B7H7Q_fh.js";import{n as K}from"./Check.es-WBEiEAvQ.js";import{c as D}from"./Warning.es-C8e3lKRB.js";function U(){return T({mutationFn:async i=>await E.post("/api/v2/import/opnsense/test",i)})}function Q(){return T({mutationFn:async i=>await E.post("/api/v2/import/opnsense/import",i)})}const V="_importPage_17krz_1",Y="_tabContent_17krz_6",$="_subMethods_17krz_12",q="_subMethod_17krz_12",X="_active_17krz_33",J="_subMethodTitle_17krz_49",Z="_form_17krz_58",W="_formGroup_17krz_64",ee="_formLabel_17krz_70",se="_formInput_17krz_78",te="_formTextarea_17krz_92",re="_formHelp_17krz_113",ae="_formCheckbox_17krz_118",s={importPage:V,tabContent:Y,subMethods:$,subMethod:q,active:X,subMethodTitle:J,form:Z,formGroup:W,formLabel:ee,formInput:se,formTextarea:te,formHelp:re,formCheckbox:ae};function fe(){const[i,m]=d.useState("ca"),[j,M]=d.useState(0),[u,S]=d.useState(0),[a,h]=d.useState({host:"",port:"443",api_key:"",api_secret:"",verify_ssl:!1}),[x,g]=d.useState([]),[P,A]=d.useState(null),[F,C]=d.useState(!1),[c,f]=d.useState([]),n=U(),b=Q(),w=async()=>{try{const t=await n.mutateAsync(a);t.success&&(g(t.items),A(`${a.host}:${a.port}`),f(t.items.map(p=>p.id)))}catch(t){console.error("Connection test failed:",t)}},B=async()=>{try{(await b.mutateAsync({...a,items:c})).success&&(C(!1),f([]),g([]),A(null))}catch(t){console.error("Import failed:",t)}},z=t=>{f(p=>p.includes(t)?p.filter(y=>y!==t):[...p,t])},H=[{key:"selected",label:"",render:t=>e.jsx("input",{type:"checkbox",checked:c.includes(t.id),onChange:()=>z(t.id)})},{key:"type",label:"Type",render:t=>e.jsx(I,{variant:t.type==="CA"?"info":"success",children:t.type})},{key:"name",label:"Name"},{key:"subject",label:"Subject",render:t=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"12px"},children:t.subject})},{key:"validUntil",label:"Valid Until"}],k=(t,p,y)=>e.jsx("div",{className:s.subMethods,children:t.map((_,v)=>e.jsxs("div",{className:`${s.subMethod} ${p===v?s.active:""}`,onClick:()=>y(v),children:[e.jsx("i",{className:_.icon}),e.jsx("div",{className:s.subMethodTitle,children:_.title})]},v))});return e.jsxs("div",{className:s.importPage,children:[e.jsx(G,{icon:"ph ph-upload",title:"Import",badge:e.jsx(I,{variant:"info",children:"Multiple Formats"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"ph ph-question",children:"Help"}),e.jsx(l,{variant:"primary",icon:"ph ph-upload-simple",children:"Upload Files"})]})}),e.jsxs(O,{children:[e.jsx(N,{active:i==="ca",onClick:()=>m("ca"),children:"CA Import"}),e.jsx(N,{active:i==="cert",onClick:()=>m("cert"),children:"Certificate Import"}),e.jsx(N,{active:i==="opnsense",onClick:()=>m("opnsense"),children:"OPNsense Import"})]}),i==="ca"&&e.jsxs("div",{className:s.tabContent,children:[k([{icon:"ph ph-clipboard-text",title:"Paste PEM"},{icon:"ph ph-upload",title:"Upload Files"},{icon:"ph ph-package",title:"Container P12/PFX"}],j,M),j===0&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Paste PEM Encoded CA"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"CA Certificate (PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
...
-----END CERTIFICATE-----`}),e.jsx("div",{className:s.formHelp,children:"Paste the PEM-encoded CA certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key (Optional, PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC7VJ...
-----END PRIVATE KEY-----`}),e.jsx("div",{className:s.formHelp,children:"Only required if this CA will issue certificates"})]}),e.jsx(o,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust"}),e.jsx("label",{htmlFor:"ca-trust",children:"Add to Trust Store"})]}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]}),j===1&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Upload CA Files"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"CA Certificate File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt,.cer"}),e.jsx("div",{className:s.formHelp,children:"Upload PEM or DER encoded certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key File (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.key"}),e.jsx("div",{className:s.formHelp,children:"Only required if this CA will issue certificates"})]}),e.jsx(o,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust-upload"}),e.jsx("label",{htmlFor:"ca-trust-upload",children:"Add to Trust Store"})]}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]}),j===2&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Import from P12/PFX Container"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"P12/PFX File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".p12,.pfx"}),e.jsx("div",{className:s.formHelp,children:"PKCS#12 container with CA certificate and private key"})]}),e.jsx(o,{label:"Container Password",type:"password",placeholder:"Enter password"}),e.jsx(o,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust-p12"}),e.jsx("label",{htmlFor:"ca-trust-p12",children:"Add to Trust Store"})]}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]})]}),i==="cert"&&e.jsxs("div",{className:s.tabContent,children:[k([{icon:"ph ph-clipboard-text",title:"Paste PEM"},{icon:"ph ph-upload",title:"Upload Files"},{icon:"ph ph-package",title:"Container"}],u,S),u===0&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Paste PEM Encoded Certificate"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate (PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN CERTIFICATE-----
...`})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key (Optional, PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN PRIVATE KEY-----
...`})]}),e.jsx(o,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]}),u===1&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Upload Certificate Files"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt,.cer"}),e.jsx("div",{className:s.formHelp,children:"Upload PEM or DER encoded certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key File (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.key"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate Chain (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt"}),e.jsx("div",{className:s.formHelp,children:"Intermediate certificates"})]}),e.jsx(o,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]}),u===2&&e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"Import from Container"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"P12/PFX File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".p12,.pfx"}),e.jsx("div",{className:s.formHelp,children:"PKCS#12 container with certificate and private key"})]}),e.jsx(o,{label:"Container Password",type:"password",placeholder:"Enter password"}),e.jsx(o,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]})]}),i==="opnsense"&&e.jsxs("div",{className:s.tabContent,children:[e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx("h3",{children:"OPNsense Connection"})}),e.jsx(r.Body,{children:e.jsxs("form",{className:s.form,onSubmit:t=>{t.preventDefault(),w()},children:[e.jsx(o,{label:"Host",placeholder:"192.168.1.1",value:a.host,onChange:t=>h({...a,host:t.target.value})}),e.jsx(o,{label:"Port",type:"number",placeholder:"443",value:a.port,onChange:t=>h({...a,port:t.target.value})}),e.jsx(o,{label:"API Key",placeholder:"Enter API key",value:a.api_key,onChange:t=>h({...a,api_key:t.target.value})}),e.jsx(o,{label:"API Secret",type:"password",placeholder:"Enter API secret",value:a.api_secret,onChange:t=>h({...a,api_secret:t.target.value})}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"verify-ssl",checked:a.verify_ssl,onChange:t=>h({...a,verify_ssl:t.target.checked})}),e.jsx("label",{htmlFor:"verify-ssl",children:"Verify SSL Certificate"})]}),e.jsx(l,{type:"submit",variant:"primary",icon:"ph ph-plug",disabled:n.isPending,children:n.isPending?"Testing...":"Test Connection"}),n.isError&&e.jsxs("div",{style:{color:"var(--status-danger)",fontSize:"13px",marginTop:"8px"},children:[e.jsx(D,{size:16})," ",n.error?.response?.data?.error||"Connection failed"]}),n.isSuccess&&n.data?.success&&e.jsxs("div",{style:{color:"var(--status-success)",fontSize:"13px",marginTop:"8px"},children:[e.jsx(K,{size:16})," Connected! Found ",n.data.stats.cas," CAs and ",n.data.stats.certificates," certificates"]})]})})]}),x.length>0&&e.jsxs(r,{children:[e.jsxs(r.Header,{children:[e.jsx("h3",{children:"Available Items"}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-tertiary)"},children:["Connected to ",P," â€¢ ",c.length," of ",x.length," selected"]})]}),e.jsxs(r.Body,{children:[e.jsx(L,{columns:H,data:x,pageSize:10}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:[e.jsxs(l,{variant:"primary",icon:"ph ph-download-simple",disabled:c.length===0,onClick:()=>C(!0),children:["Import Selected (",c.length,")"]}),e.jsx(l,{onClick:()=>f(x.map(t=>t.id)),children:"Select All"}),e.jsx(l,{onClick:()=>f([]),children:"Deselect All"})]})]})]})]}),e.jsxs(R,{isOpen:F,onClose:()=>C(!1),title:"Confirm Import",footer:e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(l,{variant:"primary",onClick:B,disabled:b.isPending,children:b.isPending?"Importing...":`Import ${c.length} Items`})]}),children:[e.jsxs("p",{children:["You are about to import ",c.length," items from OPNsense (",P,"):"]}),e.jsx("ul",{style:{marginTop:"12px",paddingLeft:"20px"},children:x.filter(t=>c.includes(t.id)).map(t=>e.jsxs("li",{style:{marginBottom:"4px"},children:[e.jsx(I,{variant:t.type==="CA"?"info":"success",children:t.type})," ",t.name]},t.id))}),e.jsx("p",{style:{marginTop:"12px",color:"var(--text-tertiary)",fontSize:"12px"},children:"This action will add these items to your UCM trust store."})]})]})}export{fe as ImportPage,fe as default};
