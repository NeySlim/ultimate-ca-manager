import{u as v}from"./useQuery-UtDf8O_D.js";import{d as n,v as u}from"./index-BF_YdiPX.js";import{u as p}from"./useMutation-DxcS9g0U.js";const l={getAll:async(e={})=>{const t=await n.get("/api/v2/certificates",{params:e}),i=(t.data||[]).map(s=>{const d=new Date(s.valid_to),r=Math.ceil((d-new Date)/(1e3*60*60*24));let o="ACTIVE";s.revoked?o="REVOKED":r<0?o="EXPIRED":r<=7?o="CRITICAL":r<=30&&(o="EXPIRING SOON");const c=s.subject?.match(/CN=([^,]+)/),f=c?c[1]:s.subject||"Unnamed Certificate",y=s.subject?.includes("Server")?"Server":"Client";return{id:s.id,name:f,serial:s.serial||"N/A",type:y,issuer:s.issuer||"Unknown",status:o,issued:s.valid_from?s.valid_from.split("T")[0]:"N/A",expires:s.valid_to?s.valid_to.split("T")[0]:"N/A",daysLeft:r>0?r:0,_raw:s}});return{data:i,meta:t.meta||{page:1,per_page:20,total:i.length}}},getById:async e=>(await n.get(`/api/v2/certificates/${e}`)).data,revoke:async(e,t)=>(await n.post(`/api/v2/certificates/${e}/revoke`,{reason:t})).data,renew:async e=>(await n.post(`/api/v2/certificates/${e}/renew`)).data,download:async(e,t="pem")=>await n.get(`/api/v2/certificates/${e}/download`,{params:{format:t},responseType:"blob"}),issue:async e=>(await n.post("/api/v2/certificates",e)).data},a={all:["certificates"],lists:()=>[...a.all,"list"],list:e=>[...a.lists(),e],details:()=>[...a.all,"detail"],detail:e=>[...a.details(),e]},A=(e={})=>v({queryKey:a.list(e),queryFn:()=>l.getAll(e)}),I=()=>{const e=u();return p({mutationFn:({id:t,reason:i})=>l.revoke(t,i),onSuccess:()=>{e.invalidateQueries({queryKey:a.all})}})},_=()=>{const e=u();return p({mutationFn:l.issue,onSuccess:()=>{e.invalidateQueries({queryKey:a.all})}})};export{_ as a,I as b,A as u};
