import{r as u,j as e,B as S,z as p}from"./index-BF_YdiPX.js";import{P as E}from"./PageTopBar--BadjI2C.js";import{F as G,a as z}from"./FiltersBar-JLAC5kZr.js";import{P as F,a as j}from"./PillFilter-DBAJirHc.js";import{B as o}from"./Badge-CBeR2bmS.js";import{a as L,E as $}from"./ErrorState-DjUcTYZG.js";import{a as M,u as O,b as K}from"./useCertificates-Dnt8OMvr.js";import{M as A}from"./Modal-B1nLQeDt.js";import{I as v}from"./Input-BImw--cY.js";import{S as U}from"./SuccessAnimation-4if0_x5k.js";import{u as W}from"./useCAs-CvngTJQZ.js";import{s as C,F as q}from"./ImportCAModal.module-BosjkRbJ.js";import{e as H}from"./export-BEFxFx9V.js";import"./useQuery-UtDf8O_D.js";import"./useMutation-DxcS9g0U.js";import"./X.es-D65hcxyn.js";import"./with-selector-BDXxVxe0.js";import"./index-CvQLL3eC.js";import"./UploadSimple.es-CG18txE7.js";const Y="_form_pko5h_1",V="_section_pko5h_7",X="_sectionTitle_pko5h_13",J="_fieldGroup_pko5h_22",Q="_fieldRow_pko5h_29",Z="_label_pko5h_35",ee="_fieldHint_pko5h_43",se="_select_pko5h_49",ae="_checkboxGroup_pko5h_75",ie="_checkbox_pko5h_75",s={form:Y,section:V,sectionTitle:X,fieldGroup:J,fieldRow:Q,label:Z,fieldHint:ee,select:se,checkboxGroup:ae,checkbox:ie};function te({isOpen:y,onClose:d}){const[x,h]=u.useState(!1),[a,f]=u.useState({ca_id:"",common_name:"",organization:"",organizational_unit:"",country:"",state:"",locality:"",san:"",validity_days:"365",key_size:"2048",key_usage:["digitalSignature","keyEncipherment"]}),g=M(),{data:k,isLoading:_}=W(),c=k?.data||[];u.useEffect(()=>{c.length>0&&!a.ca_id&&f(i=>({...i,ca_id:c[0].id.toString()}))},[c,a.ca_id]);const b=i=>{if(i.preventDefault(),!a.ca_id){p.error("Please select a Certificate Authority");return}if(!a.common_name){p.error("Common Name is required");return}const m={ca_id:parseInt(a.ca_id),common_name:a.common_name,organization:a.organization,organizational_unit:a.organizational_unit,country:a.country,state:a.state,locality:a.locality,san:a.san,validity_days:parseInt(a.validity_days),key_size:parseInt(a.key_size),key_usage:a.key_usage};g.mutate(m,{onSuccess:()=>{h(!0),p.success("Certificate issued successfully"),setTimeout(()=>{d(),h(!1),w()},2e3)},onError:N=>{p.error(`Failed to issue certificate: ${N.message}`)}})},w=()=>{f({ca_id:c.length>0?c[0].id.toString():"",common_name:"",organization:"",organizational_unit:"",country:"",state:"",locality:"",san:"",validity_days:"365",key_size:"2048",key_usage:["digitalSignature","keyEncipherment"]})},l=(i,m)=>{f(N=>({...N,[i]:m}))},r=i=>{f(m=>({...m,key_usage:m.key_usage.includes(i)?m.key_usage.filter(N=>N!==i):[...m.key_usage,i]}))};return e.jsxs(A,{isOpen:y,onClose:d,title:"Issue Certificate",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"default",onClick:d,children:"Cancel"}),e.jsx(S,{variant:"primary",onClick:b,disabled:g.isPending,children:g.isPending?"Issuing...":"Issue Certificate"})]}),children:[e.jsxs("form",{className:s.form,onSubmit:b,children:[e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Certificate Authority *"}),e.jsx("select",{className:s.select,value:a.ca_id,onChange:i=>l("ca_id",i.target.value),disabled:_,children:_?e.jsx("option",{children:"Loading CAs..."}):c.length===0?e.jsx("option",{children:"No CAs available"}):c.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Subject Information"}),e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Common Name (CN) *"}),e.jsx(v,{value:a.common_name,onChange:i=>l("common_name",i.target.value),placeholder:"example.com",required:!0})]}),e.jsxs("div",{className:s.fieldRow,children:[e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Organization (O)"}),e.jsx(v,{value:a.organization,onChange:i=>l("organization",i.target.value),placeholder:"My Company"})]}),e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Organizational Unit (OU)"}),e.jsx(v,{value:a.organizational_unit,onChange:i=>l("organizational_unit",i.target.value),placeholder:"IT Department"})]})]}),e.jsxs("div",{className:s.fieldRow,children:[e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Country (C)"}),e.jsx(v,{value:a.country,onChange:i=>l("country",i.target.value),placeholder:"US",maxLength:2})]}),e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"State/Province (ST)"}),e.jsx(v,{value:a.state,onChange:i=>l("state",i.target.value),placeholder:"California"})]}),e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"City/Locality (L)"}),e.jsx(v,{value:a.locality,onChange:i=>l("locality",i.target.value),placeholder:"San Francisco"})]})]}),e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Subject Alternative Names (SAN)"}),e.jsx(v,{value:a.san,onChange:i=>l("san",i.target.value),placeholder:"DNS:example.com, DNS:*.example.com, IP:192.168.1.1"}),e.jsx("span",{className:s.fieldHint,children:"Comma-separated list (e.g., DNS:example.com, IP:192.168.1.1)"})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Settings"}),e.jsxs("div",{className:s.fieldRow,children:[e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Validity (days)"}),e.jsx(v,{type:"number",value:a.validity_days,onChange:i=>l("validity_days",i.target.value),min:"1",max:"36500"})]}),e.jsxs("div",{className:s.fieldGroup,children:[e.jsx("label",{className:s.label,children:"Key Size (bits)"}),e.jsxs("select",{className:s.select,value:a.key_size,onChange:i=>l("key_size",i.target.value),children:[e.jsx("option",{value:"2048",children:"2048"}),e.jsx("option",{value:"4096",children:"4096"})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Key Usage"}),e.jsxs("div",{className:s.checkboxGroup,children:[e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.key_usage.includes("digitalSignature"),onChange:()=>r("digitalSignature")}),e.jsx("span",{children:"Digital Signature"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.key_usage.includes("keyEncipherment"),onChange:()=>r("keyEncipherment")}),e.jsx("span",{children:"Key Encipherment"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.key_usage.includes("dataEncipherment"),onChange:()=>r("dataEncipherment")}),e.jsx("span",{children:"Data Encipherment"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.key_usage.includes("keyAgreement"),onChange:()=>r("keyAgreement")}),e.jsx("span",{children:"Key Agreement"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.key_usage.includes("keyCertSign"),onChange:()=>r("keyCertSign")}),e.jsx("span",{children:"Certificate Signing"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.key_usage.includes("crlSign"),onChange:()=>r("crlSign")}),e.jsx("span",{children:"CRL Signing"})]})]})]})]}),x&&e.jsx(U,{message:"Certificate Issued!",onComplete:()=>h(!1)})]})}function ne({isOpen:y,onClose:d}){const[x,h]=u.useState(null),[a,f]=u.useState("pem"),[g,k]=u.useState(""),[_,c]=u.useState(!1),b=async l=>{if(l.preventDefault(),!x){p.error("Please select a file to import");return}if(a==="pkcs12"&&!g){p.error("Password is required for PKCS#12 files");return}c(!0);try{const r=new FormData;r.append("file",x),r.append("format",a),g&&r.append("password",g);const i=await fetch("/api/v2/certificates/import",{method:"POST",body:r});if(!i.ok){const m=await i.json();throw new Error(m.message||"Failed to import certificate")}p.success("Certificate imported successfully"),d(),h(null),k(""),f("pem"),window.location.reload()}catch(r){p.error(r.message||"Failed to import certificate")}finally{c(!1)}},w=e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"secondary",onClick:d,disabled:_,children:"Cancel"}),e.jsx(S,{variant:"primary",onClick:b,disabled:_,children:_?"Importing...":"Import Certificate"})]});return e.jsx(A,{isOpen:y,onClose:d,title:"Import Certificate",size:"md",footer:w,children:e.jsxs("form",{onSubmit:b,className:C.form,children:[e.jsxs("div",{className:C.section,children:[e.jsx("label",{className:C.label,children:"Certificate Format"}),e.jsxs("select",{value:a,onChange:l=>f(l.target.value),className:C.select,children:[e.jsx("option",{value:"pem",children:"PEM (Base64 encoded)"}),e.jsx("option",{value:"der",children:"DER (Binary)"}),e.jsx("option",{value:"pkcs12",children:"PKCS#12 (.p12, .pfx)"})]})]}),e.jsx(q,{file:x,onFileChange:h,accept:".pem,.crt,.cer,.der,.p12,.pfx",maxSize:10*1024*1024}),a==="pkcs12"&&e.jsxs("div",{className:C.section,children:[e.jsx("label",{className:C.label,children:"PKCS#12 Password"}),e.jsx("input",{type:"password",value:g,onChange:l=>k(l.target.value),className:C.input,placeholder:"Enter PKCS#12 password"}),e.jsx("p",{className:C.helpText,children:"Required to decrypt PKCS#12 files"})]})]})})}const le="_tableContainer_2f75z_2",re="_certNameCell_2f75z_45",ce="_certName_2f75z_45",oe="_certSerial_2f75z_56",de="_badgeType_2f75z_63",he="_badgeInfo_2f75z_74",me="_badgeNeutral_2f75z_79",ue="_badgeStatus_2f75z_84",pe="_badgeSuccess_2f75z_95",xe="_badgeWarning_2f75z_100",ge="_badgeError_2f75z_105",fe="_expiresCell_2f75z_111",je="_badgeDays_2f75z_117",ye="_actionsCell_2f75z_130",_e="_actionBtn_2f75z_135",n={tableContainer:le,certNameCell:re,certName:ce,certSerial:oe,badgeType:de,badgeInfo:he,badgeNeutral:me,badgeStatus:ue,badgeSuccess:pe,badgeWarning:xe,badgeError:ge,expiresCell:fe,badgeDays:je,actionsCell:ye,actionBtn:_e};function $e(){const[y,d]=u.useState("all"),[x,h]=u.useState("all"),[a,f]=u.useState("name"),[g,k]=u.useState(!1),[_,c]=u.useState(!1),{data:b,isLoading:w,error:l}=O(),{mutate:r}=K(),i=t=>{window.confirm(`Revoke certificate ${t.name}?`)&&r({id:t.id,reason:"Revoked by administrator"},{onSuccess:()=>p.success(`Certificate ${t.name} revoked successfully`),onError:I=>p.error(`Failed to revoke certificate: ${I.message}`)})},m=()=>{const t=b?.data||[];if(t.length===0){p.error("No data to export");return}H(t,"certificates-export",{format:"csv",columns:["id","name","type","status","issuedBy","daysLeft","issued","expires"]}),p.success("Certificates exported successfully")},N=t=>{window.open(`/api/v2/certificates/${t.id}/download`,"_blank")},P=t=>t<=7?n.badgeError:t<=30?n.badgeWarning:n.badgeSuccess,R=t=>t==="CRITICAL"?n.badgeError:t==="EXPIRING SOON"?n.badgeWarning:n.badgeSuccess,D=t=>t==="Server"||t==="Client"?n.badgeInfo:n.badgeNeutral;if(w)return e.jsxs("div",{className:n.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(o,{variant:"neutral",children:"Loading..."})}),Array.from({length:8}).map((t,I)=>e.jsx(L,{width:"100%",height:60,style:{marginBottom:"8px"}},I))]});if(l)return e.jsxs("div",{className:n.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(o,{variant:"danger",children:"Error"})}),e.jsx($,{error:l,shake:!0})]});if(l)return e.jsxs("div",{className:n.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsx(o,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading certificates: ",l.message]})]});const T=b?.data||[],B=T.filter(t=>t.status==="ACTIVE").length;return e.jsxs("div",{className:n.certificateList,children:[e.jsx(E,{icon:"ph ph-certificate",title:"Certificates",badge:e.jsxs(o,{variant:"success",children:[B," Active"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:"ph ph-upload-simple",onClick:()=>c(!0),children:"Import"}),e.jsx(S,{icon:"ph ph-download-simple",onClick:m,children:"Export"}),e.jsx(S,{variant:"primary",icon:"ph ph-file-plus",onClick:()=>k(!0),children:"Issue Certificate"})]})}),e.jsxs(G,{children:[e.jsx(z,{label:"TYPE",children:e.jsxs(F,{children:[e.jsxs(j,{active:y==="all",onClick:()=>d("all"),children:["All ",e.jsx(o,{variant:"secondary",children:"(247)"})]}),e.jsxs(j,{active:y==="server",onClick:()=>d("server"),children:["Server ",e.jsx(o,{variant:"secondary",children:"(89)"})]}),e.jsxs(j,{active:y==="client",onClick:()=>d("client"),children:["Client ",e.jsx(o,{variant:"secondary",children:"(158)"})]}),e.jsxs(j,{active:y==="acme",onClick:()=>d("acme"),children:["ACME ",e.jsx(o,{variant:"secondary",children:"(34)"})]})]})}),e.jsx(z,{label:"STATUS",children:e.jsxs(F,{children:[e.jsxs(j,{active:x==="all",onClick:()=>h("all"),children:["All ",e.jsx(o,{variant:"secondary",children:"(247)"})]}),e.jsxs(j,{active:x==="active",onClick:()=>h("active"),children:["Active ",e.jsx(o,{variant:"secondary",children:"(235)"})]}),e.jsxs(j,{active:x==="expiring",onClick:()=>h("expiring"),children:["Expiring ",e.jsx(o,{variant:"secondary",children:"(12)"})]}),e.jsxs(j,{active:x==="expired",onClick:()=>h("expired"),children:["Expired ",e.jsx(o,{variant:"secondary",children:"(0)"})]}),e.jsxs(j,{active:x==="revoked",onClick:()=>h("revoked"),children:["Revoked ",e.jsx(o,{variant:"secondary",children:"(0)"})]})]})}),e.jsx(z,{label:"SORT",children:e.jsxs("select",{value:a,onChange:t=>f(t.target.value),children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"expires",children:"Expires"})]})})]}),e.jsx("div",{className:n.tableContainer,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"CERTIFICATE"}),e.jsx("th",{style:{width:"10%"},children:"TYPE"}),e.jsx("th",{style:{width:"15%"},children:"ISSUER"}),e.jsx("th",{style:{width:"10%"},children:"STATUS"}),e.jsx("th",{style:{width:"10%"},children:"ISSUED"}),e.jsx("th",{style:{width:"10%"},children:"EXPIRES"}),e.jsx("th",{style:{width:"5%"},children:"ACTIONS"})]})}),e.jsx("tbody",{children:T.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:n.certNameCell,children:[e.jsx("span",{className:n.certName,children:t.name}),e.jsxs("span",{className:n.certSerial,children:["Serial: ",t.serial]})]})}),e.jsx("td",{children:e.jsx("span",{className:`${n.badgeType} ${D(t.type)}`,children:t.type})}),e.jsx("td",{children:t.issuer}),e.jsx("td",{children:e.jsx("span",{className:`${n.badgeStatus} ${R(t.status)}`,children:t.status})}),e.jsx("td",{children:t.issued}),e.jsx("td",{children:e.jsxs("div",{className:n.expiresCell,children:[e.jsx("span",{children:t.expires}),e.jsxs("span",{className:`${n.badgeDays} ${P(t.daysLeft)}`,children:[t.daysLeft," DAYS"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:n.actionsCell,children:[e.jsx("button",{className:n.actionBtn,title:"Download",onClick:()=>N(t),children:e.jsx("i",{className:"ph ph-download-simple"})}),e.jsx("button",{className:n.actionBtn,title:"Revoke",onClick:()=>i(t),children:e.jsx("i",{className:"ph ph-x-circle"})}),e.jsx("button",{className:n.actionBtn,title:"More",children:e.jsx("i",{className:"ph ph-dots-three-outline-vertical"})})]})})]},t.id))})]})}),e.jsx(te,{isOpen:g,onClose:()=>k(!1)}),e.jsx(ne,{isOpen:_,onClose:()=>c(!1)})]})}export{$e as CertificateList,$e as default};
