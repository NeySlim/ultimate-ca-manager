import{b as u,d as v,r as T,j as e,B as i,z as l,C as d}from"./index-DVlxmEMH.js";import{P as b}from"./PageTopBar-BGEfcvkC.js";import{S as D,a as h}from"./StatsGrid-BuG0NsMj.js";import{S as B,T as y}from"./SectionTabs-HipqSL7Y.js";import{D as w}from"./DataTable-BMsARtZL.js";import{S as I}from"./SearchToolbar-CAKs2t-P.js";import{B as j}from"./Badge-DyfSXXcj.js";import{I as m}from"./Input-Bz5wSsMw.js";import{g as F}from"./getBadgeVariant-SNrdtPAh.js";import{u as C}from"./useQuery-DUfn4_lf.js";import{u as _}from"./useMutation-cXabW4WB.js";const f={getSettings:async()=>(await u.get("/api/v2/scep/config")).data,getStats:async()=>{const o=(await u.get("/api/v2/scep/requests")).data||[],x=o.filter(r=>r.status==="pending").length,p=o.filter(r=>r.status==="approved").length,g=o.filter(r=>r.status==="rejected").length;return{total_requests:o.length,pending:x,approved:p,rejected:g,total_enrollments:p}},approveRequest:async t=>(await u.post(`/api/v2/scep/${t}/approve`)).data,rejectRequest:async t=>(await u.post(`/api/v2/scep/${t}/reject`)).data},c={all:["scep"],settings:()=>[...c.all,"settings"],stats:()=>[...c.all,"stats"],requests:t=>[...c.all,"requests",t]},L=()=>C({queryKey:c.settings(),queryFn:f.getSettings}),O=()=>C({queryKey:c.stats(),queryFn:f.getStats}),G=()=>{const t=v();return _({mutationFn:f.approveRequest,onSuccess:()=>{t.invalidateQueries({queryKey:c.all})}})},K=()=>{const t=v();return _({mutationFn:f.rejectRequest,onSuccess:()=>{t.invalidateQueries({queryKey:c.all})}})},Q="_scepDashboard_rp4o0_3",$="_tabContent_rp4o0_8",V="_form_rp4o0_14",z="_checkboxGroup_rp4o0_21",H="_checkbox_rp4o0_21",M="_formActions_rp4o0_42",U="_actions_rp4o0_48",J="_statusBadge_rp4o0_53",W="_statusDot_rp4o0_67",X="_infoBox_rp4o0_78",Y="_infoContent_rp4o0_82",Z="_infoIcon_rp4o0_87",ee="_infoTitle_rp4o0_100",se="_infoText_rp4o0_107",s={scepDashboard:Q,tabContent:$,form:V,checkboxGroup:z,checkbox:H,formActions:M,actions:U,statusBadge:J,statusDot:W,infoBox:X,infoContent:Y,infoIcon:Z,infoTitle:ee,infoText:se};function he(){const[t,o]=T.useState("config"),{data:x,isLoading:p}=L(),{data:g,isLoading:r}=O(),S=G(),k=K(),E=v(),A=p||r,a={config:x||{},stats:g||{},enrollments:[]},q=[{key:"deviceId",label:"Device ID",sortable:!0},{key:"commonName",label:"Common Name",sortable:!0},{key:"status",label:"Status",sortable:!0,render:n=>e.jsx(j,{variant:F("scep-status",n.status),children:n.status})},{key:"requestedAt",label:"Requested At",sortable:!0},{key:"approvedAt",label:"Approved At",render:n=>n.approvedAt||e.jsx("span",{style:{color:"var(--text-tertiary)"},children:"â€”"})},{key:"actions",label:"Actions",render:n=>n.status==="pending"?e.jsxs("div",{className:s.actions,children:[e.jsx(i,{variant:"success",icon:"ph ph-check",onClick:()=>{confirm(`Approve enrollment for ${n.deviceId}?`)&&S.mutate(n.id,{onSuccess:()=>l.success("Enrollment approved"),onError:()=>l.error("Failed to approve")})},children:"Approve"}),e.jsx(i,{variant:"danger",icon:"ph ph-x",onClick:()=>{confirm(`Reject enrollment for ${n.deviceId}?`)&&k.mutate(n.id,{onSuccess:()=>l.success("Enrollment rejected"),onError:()=>l.error("Failed to reject")})},children:"Reject"})]}):null}],P=[{label:"Status",options:["All Statuses","Pending","Completed","Rejected"]}],N=[{label:"Export List",icon:"ph ph-download-simple",variant:"default"}];return A?e.jsxs("div",{className:s.scepDashboard,children:[e.jsx(b,{icon:"ph ph-device-mobile",title:"SCEP",badge:e.jsx(j,{variant:"secondary",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-tertiary)"},children:"Loading SCEP data..."})]}):e.jsxs("div",{className:s.scepDashboard,children:[e.jsx(b,{icon:"ph ph-device-mobile",title:"SCEP",badge:e.jsx(j,{variant:a.config.enabled?"success":"secondary",children:a.config.enabled?"Enabled":"Disabled"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:"ph ph-arrows-clockwise",onClick:()=>{E.invalidateQueries(["scep"]),l.success("SCEP data refreshed")},children:"Refresh"}),e.jsx(i,{variant:"primary",icon:"ph ph-gear",children:"Configure"})]})}),e.jsxs(D,{columns:4,children:[e.jsx(h,{value:a.stats.total_enrollments||0,label:"Total Enrollments",icon:"ph ph-certificate"}),e.jsx(h,{value:a.stats.pending||0,label:"Pending Approvals",icon:"ph ph-clock"}),e.jsx(h,{value:a.stats.approved||0,label:"Completed Today",icon:"ph ph-check-circle"}),e.jsx(h,{value:a.stats.rejected||0,label:"Rejected Today",icon:"ph ph-x-circle"})]}),e.jsxs(B,{children:[e.jsx(y,{active:t==="config",onClick:()=>o("config"),children:"Configuration"}),e.jsx(y,{active:t==="enrollments",onClick:()=>o("enrollments"),children:"Enrollments"})]}),t==="config"&&e.jsxs("div",{className:s.tabContent,children:[e.jsxs(d,{children:[e.jsxs(d.Header,{children:[e.jsx("h3",{children:"SCEP Server Configuration"}),e.jsxs("div",{className:s.statusBadge,children:[e.jsx("span",{className:s.statusDot,"data-status":a.config.enabled?"enabled":"disabled"}),e.jsx("span",{children:a.config.enabled?"Enabled":"Disabled"})]})]}),e.jsx(d.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsx(m,{label:"SCEP URL",value:a.config.url,readOnly:!0}),e.jsx(m,{label:"CA Identifier",value:a.config.caIdentifier,readOnly:!0}),e.jsx(m,{label:"Challenge Password",type:"password",value:a.config.challengePassword,readOnly:!0}),e.jsx(m,{label:"Certificate Validity (days)",value:a.config.certificateValidity,readOnly:!0}),e.jsxs("div",{className:s.checkboxGroup,children:[e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.config.allowRenewal,readOnly:!0}),e.jsx("span",{children:"Allow Certificate Renewal"})]}),e.jsxs("label",{className:s.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a.config.autoApprove,readOnly:!0}),e.jsx("span",{children:"Auto-Approve Enrollments"})]})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx(i,{variant:"primary",icon:"ph ph-floppy-disk",children:"Save Configuration"}),e.jsx(i,{variant:"default",icon:"ph ph-arrow-clockwise",children:"Reset"})]})]})})]}),e.jsx(d,{className:s.infoBox,children:e.jsx(d.Body,{children:e.jsxs("div",{className:s.infoContent,children:[e.jsx("div",{className:s.infoIcon,children:e.jsx("i",{className:"ph ph-info"})}),e.jsxs("div",{children:[e.jsx("div",{className:s.infoTitle,children:"SCEP Enrollment"}),e.jsx("div",{className:s.infoText,children:"SCEP (Simple Certificate Enrollment Protocol) allows devices to automatically request and receive certificates. Common use cases include mobile devices (iOS, Android) and network equipment."})]})]})})})]}),t==="enrollments"&&e.jsxs("div",{className:s.tabContent,children:[e.jsx(I,{placeholder:"Search enrollments...",filters:P,actions:N,onSearch:n=>console.log("Search:",n),onFilterChange:(n,R)=>console.log("Filter:",n,R)}),e.jsx(w,{columns:q,data:a.enrollments,onRowClick:n=>console.log("Enrollment clicked:",n)})]})]})}export{he as SCEPDashboard,he as default};
