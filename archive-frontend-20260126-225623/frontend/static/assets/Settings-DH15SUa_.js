import{j as e,b as g,d as P,z as n,r as C,B as m}from"./index-BTw3bRnG.js";import{B as z}from"./Badge-DyPH1hyB.js";import{P as B}from"./PageTopBar-Cv7ANMVQ.js";import{S as V,T as y}from"./SectionTabs-CzwOw_Fo.js";import{u as D}from"./useQuery-DLKUu21d.js";import{u as _}from"./useMutation-jqxeAUVx.js";const O="_formGroup_ny9z2_1",R="_label_ny9z2_8",E="_required_ny9z2_17",F="_input_ny9z2_22",A="_inputError_ny9z2_49",M="_errorMessage_ny9z2_58",l={formGroup:O,label:R,required:E,input:F,inputError:A,errorMessage:M},t=({label:a,id:i,name:h,type:N="text",value:x,onChange:j,placeholder:T,required:b=!1,disabled:S=!1,error:r,autoComplete:o,className:k,...G})=>{const d=i||`input-${h}`,f=`${d}-error`;return e.jsxs("div",{className:`${l.formGroup} ${k||""}`,children:[a&&e.jsxs("label",{htmlFor:d,className:l.label,children:[a,b&&e.jsx("span",{className:l.required,"aria-label":"required",children:"*"})]}),e.jsx("input",{id:d,name:h,type:N,value:x,onChange:j,placeholder:T,required:b,disabled:S,autoComplete:o,className:`${l.input} ${r?l.inputError:""}`,"aria-invalid":r?"true":"false","aria-describedby":r?f:void 0,...G}),r&&e.jsx("span",{id:f,className:l.errorMessage,role:"alert",children:r})]})},v={getGeneral:async()=>(await g.get("/api/v2/settings/general")).data,updateGeneral:async a=>(await g.patch("/api/v2/settings/general",a)).data,optimizeDatabase:async()=>(await g.post("/api/v2/system/db/optimize")).data,regenerateHttpsCert:async()=>(await g.post("/api/v2/system/https/regenerate")).data},c={all:["settings"],general:()=>[...c.all,"general"],users:()=>[...c.all,"users"],dbStats:()=>[...c.all,"db-stats"]},q=()=>D({queryKey:c.general(),queryFn:v.getGeneral}),W=()=>{const a=P();return _({mutationFn:v.updateGeneral,onSuccess:()=>{a.invalidateQueries({queryKey:c.general()}),n.success("Settings updated successfully")},onError:i=>{n.error(i.response?.data?.message||"Failed to update settings")}})},$=()=>{const a=P();return _({mutationFn:v.optimizeDatabase,onSuccess:()=>{a.invalidateQueries({queryKey:c.dbStats()}),n.success("Database optimized successfully")},onError:i=>{n.error(i.response?.data?.message||"Failed to optimize database")}})},H=()=>_({mutationFn:v.regenerateHttpsCert,onSuccess:()=>{n.success("HTTPS certificate regenerated. Service restart required.")},onError:a=>{n.error(a.response?.data?.message||"Failed to regenerate certificate")}}),I="_settings_rtspn_3",Q="_tabContent_rtspn_17",K="_tabPanel_rtspn_22",Y="_settingsSection_rtspn_29",J="_sectionTitle_rtspn_39",X="_formGroup_rtspn_48",Z="_inputWithUnit_rtspn_99",s={settings:I,tabContent:Q,tabPanel:K,settingsSection:Y,sectionTitle:J,formGroup:X,inputWithUnit:Z};function re(){const[a,i]=C.useState("system"),[h,N]=C.useState({}),[x,j]=C.useState(!1),{data:T,isLoading:b}=q(),{mutate:S}=W(),r=$(),o=H(),k=()=>{S(h,{onSuccess:()=>n.success("Settings saved successfully"),onError:u=>n.error(`Failed to save settings: ${u.message}`)})},G=async()=>{j(!0);try{const u=await fetch("/api/v2/system/backup",{method:"POST",headers:{"Content-Type":"application/json"}});if(!u.ok)throw new Error("Backup failed");const L=await u.blob(),w=window.URL.createObjectURL(L),p=document.createElement("a");p.href=w,p.download=`ucm-backup-${new Date().toISOString().split("T")[0]}.zip`,document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(w),document.body.removeChild(p),n.success("Backup created successfully")}catch{n.error("Failed to create backup")}finally{j(!1)}},d=()=>{window.confirm("Are you sure you want to reset all settings to default?")&&(N({}),n.success("Settings reset to default"))},f=()=>{window.confirm("Optimize database? This may take a few moments.")&&r.mutate()},U=()=>{window.confirm("Regenerate self-signed HTTPS certificate? The service will need to be restarted.")&&o.mutate()};return b?e.jsxs("div",{className:s.settings,children:[e.jsx(B,{icon:"ph ph-gear",title:"Settings",badge:e.jsx(z,{variant:"secondary",children:"Loading..."})}),e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-tertiary)"},children:"Loading settings..."})]}):e.jsxs("div",{className:s.settings,children:[e.jsx(B,{icon:"ph ph-gear",title:"Settings",badge:e.jsx(z,{variant:"warning",children:"Requires Restart"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"default",onClick:d,children:"Reset All"}),e.jsx(m,{variant:"primary",icon:"ph ph-floppy-disk",onClick:k,children:"Save Changes"})]})}),e.jsxs(V,{children:[e.jsx(y,{active:a==="system",onClick:()=>i("system"),children:"System"}),e.jsx(y,{active:a==="database",onClick:()=>i("database"),children:"Database"}),e.jsx(y,{active:a==="security",onClick:()=>i("security"),children:"Security"}),e.jsx(y,{active:a==="backup",onClick:()=>i("backup"),children:"Backup"})]}),e.jsxs("div",{className:s.tabContent,children:[a==="system"&&e.jsxs("div",{className:s.tabPanel,children:[e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"General"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Application Name"}),e.jsx(t,{type:"text",defaultValue:"UCM - Certificate Manager"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Application URL"}),e.jsx(t,{type:"text",defaultValue:"https://netsuit.lan.pew.pet:8443"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Timezone"}),e.jsxs("select",{children:[e.jsx("option",{children:"UTC"}),e.jsx("option",{children:"Europe/Paris"}),e.jsx("option",{children:"America/New_York"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Language"}),e.jsxs("select",{children:[e.jsx("option",{children:"English"}),e.jsx("option",{children:"Fran√ßais"})]})]})]}),e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Session"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Session Timeout"}),e.jsxs("div",{className:s.inputWithUnit,children:[e.jsx(t,{type:"number",defaultValue:"30"}),e.jsx("span",{children:"minutes"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Max Concurrent Sessions"}),e.jsx(t,{type:"number",defaultValue:"5"})]})]}),e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Logging"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Log Level"}),e.jsxs("select",{children:[e.jsx("option",{children:"Debug"}),e.jsx("option",{children:"Info"}),e.jsx("option",{children:"Warning"}),e.jsx("option",{children:"Error"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Log Retention"}),e.jsxs("div",{className:s.inputWithUnit,children:[e.jsx(t,{type:"number",defaultValue:"90"}),e.jsx("span",{children:"days"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Enable Audit Log"}),e.jsx(t,{type:"checkbox",defaultChecked:!0})]})]})]}),a==="database"&&e.jsxs("div",{className:s.tabPanel,children:[e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Database Configuration"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Database Type"}),e.jsx(t,{type:"text",defaultValue:"SQLite",readOnly:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Database Path"}),e.jsx(t,{type:"text",defaultValue:"/var/lib/ucm/ucm.db",readOnly:!0})]})]}),e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Database Maintenance"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Database Size"}),e.jsx(t,{type:"text",defaultValue:"142.5 MB",readOnly:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Fragmentation"}),e.jsx(t,{type:"text",defaultValue:"3.2%",readOnly:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Last Optimization"}),e.jsx(t,{type:"text",defaultValue:"2024-03-15 02:00 UTC",readOnly:!0})]}),e.jsx("div",{className:s.formGroup,children:e.jsx(m,{variant:"primary",icon:"ph ph-broom",onClick:f,disabled:r.isPending,children:r.isPending?"Optimizing...":"Optimize Database"})})]})]}),a==="security"&&e.jsxs("div",{className:s.tabPanel,children:[e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Password Policy"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Minimum Length"}),e.jsx(t,{type:"number",defaultValue:"12"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Require Uppercase"}),e.jsx(t,{type:"checkbox",defaultChecked:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Require Numbers"}),e.jsx(t,{type:"checkbox",defaultChecked:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Password Expiration"}),e.jsxs("div",{className:s.inputWithUnit,children:[e.jsx(t,{type:"number",defaultValue:"90"}),e.jsx("span",{children:"days"})]})]})]}),e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Authentication"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Max Failed Login Attempts"}),e.jsx(t,{type:"number",defaultValue:"5"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Account Lockout Duration"}),e.jsxs("div",{className:s.inputWithUnit,children:[e.jsx(t,{type:"number",defaultValue:"30"}),e.jsx("span",{children:"minutes"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Two-Factor Authentication"}),e.jsx(t,{type:"checkbox"})]})]}),e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"HTTPS Certificate"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Current Certificate"}),e.jsx(t,{type:"text",defaultValue:"CN=ucm.local",readOnly:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Valid Until"}),e.jsx(t,{type:"text",defaultValue:"2025-03-15",readOnly:!0})]}),e.jsx("div",{className:s.formGroup,children:e.jsx(m,{variant:"primary",icon:"ph ph-arrows-clockwise",onClick:U,disabled:o.isPending,children:o.isPending?"Regenerating...":"Regenerate Self-Signed"})})]})]}),a==="backup"&&e.jsxs("div",{className:s.tabPanel,children:[e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Automated Backup"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Enable Automated Backup"}),e.jsx(t,{type:"checkbox",defaultChecked:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Backup Schedule"}),e.jsxs("select",{children:[e.jsx("option",{children:"Daily at 03:00"}),e.jsx("option",{children:"Weekly on Sunday"}),e.jsx("option",{children:"Monthly on 1st"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Backup Retention"}),e.jsxs("div",{className:s.inputWithUnit,children:[e.jsx(t,{type:"number",defaultValue:"30"}),e.jsx("span",{children:"days"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Backup Location"}),e.jsx(t,{type:"text",defaultValue:"/var/backups/ucm/"})]})]}),e.jsxs("div",{className:s.settingsSection,children:[e.jsx("div",{className:s.sectionTitle,children:"Manual Backup"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Last Backup"}),e.jsx(t,{type:"text",defaultValue:"2024-03-15 03:00 UTC",readOnly:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Backup Size"}),e.jsx(t,{type:"text",defaultValue:"245.3 MB",readOnly:!0})]}),e.jsx("div",{className:s.formGroup,children:e.jsx(m,{variant:"primary",icon:"ph ph-download-simple",onClick:G,disabled:x,children:x?"Creating Backup...":"Create Backup Now"})})]})]})]})]})}export{re as Settings,re as default};
