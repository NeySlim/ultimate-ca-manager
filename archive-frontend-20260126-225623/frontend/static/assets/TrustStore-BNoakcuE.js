import{b as g,d as T,z as p,j as e,r as S,B as m,C as b}from"./index-07BoWWAq.js";import{P as A}from"./PageTopBar-DOI4vcQk.js";import{S as R,a as j}from"./StatsGrid-CKqOj6LJ.js";import{D as M}from"./DataTable-KxVBW3v-.js";import{B as c}from"./Badge-BLJ5U_u7.js";import{u as U}from"./useQuery-3EmGCuoQ.js";import{u as w}from"./useMutation-CDuw2KqC.js";import{M as l}from"./Modal-Cni74-1Y.js";const C={getTrustedCerts:async(s={})=>(await g.get("/api/v2/truststore",{params:s})).data,getTrustedCertDetails:async s=>(await g.get(`/api/v2/truststore/${s}`)).data,addTrustedCert:async s=>(await g.post("/api/v2/truststore",s)).data,syncTrustStore:async(s="system")=>(await g.post("/api/v2/truststore/sync",{source:s})).data,removeTrustedCert:async s=>(await g.delete(`/api/v2/truststore/${s}`)).data},h={all:["truststore"],lists:()=>[...h.all,"list"],list:s=>[...h.lists(),s]},I=(s={})=>U({queryKey:h.list(s),queryFn:()=>C.getTrustedCerts(s)}),_=()=>{const s=T();return w({mutationFn:C.addTrustedCert,onSuccess:()=>{s.invalidateQueries({queryKey:h.all}),p.success("Certificate added to trust store")},onError:i=>{p.error(i.response?.data?.message||"Failed to add certificate")}})},W=()=>{const s=T();return w({mutationFn:C.removeTrustedCert,onSuccess:()=>{s.invalidateQueries({queryKey:h.all}),p.success("Certificate removed from trust store")},onError:i=>{p.error(i.response?.data?.message||"Failed to remove certificate")}})},q=()=>{const s=T();return w({mutationFn:C.syncTrustStore,onSuccess:i=>{s.invalidateQueries({queryKey:h.all});const t=i?.data?.synced_count||0;p.success(`Trust store synchronized successfully (${t} certificates)`)},onError:i=>{p.error(i.response?.data?.message||"Failed to sync trust store")}})};function G({isOpen:s,onClose:i,certificate:t}){if(!t)return null;const n=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",d=t.validUntil&&new Date(t.validUntil)<new Date,u=t.validUntil&&new Date(t.validUntil)<new Date(Date.now()+720*60*60*1e3);return e.jsxs(l,{isOpen:s,onClose:i,size:"large",children:[e.jsxs(l.Header,{children:[e.jsx("i",{className:"ph ph-certificate",style:{marginRight:"8px"}}),"Certificate Details"]}),e.jsx(l.Body,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:"var(--text-primary)",marginBottom:"12px"},children:"General Information"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 1fr",gap:"12px"},children:[e.jsx("div",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:"Name:"}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-primary)",fontWeight:500},children:t.name}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:"Subject:"}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-primary)",fontFamily:"JetBrains Mono, monospace"},children:t.subject}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:"Valid Until:"}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-primary)"},children:[n(t.validUntil),d&&e.jsx(c,{variant:"danger",style:{marginLeft:"8px"},children:"Expired"}),!d&&u&&e.jsx(c,{variant:"warning",style:{marginLeft:"8px"},children:"Expiring Soon"})]}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:"Usage:"}),e.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:t.usage?.map((o,a)=>e.jsx(c,{variant:"info",children:o},a))}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:"Auto-Trusted:"}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-primary)"},children:t.autoTrusted?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:"var(--text-primary)",marginBottom:"12px"},children:"Fingerprints"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 1fr",gap:"12px"},children:[e.jsx("div",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:"SHA-256:"}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-primary)",fontFamily:"JetBrains Mono, monospace",wordBreak:"break-all"},children:t.fingerprint})]})]})]})}),e.jsx(l.Footer,{children:e.jsx(l.CloseButton,{onClick:i,children:"Close"})})]})}function V({isOpen:s,onClose:i}){const[t,n]=S.useState({name:"",description:"",certificatePem:"",purpose:"root_ca",notes:""}),d=_(),u=async a=>{if(a.preventDefault(),!t.name||!t.certificatePem){p.error("Name and certificate PEM are required");return}if(!t.certificatePem.includes("BEGIN CERTIFICATE")){p.error("Invalid certificate format. Expected PEM format.");return}d.mutate({name:t.name,description:t.description,certificate_pem:t.certificatePem,purpose:t.purpose,notes:t.notes},{onSuccess:()=>{n({name:"",description:"",certificatePem:"",purpose:"root_ca",notes:""}),i()}})},o=a=>{const y=a.target.files[0];if(y){const f=new FileReader;f.onload=v=>{n({...t,certificatePem:v.target.result})},f.readAsText(y)}};return e.jsxs(l,{isOpen:s,onClose:i,size:"medium",children:[e.jsxs(l.Header,{children:[e.jsx("i",{className:"ph ph-plus",style:{marginRight:"8px"}}),"Add CA to Trust Store"]}),e.jsxs("form",{onSubmit:u,children:[e.jsx(l.Body,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:["Name ",e.jsx("span",{style:{color:"var(--status-danger)"},children:"*"})]}),e.jsx("input",{type:"text",value:t.name,onChange:a=>n({...t,name:a.target.value}),placeholder:"e.g., DigiCert Global Root CA",style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Description"}),e.jsx("input",{type:"text",value:t.description,onChange:a=>n({...t,description:a.target.value}),placeholder:"Brief description",style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Purpose"}),e.jsxs("select",{value:t.purpose,onChange:a=>n({...t,purpose:a.target.value}),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[e.jsx("option",{value:"root_ca",children:"Root CA"}),e.jsx("option",{value:"intermediate_ca",children:"Intermediate CA"}),e.jsx("option",{value:"code_signing",children:"Code Signing"}),e.jsx("option",{value:"email",children:"Email Protection"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:["Certificate (PEM) ",e.jsx("span",{style:{color:"var(--status-danger)"},children:"*"})]}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("input",{type:"file",accept:".pem,.crt,.cer",onChange:o,style:{fontSize:"13px"}})}),e.jsx("textarea",{value:t.certificatePem,onChange:a=>n({...t,certificatePem:a.target.value}),placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,rows:8,style:{width:"100%",padding:"8px 12px",fontSize:"12px",fontFamily:"JetBrains Mono, monospace",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-tertiary)",color:"var(--text-primary)",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"var(--text-primary)",marginBottom:"6px"},children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:a=>n({...t,notes:a.target.value}),placeholder:"Additional notes...",rows:3,style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid var(--border-primary)",borderRadius:"var(--radius)",background:"var(--bg-primary)",color:"var(--text-primary)",resize:"vertical"}})]})]})}),e.jsxs(l.Footer,{children:[e.jsx(l.CloseButton,{onClick:i,disabled:d.isPending,children:"Cancel"}),e.jsx(m,{type:"submit",variant:"primary",icon:"ph ph-plus",disabled:d.isPending,children:d.isPending?"Adding...":"Add to Trust Store"})]})]})]})}const K="_trustStore_16j0j_1",k={trustStore:K};function ee(){const[s,i]=S.useState(null),[t,n]=S.useState(!1),[d,u]=S.useState(!1),{data:o,isLoading:a,error:y}=I(),f=W(),v=q(),B=r=>r?new Date(r).toISOString().split("T")[0]:"N/A",z=(Array.isArray(o)?o:o?.data||[]).map(r=>({id:r.id,name:r.subject?.split(",")[0]?.replace("CN=","")||"Unknown",subject:r.subject||"N/A",fingerprint:r.fingerprint_sha256?.substring(0,20)+"..."||"N/A",validUntil:B(r.valid_until),usage:[r.purpose||"General"],autoTrusted:!1})),E=r=>{confirm(`Remove "${r.name}" from trust store?`)&&f.mutate(r.id)},F=r=>{i(r),n(!0)},D=()=>{confirm("Synchronize trust store with system CA bundle?")&&v.mutate()};if(y)return e.jsxs("div",{className:k.trustStore,children:[e.jsx(A,{icon:"ph ph-shield-check",title:"Trust Store",badge:e.jsx(c,{variant:"danger",children:"Error"})}),e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--color-danger)"},children:["Error loading trust store: ",y.message]})]});const P=[{key:"name",label:"Name",render:r=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",color:"var(--text-primary)",marginBottom:"2px"},children:r.name}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-tertiary)"},children:r.subject})]})},{key:"fingerprint",label:"Fingerprint",render:r=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"11px",color:"var(--text-tertiary)"},children:r.fingerprint})},{key:"validUntil",label:"Valid Until"},{key:"usage",label:"Usage",render:r=>e.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:r.usage.map((x,N)=>e.jsx(c,{variant:"info",children:x},N))})},{key:"autoTrusted",label:"Auto-Trusted",render:r=>r.autoTrusted?e.jsxs(c,{variant:"success",children:[e.jsx("i",{className:"ph ph-check",style:{marginRight:"4px"}}),"Yes"]}):e.jsx("span",{style:{fontSize:"11px",color:"var(--text-tertiary)"},children:"No"})},{key:"actions",label:"Actions",render:r=>e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"flex-end"},children:[e.jsx(m,{variant:"default",size:"sm",icon:"ph ph-eye",onClick:x=>{x.stopPropagation(),F(r)}}),e.jsx(m,{variant:"default",size:"sm",icon:"ph ph-trash",onClick:x=>{x.stopPropagation(),E(r)}})]})}];return e.jsxs("div",{className:k.trustStore,children:[e.jsx(A,{icon:"ph ph-shield-check",title:"Trust Store",badge:e.jsxs(c,{variant:"success",children:[z.length," Trusted CAs"]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:"ph ph-arrows-clockwise",onClick:D,disabled:v.isPending,children:v.isPending?"Syncing...":"Sync Trust Store"}),e.jsx(m,{variant:"primary",icon:"ph ph-plus",onClick:()=>u(!0),children:"Add CA"})]})}),e.jsxs(R,{columns:4,children:[e.jsx(j,{value:"12",label:"Trusted CAs",icon:"ph ph-certificate"}),e.jsx(j,{value:"45",label:"System Trust Store",icon:"ph ph-package"}),e.jsx(j,{value:"2 days ago",label:"Last Updated",icon:"ph ph-clock"}),e.jsx(j,{value:e.jsxs(c,{variant:"success",children:[e.jsx("i",{className:"ph ph-check-circle",style:{marginRight:"4px"}}),"Enabled"]}),label:"Auto-Sync Status",icon:"ph ph-arrows-clockwise"})]}),e.jsxs(b,{children:[e.jsxs(b.Header,{children:[e.jsx("h3",{children:"Trusted Certificate Authorities"}),e.jsx(m,{variant:"default",icon:"ph ph-funnel",children:"Filter"})]}),e.jsx(b.Body,{children:e.jsx(M,{columns:P,data:z,loading:a,onRowClick:r=>console.log("CA clicked:",r),pageSize:10})})]}),e.jsx(G,{isOpen:t,onClose:()=>n(!1),certificate:s}),e.jsx(V,{isOpen:d,onClose:()=>u(!1)})]})}export{ee as TrustStore,ee as default};
