import{d as k,r as d,j as e,B as l,C as a}from"./index-DrUF5BEZ.js";import{P as O}from"./PageTopBar-DhktPPOD.js";import{S as L,T as N}from"./SectionTabs-JWz0gkQV.js";import{I as o}from"./Input-Dg6rpvky.js";import{B as I}from"./Badge-BgGeUewX.js";import{D as R}from"./DataTable-CsyZgeQ4.js";import{M as K}from"./Modal-CSsNUB49.js";import{u as T}from"./useMutation-DdijebKA.js";import{n as D}from"./Check.es-xIY7_8Aa.js";import{c as z}from"./Warning.es-DKSE0o0C.js";import"./with-selector-Yf2-uoA0.js";import"./index-DST8ufLI.js";function U(){return T({mutationFn:async i=>await k.post("/api/v2/import/opnsense/test",i)})}function Q(){return T({mutationFn:async i=>await k.post("/api/v2/import/opnsense/import",i)})}const V="_importPage_19494_1",Y="_tabContent_19494_6",$="_subMethods_19494_12",q="_subMethod_19494_12",X="_active_19494_33",J="_subMethodTitle_19494_49",Z="_form_19494_58",W="_formGroup_19494_64",ee="_formLabel_19494_70",se="_formInput_19494_78",te="_formTextarea_19494_92",ae="_formHelp_19494_131",re="_formCheckbox_19494_136",s={importPage:V,tabContent:Y,subMethods:$,subMethod:q,active:X,subMethodTitle:J,form:Z,formGroup:W,formLabel:ee,formInput:se,formTextarea:te,formHelp:ae,formCheckbox:re};function ue(){const[i,m]=d.useState("ca"),[j,M]=d.useState(0),[u,S]=d.useState(0),[r,h]=d.useState({host:"",port:"443",api_key:"",api_secret:"",verify_ssl:!1}),[x,g]=d.useState([]),[P,A]=d.useState(null),[F,C]=d.useState(!1),[c,f]=d.useState([]),n=U(),b=Q(),w=async()=>{try{const t=await n.mutateAsync(r);t.success&&(g(t.items),A(`${r.host}:${r.port}`),f(t.items.map(p=>p.id)))}catch(t){console.error("Connection test failed:",t)}},B=async()=>{try{(await b.mutateAsync({...r,items:c})).success&&(C(!1),f([]),g([]),A(null))}catch(t){console.error("Import failed:",t)}},H=t=>{f(p=>p.includes(t)?p.filter(y=>y!==t):[...p,t])},G=[{key:"selected",label:"",render:t=>e.jsx("input",{type:"checkbox",checked:c.includes(t.id),onChange:()=>H(t.id)})},{key:"type",label:"Type",render:t=>e.jsx(I,{variant:t.type==="CA"?"info":"success",children:t.type})},{key:"name",label:"Name"},{key:"subject",label:"Subject",render:t=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"12px"},children:t.subject})},{key:"validUntil",label:"Valid Until"}],_=(t,p,y)=>e.jsx("div",{className:s.subMethods,children:t.map((E,v)=>e.jsxs("div",{className:`${s.subMethod} ${p===v?s.active:""}`,onClick:()=>y(v),children:[e.jsx("i",{className:E.icon}),e.jsx("div",{className:s.subMethodTitle,children:E.title})]},v))});return e.jsxs("div",{className:s.importPage,children:[e.jsx(O,{icon:"ph ph-upload",title:"Import",badge:e.jsx(I,{variant:"info",children:"Multiple Formats"}),actions:e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:"ph ph-question",children:"Help"}),e.jsx(l,{variant:"primary",icon:"ph ph-upload-simple",children:"Upload Files"})]})}),e.jsxs(L,{children:[e.jsx(N,{active:i==="ca",onClick:()=>m("ca"),children:"CA Import"}),e.jsx(N,{active:i==="cert",onClick:()=>m("cert"),children:"Certificate Import"}),e.jsx(N,{active:i==="opnsense",onClick:()=>m("opnsense"),children:"OPNsense Import"})]}),i==="ca"&&e.jsxs("div",{className:s.tabContent,children:[_([{icon:"ph ph-clipboard-text",title:"Paste PEM"},{icon:"ph ph-upload",title:"Upload Files"},{icon:"ph ph-package",title:"Container P12/PFX"}],j,M),j===0&&e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"Paste PEM Encoded CA"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"CA Certificate (PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
...
-----END CERTIFICATE-----`}),e.jsx("div",{className:s.formHelp,children:"Paste the PEM-encoded CA certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key (Optional, PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC7VJ...
-----END PRIVATE KEY-----`}),e.jsx("div",{className:s.formHelp,children:"Only required if this CA will issue certificates"})]}),e.jsx(o,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust"}),e.jsx("label",{htmlFor:"ca-trust",children:"Add to Trust Store"})]}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]}),j===1&&e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"Upload CA Files"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"CA Certificate File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt,.cer"}),e.jsx("div",{className:s.formHelp,children:"Upload PEM or DER encoded certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key File (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.key"}),e.jsx("div",{className:s.formHelp,children:"Only required if this CA will issue certificates"})]}),e.jsx(o,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust-upload"}),e.jsx("label",{htmlFor:"ca-trust-upload",children:"Add to Trust Store"})]}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]}),j===2&&e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"Import from P12/PFX Container"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"P12/PFX File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".p12,.pfx"}),e.jsx("div",{className:s.formHelp,children:"PKCS#12 container with CA certificate and private key"})]}),e.jsx(o,{label:"Container Password",type:"password",placeholder:"Enter password"}),e.jsx(o,{label:"CA Name",placeholder:"My Root CA"}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"ca-trust-p12"}),e.jsx("label",{htmlFor:"ca-trust-p12",children:"Add to Trust Store"})]}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import CA"})]})})]})]}),i==="cert"&&e.jsxs("div",{className:s.tabContent,children:[_([{icon:"ph ph-clipboard-text",title:"Paste PEM"},{icon:"ph ph-upload",title:"Upload Files"},{icon:"ph ph-package",title:"Container"}],u,S),u===0&&e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"Paste PEM Encoded Certificate"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate (PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN CERTIFICATE-----
...`})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key (Optional, PEM)"}),e.jsx("textarea",{className:s.formTextarea,placeholder:`-----BEGIN PRIVATE KEY-----
...`})]}),e.jsx(o,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]}),u===1&&e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"Upload Certificate Files"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt,.cer"}),e.jsx("div",{className:s.formHelp,children:"Upload PEM or DER encoded certificate"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Private Key File (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.key"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Certificate Chain (Optional)"}),e.jsx("input",{type:"file",className:s.formInput,accept:".pem,.crt"}),e.jsx("div",{className:s.formHelp,children:"Intermediate certificates"})]}),e.jsx(o,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]}),u===2&&e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"Import from Container"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"P12/PFX File"}),e.jsx("input",{type:"file",className:s.formInput,accept:".p12,.pfx"}),e.jsx("div",{className:s.formHelp,children:"PKCS#12 container with certificate and private key"})]}),e.jsx(o,{label:"Container Password",type:"password",placeholder:"Enter password"}),e.jsx(o,{label:"Certificate Name",placeholder:"server.example.com"}),e.jsx(l,{variant:"primary",icon:"ph ph-download",children:"Import Certificate"})]})})]})]}),i==="opnsense"&&e.jsxs("div",{className:s.tabContent,children:[e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx("h3",{children:"OPNsense Connection"})}),e.jsx(a.Body,{children:e.jsxs("form",{className:s.form,onSubmit:t=>{t.preventDefault(),w()},children:[e.jsx(o,{label:"Host",placeholder:"192.168.1.1",value:r.host,onChange:t=>h({...r,host:t.target.value})}),e.jsx(o,{label:"Port",type:"number",placeholder:"443",value:r.port,onChange:t=>h({...r,port:t.target.value})}),e.jsx(o,{label:"API Key",placeholder:"Enter API key",value:r.api_key,onChange:t=>h({...r,api_key:t.target.value})}),e.jsx(o,{label:"API Secret",type:"password",placeholder:"Enter API secret",value:r.api_secret,onChange:t=>h({...r,api_secret:t.target.value})}),e.jsxs("div",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",id:"verify-ssl",checked:r.verify_ssl,onChange:t=>h({...r,verify_ssl:t.target.checked})}),e.jsx("label",{htmlFor:"verify-ssl",children:"Verify SSL Certificate"})]}),e.jsx(l,{type:"submit",variant:"primary",icon:"ph ph-plug",disabled:n.isPending,children:n.isPending?"Testing...":"Test Connection"}),n.isError&&e.jsxs("div",{style:{color:"var(--status-danger)",fontSize:"13px",marginTop:"8px"},children:[e.jsx(z,{size:16})," ",n.error?.response?.data?.error||"Connection failed"]}),n.isSuccess&&n.data?.success&&e.jsxs("div",{style:{color:"var(--status-success)",fontSize:"13px",marginTop:"8px"},children:[e.jsx(D,{size:16})," Connected! Found ",n.data.stats.cas," CAs and ",n.data.stats.certificates," certificates"]})]})})]}),x.length>0&&e.jsxs(a,{children:[e.jsxs(a.Header,{children:[e.jsx("h3",{children:"Available Items"}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-tertiary)"},children:["Connected to ",P," â€¢ ",c.length," of ",x.length," selected"]})]}),e.jsxs(a.Body,{children:[e.jsx(R,{columns:G,data:x,pageSize:10}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:[e.jsxs(l,{variant:"primary",icon:"ph ph-download-simple",disabled:c.length===0,onClick:()=>C(!0),children:["Import Selected (",c.length,")"]}),e.jsx(l,{onClick:()=>f(x.map(t=>t.id)),children:"Select All"}),e.jsx(l,{onClick:()=>f([]),children:"Deselect All"})]})]})]})]}),e.jsxs(K,{isOpen:F,onClose:()=>C(!1),title:"Confirm Import",footer:e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(l,{variant:"primary",onClick:B,disabled:b.isPending,children:b.isPending?"Importing...":`Import ${c.length} Items`})]}),children:[e.jsxs("p",{children:["You are about to import ",c.length," items from OPNsense (",P,"):"]}),e.jsx("ul",{style:{marginTop:"12px",paddingLeft:"20px"},children:x.filter(t=>c.includes(t.id)).map(t=>e.jsxs("li",{style:{marginBottom:"4px"},children:[e.jsx(I,{variant:t.type==="CA"?"info":"success",children:t.type})," ",t.name]},t.id))}),e.jsx("p",{style:{marginTop:"12px",color:"var(--text-tertiary)",fontSize:"12px"},children:"This action will add these items to your UCM trust store."})]})]})}export{ue as ImportPage,ue as default};
